
function jquery_domChanged(){}!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(C,e){"use strict";function g(e){return null!=e&&e===e.window}var t=[],E=C.document,r=Object.getPrototypeOf,s=t.slice,v=t.concat,u=t.push,i=t.indexOf,n={},o=n.toString,y=n.hasOwnProperty,a=y.toString,l=a.call(Object),m={},x=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||E).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var f="3.4.1",k=function(e,t){return new k.fn.init(e,t)},p=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;function d(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!x(e)&&!g(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}k.fn=k.prototype={jquery:f,constructor:k,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=k.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return k.each(this,e)},map:function(n){return this.pushStack(k.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},k.extend=k.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||x(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(k.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||k.isPlainObject(n)?n:{},i=!1,a[t]=k.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},k.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==o.call(e))&&(!(t=r(e))||"function"==typeof(n=y.call(t,"constructor")&&t.constructor)&&a.call(n)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t){b(e,{nonce:t&&t.nonce})},each:function(e,t){var n,r=0;if(d(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?"":(e+"").replace(p,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(d(Object(e))?k.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!=a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(d(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return v.apply([],a)},guid:1,support:m}),"function"==typeof Symbol&&(k.fn[Symbol.iterator]=t[Symbol.iterator]),k.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var h=function(n){function f(e,t,n){var r="0x"+t-65536;return r!=r||n?t:r<0?String.fromCharCode(65536+r):String.fromCharCode(r>>10|55296,1023&r|56320)}function i(){T()}var e,d,b,o,a,h,p,g,w,u,l,T,C,s,E,v,c,y,m,k="sizzle"+ +new Date,x=n.document,S=0,r=0,N=ue(),A=ue(),D=ue(),j=ue(),q=function(e,t){return e===t&&(l=!0),0},L={}.hasOwnProperty,t=[],H=t.pop,O=t.push,P=t.push,R=t.slice,M=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},I="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",W="[\\x20\\t\\r\\n\\f]",$="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",F="\\["+W+"*("+$+")(?:"+W+"*([*^$|!~]?=)"+W+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+$+"))|)"+W+"*\\]",B=":("+$+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+F+")*)|.*)\\)|)",_=new RegExp(W+"+","g"),z=new RegExp("^"+W+"+|((?:^|[^\\\\])(?:\\\\.)*)"+W+"+$","g"),U=new RegExp("^"+W+"*,"+W+"*"),X=new RegExp("^"+W+"*([>+~]|"+W+")"+W+"*"),V=new RegExp(W+"|>"),G=new RegExp(B),Y=new RegExp("^"+$+"$"),Q={ID:new RegExp("^#("+$+")"),CLASS:new RegExp("^\\.("+$+")"),TAG:new RegExp("^("+$+"|[*])"),ATTR:new RegExp("^"+F),PSEUDO:new RegExp("^"+B),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+W+"*(even|odd|(([+-]|)(\\d*)n|)"+W+"*(?:([+-]|)"+W+"*(\\d+)|))"+W+"*\\)|)","i"),bool:new RegExp("^(?:"+I+")$","i"),needsContext:new RegExp("^"+W+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+W+"*((?:-\\d)?\\d*)"+W+"*\\)|)(?=[^-]|$)","i")},J=/HTML$/i,K=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,ee=/^[^{]+\{\s*\[native \w/,te=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ne=/[+~]/,re=new RegExp("\\\\([\\da-f]{1,6}"+W+"?|("+W+")|.)","ig"),ie=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,oe=function(e,t){return t?"\0"===e?"ï¿½":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},ae=me(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{P.apply(t=R.call(x.childNodes),x.childNodes),t[x.childNodes.length].nodeType}catch(e){P={apply:t.length?function(e,t){O.apply(e,R.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&((e?e.ownerDocument||e:x)!==C&&T(e),e=e||C,E)){if(11!==p&&(u=te.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&m(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return P.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return P.apply(n,e.getElementsByClassName(i)),n}if(d.qsa&&!j[t+" "]&&(!v||!v.test(t))&&(1!==p||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&V.test(t)){for((s=e.getAttribute("id"))?s=s.replace(ie,oe):e.setAttribute("id",s=k),o=(l=h(t)).length;o--;)l[o]="#"+s+" "+ye(l[o]);c=l.join(","),f=ne.test(t)&&ge(e.parentNode)||e}try{return P.apply(n,f.querySelectorAll(c)),n}catch(e){j(t,!0)}finally{s===k&&e.removeAttribute("id")}}}return g(t.replace(z,"$1"),e,n,r)}function ue(){var n=[];function r(e,t){return n.push(e+" ")>b.cacheLength&&delete r[n.shift()],r[e+" "]=t}return r}function le(e){return e[k]=!0,e}function ce(e){var t=C.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){for(var n=e.split("|"),r=n.length;r--;)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function de(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function he(a){return le(function(o){return o=+o,le(function(e,t){for(var n,r=a([],e.length,o),i=r.length;i--;)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ge(e){return e&&void 0!==e.getElementsByTagName&&e}for(e in d=se.support={},a=se.isXML=function(e){var t=e.namespaceURI,n=(e.ownerDocument||e).documentElement;return!J.test(t||n&&n.nodeName||"HTML")},T=se.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:x;return r!==C&&9===r.nodeType&&r.documentElement&&(s=(C=r).documentElement,E=!a(C),x!==C&&(n=C.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",i,!1):n.attachEvent&&n.attachEvent("onunload",i)),d.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment("")),!e.getElementsByTagName("*").length}),d.getElementsByClassName=ee.test(C.getElementsByClassName),d.getById=ce(function(e){return s.appendChild(e).id=k,!C.getElementsByName||!C.getElementsByName(k).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(re,f);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if(void 0!==t.getElementById&&E){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(re,f);return function(e){var t=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if(void 0!==t.getElementById&&E){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];for(i=t.getElementsByName(e),r=0;o=i[r++];)if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"!==e)return o;for(;n=o[i++];)1===n.nodeType&&r.push(n);return r},b.find.CLASS=d.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&E)return t.getElementsByClassName(e)},c=[],v=[],(d.qsa=ee.test(C.querySelectorAll))&&(ce(function(e){s.appendChild(e).innerHTML="<a id='"+k+"'></a><select id='"+k+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+W+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+W+"*(?:value|"+I+")"),e.querySelectorAll("[id~="+k+"-]").length||v.push("~="),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+k+"+*").length||v.push(".#.+[+~]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=C.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+W+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),s.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(d.matchesSelector=ee.test(y=s.matches||s.webkitMatchesSelector||s.mozMatchesSelector||s.oMatchesSelector||s.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=y.call(e,"*"),y.call(e,"[s!='']:x"),c.push("!=",B)}),v=v.length&&new RegExp(v.join("|")),c=c.length&&new RegExp(c.join("|")),t=ee.test(s.compareDocumentPosition),m=t||ee.test(s.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},q=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e===C||e.ownerDocument===x&&m(x,e)?-1:t===C||t.ownerDocument===x&&m(x,t)?1:u?M(u,e)-M(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e===C?-1:t===C?1:i?-1:o?1:u?M(u,e)-M(u,t):0;if(i===o)return pe(e,t);for(n=e;n=n.parentNode;)a.unshift(n);for(n=t;n=n.parentNode;)s.unshift(n);for(;a[r]===s[r];)r++;return r?pe(a[r],s[r]):a[r]===x?-1:s[r]===x?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if((e.ownerDocument||e)!==C&&T(e),d.matchesSelector&&E&&!j[t+" "]&&(!c||!c.test(t))&&(!v||!v.test(t)))try{var n=y.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){j(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!==C&&T(e),m(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!==C&&T(e);var n=b.attrHandle[t.toLowerCase()],r=n&&L.call(b.attrHandle,t.toLowerCase())?n(e,t,!E):void 0;return void 0!==r?r:d.attributes||!E?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(ie,oe)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(q),l){for(;t=e[i++];)t===e[i]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r++];)n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:Q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(re,f),e[3]=(e[3]||e[4]||e[5]||"").replace(re,f),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return Q.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&G.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(re,f).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=N[e+" "];return t||(t=new RegExp("(^|"+W+")"+e+"("+W+"|$)"))&&N(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=se.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(_," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,v){var y="nth"!==h.slice(0,3),m="last"!==h.slice(-4),x="of-type"===e;return 1===g&&0===v?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=y!=m?"nextSibling":"previousSibling",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(y){for(;l;){for(a=e;a=a[l];)if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){for(d=(s=(r=(i=(o=(a=c)[k]||(a[k]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===S&&r[1])&&r[2],a=s&&c.childNodes[s];a=++s&&a&&a[l]||(d=s=0)||u.pop();)if(1===a.nodeType&&++d&&a===e){i[h]=[S,s,d];break}}else if(p&&(d=s=(r=(i=(o=(a=e)[k]||(a[k]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===S&&r[1]),!1===d)for(;(a=++s&&a&&a[l]||(d=s=0)||u.pop())&&((x?a.nodeName.toLowerCase()!==f:1!==a.nodeType)||!++d||(p&&((i=(o=a[k]||(a[k]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[S,d]),a!==e)););return(d-=v)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[k]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){for(var n,r=a(e,o),i=r.length;i--;)e[n=M(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=p(e.replace(z,"$1"));return s[k]?le(function(e,t,n,r){for(var i,o=s(e,null,r,[]),a=e.length;a--;)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(re,f),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return Y.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(re,f).toLowerCase(),function(e){var t;do{if(t=E?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===s},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:de(!1),disabled:de(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return Z.test(e.nodeName)},input:function(e){return K.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:he(function(){return[0]}),last:he(function(e,t){return[t-1]}),eq:he(function(e,t,n){return[n<0?n+t:n]}),even:he(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:he(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:he(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:he(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=function(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=function(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}(e);function ve(){}function ye(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function me(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,p=r++;return e.first?function(e,t,n){for(;e=e[u];)if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var r,i,o,a=[S,p];if(n){for(;e=e[u];)if((1===e.nodeType||f)&&s(e,t,n))return!0}else for(;e=e[u];)if(1===e.nodeType||f)if(i=(o=e[k]||(e[k]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===S&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function xe(i){return 1<i.length?function(e,t,n){for(var r=i.length;r--;)if(!i[r](e,t,n))return!1;return!0}:i[0]}function be(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function we(d,h,g,v,y,e){return v&&!v[k]&&(v=we(v)),y&&!y[k]&&(y=we(y,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:be(c,s,d,n,r),p=g?y||(e?d:l||v)?[]:t:f;if(g&&g(f,p,n,r),v)for(i=be(p,u),v(i,[],n,r),o=i.length;o--;)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a));if(e){if(y||d){if(y){for(i=[],o=p.length;o--;)(a=p[o])&&i.push(f[o]=a);y(null,p=[],i,r)}for(o=p.length;o--;)(a=p[o])&&-1<(i=y?M(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=be(p===t?p.splice(l,p.length):p),y?y(null,t,p,r):P.apply(t,p)})}function Te(v,y){function e(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=S+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t===C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){for(a=0,t||o.ownerDocument===C||(T(o),n=!E);s=v[a++];)if(s(o,t||C,n)){r.push(o);break}i&&(S=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){for(a=0;s=y[a++];)s(c,f,t,n);if(e){if(0<u)for(;l--;)c[l]||f[l]||(f[l]=H.call(r));f=be(f)}P.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&se.uniqueSort(r)}return i&&(S=h,w=p),c}var m=0<y.length,x=0<v.length;return m?le(e):e}return ve.prototype=b.filters=b.pseudos,b.setFilters=new ve,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=A[e+" "];if(l)return t?0:l.slice(0);for(a=e,s=[],u=b.preFilter;a;){for(o in n&&!(r=U.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=X.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace(z," ")}),a=a.slice(n.length)),b.filter)!(r=Q[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):A(e,s).slice(0)},p=se.compile=function(e,t){var n,r=[],i=[],o=D[e+" "];if(!o){for(n=(t=t||h(e)).length;n--;)(o=function e(t){for(var i,n,r,o=t.length,a=b.relative[t[0].type],s=a||b.relative[" "],u=a?1:0,l=me(function(e){return e===i},s,!0),c=me(function(e){return-1<M(i,e)},s,!0),f=[function(e,t,n){var r=!a&&(n||t!==w)||((i=t).nodeType?l:c)(e,t,n);return i=null,r}];u<o;u++)if(n=b.relative[t[u].type])f=[me(xe(f),n)];else{if((n=b.filter[t[u].type].apply(null,t[u].matches))[k]){for(r=++u;r<o&&!b.relative[t[r].type];r++);return we(1<u&&xe(f),1<u&&ye(t.slice(0,u-1).concat({value:" "===t[u-2].type?"*":""})).replace(z,"$1"),n,u<r&&e(t.slice(u,r)),r<o&&e(t=t.slice(r)),r<o&&ye(t))}f.push(n)}return xe(f)}(t[n]))[k]?r.push(o):i.push(o);(o=D(e,Te(i,r))).selector=e}return o},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&E&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(re,f),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(i=Q.needsContext.test(e)?0:o.length;i--&&(a=o[i],!b.relative[s=a.type]);)if((u=b.find[s])&&(r=u(a.matches[0].replace(re,f),ne.test(o[0].type)&&ge(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&ye(o)))return P.apply(n,r),n;break}}return(l||p(e,c))(r,t,!E,n,!t||ne.test(e)&&ge(t.parentNode)||t),n},d.sortStable=k.split("").sort(q).join("")===k,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(I,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(C);k.find=h,k.expr=h.selectors,k.expr[":"]=k.expr.pseudos,k.uniqueSort=k.unique=h.uniqueSort,k.text=h.getText,k.isXMLDoc=h.isXML,k.contains=h.contains,k.escapeSelector=h.escape;function T(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&k(e).is(n))break;r.push(e)}return r}function S(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}var N=k.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var D=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,n,r){return x(n)?k.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?k.grep(e,function(e){return e===n!==r}):"string"!=typeof n?k.grep(e,function(e){return-1<i.call(n,e)!==r}):k.filter(n,e,r)}k.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?k.find.matchesSelector(r,e)?[r]:[]:k.find.matches(e,k.grep(t,function(e){return 1===e.nodeType}))},k.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(k(e).filter(function(){for(t=0;t<r;t++)if(k.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)k.find(e,i[t],n);return 1<r?k.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&N.test(e)?k(e):e||[],!1).length}});var q,L=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(k.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||q,"string"!=typeof e)return e.nodeType?(this[0]=e,this.length=1,this):x(e)?void 0!==n.ready?n.ready(e):e(k):k.makeArray(e,this);if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:L.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof k?t[0]:t,k.merge(this,k.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:E,!0)),D.test(r[1])&&k.isPlainObject(t))for(r in t)x(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=E.getElementById(r[2]))&&(this[0]=i,this.length=1),this}).prototype=k.fn,q=k(E);var H=/^(?:parents|prev(?:Until|All))/,O={children:!0,contents:!0,next:!0,prev:!0};function P(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}k.fn.extend({has:function(e){var t=k(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(k.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&k(e);if(!N.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&k.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?k.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(k(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(k.uniqueSort(k.merge(this.get(),k(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),k.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return T(e,"parentNode")},parentsUntil:function(e,t,n){return T(e,"parentNode",n)},next:function(e){return P(e,"nextSibling")},prev:function(e){return P(e,"previousSibling")},nextAll:function(e){return T(e,"nextSibling")},prevAll:function(e){return T(e,"previousSibling")},nextUntil:function(e,t,n){return T(e,"nextSibling",n)},prevUntil:function(e,t,n){return T(e,"previousSibling",n)},siblings:function(e){return S((e.parentNode||{}).firstChild,e)},children:function(e){return S(e.firstChild)},contents:function(e){return void 0!==e.contentDocument?e.contentDocument:(A(e,"template")&&(e=e.content||e),k.merge([],e.childNodes))}},function(r,i){k.fn[r]=function(e,t){var n=k.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=k.filter(t,n)),1<this.length&&(O[r]||k.uniqueSort(n),H.test(r)&&n.reverse()),this.pushStack(n)}});var R=/[^\x20\t\r\n\f]+/g;function M(e){return e}function I(e){throw e}function W(e,t,n,r){var i;try{e&&x(i=e.promise)?i.call(e).done(t).fail(n):e&&x(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}k.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},k.each(e.match(R)||[],function(e,t){n[t]=!0}),n):k.extend({},r);function i(){for(s=s||r.once,a=o=!0;l.length;c=-1)for(t=l.shift();++c<u.length;)!1===u[c].apply(t[0],t[1])&&r.stopOnFalse&&(c=u.length,t=!1);r.memory||(t=!1),o=!1,s&&(u=t?[]:"")}var o,t,a,s,u=[],l=[],c=-1,f={add:function(){return u&&(t&&!o&&(c=u.length-1,l.push(t)),function n(e){k.each(e,function(e,t){x(t)?r.unique&&f.has(t)||u.push(t):t&&t.length&&"string"!==w(t)&&n(t)})}(arguments),t&&!o&&i()),this},remove:function(){return k.each(arguments,function(e,t){for(var n;-1<(n=k.inArray(t,u,n));)u.splice(n,1),n<=c&&c--}),this},has:function(e){return e?-1<k.inArray(e,u):0<u.length},empty:function(){return u=u&&[],this},disable:function(){return s=l=[],u=t="",this},disabled:function(){return!u},lock:function(){return s=l=[],t||o||(u=t=""),this},locked:function(){return!!s},fireWith:function(e,t){return s||(t=[e,(t=t||[]).slice?t.slice():t],l.push(t),o||i()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!a}};return f},k.extend({Deferred:function(e){var o=[["notify","progress",k.Callbacks("memory"),k.Callbacks("memory"),2],["resolve","done",k.Callbacks("once memory"),k.Callbacks("once memory"),0,"resolved"],["reject","fail",k.Callbacks("once memory"),k.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},catch:function(e){return a.then(null,e)},pipe:function(){var i=arguments;return k.Deferred(function(r){k.each(o,function(e,t){var n=x(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&x(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){function e(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,x(t)?s?t.call(e,l(u,o,M,s),l(u,o,I,s)):(u++,t.call(e,l(u,o,M,s),l(u,o,I,s),l(u,o,M,o.notifyWith))):(a!==M&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}}var n=this,r=arguments,t=s?e:function(){try{e()}catch(e){k.Deferred.exceptionHook&&k.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==I&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(k.Deferred.getStackHook&&(t.stackTrace=k.Deferred.getStackHook()),C.setTimeout(t))}}return k.Deferred(function(e){o[0][3].add(l(0,e,x(r)?r:M,e.notifyWith)),o[1][3].add(l(0,e,x(t)?t:M)),o[2][3].add(l(0,e,x(n)?n:I))}).promise()},promise:function(e){return null!=e?k.extend(e,a):a}},s={};return k.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){function t(t){return function(e){i[t]=this,o[t]=1<arguments.length?s.call(arguments):e,--n||a.resolveWith(i,o)}}var n=arguments.length,r=n,i=Array(r),o=s.call(arguments),a=k.Deferred();if(n<=1&&(W(e,a.done(t(r)).resolve,a.reject,!n),"pending"===a.state()||x(o[r]&&o[r].then)))return a.then();for(;r--;)W(o[r],t(r),a.reject);return a.promise()}});var $=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;k.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&$.test(e.name)&&C.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},k.readyException=function(e){C.setTimeout(function(){throw e})};var F=k.Deferred();function B(){E.removeEventListener("DOMContentLoaded",B),C.removeEventListener("load",B),k.ready()}k.fn.ready=function(e){return F.then(e).catch(function(e){k.readyException(e)}),this},k.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--k.readyWait:k.isReady)||(k.isReady=!0)!==e&&0<--k.readyWait||F.resolveWith(E,[k])}}),k.ready.then=F.then,"complete"===E.readyState||"loading"!==E.readyState&&!E.documentElement.doScroll?C.setTimeout(k.ready):(E.addEventListener("DOMContentLoaded",B),C.addEventListener("load",B));var _=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===w(n))for(s in i=!0,n)_(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,x(r)||(a=!0),l&&(t=a?(t.call(e,r),null):(l=t,function(e,t,n){return l.call(k(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},z=/^-ms-/,U=/-([a-z])/g;function X(e,t){return t.toUpperCase()}function V(e){return e.replace(z,"ms-").replace(U,X)}function G(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType}function Y(){this.expando=k.expando+Y.uid++}Y.uid=1,Y.prototype={cache:function(e){var t=e[this.expando];return t||(t={},G(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[V(t)]=n;else for(r in t)i[V(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][V(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(V):(t=V(t))in r?[t]:t.match(R)||[]).length;for(;n--;)delete r[t[n]]}void 0!==t&&!k.isEmptyObject(r)||(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!k.isEmptyObject(t)}};var Q=new Y,J=new Y,K=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Z=/[A-Z]/g;function ee(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(Z,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:K.test(i)?JSON.parse(i):i)}catch(e){}J.set(e,t,n)}else n=void 0;return n}k.extend({hasData:function(e){return J.hasData(e)||Q.hasData(e)},data:function(e,t,n){return J.access(e,t,n)},removeData:function(e,t){J.remove(e,t)},_data:function(e,t,n){return Q.access(e,t,n)},_removeData:function(e,t){Q.remove(e,t)}}),k.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0!==n)return"object"==typeof n?this.each(function(){J.set(this,n)}):_(this,function(e){var t;return o&&void 0===e?void 0!==(t=J.get(o,n))||void 0!==(t=ee(o,n))?t:void 0:void this.each(function(){J.set(this,n,e)})},null,e,1<arguments.length,null,!0);if(this.length&&(i=J.get(o),1===o.nodeType&&!Q.get(o,"hasDataAttrs"))){for(t=a.length;t--;)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=V(r.slice(5)),ee(o,r,i[r]));Q.set(o,"hasDataAttrs",!0)}return i},removeData:function(e){return this.each(function(){J.remove(this,e)})}}),k.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Q.get(e,t),n&&(!r||Array.isArray(n)?r=Q.access(e,t,k.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=k.queue(e,t),r=n.length,i=n.shift(),o=k._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){k.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Q.get(e,n)||Q.access(e,n,{empty:k.Callbacks("once memory").add(function(){Q.remove(e,[t+"queue",n])})})}}),k.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?k.queue(this[0],t):void 0===n?this:this.each(function(){var e=k.queue(this,t,n);k._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&k.dequeue(this,t)})},dequeue:function(e){return this.each(function(){k.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){function n(){--i||o.resolveWith(a,[a])}var r,i=1,o=k.Deferred(),a=this,s=this.length;for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)(r=Q.get(a[s],e+"queueHooks"))&&r.empty&&(i++,r.empty.add(n));return n(),o.promise(t)}});var te=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ne=new RegExp("^(?:([+-])=|)("+te+")([a-z%]*)$","i"),re=["Top","Right","Bottom","Left"],ie=E.documentElement,oe=function(e){return k.contains(e.ownerDocument,e)},ae={composed:!0};ie.getRootNode&&(oe=function(e){return k.contains(e.ownerDocument,e)||e.getRootNode(ae)===e.ownerDocument});function se(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];for(o in i=n.apply(e,r||[]),t)e.style[o]=a[o];return i}var ue=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&oe(e)&&"none"===k.css(e,"display")};function le(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return k.css(e,t,"")},u=s(),l=n&&n[3]||(k.cssNumber[t]?"":"px"),c=e.nodeType&&(k.cssNumber[t]||"px"!==l&&+u)&&ne.exec(k.css(e,t));if(c&&c[3]!==l){for(u/=2,l=l||c[3],c=+u||1;a--;)k.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,k.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ce={};function fe(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=Q.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ue(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ce[s])||(o=a.body.appendChild(a.createElement(s)),u=k.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ce[s]=u)))):"none"!==n&&(l[c]="none",Q.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}k.fn.extend({show:function(){return fe(this,!0)},hide:function(){return fe(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ue(this)?k(this).show():k(this).hide()})}});var pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i,ge={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ve(e,t){var n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&A(e,t)?k.merge([e],n):n}function ye(e,t){for(var n=0,r=e.length;n<r;n++)Q.set(e[n],"globalEval",!t||Q.get(t[n],"globalEval"))}ge.optgroup=ge.option,ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td;var me,xe,be=/<|&#?\w+;/;function we(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===w(o))k.merge(p,o.nodeType?[o]:o);else if(be.test(o)){for(a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+k.htmlPrefilter(o)+u[2],c=u[0];c--;)a=a.lastChild;k.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));for(f.textContent="",d=0;o=p[d++];)if(r&&-1<k.inArray(o,r))i&&i.push(o);else if(l=oe(o),a=ve(f.appendChild(o),"script"),l&&ye(a),n)for(c=0;o=a[c++];)he.test(o.type||"")&&n.push(o);return f}me=E.createDocumentFragment().appendChild(E.createElement("div")),(xe=E.createElement("input")).setAttribute("type","radio"),xe.setAttribute("checked","checked"),xe.setAttribute("name","t"),me.appendChild(xe),m.checkClone=me.cloneNode(!0).cloneNode(!0).lastChild.checked,me.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!me.cloneNode(!0).lastChild.defaultValue;var Te=/^key/,Ce=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ee=/^([^.]*)(?:\.(.+)|)/;function ke(){return!0}function Se(){return!1}function Ne(e,t){return e===function(){try{return E.activeElement}catch(e){}}()==("focus"===t)}function Ae(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Ae(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Se;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return k().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=k.guid++)),e.each(function(){k.event.add(this,t,i,r,n)})}function De(e,i,o){o?(Q.set(e,i,!1),k.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Q.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(k.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Q.set(this,i,r),t=o(this,i),this[i](),r!==(n=Q.get(this,i))||t?Q.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n.value}else r.length&&(Q.set(this,i,{value:k.event.trigger(k.extend(r[0],k.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Q.get(e,i)&&k.event.add(e,i,ke)}k.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Q.get(t);if(v)for(n.handler&&(n=(o=n).handler,i=o.selector),i&&k.find.matchesSelector(ie,i),n.guid||(n.guid=k.guid++),(u=v.events)||(u=v.events={}),(a=v.handle)||(a=v.handle=function(e){return void 0!==k&&k.event.triggered!==e.type?k.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(R)||[""]).length;l--;)d=g=(s=Ee.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=k.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=k.event.special[d]||{},c=k.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&k.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),k.event.global[d]=!0)},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Q.hasData(e)&&Q.get(e);if(v&&(u=v.events)){for(l=(t=(t||"").match(R)||[""]).length;l--;)if(d=g=(s=Ee.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){for(f=k.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;o--;)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||k.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)k.event.remove(e,d+t[l],n,r,!0);k.isEmptyObject(u)&&Q.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=k.event.fix(e),u=new Array(arguments.length),l=(Q.get(this,"events")||{})[s.type]||[],c=k.event.special[s.type]||{};for(u[0]=s,t=1;t<arguments.length;t++)u[t]=arguments[t];if(s.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,s)){for(a=k.event.handlers.call(this,s,l),t=0;(i=a[t++])&&!s.isPropagationStopped();)for(s.currentTarget=i.elem,n=0;(o=i.handlers[n++])&&!s.isImmediatePropagationStopped();)s.rnamespace&&!1!==o.namespace&&!s.rnamespace.test(o.namespace)||(s.handleObj=o,s.data=o.data,void 0!==(r=((k.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,u))&&!1===(s.result=r)&&(s.preventDefault(),s.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,s),s.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<k(i,this).index(l):k.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(k.Event.prototype,t,{enumerable:!0,configurable:!0,get:x(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[k.expando]?e:new k.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&De(t,"click",ke),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&De(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&A(t,"input")&&Q.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},k.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},k.Event=function(e,t){if(!(this instanceof k.Event))return new k.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?ke:Se,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&k.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[k.expando]=!0},k.Event.prototype={constructor:k.Event,isDefaultPrevented:Se,isPropagationStopped:Se,isImmediatePropagationStopped:Se,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=ke,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=ke,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=ke,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},k.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&Te.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Ce.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},k.event.addProp),k.each({focus:"focusin",blur:"focusout"},function(e,t){k.event.special[e]={setup:function(){return De(this,e,Ne),!1},trigger:function(){return De(this,e),!0},delegateType:t}}),k.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){k.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||k.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),k.fn.extend({on:function(e,t,n,r){return Ae(this,e,t,n,r)},one:function(e,t,n,r){return Ae(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,k(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"!=typeof e)return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Se),this.each(function(){k.event.remove(this,e,n,t)});for(i in e)this.off(i,t,e[i]);return this}});var je=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,qe=/<script|<style|<link/i,Le=/checked\s*(?:[^=]|=\s*.checked.)/i,He=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Oe(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&k(e).children("tbody")[0]||e}function Pe(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Re(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Me(e,t){var n,r,i,o,a,s,u,l;if(1===t.nodeType){if(Q.hasData(e)&&(o=Q.access(e),a=Q.set(t,o),l=o.events))for(i in delete a.handle,a.events={},l)for(n=0,r=l[i].length;n<r;n++)k.event.add(t,i,l[i][n]);J.hasData(e)&&(s=J.access(e),u=k.extend({},s),J.set(t,u))}}function Ie(n,r,i,o){r=v.apply([],r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=x(d);if(h||1<f&&"string"==typeof d&&!m.checkClone&&Le.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),Ie(t,r,i,o),jquery_domChanged()});if(f&&(t=(e=we(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=k.map(ve(e,"script"),Pe)).length;c<f;c++)u=e,c!==p&&(u=k.clone(u,!0,!0),s&&k.merge(a,ve(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,k.map(a,Re),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!Q.access(u,"globalEval")&&k.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?k._evalUrl&&!u.noModule&&k._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")}):b(u.textContent.replace(He,""),u,l))}return jquery_domChanged(),n}function We(e,t,n){for(var r,i=t?k.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||k.cleanData(ve(r)),r.parentNode&&(n&&oe(r)&&ye(ve(r,"script")),r.parentNode.removeChild(r));return e}k.extend({htmlPrefilter:function(e){return e.replace(je,"<$1></$2>")},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=oe(e);if(!(m.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||k.isXMLDoc(e)))for(a=ve(c),r=0,i=(o=ve(e)).length;r<i;r++)s=o[r],u=a[r],"input"===(l=u.nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ve(e),a=a||ve(c),r=0,i=o.length;r<i;r++)Me(o[r],a[r]);else Me(e,c);return 0<(a=ve(c,"script")).length&&ye(a,!f&&ve(e,"script")),c},cleanData:function(e){for(var t,n,r,i=k.event.special,o=0;void 0!==(n=e[o]);o++)if(G(n)){if(t=n[Q.expando]){if(t.events)for(r in t.events)i[r]?k.event.remove(n,r):k.removeEvent(n,r,t.handle);n[Q.expando]=void 0}n[J.expando]&&(n[J.expando]=void 0)}}}),k.fn.extend({detach:function(e){return We(this,e,!0)},remove:function(e){return We(this,e)},text:function(e){return _(this,function(e){return void 0===e?k.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Ie(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Oe(this,e).appendChild(e)})},prepend:function(){return Ie(this,arguments,function(e){var t;1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(t=Oe(this,e)).insertBefore(e,t.firstChild)})},before:function(){return Ie(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Ie(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(k.cleanData(ve(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return k.clone(this,e,t)})},html:function(e){return _(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!qe.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=k.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(k.cleanData(ve(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return Ie(this,arguments,function(e){var t=this.parentNode;k.inArray(this,n)<0&&(k.cleanData(ve(this)),t&&t.replaceChild(e,this))},n)}}),k.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){k.fn[e]=function(e){for(var t,n=[],r=k(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),k(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var $e,Fe,Be,_e,ze,Ue,Xe,Ve=new RegExp("^("+te+")(?!px)[a-z%]+$","i"),Ge=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=C),t.getComputedStyle(e)},Ye=new RegExp(re.join("|"),"i");function Qe(){var e;Xe&&(Ue.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",Xe.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ie.appendChild(Ue).appendChild(Xe),e=C.getComputedStyle(Xe),$e="1%"!==e.top,ze=12===Je(e.marginLeft),Xe.style.right="60%",_e=36===Je(e.right),Fe=36===Je(e.width),Xe.style.position="absolute",Be=12===Je(Xe.offsetWidth/3),ie.removeChild(Ue),Xe=null)}function Je(e){return Math.round(parseFloat(e))}function Ke(e,t,n){var r,i,o,a,s=e.style;return(n=n||Ge(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||oe(e)||(a=k.style(e,t)),!m.pixelBoxStyles()&&Ve.test(a)&&Ye.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function Ze(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}Ue=E.createElement("div"),(Xe=E.createElement("div")).style&&(Xe.style.backgroundClip="content-box",Xe.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===Xe.style.backgroundClip,k.extend(m,{boxSizingReliable:function(){return Qe(),Fe},pixelBoxStyles:function(){return Qe(),_e},pixelPosition:function(){return Qe(),$e},reliableMarginLeft:function(){return Qe(),ze},scrollboxSize:function(){return Qe(),Be}}));var et=["Webkit","Moz","ms"],tt=E.createElement("div").style,nt={};function rt(e){var t=k.cssProps[e]||nt[e];return t||(e in tt?e:nt[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=et.length;n--;)if((e=et[n]+t)in tt)return e}(e)||e)}var it=/^(none|table(?!-c[ea]).+)/,ot=/^--/,at={position:"absolute",visibility:"hidden",display:"block"},st={letterSpacing:"0",fontWeight:"400"};function ut(e,t,n){var r=ne.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function lt(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=k.css(e,n+re[a],!0,i)),r?("content"===n&&(u-=k.css(e,"padding"+re[a],!0,i)),"margin"!==n&&(u-=k.css(e,"border"+re[a]+"Width",!0,i))):(u+=k.css(e,"padding"+re[a],!0,i),"padding"!==n?u+=k.css(e,"border"+re[a]+"Width",!0,i):s+=k.css(e,"border"+re[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function ct(e,t,n){var r=Ge(e),i=(!m.boxSizingReliable()||n)&&"border-box"===k.css(e,"boxSizing",!1,r),o=i,a=Ke(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Ve.test(a)){if(!n)return a;a="auto"}return(!m.boxSizingReliable()&&i||"auto"===a||!parseFloat(a)&&"inline"===k.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===k.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+lt(e,t,n||(i?"border":"content"),o,r,a)+"px"}function ft(e,t,n,r,i){return new ft.prototype.init(e,t,n,r,i)}k.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Ke(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=V(t),u=ot.test(t),l=e.style;if(u||(t=rt(s)),a=k.cssHooks[t]||k.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=ne.exec(n))&&i[1]&&(n=le(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(k.cssNumber[s]?"":"px")),m.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=V(t);return ot.test(t)||(t=rt(s)),(a=k.cssHooks[t]||k.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Ke(e,t,r)),"normal"===i&&t in st&&(i=st[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),k.each(["height","width"],function(e,u){k.cssHooks[u]={get:function(e,t,n){if(t)return!it.test(k.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?ct(e,u,n):se(e,at,function(){return ct(e,u,n)})},set:function(e,t,n){var r,i=Ge(e),o=!m.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===k.css(e,"boxSizing",!1,i),s=n?lt(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-lt(e,u,"border",!1,i)-.5)),s&&(r=ne.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=k.css(e,u)),ut(0,t,s)}}}),k.cssHooks.marginLeft=Ze(m.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Ke(e,"marginLeft"))||e.getBoundingClientRect().left-se(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),k.each({margin:"",padding:"",border:"Width"},function(i,o){k.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+re[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(k.cssHooks[i+o].set=ut)}),k.fn.extend({css:function(e,t){return _(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Ge(e),i=t.length;a<i;a++)o[t[a]]=k.css(e,t[a],!1,r);return o}return void 0!==n?k.style(e,t,n):k.css(e,t)},e,t,1<arguments.length)}}),(k.Tween=ft).prototype={constructor:ft,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||k.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(k.cssNumber[n]?"":"px")},cur:function(){var e=ft.propHooks[this.prop];return e&&e.get?e.get(this):ft.propHooks._default.get(this)},run:function(e){var t,n=ft.propHooks[this.prop];return this.options.duration?this.pos=t=k.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):ft.propHooks._default.set(this),this}},ft.prototype.init.prototype=ft.prototype,ft.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=k.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){k.fx.step[e.prop]?k.fx.step[e.prop](e):1!==e.elem.nodeType||!k.cssHooks[e.prop]&&null==e.elem.style[rt(e.prop)]?e.elem[e.prop]=e.now:k.style(e.elem,e.prop,e.now+e.unit)}}},ft.propHooks.scrollTop=ft.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},k.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},k.fx=ft.prototype.init,k.fx.step={};var pt,dt,ht,gt,vt=/^(?:toggle|show|hide)$/,yt=/queueHooks$/;function mt(){dt&&(!1===E.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(mt):C.setTimeout(mt,k.fx.interval),k.fx.tick())}function xt(){return C.setTimeout(function(){pt=void 0}),pt=Date.now()}function bt(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=re[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function wt(e,t,n){for(var r,i=(Tt.tweeners[t]||[]).concat(Tt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function Tt(o,e,t){var n,a,r=0,i=Tt.prefilters.length,s=k.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=pt||xt(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:k.extend({},e),opts:k.extend(!0,{specialEasing:{},easing:k.easing._default},t),originalProperties:e,originalOptions:t,startTime:pt||xt(),duration:t.duration,tweens:[],createTween:function(e,t){var n=k.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=V(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=k.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=Tt.prefilters[r].call(l,o,c,l.opts))return x(n.stop)&&(k._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return k.map(c,wt,l),x(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),k.fx.timer(k.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}k.Animation=k.extend(Tt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return le(n.elem,e,ne.exec(t),n),n}]},tweener:function(e,t){for(var n,r=0,i=(e=x(e)?(t=e,["*"]):e.match(R)).length;r<i;r++)n=e[r],Tt.tweeners[n]=Tt.tweeners[n]||[],Tt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ue(e),v=Q.get(e,"fxshow");for(r in n.queue||(null==(a=k._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,k.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],vt.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||k.style(e,r)}if((u=!k.isEmptyObject(t))||!k.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=Q.get(e,"display")),"none"===(c=k.css(e,"display"))&&(l?c=l:(fe([e],!0),l=e.style.display||l,c=k.css(e,"display"),fe([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===k.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=Q.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&fe([e],!0),p.done(function(){for(r in g||fe([e]),Q.remove(e,"fxshow"),d)k.style(e,r,d[r])})),u=wt(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?Tt.prefilters.unshift(e):Tt.prefilters.push(e)}}),k.speed=function(e,t,n){var r=e&&"object"==typeof e?k.extend({},e):{complete:n||!n&&t||x(e)&&e,duration:e,easing:n&&t||t&&!x(t)&&t};return k.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in k.fx.speeds?r.duration=k.fx.speeds[r.duration]:r.duration=k.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){x(r.old)&&r.old.call(this),r.queue&&k.dequeue(this,r.queue)},r},k.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ue).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){function i(){var e=Tt(this,k.extend({},t),a);(o||Q.get(this,"finish"))&&e.stop(!0)}var o=k.isEmptyObject(t),a=k.speed(e,n,r);return i.finish=i,o||!1===a.queue?this.each(i):this.queue(a.queue,i)},stop:function(i,e,o){function a(e){var t=e.stop;delete e.stop,t(o)}return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&!1!==i&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=k.timers,r=Q.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&yt.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||k.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=Q.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=k.timers,o=n?n.length:0;for(t.finish=!0,k.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),k.each(["toggle","show","hide"],function(e,r){var i=k.fn[r];k.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(bt(r,!0),e,t,n)}}),k.each({slideDown:bt("show"),slideUp:bt("hide"),slideToggle:bt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){k.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),k.timers=[],k.fx.tick=function(){var e,t=0,n=k.timers;for(pt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||k.fx.stop(),pt=void 0},k.fx.timer=function(e){k.timers.push(e),k.fx.start()},k.fx.interval=13,k.fx.start=function(){dt||(dt=!0,mt())},k.fx.stop=function(){dt=null},k.fx.speeds={slow:600,fast:200,_default:400},k.fn.delay=function(r,e){return r=k.fx&&k.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},ht=E.createElement("input"),gt=E.createElement("select").appendChild(E.createElement("option")),ht.type="checkbox",m.checkOn=""!==ht.value,m.optSelected=gt.selected,(ht=E.createElement("input")).value="t",ht.type="radio",m.radioValue="t"===ht.value;var Ct,Et=k.expr.attrHandle;k.fn.extend({attr:function(e,t){return _(this,k.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){k.removeAttr(this,e)})}}),k.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?k.prop(e,t,n):(1===o&&k.isXMLDoc(e)||(i=k.attrHooks[t.toLowerCase()]||(k.expr.match.bool.test(t)?Ct:void 0)),void 0!==n?null===n?void k.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):!(i&&"get"in i&&null!==(r=i.get(e,t)))&&null==(r=k.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!m.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(R);if(i&&1===e.nodeType)for(;n=i[r++];)e.removeAttribute(n)}}),Ct={set:function(e,t,n){return!1===t?k.removeAttr(e,n):e.setAttribute(n,n),n}},k.each(k.expr.match.bool.source.match(/\w+/g),function(e,t){var a=Et[t]||k.find.attr;Et[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=Et[o],Et[o]=r,r=null!=a(e,t,n)?o:null,Et[o]=i),r}});var kt=/^(?:input|select|textarea|button)$/i,St=/^(?:a|area)$/i;function Nt(e){return(e.match(R)||[]).join(" ")}function At(e){return e.getAttribute&&e.getAttribute("class")||""}function Dt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(R)||[]}k.fn.extend({prop:function(e,t){return _(this,k.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[k.propFix[e]||e]})}}),k.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&k.isXMLDoc(e)||(t=k.propFix[t]||t,i=k.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=k.find.attr(e,"tabindex");return t?parseInt(t,10):kt.test(e.nodeName)||St.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(k.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),k.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){k.propFix[this.toLowerCase()]=this}),k.fn.extend({addClass:function(t){var e,n,r,i,o,a,s,u=0;if(x(t))return this.each(function(e){k(this).addClass(t.call(this,e,At(this)))});if((e=Dt(t)).length)for(;n=this[u++];)if(i=At(n),r=1===n.nodeType&&" "+Nt(i)+" "){for(a=0;o=e[a++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=Nt(r))&&n.setAttribute("class",s)}return this},removeClass:function(t){var e,n,r,i,o,a,s,u=0;if(x(t))return this.each(function(e){k(this).removeClass(t.call(this,e,At(this)))});if(!arguments.length)return this.attr("class","");if((e=Dt(t)).length)for(;n=this[u++];)if(i=At(n),r=1===n.nodeType&&" "+Nt(i)+" "){for(a=0;o=e[a++];)for(;-1<r.indexOf(" "+o+" ");)r=r.replace(" "+o+" "," ");i!==(s=Nt(r))&&n.setAttribute("class",s)}return this},toggleClass:function(i,t){var o=typeof i,a="string"==o||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):x(i)?this.each(function(e){k(this).toggleClass(i.call(this,e,At(this),t),t)}):this.each(function(){var e,t,n,r;if(a)for(t=0,n=k(this),r=Dt(i);e=r[t++];)n.hasClass(e)?n.removeClass(e):n.addClass(e);else void 0!==i&&"boolean"!=o||((e=At(this))&&Q.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",!e&&!1!==i&&Q.get(this,"__className__")||""))})},hasClass:function(e){for(var t,n=0,r=" "+e+" ";t=this[n++];)if(1===t.nodeType&&-1<(" "+Nt(At(t))+" ").indexOf(r))return!0;return!1}});var jt=/\r/g;k.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=x(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,k(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=k.map(t,function(e){return null==e?"":e+""})),(r=k.valHooks[this.type]||k.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=k.valHooks[t.type]||k.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(jt,""):null==e?"":e:void 0}}),k.extend({valHooks:{option:{get:function(e){var t=k.find.attr(e,"value");return null!=t?t:Nt(k.text(e))}},select:{get:function(e){for(var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type,a=o?null:[],s=o?i+1:r.length,u=i<0?s:o?i:0;u<s;u++)if(((n=r[u]).selected||u===i)&&!n.disabled&&(!n.parentNode.disabled||!A(n.parentNode,"optgroup"))){if(t=k(n).val(),o)return t;a.push(t)}return a},set:function(e,t){for(var n,r,i=e.options,o=k.makeArray(t),a=i.length;a--;)((r=i[a]).selected=-1<k.inArray(k.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),k.each(["radio","checkbox"],function(){k.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<k.inArray(k(e).val(),t)}},m.checkOn||(k.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),m.focusin="onfocusin"in C;function qt(e){e.stopPropagation()}var Lt=/^(?:focusinfocus|focusoutblur)$/;k.extend(k.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f=[n||E],p=y.call(e,"type")?e.type:e,d=y.call(e,"namespace")?e.namespace.split("."):[],h=c=o=n=n||E;if(3!==n.nodeType&&8!==n.nodeType&&!Lt.test(p+k.event.triggered)&&(-1<p.indexOf(".")&&(p=(d=p.split(".")).shift(),d.sort()),s=p.indexOf(":")<0&&"on"+p,(e=e[k.expando]?e:new k.Event(p,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=d.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:k.makeArray(t,[e]),l=k.event.special[p]||{},r||!l.trigger||!1!==l.trigger.apply(n,t))){if(!r&&!l.noBubble&&!g(n)){for(a=l.delegateType||p,Lt.test(a+p)||(h=h.parentNode);h;h=h.parentNode)f.push(h),o=h;o===(n.ownerDocument||E)&&f.push(o.defaultView||o.parentWindow||C)}for(i=0;(h=f[i++])&&!e.isPropagationStopped();)c=h,e.type=1<i?a:l.bindType||p,(u=(Q.get(h,"events")||{})[e.type]&&Q.get(h,"handle"))&&u.apply(h,t),(u=s&&h[s])&&u.apply&&G(h)&&(e.result=u.apply(h,t),!1===e.result&&e.preventDefault());return e.type=p,r||e.isDefaultPrevented()||l._default&&!1!==l._default.apply(f.pop(),t)||!G(n)||s&&x(n[p])&&!g(n)&&((o=n[s])&&(n[s]=null),k.event.triggered=p,e.isPropagationStopped()&&c.addEventListener(p,qt),n[p](),e.isPropagationStopped()&&c.removeEventListener(p,qt),k.event.triggered=void 0,o&&(n[s]=o)),e.result}},simulate:function(e,t,n){var r=k.extend(new k.Event,n,{type:e,isSimulated:!0});k.event.trigger(r,null,t)}}),k.fn.extend({trigger:function(e,t){return this.each(function(){k.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return k.event.trigger(e,t,n,!0)}}),m.focusin||k.each({focus:"focusin",blur:"focusout"},function(n,r){function i(e){k.event.simulate(r,e.target,k.event.fix(e))}k.event.special[r]={setup:function(){var e=this.ownerDocument||this,t=Q.access(e,r);t||e.addEventListener(n,i,!0),Q.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this,t=Q.access(e,r)-1;t?Q.access(e,r,t):(e.removeEventListener(n,i,!0),Q.remove(e,r))}}});var Ht=C.location,Ot=Date.now(),Pt=/\?/;k.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||k.error("Invalid XML: "+e),t};var Rt=/\[\]$/,Mt=/\r?\n/g,It=/^(?:submit|button|image|reset|file)$/i,Wt=/^(?:input|select|textarea|keygen)/i;k.param=function(e,t){function n(e,t){var n=x(t)?t():t;i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)}var r,i=[];if(null==e)return"";if(Array.isArray(e)||e.jquery&&!k.isPlainObject(e))k.each(e,function(){n(this.name,this.value)});else for(r in e)!function n(r,e,i,o){var t;if(Array.isArray(e))k.each(e,function(e,t){i||Rt.test(r)?o(r,t):n(r+"["+("object"==typeof t&&null!=t?e:"")+"]",t,i,o)});else if(i||"object"!==w(e))o(r,e);else for(t in e)n(r+"["+t+"]",e[t],i,o)}(r,e[r],t,n);return i.join("&")},k.fn.extend({serialize:function(){return k.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=k.prop(this,"elements");return e?k.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!k(this).is(":disabled")&&Wt.test(this.nodeName)&&!It.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=k(this).val();return null==n?null:Array.isArray(n)?k.map(n,function(e){return{name:t.name,value:e.replace(Mt,"\r\n")}}):{name:t.name,value:n.replace(Mt,"\r\n")}}).get()}});var $t=/%20/g,Ft=/#.*$/,Bt=/([?&])_=[^&]*/,_t=/^(.*?):[ \t]*([^\r\n]*)$/gm,zt=/^(?:GET|HEAD)$/,Ut=/^\/\//,Xt={},Vt={},Gt="*/".concat("*"),Yt=E.createElement("a");function Qt(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(R)||[];if(x(t))for(;n=i[r++];)"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Jt(t,i,o,a){var s={},u=t===Vt;function l(e){var r;return s[e]=!0,k.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Kt(e,t){var n,r,i=k.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r=r||{})[n]=t[n]);return r&&k.extend(!0,e,r),e}Yt.href=Ht.href,k.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ht.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Ht.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Gt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":k.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Kt(Kt(e,k.ajaxSettings),t):Kt(k.ajaxSettings,e)},ajaxPrefilter:Qt(Xt),ajaxTransport:Qt(Vt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=k.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?k(y):k.event,x=k.Deferred(),b=k.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n)for(n={};t=_t.exec(p);)n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||Ht.href)+"").replace(Ut,Ht.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(R)||[""],null==v.crossDomain){r=E.createElement("a");try{r.href=v.url,r.href,v.crossDomain=Yt.protocol+"//"+Yt.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=k.param(v.data,v.traditional)),Jt(Xt,v,t,T),h)return T;for(i in(g=k.event&&v.global)&&0==k.active++&&k.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!zt.test(v.type),f=v.url.replace(Ft,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace($t,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(Pt.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(Bt,"$1"),o=(Pt.test(f)?"&":"?")+"_="+Ot+++o),v.url=f+o),v.ifModified&&(k.lastModified[f]&&T.setRequestHeader("If-Modified-Since",k.lastModified[f]),k.etag[f]&&T.setRequestHeader("If-None-Match",k.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+Gt+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Jt(Vt,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=C.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){for(var r,i,o,a,s=e.contents,u=e.dataTypes;"*"===u[0];)u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a=a||i}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];for(o=c.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(k.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(k.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--k.active||k.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return k.get(e,t,n,"json")},getScript:function(e,t){return k.get(e,void 0,t,"script")}}),k.each(["get","post"],function(e,i){k[i]=function(e,t,n,r){return x(t)&&(r=r||n,n=t,t=void 0),k.ajax(k.extend({url:e,type:i,dataType:r,data:t,success:n},k.isPlainObject(e)&&e))}}),k._evalUrl=function(e,t){return k.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){k.globalEval(e,t)}})},k.fn.extend({wrapAll:function(e){var t;return this[0]&&(x(e)&&(e=e.call(this[0])),t=k(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return x(n)?this.each(function(e){k(this).wrapInner(n.call(this,e))}):this.each(function(){var e=k(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=x(t);return this.each(function(e){k(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){k(this).replaceWith(this.childNodes)}),this}}),k.expr.pseudos.hidden=function(e){return!k.expr.pseudos.visible(e)},k.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},k.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var Zt={0:200,1223:204},en=k.ajaxSettings.xhr();m.cors=!!en&&"withCredentials"in en,m.ajax=en=!!en,k.ajaxTransport(function(i){var o,a;if(m.cors||en&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Zt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),k.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),k.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return k.globalEval(e),e}}}),k.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),k.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=k("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),E.head.appendChild(r[0])},abort:function(){i&&i()}}});var tn,nn=[],rn=/(=)\?(?=&|$)|\?\?/;k.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=nn.pop()||k.expando+"_"+Ot++;return this[e]=!0,e}}),k.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(rn.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&rn.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=x(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(rn,"$1"+r):!1!==e.jsonp&&(e.url+=(Pt.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||k.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?k(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,nn.push(r)),o&&x(i)&&i(o[0]),o=i=void 0}),"script"}),m.createHTMLDocument=((tn=E.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===tn.childNodes.length),k.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(m.createHTMLDocument?((r=(t=E.implementation.createHTMLDocument("")).createElement("base")).href=E.location.href,t.head.appendChild(r)):t=E),o=!n&&[],(i=D.exec(e))?[t.createElement(i[1])]:(i=we([e],t,o),o&&o.length&&k(o).remove(),k.merge([],i.childNodes)));var r,i,o},k.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=Nt(e.slice(s)),e=e.slice(0,s)),x(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&k.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?k("<div>").append(k.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},k.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){k.fn[t]=function(e){return this.on(t,e)}}),k.expr.pseudos.animated=function(t){return k.grep(k.timers,function(e){return t===e.elem}).length},k.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=k.css(e,"position"),c=k(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=k.css(e,"top"),u=k.css(e,"left"),i=("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,r.left):(a=parseFloat(o)||0,parseFloat(u)||0),x(t)&&(t=t.call(e,n,k.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},k.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){k.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===k.css(r,"position"))t=r.getBoundingClientRect();else{for(t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===k.css(e,"position");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=k(e).offset()).top+=k.css(e,"borderTopWidth",!0),i.left+=k.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-k.css(r,"marginTop",!0),left:t.left-i.left-k.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===k.css(e,"position");)e=e.offsetParent;return e||ie})}}),k.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;k.fn[t]=function(e){return _(this,function(e,t,n){var r;return g(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n?r?r[i]:e[t]:void(r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n)},t,e,arguments.length)}}),k.each(["top","left"],function(e,n){k.cssHooks[n]=Ze(m.pixelPosition,function(e,t){if(t)return t=Ke(e,n),Ve.test(t)?k(e).position()[n]+"px":t})}),k.each({Height:"height",Width:"width"},function(a,s){k.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){k.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return _(this,function(e,t,n){var r;return g(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?k.css(e,t,i):k.style(e,t,n,i)},s,n?e:void 0,n)}})}),k.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){k.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}}),k.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),k.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}}),k.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),x(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||k.guid++,i},k.holdReady=function(e){e?k.readyWait++:k.ready(!0)},k.isArray=Array.isArray,k.parseJSON=JSON.parse,k.nodeName=A,k.isFunction=x,k.isWindow=g,k.camelCase=V,k.type=w,k.now=Date.now,k.isNumeric=function(e){var t=k.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},"function"==typeof define&&define.amd&&define("jquery",[],function(){return k});var on=C.jQuery,an=C.$;return k.noConflict=function(e){return C.$===k&&(C.$=an),e&&C.jQuery===k&&(C.jQuery=on),k},e||(C.jQuery=C.$=k),k});


(function($){
	$.fn.live=function(event, callback){
		if (!callback){
			return;
		}

		$(document.body).on(event, this, callback);
	};
})(jQuery);

(function($){var a=$.fn.jquery.split("."),b;for(b in a)a[b]=parseInt(a[b]);if(!$.browser&&(1<a[0]||9<=a[1])){a={browser:void 0,version:void 0,mobile:!1};navigator&&navigator.userAgent&&(a.ua=navigator.userAgent,a.webkit=/WebKit/i.test(a.ua),a.browserArray="MSIE Chrome Opera Kindle Silk BlackBerry PlayBook Android Safari Mozilla Nokia".split(" "),/Sony[^ ]*/i.test(a.ua)?a.mobile="Sony":/RIM Tablet/i.test(a.ua)?a.mobile="RIM Tablet":/BlackBerry/i.test(a.ua)?a.mobile="BlackBerry":/iPhone/i.test(a.ua)?
		a.mobile="iPhone":/iPad/i.test(a.ua)?a.mobile="iPad":/iPod/i.test(a.ua)?a.mobile="iPod":/Opera Mini/i.test(a.ua)?a.mobile="Opera Mini":/IEMobile/i.test(a.ua)?a.mobile="IEMobile":/BB[0-9]{1,}; Touch/i.test(a.ua)?a.mobile="BlackBerry":/Nokia/i.test(a.ua)?a.mobile="Nokia":/Android/i.test(a.ua)&&(a.mobile="Android"),/MSIE|Trident/i.test(a.ua)?(a.browser="MSIE",a.version=/MSIE/i.test(navigator.userAgent)&&0<parseFloat(a.ua.split("MSIE")[1].match(/[0-9\.]{1,}/)[0])?parseFloat(a.ua.split("MSIE")[1].match(/[0-9\.]{1,}/)[0]):
		"Edge",/Trident/i.test(a.ua)&&/rv:([0-9]{1,}[\.0-9]{0,})/.test(a.ua)&&(a.version=parseFloat(a.ua.match(/rv:([0-9]{1,}[\.0-9]{0,})/)[1].match(/[0-9\.]{1,}/)[0]))):/Chrome/.test(a.ua)?(a.browser="Chrome",a.version=parseFloat(a.ua.split("Chrome/")[1].split("Safari")[0].match(/[0-9\.]{1,}/)[0])):/Opera/.test(a.ua)?(a.browser="Opera",a.version=parseFloat(a.ua.split("Version/")[1].match(/[0-9\.]{1,}/)[0])):/Kindle|Silk|KFTT|KFOT|KFJWA|KFJWI|KFSOWI|KFTHWA|KFTHWI|KFAPWA|KFAPWI/i.test(a.ua)?(a.mobile="Kindle",
		/Silk/i.test(a.ua)?(a.browser="Silk",a.version=parseFloat(a.ua.split("Silk/")[1].split("Safari")[0].match(/[0-9\.]{1,}/)[0])):/Kindle/i.test(a.ua)&&/Version/i.test(a.ua)&&(a.browser="Kindle",a.version=parseFloat(a.ua.split("Version/")[1].split("Safari")[0].match(/[0-9\.]{1,}/)[0]))):/BlackBerry/.test(a.ua)?(a.browser="BlackBerry",a.version=parseFloat(a.ua.split("/")[1].match(/[0-9\.]{1,}/)[0])):/PlayBook/.test(a.ua)?(a.browser="PlayBook",a.version=parseFloat(a.ua.split("Version/")[1].split("Safari")[0].match(/[0-9\.]{1,}/)[0])):
		/BB[0-9]{1,}; Touch/.test(a.ua)?(a.browser="Blackberry",a.version=parseFloat(a.ua.split("Version/")[1].split("Safari")[0].match(/[0-9\.]{1,}/)[0])):/Android/.test(a.ua)?(a.browser="Android",a.version=parseFloat(a.ua.split("Version/")[1].split("Safari")[0].match(/[0-9\.]{1,}/)[0])):/Safari/.test(a.ua)?(a.browser="Safari",a.version=parseFloat(a.ua.split("Version/")[1].split("Safari")[0].match(/[0-9\.]{1,}/)[0])):/Firefox/.test(a.ua)?(a.browser="Mozilla",a.version=parseFloat(a.ua.split("Firefox/")[1].match(/[0-9\.]{1,}/)[0])):
		/Nokia/.test(a.ua)&&(a.browser="Nokia",a.version=parseFloat(a.ua.split("Browser")[1].match(/[0-9\.]{1,}/)[0])));if(a.browser)for(var c in a.browserArray)a[a.browserArray[c].toLowerCase()]=a.browser==a.browserArray[c];$.extend(!0,$.browser={},a)}})(jQuery);
		/* - - - - - - - - - - - - - - - - - - - */






(function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(t){function e(t){for(var e=t.css("visibility");"inherit"===e;)t=t.parent(),e=t.css("visibility");return"hidden"!==e}function i(t){for(var e,i;t.length&&t[0]!==document;){if (e=t.css("position"),("absolute"===e||"relative"===e||"fixed"===e)&&(i=parseInt(t.css("zIndex"),10),!isNaN(i)&&0!==i))return i;t=t.parent()}return 0}function s(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.regional.en=t.extend(!0,{},this.regional[""]),this.regional["en-US"]=t.extend(!0,{},this.regional.en),this.dpDiv=n(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function n(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.on("mouseout",i,function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).on("mouseover",i,o)}function o(){t.datepicker._isDisabledDatepicker(u.inline?u.dpDiv.parent()[0]:u.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))}function a(e,i){t.extend(e,i);for(var s in i)null==i[s]&&(e[s]=i[s]);return e}t.ui=t.ui||{},t.ui.version="1.12.1";var r=0,l=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,n,o;for(o=0;null!=(n=i[o]);o++)try{s=t._data(n,"events"),s&&s.remove&&t(n).triggerHandler("remove")}catch(a){}e(i)}}(t.cleanData),t.widget=function(e,i,s){var n,o,a,r={},l=e.split(".")[0];e=e.split(".")[1];var h=l+"-"+e;return s||(s=i,i=t.Widget),t.isArray(s)&&(s=t.extend.apply(null,[{}].concat(s))),t.expr[":"][h.toLowerCase()]=function(e){return!!t.data(e,h)},t[l]=t[l]||{},n=t[l][e],o=t[l][e]=function(t,e){return this._createWidget?(arguments.length&&this._createWidget(t,e),void 0):new o(t,e)},t.extend(o,n,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),a=new i,a.options=t.widget.extend({},a.options),t.each(s,function(e,s){return t.isFunction(s)?(r[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function n(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=o,e}}(),void 0):(r[e]=s,void 0)}),o.prototype=t.widget.extend(a,{widgetEventPrefix:n?a.widgetEventPrefix||e:e},r,{constructor:o,namespace:l,widgetName:e,widgetFullName:h}),n?(t.each(n._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete n._childConstructors):i._childConstructors.push(o),t.widget.bridge(e,o),o},t.widget.extend=function(e){for(var i,s,n=l.call(arguments,1),o=0,a=n.length;a>o;o++)for(i in n[o])s=n[o][i],n[o].hasOwnProperty(i)&&void 0!==s&&(e[i]=t.isPlainObject(s)?t.isPlainObject(e[i])?t.widget.extend({},e[i],s):t.widget.extend({},s):s);return e},t.widget.bridge=function(e,i){var s=i.prototype.widgetFullName||e;t.fn[e]=function(n){var o="string"==typeof n,a=l.call(arguments,1),r=this;return o?this.length||"instance"!==n?this.each(function(){var i,o=t.data(this,s);return"instance"===n?(r=o,!1):o?t.isFunction(o[n])&&"_"!==n.charAt(0)?(i=o[n].apply(o,a),i!==o&&void 0!==i?(r=i&&i.jquery?r.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+n+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; "+"attempted to call method '"+n+"'")}):r=void 0:(a.length&&(n=t.widget.extend.apply(null,[n].concat(a))),this.each(function(){var e=t.data(this,s);e?(e.option(n||{}),e._init&&e._init()):t.data(this,s,new i(n,this))})),r}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=r++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var s,n,o,a=e;if (0===arguments.length)return t.widget.extend({},this.options);if ("string"==typeof e)if (a={},s=e.split("."),e=s.shift(),s.length){for(n=a[e]=t.widget.extend({},this.options[e]),o=0;s.length-1>o;o++)n[s[o]]=n[s[o]]||{},n=n[s[o]];if (e=s.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if (1===arguments.length)return void 0===this.options[e]?null:this.options[e];a[e]=i}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var i,s,n;for(i in e)n=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&n&&n.length&&(s=t(n.get()),this._removeClass(n,i),s.addClass(this._classes({element:s,keys:i,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){function i(i,o){var a,r;for(r=0;i.length>r;r++)a=n.classesElementLookup[i[r]]||t(),a=e.add?t(t.unique(a.get().concat(e.element.get()))):t(a.not(e.element).get()),n.classesElementLookup[i[r]]=a,s.push(i[r]),o&&e.classes[i[r]]&&s.push(e.classes[i[r]])}var s=[],n=this;return e=t.extend({element:this.element,classes:this.options.classes||{}},e),this._on(e.element,{remove:"_untrackClassesElement"}),e.keys&&i(e.keys.match(/\S+/g)||[],!0),e.extra&&i(e.extra.match(/\S+/g)||[]),s.join(" ")},_untrackClassesElement:function(e){var i=this;t.each(i.classesElementLookup,function(s,n){-1!==t.inArray(e.target,n)&&(i.classesElementLookup[s]=t(n.not(e.target).get()))})},_removeClass:function(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function(t,e,i,s){s="boolean"==typeof s?s:i;var n="string"==typeof t||null===t,o={extra:n?e:i,keys:n?t:e,element:n?this.element:t,add:s};return o.element.toggleClass(this._classes(o),s),this},_on:function(e,i,s){var n,o=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=n=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),t.each(s,function(s,a){function r(){return e||o.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?o[a]:a).apply(o,arguments):void 0}"string"!=typeof a&&(r.guid=a.guid=a.guid||r.guid||t.guid++);var l=s.match(/^([\w:-]*)\s*(.*)$/),h=l[1]+o.eventNamespace,c=l[2];c?n.on(h,c,r):i.on(h,r)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,i,s){var n,o,a=this.options[e];if (s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(t.isFunction(a)&&a.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){"string"==typeof n&&(n={effect:n});var a,r=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),a=!t.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),a&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}}),t.widget,function(){function e(t,e,i){return[parseFloat(t[0])*(u.test(t[0])?e/100:1),parseFloat(t[1])*(u.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}function s(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}var n,o=Math.max,a=Math.abs,r=/left|center|right/,l=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,u=/%$/,d=t.fn.position;t.position={scrollbarWidth:function(){if (void 0!==n)return n;var e,i,s=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return t("body").append(s),e=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,e===i&&(i=s[0].clientWidth),s.remove(),n=e-i},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),s=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,o="scroll"===s||"auto"===s&&e.height<e.element[0].scrollHeight;return{width:o?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),s=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType,o=!s&&!n;return{element:i,isWindow:s,isDocument:n,offset:o?t(e).offset():{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},t.fn.position=function(n){if (!n||!n.of)return d.apply(this,arguments);n=t.extend({},n);var u,p,f,g,m,_,v=t(n.of),b=t.position.getWithinInfo(n.within),y=t.position.getScrollInfo(b),w=(n.collision||"flip").split(" "),k={};return _=s(v),v[0].preventDefault&&(n.at="left top"),p=_.width,f=_.height,g=_.offset,m=t.extend({},g),t.each(["my","at"],function(){var t,e,i=(n[this]||"").split(" ");1===i.length&&(i=r.test(i[0])?i.concat(["center"]):l.test(i[0])?["center"].concat(i):["center","center"]),i[0]=r.test(i[0])?i[0]:"center",i[1]=l.test(i[1])?i[1]:"center",t=h.exec(i[0]),e=h.exec(i[1]),k[this]=[t?t[0]:0,e?e[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===n.at[0]?m.left+=p:"center"===n.at[0]&&(m.left+=p/2),"bottom"===n.at[1]?m.top+=f:"center"===n.at[1]&&(m.top+=f/2),u=e(k.at,p,f),m.left+=u[0],m.top+=u[1],this.each(function(){var s,r,l=t(this),h=l.outerWidth(),c=l.outerHeight(),d=i(this,"marginLeft"),_=i(this,"marginTop"),x=h+d+i(this,"marginRight")+y.width,C=c+_+i(this,"marginBottom")+y.height,D=t.extend({},m),T=e(k.my,l.outerWidth(),l.outerHeight());"right"===n.my[0]?D.left-=h:"center"===n.my[0]&&(D.left-=h/2),"bottom"===n.my[1]?D.top-=c:"center"===n.my[1]&&(D.top-=c/2),D.left+=T[0],D.top+=T[1],s={marginLeft:d,marginTop:_},t.each(["left","top"],function(e,i){t.ui.position[w[e]]&&t.ui.position[w[e]][i](D,{targetWidth:p,targetHeight:f,elemWidth:h,elemHeight:c,collisionPosition:s,collisionWidth:x,collisionHeight:C,offset:[u[0]+T[0],u[1]+T[1]],my:n.my,at:n.at,within:b,elem:l})}),n.using&&(r=function(t){var e=g.left-D.left,i=e+p-h,s=g.top-D.top,r=s+f-c,u={target:{element:v,left:g.left,top:g.top,width:p,height:f},element:{element:l,left:D.left,top:D.top,width:h,height:c},horizontal:0>i?"left":e>0?"right":"center",vertical:0>r?"top":s>0?"bottom":"middle"};h>p&&p>a(e+i)&&(u.horizontal="center"),c>f&&f>a(s+r)&&(u.vertical="middle"),u.important=o(a(e),a(i))>o(a(s),a(r))?"horizontal":"vertical",n.using.call(this,t,u)}),l.offset(t.extend(D,{using:r}))})},t.ui.position={fit:{left:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=t.left-e.collisionPosition.marginLeft,l=n-r,h=r+e.collisionWidth-a-n;e.collisionWidth>a?l>0&&0>=h?(i=t.left+l+e.collisionWidth-a-n,t.left+=l-i):t.left=h>0&&0>=l?n:l>h?n+a-e.collisionWidth:n:l>0?t.left+=l:h>0?t.left-=h:t.left=o(t.left-r,t.left)},top:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollTop:s.offset.top,a=e.within.height,r=t.top-e.collisionPosition.marginTop,l=n-r,h=r+e.collisionHeight-a-n;e.collisionHeight>a?l>0&&0>=h?(i=t.top+l+e.collisionHeight-a-n,t.top+=l-i):t.top=h>0&&0>=l?n:l>h?n+a-e.collisionHeight:n:l>0?t.top+=l:h>0?t.top-=h:t.top=o(t.top-r,t.top)}},flip:{left:function(t,e){var i,s,n=e.within,o=n.offset.left+n.scrollLeft,r=n.width,l=n.isWindow?n.scrollLeft:n.offset.left,h=t.left-e.collisionPosition.marginLeft,c=h-l,u=h+e.collisionWidth-r-l,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>c?(i=t.left+d+p+f+e.collisionWidth-r-o,(0>i||a(c)>i)&&(t.left+=d+p+f)):u>0&&(s=t.left-e.collisionPosition.marginLeft+d+p+f-l,(s>0||u>a(s))&&(t.left+=d+p+f))},top:function(t,e){var i,s,n=e.within,o=n.offset.top+n.scrollTop,r=n.height,l=n.isWindow?n.scrollTop:n.offset.top,h=t.top-e.collisionPosition.marginTop,c=h-l,u=h+e.collisionHeight-r-l,d="top"===e.my[1],p=d?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>c?(s=t.top+p+f+g+e.collisionHeight-r-o,(0>s||a(c)>s)&&(t.top+=p+f+g)):u>0&&(i=t.top-e.collisionPosition.marginTop+p+f+g-l,(i>0||u>a(i))&&(t.top+=p+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}}}(),t.ui.position,t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])}}),t.fn.extend({disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}}),t.ui.focusable=function(i,s){var n,o,a,r,l,h=i.nodeName.toLowerCase();return"area"===h?(n=i.parentNode,o=n.name,i.href&&o&&"map"===n.nodeName.toLowerCase()?(a=t("img[usemap='#"+o+"']"),a.length>0&&a.is(":visible")):!1):(/^(input|select|textarea|button|object)$/.test(h)?(r=!i.disabled,r&&(l=t(i).closest("fieldset")[0],l&&(r=!l.disabled))):r="a"===h?i.href||s:s,r&&t(i).is(":visible")&&e(t(i)))},t.extend(t.expr[":"],{focusable:function(e){return t.ui.focusable(e,null!=t.attr(e,"tabindex"))}}),t.ui.focusable,t.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):t(this[0].form)},t.ui.formResetMixin={_formResetHandler:function(){var e=t(this);setTimeout(function(){var i=e.data("ui-form-reset-instances");t.each(i,function(){this.refresh()})})},_bindFormResetHandler:function(){if (this.form=this.element.form(),this.form.length){var t=this.form.data("ui-form-reset-instances")||[];t.length||this.form.on("reset.ui-form-reset",this._formResetHandler),t.push(this),this.form.data("ui-form-reset-instances",t)}},_unbindFormResetHandler:function(){if (this.form.length){var e=this.form.data("ui-form-reset-instances");e.splice(t.inArray(this,e),1),e.length?this.form.data("ui-form-reset-instances",e):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}},"1.7"===t.fn.jquery.substring(0,3)&&(t.each(["Width","Height"],function(e,i){function s(e,i,s,o){return t.each(n,function(){i-=parseFloat(t.css(e,"padding"+this))||0,s&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),o&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],o=i.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?a["inner"+i].call(this):this.each(function(){t(this).css(o,s(this,e)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?a["outer"+i].call(this,e):this.each(function(){t(this).css(o,s(this,e,!0,n)+"px")})}}),t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},t.ui.escapeSelector=function(){var t=/([!"#$%&'()*+,./:;<=>?@[\]^`{|}~])/g;return function(e){return e.replace(t,"\\$1")}}(),t.fn.labels=function(){var e,i,s,n,o;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(n=this.eq(0).parents("label"),s=this.attr("id"),s&&(e=this.eq(0).parents().last(),o=e.add(e.length?e.siblings():this.siblings()),i="label[for='"+t.ui.escapeSelector(s)+"']",n=n.add(o.find(i).addBack(i))),this.pushStack(n))},t.fn.scrollParent=function(e){var i=this.css("position"),s="absolute"===i,n=e?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=t(this);return s&&"static"===e.css("position")?!1:n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:t(this[0].ownerDocument||document)},t.extend(t.expr[":"],{tabbable:function(e){var i=t.attr(e,"tabindex"),s=null!=i;return(!s||i>=0)&&t.ui.focusable(e,s)}}),t.fn.extend({uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var h=!1;t(document).on("mouseup",function(){h=!1}),t.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.on("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).on("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if (!h){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,s=1===e.which,n="string"==typeof this.options.cancel&&e.target.nodeName?t(e.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(e)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),h=!0,!0)):!0}},_mouseMove:function(e){if (this._mouseMoved){if (t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if (!e.which)if (e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if (!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,h=!1,e.preventDefault()},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),t.ui.plugin={add:function(e,i,s){var n,o=t.ui[e].prototype;for(n in s)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,s[n]])},call:function(t,e,i,s){var n,o=t.plugins[e];if (o&&(s||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(n=0;o.length>n;n++)t.options[o[n][0]]&&o[n][1].apply(t.element,i)}},t.ui.safeActiveElement=function(t){var e;try{e=t.activeElement}catch(i){e=t.body}return e||(e=t.body),e.nodeName||(e=t.body),e},t.ui.safeBlur=function(e){e&&"body"!==e.nodeName.toLowerCase()&&t(e).trigger("blur")},t.widget("ui.draggable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(e){var i=this.options;return this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(this._blurActiveElement(e),this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var i=t.ui.safeActiveElement(this.document[0]),s=t(e.target);s.closest(i).length||t.ui.safeBlur(i)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function(e,i){if (this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if (this._trigger("drag",e,s)===!1)return this._mouseUp(new t.Event("mouseup",e)),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.trigger("focus"),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new t.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper),n=s?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if ("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options,o=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,t(o).width()-this.helperProportions.width-this.margins.left,(t(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=t(n.containment),s=i[0],s&&(e=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)
},_convertPositionTo:function(t,e){e||(e=this.position);var i="absolute"===t?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(t,e){var i,s,n,o,a=this.options,r=this._isRootNode(this.scrollParent[0]),l=t.pageX,h=t.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(h=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(h=i[3]+this.offset.click.top)),a.grid&&(n=a.grid[1]?this.originalPageY+Math.round((h-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,h=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-a.grid[1]:n+a.grid[1]:n,o=a.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,l=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-a.grid[0]:o+a.grid[0]:o),"y"===a.axis&&(l=this.originalPageX),"x"===a.axis&&(h=this.originalPageY)),{top:h-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i,s){var n=t.extend({},i,{item:s.element});s.sortables=[],t(s.options.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",e,n))})},stop:function(e,i,s){var n=t.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,t.each(s.sortables,function(){var t=this;t.isOver?(t.isOver=0,s.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,n))})},drag:function(e,i,s){t.each(s.sortables,function(){var n=!1,o=this;o.positionAbs=s.positionAbs,o.helperProportions=s.helperProportions,o.offset.click=s.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,t.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&t.contains(o.element[0],this.element[0])&&(n=!1),n})),n?(o.isOver||(o.isOver=1,s._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},e.target=o.currentItem[0],o._mouseCapture(e,!0),o._mouseStart(e,!0,!0),o.offset.click.top=s.offset.click.top,o.offset.click.left=s.offset.click.left,o.offset.parent.left-=s.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=s.offset.parent.top-o.offset.parent.top,s._trigger("toSortable",e),s.dropped=o.element,t.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,o.fromOutside=s),o.currentItem&&(o._mouseDrag(e),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",e,o._uiHash(o)),o._mouseStop(e,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(e),i.position=s._generatePosition(e,!0),s._trigger("fromSortable",e),s.dropped=!1,t.each(s.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i,s){var n=t("body"),o=s.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function(e,i,s){var n=s.options;n._cursor&&t("body").css("cursor",n._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function(e,i,s){var n=s.options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,i,s){var n=s.options,o=!1,a=s.scrollParentNotHidden[0],r=s.document[0];a!==r&&"HTML"!==a.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+a.offsetHeight-e.pageY<n.scrollSensitivity?a.scrollTop=o=a.scrollTop+n.scrollSpeed:e.pageY-s.overflowOffset.top<n.scrollSensitivity&&(a.scrollTop=o=a.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+a.offsetWidth-e.pageX<n.scrollSensitivity?a.scrollLeft=o=a.scrollLeft+n.scrollSpeed:e.pageX-s.overflowOffset.left<n.scrollSensitivity&&(a.scrollLeft=o=a.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-t(r).scrollTop()<n.scrollSensitivity?o=t(r).scrollTop(t(r).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(r).scrollTop())<n.scrollSensitivity&&(o=t(r).scrollTop(t(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-t(r).scrollLeft()<n.scrollSensitivity?o=t(r).scrollLeft(t(r).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(r).scrollLeft())<n.scrollSensitivity&&(o=t(r).scrollLeft(t(r).scrollLeft()+n.scrollSpeed)))),o!==!1&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(s,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i,s){var n=s.options;s.snapElements=[],t(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var e=t(this),i=e.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(e,i,s){var n,o,a,r,l,h,c,u,d,p,f=s.options,g=f.snapTolerance,m=i.offset.left,_=m+s.helperProportions.width,v=i.offset.top,b=v+s.helperProportions.height;for(d=s.snapElements.length-1;d>=0;d--)l=s.snapElements[d].left-s.margins.left,h=l+s.snapElements[d].width,c=s.snapElements[d].top-s.margins.top,u=c+s.snapElements[d].height,l-g>_||m>h+g||c-g>b||v>u+g||!t.contains(s.snapElements[d].item.ownerDocument,s.snapElements[d].item)?(s.snapElements[d].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(n=g>=Math.abs(c-b),o=g>=Math.abs(u-v),a=g>=Math.abs(l-_),r=g>=Math.abs(h-m),n&&(i.position.top=s._convertPositionTo("relative",{top:c-s.helperProportions.height,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left)),p=n||o||a||r,"outer"!==f.snapMode&&(n=g>=Math.abs(c-v),o=g>=Math.abs(u-b),a=g>=Math.abs(l-m),r=g>=Math.abs(h-_),n&&(i.position.top=s._convertPositionTo("relative",{top:c,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left)),!s.snapElements[d].snapping&&(n||o||a||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=n||o||a||r||p)}}),t.ui.plugin.add("draggable","stack",{start:function(e,i,s){var n,o=s.options,a=t.makeArray(t(o.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});a.length&&(n=parseInt(t(a[0]).css("zIndex"),10)||0,t(a).each(function(e){t(this).css("zIndex",n+e)}),this.css("zIndex",n+a.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function(e,i,s){var n=s.options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}}),t.ui.draggable,t.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(s)?s:function(t){return t.is(s)},this.proportions=function(){return arguments.length?(e=arguments[0],void 0):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this._addClass("ui-droppable")},_addToManager:function(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function(t){for(var e=0;t.length>e;e++)t[e]===this&&t.splice(e,1)},_destroy:function(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e)},_setOption:function(e,i){if ("accept"===e)this.accept=t.isFunction(i)?i:function(t){return t.is(i)};else if ("scope"===e){var s=t.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(e,i)},_activate:function(e){var i=t.ui.ddmanager.current;this._addActiveClass(),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this._removeActiveClass(),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._addHoverClass(),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeHoverClass(),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var s=i||t.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=t(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&c(s,t.extend(i,{offset:i.element.offset()}),i.options.tolerance,e)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",e,this.ui(s)),this.element):!1):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});var c=t.ui.intersect=function(){function t(t,e,i){return t>=e&&e+i>t}return function(e,i,s,n){if (!i.offset)return!1;var o=(e.positionAbs||e.position.absolute).left+e.margins.left,a=(e.positionAbs||e.position.absolute).top+e.margins.top,r=o+e.helperProportions.width,l=a+e.helperProportions.height,h=i.offset.left,c=i.offset.top,u=h+i.proportions().width,d=c+i.proportions().height;switch(s){case"fit":return o>=h&&u>=r&&a>=c&&d>=l;case"intersect":return o+e.helperProportions.width/2>h&&u>r-e.helperProportions.width/2&&a+e.helperProportions.height/2>c&&d>l-e.helperProportions.height/2;case"pointer":return t(n.pageY,c,i.proportions().height)&&t(n.pageX,h,i.proportions().width);case"touch":return(a>=c&&d>=a||l>=c&&d>=l||c>a&&l>d)&&(o>=h&&u>=o||r>=h&&u>=r||h>o&&r>u);default:return!1}}}();t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,i){var s,n,o=t.ui.ddmanager.droppables[e.options.scope]||[],a=i?i.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(s=0;o.length>s;s++)if (!(o[s].options.disabled||e&&!o[s].accept.call(o[s].element[0],e.currentItem||e.element))){for(n=0;r.length>n;n++)if (r[n]===o[s].element[0]){o[s].proportions().height=0;continue t}o[s].visible="none"!==o[s].element.css("display"),o[s].visible&&("mousedown"===a&&o[s]._activate.call(o[s],i),o[s].offset=o[s].element.offset(),o[s].proportions({width:o[s].element[0].offsetWidth,height:o[s].element[0].offsetHeight}))}},drop:function(e,i){var s=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&c(e,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(e,i){e.element.parentsUntil("body").on("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if (!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,o,a=c(e,this,this.options.tolerance,i),r=!a&&this.isover?"isout":a&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return t(this).droppable("instance").options.scope===n}),o.length&&(s=t(o[0]).droppable("instance"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").off("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}},t.uiBackCompat!==!1&&t.widget("ui.droppable",t.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),t.ui.droppable,t.widget("ui.resizable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseFloat(t)||0},_isNumber:function(t){return!isNaN(parseFloat(t))},_hasScroll:function(e,i){if ("hidden"===t(e).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return e[s]>0?!0:(e[s]=1,n=e[s]>0,e[s]=0,n)},_create:function(){var e,i=this.options,s=this;this._addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,e={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(e),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(e),this._proportionallyResize()),this._setupHandles(),i.autoHide&&t(this.element).on("mouseenter",function(){i.disabled||(s._removeClass("ui-resizable-autohide"),s._handles.show())}).on("mouseleave",function(){i.disabled||s.resizing||(s._addClass("ui-resizable-autohide"),s._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(t,e){switch(this._super(t,e),t){case"handles":this._removeHandles(),this._setupHandles();break;default:}},_setupHandles:function(){var e,i,s,n,o,a=this.options,r=this;if (this.handles=a.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),s=this.handles.split(","),this.handles={},i=0;s.length>i;i++)e=t.trim(s[i]),n="ui-resizable-"+e,o=t("<div>"),this._addClass(o,"ui-resizable-handle "+n),o.css({zIndex:a.zIndex}),this.handles[e]=".ui-resizable-"+e,this.element.append(o);this._renderAxis=function(e){var i,s,n,o;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=t(this.handles[i]),this._on(this.handles[i],{mousedown:r._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=t(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,o),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){r.resizing||(this.className&&(o=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),r.axis=o&&o[1]?o[1]:"se")}),a.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(e){var i,s,n=!1;for(i in this.handles)s=t(this.handles[i])[0],(s===e.target||t.contains(s,e.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(e){var i,s,n,o=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),o.containment&&(i+=t(o.containment).scrollLeft()||0,s+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===n?this.axis+"-resize":n),this._addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var i,s,n=this.originalMousePosition,o=this.axis,a=e.pageX-n.left||0,r=e.pageY-n.top||0,l=this._change[o];return this._updatePrevProperties(),l?(i=l.apply(this,[e,a,r]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(e){this.resizing=!1;var i,s,n,o,a,r,l,h=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:c.sizeDiff.height,o=s?0:c.sizeDiff.width,a={width:c.helper.width()-o,height:c.helper.height()-n},r=parseFloat(c.element.css("left"))+(c.position.left-c.originalPosition.left)||null,l=parseFloat(c.element.css("top"))+(c.position.top-c.originalPosition.top)||null,h.animate||this.element.css(t.extend(a,{top:l,left:r})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!h.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function(t){var e,i,s,n,o,a=this.options;o={minWidth:this._isNumber(a.minWidth)?a.minWidth:0,maxWidth:this._isNumber(a.maxWidth)?a.maxWidth:1/0,minHeight:this._isNumber(a.minHeight)?a.minHeight:0,maxHeight:this._isNumber(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||t)&&(e=o.minHeight*this.aspectRatio,s=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),s>o.minHeight&&(o.minHeight=s),o.maxWidth>i&&(o.maxWidth=i),o.maxHeight>n&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,s=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===s&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===s&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,s=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,n=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,a=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,r=this.originalPosition.left+this.originalSize.width,l=this.originalPosition.top+this.originalSize.height,h=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return o&&(t.width=e.minWidth),a&&(t.height=e.minHeight),s&&(t.width=e.maxWidth),n&&(t.height=e.maxHeight),o&&h&&(t.left=r-e.minWidth),s&&h&&(t.left=r-e.maxWidth),a&&c&&(t.top=l-e.minHeight),n&&c&&(t.top=l-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var e=0,i=[],s=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],n=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];4>e;e++)i[e]=parseFloat(s[e])||0,i[e]+=parseFloat(n[e])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if (this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;this._proportionallyResizeElements.length>e;e++)t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize,s=this.originalPosition;return{left:s.left+e,width:i.width-e}},n:function(t,e,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),a=o&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=o?0:i.sizeDiff.width,l={width:i.size.width-r,height:i.size.height-a},h=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,c=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(l,c&&h?{top:c,left:h}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};n&&n.length&&t(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,i,s,n,o,a,r,l=t(this).resizable("instance"),h=l.options,c=l.element,u=h.containment,d=u instanceof t?u.get(0):/parent/.test(u)?c.parent().get(0):u;d&&(l.containerElement=t(d),/document/.test(u)||u===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(d),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,s){i[t]=l._num(e.css("padding"+s))}),l.containerOffset=e.offset(),l.containerPosition=e.position(),l.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},s=l.containerOffset,n=l.containerSize.height,o=l.containerSize.width,a=l._hasScroll(d,"left")?d.scrollWidth:o,r=l._hasScroll(d)?d.scrollHeight:n,l.parentData={element:d,left:s.left,top:s.top,width:a,height:r}))},resize:function(e){var i,s,n,o,a=t(this).resizable("instance"),r=a.options,l=a.containerOffset,h=a.position,c=a._aspectRatio||e.shiftKey,u={top:0,left:0},d=a.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(u=l),h.left<(a._helper?l.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-l.left:a.position.left-u.left),c&&(a.size.height=a.size.width/a.aspectRatio,p=!1),a.position.left=r.helper?l.left:0),h.top<(a._helper?l.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-l.top:a.position.top),c&&(a.size.width=a.size.height*a.aspectRatio,p=!1),a.position.top=a._helper?l.top:0),n=a.containerElement.get(0)===a.element.parent().get(0),o=/relative|absolute/.test(a.containerElement.css("position")),n&&o?(a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top):(a.offset.left=a.element.offset().left,a.offset.top=a.element.offset().top),i=Math.abs(a.sizeDiff.width+(a._helper?a.offset.left-u.left:a.offset.left-l.left)),s=Math.abs(a.sizeDiff.height+(a._helper?a.offset.top-u.top:a.offset.top-l.top)),i+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-i,c&&(a.size.height=a.size.width/a.aspectRatio,p=!1)),s+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-s,c&&(a.size.width=a.size.height*a.aspectRatio,p=!1)),p||(a.position.left=a.prevPosition.left,a.position.top=a.prevPosition.top,a.size.width=a.prevSize.width,a.size.height=a.prevSize.height)},stop:function(){var e=t(this).resizable("instance"),i=e.options,s=e.containerOffset,n=e.containerPosition,o=e.containerElement,a=t(e.helper),r=a.offset(),l=a.outerWidth()-e.sizeDiff.width,h=a.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:l,height:h}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:l,height:h})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).resizable("instance"),i=e.options;t(i.alsoResize).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseFloat(e.width()),height:parseFloat(e.height()),left:parseFloat(e.css("left")),top:parseFloat(e.css("top"))})})},resize:function(e,i){var s=t(this).resizable("instance"),n=s.options,o=s.originalSize,a=s.originalPosition,r={height:s.size.height-o.height||0,width:s.size.width-o.width||0,top:s.position.top-a.top||0,left:s.position.left-a.left||0};
t(n.alsoResize).each(function(){var e=t(this),s=t(this).data("ui-resizable-alsoresize"),n={},o=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(s[e]||0)+(r[e]||0);i&&i>=0&&(n[e]=i||null)}),e.css(n)})},stop:function(){t(this).removeData("ui-resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).resizable("instance"),i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),e._addClass(e.ghost,"ui-resizable-ghost"),t.uiBackCompat!==!1&&"string"==typeof e.options.ghost&&e.ghost.addClass(this.options.ghost),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e,i=t(this).resizable("instance"),s=i.options,n=i.size,o=i.originalSize,a=i.originalPosition,r=i.axis,l="number"==typeof s.grid?[s.grid,s.grid]:s.grid,h=l[0]||1,c=l[1]||1,u=Math.round((n.width-o.width)/h)*h,d=Math.round((n.height-o.height)/c)*c,p=o.width+u,f=o.height+d,g=s.maxWidth&&p>s.maxWidth,m=s.maxHeight&&f>s.maxHeight,_=s.minWidth&&s.minWidth>p,v=s.minHeight&&s.minHeight>f;s.grid=l,_&&(p+=h),v&&(f+=c),g&&(p-=h),m&&(f-=c),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=a.top-d):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=a.left-u):((0>=f-c||0>=p-h)&&(e=i._getPaddingPlusBorderDimensions(this)),f-c>0?(i.size.height=f,i.position.top=a.top-d):(f=c-e.height,i.size.height=f,i.position.top=a.top+o.height-f),p-h>0?(i.size.width=p,i.position.left=a.left-u):(p=h-e.width,i.size.width=p,i.position.left=a.left+o.width-p))}}),t.ui.resizable,t.widget("ui.selectable",t.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e.elementPos=t(e.element[0]).offset(),e.selectees=t(e.options.filter,e.element[0]),e._addClass(e.selectees,"ui-selectee"),e.selectees.each(function(){var i=t(this),s=i.offset(),n={left:s.left-e.elementPos.left,top:s.top-e.elementPos.top};t.data(this,"selectable-item",{element:this,$element:i,left:n.left,top:n.top,right:n.left+i.outerWidth(),bottom:n.top+i.outerHeight(),startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=t("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(e){var i=this,s=this.options;this.opos=[e.pageX,e.pageY],this.elementPos=t(this.element[0]).offset(),this.options.disabled||(this.selectees=t(s.filter,this.element[0]),this._trigger("start",e),t(s.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=t.data(this,"selectable-item");s.startselected=!0,e.metaKey||e.ctrlKey||(i._removeClass(s.$element,"ui-selected"),s.selected=!1,i._addClass(s.$element,"ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",e,{unselecting:s.element}))}),t(e.target).parents().addBack().each(function(){var s,n=t.data(this,"selectable-item");return n?(s=!e.metaKey&&!e.ctrlKey||!n.$element.hasClass("ui-selected"),i._removeClass(n.$element,s?"ui-unselecting":"ui-selected")._addClass(n.$element,s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",e,{selecting:n.element}):i._trigger("unselecting",e,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(e){if (this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,o=this.opos[0],a=this.opos[1],r=e.pageX,l=e.pageY;return o>r&&(i=r,r=o,o=i),a>l&&(i=l,l=a,a=i),this.helper.css({left:o,top:a,width:r-o,height:l-a}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),h=!1,c={};i&&i.element!==s.element[0]&&(c.left=i.left+s.elementPos.left,c.right=i.right+s.elementPos.left,c.top=i.top+s.elementPos.top,c.bottom=i.bottom+s.elementPos.top,"touch"===n.tolerance?h=!(c.left>r||o>c.right||c.top>l||a>c.bottom):"fit"===n.tolerance&&(h=c.left>o&&r>c.right&&c.top>a&&l>c.bottom),h?(i.selected&&(s._removeClass(i.$element,"ui-selected"),i.selected=!1),i.unselecting&&(s._removeClass(i.$element,"ui-unselecting"),i.unselecting=!1),i.selecting||(s._addClass(i.$element,"ui-selecting"),i.selecting=!0,s._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,s._addClass(i.$element,"ui-selected"),i.selected=!0):(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,i.startselected&&(s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(s._removeClass(i.$element,"ui-selected"),i.selected=!1,s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",e,{unselected:s.element})}),t(".ui-selecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-selecting")._addClass(s.$element,"ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",e,{selected:s.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),t.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var s=null,n=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(s=t(e.target)),s?!this.options.handle||i||(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(e,i,s){var n,o,a=this.options;if (this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-this.document.scrollTop()<a.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-a.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<a.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+a.scrollSpeed)),e.pageX-this.document.scrollLeft()<a.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-a.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<a.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+a.scrollSpeed))),r!==!1&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if (s=this.items[i],n=s.item[0],o=this._intersectsWithPointer(s),o&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],n):!0)){if (this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if (e){if (t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if (this.dragging){this._mouseUp(new t.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,l=r+t.height,h=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||s+h>r&&l>s+h,d="y"===this.options.axis||e+c>o&&a>e+c,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&a>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&l>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e,i,s="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),o=s&&n;return o?(e=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===e?2:1:e&&("down"===e?2:1)):!1},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&e||"up"===s&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){r.push(this)}var s,n,o,a,r=[],l=[],h=this._connectWith();if (h&&e)for(s=h.length-1;s>=0;s--)for(o=t(h[s],this.document[0]),n=o.length-1;n>=0;n--)a=t.data(o[n],this.widgetFullName),a&&a!==this&&!a.options.disabled&&l.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(l.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=l.length-1;s>=0;s--)l[s][0].each(i);return t(r)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if (e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,n,o,a,r,l,h,c=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if (d&&this.ready)for(i=d.length-1;i>=0;i--)for(n=t(d[i],this.document[0]),s=n.length-1;s>=0;s--)o=t.data(n[s],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=u.length-1;i>=0;i--)for(a=u[i][1],r=u[i][0],s=0,h=r.length;h>s;s++)l=t(r[s]),l.data(this.widgetName+"-item",a),c.push({item:l,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,o;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if (this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,s=e.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]);return e._addClass(n,"ui-sortable-placeholder",i||e.currentItem[0].className)._removeClass(n,"ui-sortable-helper"),"tbody"===s?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(n)):"tr"===s?e._createTrPlaceholder(e.currentItem,n):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var s=this;e.children().each(function(){t("<td>&#160;</td>",s.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,s,n,o,a,r,l,h,c,u,d=null,p=null;for(i=this.containers.length-1;i>=0;i--)if (!t.contains(this.currentItem[0],this.containers[i].element[0]))if (this._intersectsWith(this.containers[i].containerCache)){if (d&&t.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if (d)if (1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,c=d.floating||this._isFloating(this.currentItem),a=c?"left":"top",r=c?"width":"height",u=c?"pageX":"pageY",s=this.items.length-1;s>=0;s--)t.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(l=this.items[s].item.offset()[a],h=!1,e[u]-l>this.items[s][r]/2&&(h=!0),n>Math.abs(e[u]-l)&&(n=Math.abs(e[u]-l),o=this.items[s],this.direction=h?"up":"down"));if (!o&&!this.options.dropOnEmpty)return;if (this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if ("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function(e){var i,s,n=this.options,o=e.pageX,a=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:r.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,n=[];if (!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)e||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if (this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(s=0;n.length>s;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(t){t.preventDefault()},"click .ui-menu-item":function(e){var i=t(e.target),s=t(t.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&s.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){if (!this.previousFilter){var i=t(e.target).closest(".ui-menu-item"),s=t(e.currentTarget);i[0]===s[0]&&(this._removeClass(s.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(e,s))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.find(this.options.items).eq(0);
e||this.focus(t,i)},blur:function(e){this._delay(function(){var i=!t.contains(this.element[0],t.ui.safeActiveElement(this.document[0]));i&&this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){this._closeOnDocumentClick(t)&&this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){var e=this.element.find(".ui-menu-item").removeAttr("role aria-disabled"),i=e.children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),i.children().each(function(){var e=t(this);e.data("ui-menu-submenu-caret")&&e.remove()})},_keydown:function(e){var i,s,n,o,a=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:a=!1,s=this.previousFilter||"",o=!1,n=e.keyCode>=96&&105>=e.keyCode?""+(e.keyCode-96):String.fromCharCode(e.keyCode),clearTimeout(this.filterTimer),n===s?o=!0:n=s+n,i=this._filterMenuItems(n),i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(n=String.fromCharCode(e.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(e,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}a&&e.preventDefault()},_activate:function(t){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(t):this.select(t))},refresh:function(){var e,i,s,n,o,a=this,r=this.options.icons.submenu,l=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),s=l.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),i=e.prev(),s=t("<span>").data("ui-menu-submenu-caret",!0);a._addClass(s,"ui-menu-icon","ui-icon "+r),i.attr("aria-haspopup","true").prepend(s),e.attr("aria-labelledby",i.attr("id"))}),this._addClass(s,"ui-menu","ui-widget ui-widget-content ui-front"),e=l.add(this.element),i=e.find(this.options.items),i.not(".ui-menu-item").each(function(){var e=t(this);a._isDivider(e)&&a._addClass(e,"ui-menu-divider","ui-widget-content")}),n=i.not(".ui-menu-item, .ui-menu-divider"),o=n.children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(n,"ui-menu-item")._addClass(o,"ui-menu-item-wrapper"),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){if ("icons"===t){var i=this.element.find(".ui-menu-icon");this._removeClass(i,null,this.options.icons.submenu)._addClass(i,null,e.submenu)}this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t+""),this._toggleClass(null,"ui-state-disabled",!!t)},focus:function(t,e){var i,s,n;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),s=this.active.children(".ui-menu-item-wrapper"),this._addClass(s,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),n=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(n,null,"ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=e.children(".ui-menu"),i.length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,s,n,o,a,r;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-i-s,o=this.activeMenu.scrollTop(),a=this.activeMenu.height(),r=e.outerHeight(),0>n?this.activeMenu.scrollTop(o+n):n+r>a&&this.activeMenu.scrollTop(o+n-a+r))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",t,{item:this.active}),this.active=null)},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(e),this._removeClass(s.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=s},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(e){return!t(e.target).closest(".ui-menu").length},_isDivider:function(t){return!/[^\-\u2014\u2013\s]/.test(t.text())},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var s;this.active&&(s="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[e]()),this.focus(i,s)},nextPage:function(e){var i,s,n;return this.active?(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=t(this),0>i.offset().top-s-n}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())),void 0):(this.next(e),void 0)},previousPage:function(e){var i,s,n;return this.active?(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-s+n>0}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items).first())),void 0):(this.next(e),void 0)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)},_filterMenuItems:function(e){var i=e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(t.trim(t(this).children(".ui-menu-item-wrapper").text()))})}}),t.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,i,s,n=this.element[0].nodeName.toLowerCase(),o="textarea"===n,a="input"===n;this.isMultiLine=o||!a&&this._isContentEditable(this.element),this.valueMethod=this.element[o||a?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if (this.element.prop("readOnly"))return e=!0,s=!0,i=!0,void 0;e=!1,s=!1,i=!1;var o=t.ui.keyCode;switch(n.keyCode){case o.PAGE_UP:e=!0,this._move("previousPage",n);break;case o.PAGE_DOWN:e=!0,this._move("nextPage",n);break;case o.UP:e=!0,this._keyEvent("previous",n);break;case o.DOWN:e=!0,this._keyEvent("next",n);break;case o.ENTER:this.menu.active&&(e=!0,n.preventDefault(),this.menu.select(n));break;case o.TAB:this.menu.active&&this.menu.select(n);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if (e)return e=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault(),void 0;if (!i){var n=t.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(t){return s?(s=!1,t.preventDefault(),void 0):(this._searchTimeout(t),void 0)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?(delete this.cancelBlur,void 0):(clearTimeout(this.searching),this.close(t),this._change(t),void 0)}}),this._initSource(),this.menu=t("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,this.element[0]!==t.ui.safeActiveElement(this.document[0])&&this.element.trigger("focus")})},menufocus:function(e,i){var s,n;return this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type))?(this.menu.blur(),this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)}),void 0):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",e,{item:n})&&e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(n.value),s=i.item.attr("aria-label")||n.value,s&&t.trim(s).length&&(this.liveRegion.children().hide(),t("<div>").text(s).appendTo(this.liveRegion)),void 0)},menuselect:function(e,i){var s=i.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==t.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=s})),!1!==this._trigger("select",e,{item:s})&&this._value(s.value),this.term=this._value(),this.close(e),this.selectedItem=s}}),this.liveRegion=t("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(e){var i=this.menu.element[0];return e.target===this.element[0]||e.target===i||t.contains(i,e.target)},_closeOnClickOutside:function(t){this._isEventTargetInWidget(t)||this.close()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,i,s=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,s){s(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,n){s.xhr&&s.xhr.abort(),s.xhr=t.ajax({url:i,data:e,dataType:"json",success:function(t){n(t)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){var e=this.term===this._value(),i=this.menu.element.is(":visible"),s=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey;(!e||e&&!i&&!s)&&(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):this._trigger("search",e)!==!1?this._search(t):void 0},_search:function(t){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy(function(t){e===this.requestIndex&&this.__response(t),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")},this)},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({},e,{label:e.label||e.value,value:e.value||e.label})})},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var s=this;t.each(i,function(t,i){s._renderItemData(e,i)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").append(t("<div>").text(i.label)).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this.isMultiLine||this._value(this.term),this.menu.blur(),void 0):(this.menu[t](e),void 0):(this.search(null,e),void 0)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(t,e),e.preventDefault())},_isContentEditable:function(t){if (!t.length)return!1;var e=t.prop("contentEditable");return"inherit"===e?this._isContentEditable(t.parent()):"true"===e}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var s=RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return s.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.children().hide(),t("<div>").text(i).appendTo(this.liveRegion))}}),t.ui.autocomplete,t.extend(t.ui,{datepicker:{version:"1.12.1"}});var u;t.extend(s.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return a(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var s,n,o;s=e.nodeName.toLowerCase(),n="div"===s||"span"===s,e.id||(this.uuid+=1,e.id="dp"+this.uuid),o=this._newInst(t(e),n),o.settings=t.extend({},i||{}),"input"===s?this._connectDatepicker(e,o):n&&this._inlineDatepicker(e,o)},_newInst:function(e,i){var s=e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:s,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?n(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var s=t(e);i.append=t([]),i.trigger=t([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(i),t.data(e,"datepicker",i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var s,n,o,a=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),a&&(i.append=t("<span class='"+this._appendClass+"'>"+a+"</span>"),e[r?"before":"after"](i.append)),e.off("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),s=this._get(i,"showOn"),("focus"===s||"both"===s)&&e.on("focus",this._showDatepicker),("button"===s||"both"===s)&&(n=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:o,alt:n,title:n}):t("<button type='button'></button>").addClass(this._triggerClass).html(o?t("<img/>").attr({src:o,alt:n,title:n}):n)),e[r?"before":"after"](i.trigger),i.trigger.on("click",function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if (this._get(t,"autoSize")&&!t.inline){var e,i,s,n,o=new Date(2009,11,20),a=this._get(t,"dateFormat");a.match(/[DM]/)&&(e=function(t){for(i=0,s=0,n=0;t.length>n;n++)t[n].length>i&&(i=t[n].length,s=n);return s},o.setMonth(e(this._get(t,a.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(e(this._get(t,a.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),t.input.attr("size",this._formatDate(t,o).length)}},_inlineDatepicker:function(e,i){var s=t(e);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),t.data(e,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,i,s,n,o){var r,l,h,c,u,d=this._dialogInst;return d||(this.uuid+=1,r="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+r+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),t("body").append(this._dialogInput),d=this._dialogInst=this._newInst(this._dialogInput,!1),d.settings={},t.data(this._dialogInput[0],"datepicker",d)),a(d.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(d,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(l=document.documentElement.clientWidth,h=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,u=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[l/2-100+c,h/2-150+u]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),d.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],"datepicker",d),this},_destroyDatepicker:function(e){var i,s=t(e),n=t.data(e,"datepicker");s.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty(),u===n&&(u=null))},_enableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,"datepicker");n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if (!t)return!1;for(var e=0;this._disabledInputs.length>e;e++)if (this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,"datepicker")}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,i,s){var n,o,r,l,h=this._getInst(e);return 2===arguments.length&&"string"==typeof i?"defaults"===i?t.extend({},t.datepicker._defaults):h?"all"===i?t.extend({},h.settings):this._get(h,i):null:(n=i||{},"string"==typeof i&&(n={},n[i]=s),h&&(this._curInst===h&&this._hideDatepicker(),o=this._getDateDatepicker(e,!0),r=this._getMinMaxDate(h,"min"),l=this._getMinMaxDate(h,"max"),a(h.settings,n),null!==r&&void 0!==n.dateFormat&&void 0===n.minDate&&(h.settings.minDate=this._formatDate(h,r)),null!==l&&void 0!==n.dateFormat&&void 0===n.maxDate&&(h.settings.maxDate=this._formatDate(h,l)),"disabled"in n&&(n.disabled?this._disableDatepicker(e):this._enableDatepicker(e)),this._attachments(t(e),h),this._autoSize(h),this._setDate(h,o),this._updateAlternate(h),this._updateDatepicker(h)),void 0)},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,s,n,o=t.datepicker._getInst(e.target),a=!0,r=o.dpDiv.is(".ui-datepicker-rtl");if (o._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),a=!1;break;case 13:return n=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",o.dpDiv),n[0]&&t.datepicker._selectDay(e.target,o.selectedMonth,o.selectedYear,n[0]),i=t.datepicker._get(o,"onSelect"),i?(s=t.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[s,o])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),a=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),a=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?1:-1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),a=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?-1:1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),a=e.ctrlKey||e.metaKey;break;default:a=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):a=!1;a&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var i,s,n=t.datepicker._getInst(e.target);return t.datepicker._get(n,"constrainInput")?(i=t.datepicker._possibleChars(t.datepicker._get(n,"dateFormat")),s=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||" ">s||!i||i.indexOf(s)>-1):void 0},_doKeyUp:function(e){var i,s=t.datepicker._getInst(e.target);if (s.input.val()!==s.lastVal)try{i=t.datepicker.parseDate(t.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,t.datepicker._getFormatConfig(s)),i&&(t.datepicker._setDateFromField(s),t.datepicker._updateAlternate(s),t.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(e){if (e=e.target||e,"input"!==e.nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),!t.datepicker._isDisabledDatepicker(e)&&t.datepicker._lastInput!==e){var s,n,o,r,l,h,c;s=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==s&&(t.datepicker._curInst.dpDiv.stop(!0,!0),s&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),n=t.datepicker._get(s,"beforeShow"),o=n?n.apply(e,[e,s]):{},o!==!1&&(a(s.settings,o),s.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(s),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),r=!1,t(e).parents().each(function(){return r|="fixed"===t(this).css("position"),!r}),l={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,s.dpDiv.empty(),s.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(s),l=t.datepicker._checkOffset(s,l,r),s.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":r?"fixed":"absolute",display:"none",left:l.left+"px",top:l.top+"px"}),s.inline||(h=t.datepicker._get(s,"showAnim"),c=t.datepicker._get(s,"duration"),s.dpDiv.css("z-index",i(t(e))+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[h]?s.dpDiv.show(h,t.datepicker._get(s,"showOptions"),c):s.dpDiv[h||"show"](h?c:null),t.datepicker._shouldFocusInput(s)&&s.input.trigger("focus"),t.datepicker._curInst=s))}},_updateDatepicker:function(e){this.maxRows=4,u=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var i,s=this._getNumberOfMonths(e),n=s[1],a=17,r=e.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&o.apply(r.get(0)),e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&e.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",a*n+"em"),e.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.trigger("focus"),e.yearshtml&&(i=e.yearshtml,setTimeout(function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,s){var n=e.dpDiv.outerWidth(),o=e.dpDiv.outerHeight(),a=e.input?e.input.outerWidth():0,r=e.input?e.input.outerHeight():0,l=document.documentElement.clientWidth+(s?0:t(document).scrollLeft()),h=document.documentElement.clientHeight+(s?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?n-a:0,i.left-=s&&i.left===e.input.offset().left?t(document).scrollLeft():0,i.top-=s&&i.top===e.input.offset().top+r?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>l&&l>n?Math.abs(i.left+n-l):0),i.top-=Math.min(i.top,i.top+o>h&&h>o?Math.abs(o+r):0),i},_findPos:function(e){for(var i,s=this._getInst(e),n=this._get(s,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[n?"previousSibling":"nextSibling"];return i=t(e).offset(),[i.left,i.top]},_hideDatepicker:function(e){var i,s,n,o,a=this._curInst;!a||e&&a!==t.data(e,"datepicker")||this._datepickerShowing&&(i=this._get(a,"showAnim"),s=this._get(a,"duration"),n=function(){t.datepicker._tidyDialog(a)},t.effects&&(t.effects.effect[i]||t.effects[i])?a.dpDiv.hide(i,t.datepicker._get(a,"showOptions"),s,n):a.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,o=this._get(a,"onClose"),o&&o.apply(a.input?a.input[0]:null,[a.input?a.input.val():"",a]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(e){if (t.datepicker._curInst){var i=t(e.target),s=t.datepicker._getInst(i[0]);(i[0].id!==t.datepicker._mainDivId&&0===i.parents("#"+t.datepicker._mainDivId).length&&!i.hasClass(t.datepicker.markerClassName)&&!i.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||i.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==s)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,i,s){var n=t(e),o=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(o,i+("M"===s?this._get(o,"showCurrentAtPos"):0),s),this._updateDatepicker(o))},_gotoToday:function(e){var i,s=t(e),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(e,i,s){var n=t(e),o=this._getInst(n[0]);o["selected"+("M"===s?"Month":"Year")]=o["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(n)},_selectDay:function(e,i,s,n){var o,a=t(e);t(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(a[0])||(o=this._getInst(a[0]),o.selectedDay=o.currentDay=t("a",n).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=s,this._selectDate(e,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(e){var i=t(e);this._selectDate(i,"")},_selectDate:function(e,i){var s,n=t(e),o=this._getInst(n[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),s=this._get(o,"onSelect"),s?s.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.trigger("focus"),this._lastInput=null)
},_updateAlternate:function(e){var i,s,n,o=this._get(e,"altField");o&&(i=this._get(e,"altFormat")||this._get(e,"dateFormat"),s=this._getDate(e),n=this.formatDate(i,s,this._getFormatConfig(e)),t(o).val(n))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,i=new Date(t.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(e,i,s){if (null==e||null==i)throw"Invalid arguments";if (i="object"==typeof i?""+i:i+"",""===i)return null;var n,o,a,r,l=0,h=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof h?h:(new Date).getFullYear()%100+parseInt(h,10),u=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,d=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,f=(s?s.monthNames:null)||this._defaults.monthNames,g=-1,m=-1,_=-1,v=-1,b=!1,y=function(t){var i=e.length>n+1&&e.charAt(n+1)===t;return i&&n++,i},w=function(t){var e=y(t),s="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,n="y"===t?s:1,o=RegExp("^\\d{"+n+","+s+"}"),a=i.substring(l).match(o);if (!a)throw"Missing number at position "+l;return l+=a[0].length,parseInt(a[0],10)},k=function(e,s,n){var o=-1,a=t.map(y(e)?n:s,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if (t.each(a,function(t,e){var s=e[1];return i.substr(l,s.length).toLowerCase()===s.toLowerCase()?(o=e[0],l+=s.length,!1):void 0}),-1!==o)return o+1;throw"Unknown name at position "+l},x=function(){if (i.charAt(l)!==e.charAt(n))throw"Unexpected literal at position "+l;l++};for(n=0;e.length>n;n++)if (b)"'"!==e.charAt(n)||y("'")?x():b=!1;else switch(e.charAt(n)){case"d":_=w("d");break;case"D":k("D",u,d);break;case"o":v=w("o");break;case"m":m=w("m");break;case"M":m=k("M",p,f);break;case"y":g=w("y");break;case"@":r=new Date(w("@")),g=r.getFullYear(),m=r.getMonth()+1,_=r.getDate();break;case"!":r=new Date((w("!")-this._ticksTo1970)/1e4),g=r.getFullYear(),m=r.getMonth()+1,_=r.getDate();break;case"'":y("'")?x():b=!0;break;default:x()}if (i.length>l&&(a=i.substr(l),!/^\s+/.test(a)))throw"Extra/unparsed characters found in date: "+a;if (-1===g?g=(new Date).getFullYear():100>g&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(c>=g?0:-100)),v>-1)for(m=1,_=v;;){if (o=this._getDaysInMonth(g,m-1),o>=_)break;m++,_-=o}if (r=this._daylightSavingAdjust(new Date(g,m-1,_)),r.getFullYear()!==g||r.getMonth()+1!==m||r.getDate()!==_)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(t,e,i){if (!e)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,a=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,l=function(e){var i=t.length>s+1&&t.charAt(s+1)===e;return i&&s++,i},h=function(t,e,i){var s=""+e;if (l(t))for(;i>s.length;)s="0"+s;return s},c=function(t,e,i,s){return l(t)?s[e]:i[e]},u="",d=!1;if (e)for(s=0;t.length>s;s++)if (d)"'"!==t.charAt(s)||l("'")?u+=t.charAt(s):d=!1;else switch(t.charAt(s)){case"d":u+=h("d",e.getDate(),2);break;case"D":u+=c("D",e.getDay(),n,o);break;case"o":u+=h("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=h("m",e.getMonth()+1,2);break;case"M":u+=c("M",e.getMonth(),a,r);break;case"y":u+=l("y")?e.getFullYear():(10>e.getFullYear()%100?"0":"")+e.getFullYear()%100;break;case"@":u+=e.getTime();break;case"!":u+=1e4*e.getTime()+this._ticksTo1970;break;case"'":l("'")?u+="'":d=!0;break;default:u+=t.charAt(s)}return u},_possibleChars:function(t){var e,i="",s=!1,n=function(i){var s=t.length>e+1&&t.charAt(e+1)===i;return s&&e++,s};for(e=0;t.length>e;e++)if (s)"'"!==t.charAt(e)||n("'")?i+=t.charAt(e):s=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,e){return void 0!==t.settings[e]?t.settings[e]:this._defaults[e]},_setDateFromField:function(t,e){if (t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),s=t.lastVal=t.input?t.input.val():null,n=this._getDefaultDate(t),o=n,a=this._getFormatConfig(t);try{o=this.parseDate(i,s,a)||n}catch(r){s=e?"":s}t.selectedDay=o.getDate(),t.drawMonth=t.selectedMonth=o.getMonth(),t.drawYear=t.selectedYear=o.getFullYear(),t.currentDay=s?o.getDate():0,t.currentMonth=s?o.getMonth():0,t.currentYear=s?o.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,i,s){var n=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},o=function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,o=n.getFullYear(),a=n.getMonth(),r=n.getDate(),l=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,h=l.exec(i);h;){switch(h[2]||"d"){case"d":case"D":r+=parseInt(h[1],10);break;case"w":case"W":r+=7*parseInt(h[1],10);break;case"m":case"M":a+=parseInt(h[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a));break;case"y":case"Y":o+=parseInt(h[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a))}h=l.exec(i)}return new Date(o,a,r)},a=null==i||""===i?s:"string"==typeof i?o(i):"number"==typeof i?isNaN(i)?s:n(i):new Date(i.getTime());return a=a&&"Invalid Date"==""+a?s:a,a&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)),this._daylightSavingAdjust(a)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var s=!e,n=t.selectedMonth,o=t.selectedYear,a=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=a.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=a.getMonth(),t.drawYear=t.selectedYear=t.currentYear=a.getFullYear(),n===t.selectedMonth&&o===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(s?"":this._formatDate(t))},_getDate:function(t){var e=!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return e},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),s="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(s,-i,"M")},next:function(){t.datepicker._adjustDate(s,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(s)},selectDay:function(){return t.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(s,this,"Y"),!1}};t(this).on(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,i,s,n,o,a,r,l,h,c,u,d,p,f,g,m,_,v,b,y,w,k,x,C,D,T,I,M,P,S,N,H,A,z,O,E,W,F,L,R=new Date,Y=this._daylightSavingAdjust(new Date(R.getFullYear(),R.getMonth(),R.getDate())),B=this._get(t,"isRTL"),j=this._get(t,"showButtonPanel"),q=this._get(t,"hideIfNoPrevNext"),K=this._get(t,"navigationAsDateFormat"),U=this._getNumberOfMonths(t),V=this._get(t,"showCurrentAtPos"),X=this._get(t,"stepMonths"),$=1!==U[0]||1!==U[1],G=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),J=this._getMinMaxDate(t,"min"),Q=this._getMinMaxDate(t,"max"),Z=t.drawMonth-V,te=t.drawYear;if (0>Z&&(Z+=12,te--),Q)for(e=this._daylightSavingAdjust(new Date(Q.getFullYear(),Q.getMonth()-U[0]*U[1]+1,Q.getDate())),e=J&&J>e?J:e;this._daylightSavingAdjust(new Date(te,Z,1))>e;)Z--,0>Z&&(Z=11,te--);for(t.drawMonth=Z,t.drawYear=te,i=this._get(t,"prevText"),i=K?this.formatDate(i,this._daylightSavingAdjust(new Date(te,Z-X,1)),this._getFormatConfig(t)):i,s=this._canAdjustMonth(t,-1,te,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(B?"e":"w")+"'>"+i+"</span></a>":q?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(B?"e":"w")+"'>"+i+"</span></a>",n=this._get(t,"nextText"),n=K?this.formatDate(n,this._daylightSavingAdjust(new Date(te,Z+X,1)),this._getFormatConfig(t)):n,o=this._canAdjustMonth(t,1,te,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(B?"w":"e")+"'>"+n+"</span></a>":q?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(B?"w":"e")+"'>"+n+"</span></a>",a=this._get(t,"currentText"),r=this._get(t,"gotoCurrent")&&t.currentDay?G:Y,a=K?this.formatDate(a,r,this._getFormatConfig(t)):a,l=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",h=j?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(B?l:"")+(this._isInRange(t,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+a+"</button>":"")+(B?"":l)+"</div>":"",c=parseInt(this._get(t,"firstDay"),10),c=isNaN(c)?0:c,u=this._get(t,"showWeek"),d=this._get(t,"dayNames"),p=this._get(t,"dayNamesMin"),f=this._get(t,"monthNames"),g=this._get(t,"monthNamesShort"),m=this._get(t,"beforeShowDay"),_=this._get(t,"showOtherMonths"),v=this._get(t,"selectOtherMonths"),b=this._getDefaultDate(t),y="",k=0;U[0]>k;k++){for(x="",this.maxRows=4,C=0;U[1]>C;C++){if (D=this._daylightSavingAdjust(new Date(te,Z,t.selectedDay)),T=" ui-corner-all",I="",$){if (I+="<div class='ui-datepicker-group",U[1]>1)switch(C){case 0:I+=" ui-datepicker-group-first",T=" ui-corner-"+(B?"right":"left");break;case U[1]-1:I+=" ui-datepicker-group-last",T=" ui-corner-"+(B?"left":"right");break;default:I+=" ui-datepicker-group-middle",T=""}I+="'>"}for(I+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+T+"'>"+(/all|left/.test(T)&&0===k?B?o:s:"")+(/all|right/.test(T)&&0===k?B?s:o:"")+this._generateMonthYearHeader(t,Z,te,J,Q,k>0||C>0,f,g)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",M=u?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",w=0;7>w;w++)P=(w+c)%7,M+="<th scope='col'"+((w+c+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+d[P]+"'>"+p[P]+"</span></th>";for(I+=M+"</tr></thead><tbody>",S=this._getDaysInMonth(te,Z),te===t.selectedYear&&Z===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,S)),N=(this._getFirstDayOfMonth(te,Z)-c+7)%7,H=Math.ceil((N+S)/7),A=$?this.maxRows>H?this.maxRows:H:H,this.maxRows=A,z=this._daylightSavingAdjust(new Date(te,Z,1-N)),O=0;A>O;O++){for(I+="<tr>",E=u?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(z)+"</td>":"",w=0;7>w;w++)W=m?m.apply(t.input?t.input[0]:null,[z]):[!0,""],F=z.getMonth()!==Z,L=F&&!v||!W[0]||J&&J>z||Q&&z>Q,E+="<td class='"+((w+c+6)%7>=5?" ui-datepicker-week-end":"")+(F?" ui-datepicker-other-month":"")+(z.getTime()===D.getTime()&&Z===t.selectedMonth&&t._keyEvent||b.getTime()===z.getTime()&&b.getTime()===D.getTime()?" "+this._dayOverClass:"")+(L?" "+this._unselectableClass+" ui-state-disabled":"")+(F&&!_?"":" "+W[1]+(z.getTime()===G.getTime()?" "+this._currentClass:"")+(z.getTime()===Y.getTime()?" ui-datepicker-today":""))+"'"+(F&&!_||!W[2]?"":" title='"+W[2].replace(/'/g,"&#39;")+"'")+(L?"":" data-handler='selectDay' data-event='click' data-month='"+z.getMonth()+"' data-year='"+z.getFullYear()+"'")+">"+(F&&!_?"&#xa0;":L?"<span class='ui-state-default'>"+z.getDate()+"</span>":"<a class='ui-state-default"+(z.getTime()===Y.getTime()?" ui-state-highlight":"")+(z.getTime()===G.getTime()?" ui-state-active":"")+(F?" ui-priority-secondary":"")+"' href='#'>"+z.getDate()+"</a>")+"</td>",z.setDate(z.getDate()+1),z=this._daylightSavingAdjust(z);I+=E+"</tr>"}Z++,Z>11&&(Z=0,te++),I+="</tbody></table>"+($?"</div>"+(U[0]>0&&C===U[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),x+=I}y+=x}return y+=h,t._keyEvent=!1,y},_generateMonthYearHeader:function(t,e,i,s,n,o,a,r){var l,h,c,u,d,p,f,g,m=this._get(t,"changeMonth"),_=this._get(t,"changeYear"),v=this._get(t,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",y="";if (o||!m)y+="<span class='ui-datepicker-month'>"+a[e]+"</span>";else{for(l=s&&s.getFullYear()===i,h=n&&n.getFullYear()===i,y+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;12>c;c++)(!l||c>=s.getMonth())&&(!h||n.getMonth()>=c)&&(y+="<option value='"+c+"'"+(c===e?" selected='selected'":"")+">"+r[c]+"</option>");y+="</select>"}if (v||(b+=y+(!o&&m&&_?"":"&#xa0;")),!t.yearshtml)if (t.yearshtml="",o||!_)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(u=this._get(t,"yearRange").split(":"),d=(new Date).getFullYear(),p=function(t){var e=t.match(/c[+\-].*/)?i+parseInt(t.substring(1),10):t.match(/[+\-].*/)?d+parseInt(t,10):parseInt(t,10);return isNaN(e)?d:e},f=p(u[0]),g=Math.max(f,p(u[1]||"")),f=s?Math.max(f,s.getFullYear()):f,g=n?Math.min(g,n.getFullYear()):g,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g>=f;f++)t.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";t.yearshtml+="</select>",b+=t.yearshtml,t.yearshtml=null}return b+=this._get(t,"yearSuffix"),v&&(b+=(!o&&m&&_?"":"&#xa0;")+y),b+="</div>"},_adjustInstDate:function(t,e,i){var s=t.selectedYear+("Y"===i?e:0),n=t.selectedMonth+("M"===i?e:0),o=Math.min(t.selectedDay,this._getDaysInMonth(s,n))+("D"===i?e:0),a=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(s,n,o)));t.selectedDay=a.getDate(),t.drawMonth=t.selectedMonth=a.getMonth(),t.drawYear=t.selectedYear=a.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),s=this._getMinMaxDate(t,"max"),n=i&&i>e?i:e;return s&&n>s?s:n},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,s){var n=this._getNumberOfMonths(t),o=this._daylightSavingAdjust(new Date(i,s+(0>e?e:n[0]*n[1]),1));return 0>e&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(t,o)},_isInRange:function(t,e){var i,s,n=this._getMinMaxDate(t,"min"),o=this._getMinMaxDate(t,"max"),a=null,r=null,l=this._get(t,"yearRange");return l&&(i=l.split(":"),s=(new Date).getFullYear(),a=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(a+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||e.getTime()>=n.getTime())&&(!o||e.getTime()<=o.getTime())&&(!a||e.getFullYear()>=a)&&(!r||r>=e.getFullYear())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,s){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var n=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(s,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),n,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if (!this.length)return this;t.datepicker.initialized||(t(document).on("mousedown",t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i))},t.datepicker=new s,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.12.1",t.datepicker,t.widget("ui.progressbar",{version:"1.12.1",options:{classes:{"ui-progressbar":"ui-corner-all","ui-progressbar-value":"ui-corner-left","ui-progressbar-complete":"ui-corner-right"},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.attr({role:"progressbar","aria-valuemin":this.min}),this._addClass("ui-progressbar","ui-widget ui-widget-content"),this.valueDiv=t("<div>").appendTo(this.element),this._addClass(this.valueDiv,"ui-progressbar-value","ui-widget-header"),this._refreshValue()},_destroy:function(){this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow"),this.valueDiv.remove()},value:function(t){return void 0===t?this.options.value:(this.options.value=this._constrainedValue(t),this._refreshValue(),void 0)},_constrainedValue:function(t){return void 0===t&&(t=this.options.value),this.indeterminate=t===!1,"number"!=typeof t&&(t=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).width(i.toFixed(0)+"%"),this._toggleClass(this.valueDiv,"ui-progressbar-complete",null,e===this.options.max)._toggleClass("ui-progressbar-indeterminate",null,this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div>").appendTo(this.valueDiv),this._addClass(this.overlayDiv,"ui-progressbar-overlay"))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}}),t.widget("ui.slider",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,s=this.options,n=this.element.find(".ui-slider-handle"),o="<span tabindex='0'></span>",a=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),e=n.length;i>e;e++)a.push(o);this.handles=n.add(t(a.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e).attr("tabIndex",0)})},_createRange:function(){var e=this.options;e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})):(this.range=t("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),("min"===e.range||"max"===e.range)&&this._addClass(this.range,"ui-slider-range-"+e.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(e){var i,s,n,o,a,r,l,h,c=this,u=this.options;return u.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(s-c.values(e));(n>i||n===i&&(e===c._lastChangedValue||c.values(e)===u.min))&&(n=i,o=t(this),a=e)}),r=this._start(e,a),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=a,this._addClass(o,null,"ui-state-active"),o.trigger("focus"),l=o.offset(),h=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=h?{left:0,top:0}:{left:e.pageX-l.left-o.width()/2,top:e.pageY-l.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,a,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,s,n,o;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/e,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),o=this._valueMin()+s*n,this._trimAlignValue(o)},_uiHash:function(t,e,i){var s={handle:this.handles[t],handleIndex:t,value:void 0!==e?e:this.value()};return this._hasMultipleValues()&&(s.value=void 0!==e?e:this.values(t),s.values=i||this.values()),s},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(t,e){return this._trigger("start",t,this._uiHash(e))},_slide:function(t,e,i){var s,n,o=this.value(),a=this.values();this._hasMultipleValues()&&(n=this.values(e?0:1),o=this.values(e),2===this.options.values.length&&this.options.range===!0&&(i=0===e?Math.min(n,i):Math.max(n,i)),a[e]=i),i!==o&&(s=this._trigger("slide",t,this._uiHash(e,i,a)),s!==!1&&(this._hasMultipleValues()?this.values(e,i):this.value(i)))},_stop:function(t,e){this._trigger("stop",t,this._uiHash(e))},_change:function(t,e){this._keySliding||this._mouseSliding||(this._lastChangedValue=e,this._trigger("change",t,this._uiHash(e)))},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(e,i){var s,n,o;if (arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),this._change(null,e),void 0;if (!arguments.length)return this._values();if (!t.isArray(arguments[0]))return this._hasMultipleValues()?this._values(e):this.value();for(s=this.options.values,n=arguments[0],o=0;s.length>o;o+=1)s[o]=this._trimAlignValue(n[o]),this._change(null,o);this._refreshValue()},_setOption:function(e,i){var s,n=0;switch("range"===e&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(n=this.options.values.length),this._super(e,i),e){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(i),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=n-1;s>=0;s--)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(t){this._super(t),this._toggleClass(null,"ui-state-disabled",!!t)},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,s;if (arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if (this._hasMultipleValues()){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(t){if (this._valueMin()>=t)return this._valueMin();if (t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,s=t-i;return 2*Math.abs(i)>=e&&(s+=i>0?e:-e),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var t=this.options.max,e=this._valueMin(),i=this.options.step,s=Math.round((t-e)/i)*i;t=s+e,t>this.options.max&&(t-=i),this.max=parseFloat(t.toFixed(this._precision()))},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(t){"vertical"===t&&this.range.css({width:"",left:""}),"horizontal"===t&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var e,i,s,n,o,a=this.options.range,r=this.options,l=this,h=this._animateOff?!1:r.animate,c={};this._hasMultipleValues()?this.handles.each(function(s){i=100*((l.values(s)-l._valueMin())/(l._valueMax()-l._valueMin())),c["horizontal"===l.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[h?"animate":"css"](c,r.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===s&&l.range.stop(1,1)[h?"animate":"css"]({left:i+"%"},r.animate),1===s&&l.range[h?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:r.animate})):(0===s&&l.range.stop(1,1)[h?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&l.range[h?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:r.animate}))),e=i}):(s=this.value(),n=this._valueMin(),o=this._valueMax(),i=o!==n?100*((s-n)/(o-n)):0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[h?"animate":"css"](c,r.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:i+"%"},r.animate),"max"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:100-i+"%"},r.animate),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:i+"%"},r.animate),"max"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:100-i+"%"},r.animate))},_handleEvents:{keydown:function(e){var i,s,n,o,a=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if (e.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(t(e.target),null,"ui-state-active"),i=this._start(e,a),i===!1))return}switch(o=this.options.step,s=n=this._hasMultipleValues()?this.values(a):this.value(),e.keyCode){case t.ui.keyCode.HOME:n=this._valueMin();break;case t.ui.keyCode.END:n=this._valueMax();break;case t.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if (s===this._valueMax())return;n=this._trimAlignValue(s+o);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if (s===this._valueMin())return;n=this._trimAlignValue(s-o)}this._slide(e,a,n)},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),this._removeClass(t(e.target),null,"ui-state-active"))}}});var d="ui-effects-",p="ui-effects-style",f="ui-effects-animated",g=t;t.effects={effect:{}},function(t,e){function i(t,e,i){var s=u[e.type]||{};return null==t?i||!e.def?null:e.def:(t=s.floor?~~t:parseFloat(t),isNaN(t)?e.def:s.mod?(t+s.mod)%s.mod:0>t?0:t>s.max?s.max:t)}function s(i){var s=h(),n=s._rgba=[];return i=i.toLowerCase(),f(l,function(t,o){var a,r=o.re.exec(i),l=r&&o.parse(r),h=o.space||"rgba";return l?(a=s[h](l),s[c[h].cache]=a[c[h].cache],n=s._rgba=a._rgba,!1):e}),n.length?("0,0,0,0"===n.join()&&t.extend(n,o.transparent),s):o[i]}function n(t,e,i){return i=(i+1)%1,1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var o,a="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],h=t.Color=function(e,i,s,n){return new t.Color.fn.parse(e,i,s,n)},c={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},u={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=h.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(c,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}
}),h.fn=t.extend(h.prototype,{parse:function(n,a,r,l){if (n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(a),a=e);var u=this,d=t.type(n),p=this._rgba=[];return a!==e&&(n=[n,a,r,l],d="array"),"string"===d?this.parse(s(n)||o._default):"array"===d?(f(c.rgba.props,function(t,e){p[e.idx]=i(n[e.idx],e)}),this):"object"===d?(n instanceof h?f(c,function(t,e){n[e.cache]&&(u[e.cache]=n[e.cache].slice())}):f(c,function(e,s){var o=s.cache;f(s.props,function(t,e){if (!u[o]&&s.to){if ("alpha"===t||null==n[t])return;u[o]=s.to(u._rgba)}u[o][e.idx]=i(n[t],e,!0)}),u[o]&&0>t.inArray(null,u[o].slice(0,3))&&(u[o][3]=1,s.from&&(u._rgba=s.from(u[o])))}),this):e},is:function(t){var i=h(t),s=!0,n=this;return f(c,function(t,o){var a,r=i[o.cache];return r&&(a=n[o.cache]||o.to&&o.to(n._rgba)||[],f(o.props,function(t,i){return null!=r[i.idx]?s=r[i.idx]===a[i.idx]:e})),s}),s},_space:function(){var t=[],e=this;return f(c,function(i,s){e[s.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var s=h(t),n=s._space(),o=c[n],a=0===this.alpha()?h("transparent"):this,r=a[o.cache]||o.to(a._rgba),l=r.slice();return s=s[o.cache],f(o.props,function(t,n){var o=n.idx,a=r[o],h=s[o],c=u[n.type]||{};null!==h&&(null===a?l[o]=h:(c.mod&&(h-a>c.mod/2?a+=c.mod:a-h>c.mod/2&&(a-=c.mod)),l[o]=i((h-a)*e+a,n)))}),this[n](l)},blend:function(e){if (1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=h(e)._rgba;return h(t.map(i,function(t,e){return(1-s)*n[e]+s*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),s=i.pop();return e&&i.push(~~(255*s)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),h.fn.parse.prototype=h.fn,c.hsla.to=function(t){if (null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,s=t[0]/255,n=t[1]/255,o=t[2]/255,a=t[3],r=Math.max(s,n,o),l=Math.min(s,n,o),h=r-l,c=r+l,u=.5*c;return e=l===r?0:s===r?60*(n-o)/h+360:n===r?60*(o-s)/h+120:60*(s-n)/h+240,i=0===h?0:.5>=u?h/c:h/(2-c),[Math.round(e)%360,i,u,null==a?1:a]},c.hsla.from=function(t){if (null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],s=t[2],o=t[3],a=.5>=s?s*(1+i):s+i-s*i,r=2*s-a;return[Math.round(255*n(r,a,e+1/3)),Math.round(255*n(r,a,e)),Math.round(255*n(r,a,e-1/3)),o]},f(c,function(s,n){var o=n.props,a=n.cache,l=n.to,c=n.from;h.fn[s]=function(s){if (l&&!this[a]&&(this[a]=l(this._rgba)),s===e)return this[a].slice();var n,r=t.type(s),u="array"===r||"object"===r?s:arguments,d=this[a].slice();return f(o,function(t,e){var s=u["object"===r?t:e.idx];null==s&&(s=d[e.idx]),d[e.idx]=i(s,e)}),c?(n=h(c(d)),n[a]=d,n):h(d)},f(o,function(e,i){h.fn[e]||(h.fn[e]=function(n){var o,a=t.type(n),l="alpha"===e?this._hsla?"hsla":"rgba":s,h=this[l](),c=h[i.idx];return"undefined"===a?c:("function"===a&&(n=n.call(this,c),a=t.type(n)),null==n&&i.empty?this:("string"===a&&(o=r.exec(n),o&&(n=c+parseFloat(o[2])*("+"===o[1]?1:-1))),h[i.idx]=n,this[l](h)))})})}),h.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,n){var o,a,r="";if ("transparent"!==n&&("string"!==t.type(n)||(o=s(n)))){if (n=h(o||n),!d.rgba&&1!==n._rgba[3]){for(a="backgroundColor"===i?e.parentNode:e;(""===r||"transparent"===r)&&a&&a.style;)try{r=t.css(a,"backgroundColor"),a=a.parentNode}catch(l){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(l){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=h(e.elem,i),e.end=h(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},h.hook(a),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,s){e["border"+s+"Color"]=t}),e}},o=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(g),function(){function e(e){var i,s,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,o={};if (n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(o[t.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(o[i]=n[i]);return o}function i(e,i){var s,o,a={};for(s in i)o=i[s],e[s]!==o&&(n[s]||(t.fx.step[s]||!isNaN(parseFloat(o)))&&(a[s]=o));return a}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(g.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(n,o,a,r){var l=t.speed(o,a,r);return this.queue(function(){var o,a=t(this),r=a.attr("class")||"",h=l.children?a.find("*").addBack():a;h=h.map(function(){var i=t(this);return{el:i,start:e(this)}}),o=function(){t.each(s,function(t,e){n[e]&&a[e+"Class"](n[e])})},o(),h=h.map(function(){return this.end=e(this.el[0]),this.diff=i(this.start,this.end),this}),a.attr("class",r),h=h.map(function(){var e=this,i=t.Deferred(),s=t.extend({},l,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,s),i.promise()}),t.when.apply(t,h.get()).done(function(){o(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),l.complete.call(a[0])})})},t.fn.extend({addClass:function(e){return function(i,s,n,o){return s?t.effects.animateClass.call(this,{add:i},s,n,o):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,s,n,o){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},s,n,o):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(i,s,n,o,a){return"boolean"==typeof s||void 0===s?n?t.effects.animateClass.call(this,s?{add:i}:{remove:i},n,o,a):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},s,n,o)}}(t.fn.toggleClass),switchClass:function(e,i,s,n,o){return t.effects.animateClass.call(this,{add:i,remove:e},s,n,o)}})}(),function(){function e(e,i,s,n){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(n=s,s=i,i={}),t.isFunction(s)&&(n=s,s=null),i&&t.extend(e,i),s=s||i.duration,e.duration=t.fx.off?0:"number"==typeof s?s:s in t.fx.speeds?t.fx.speeds[s]:t.fx.speeds._default,e.complete=n||i.complete,e}function i(e){return!e||"number"==typeof e||t.fx.speeds[e]?!0:"string"!=typeof e||t.effects.effect[e]?t.isFunction(e)?!0:"object"!=typeof e||e.effect?!1:!0:!0}function s(t,e){var i=e.outerWidth(),s=e.outerHeight(),n=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/,o=n.exec(t)||["",0,i,s,0];return{top:parseFloat(o[1])||0,right:"auto"===o[2]?i:parseFloat(o[2]),bottom:"auto"===o[3]?s:parseFloat(o[3]),left:parseFloat(o[4])||0}}t.expr&&t.expr.filters&&t.expr.filters.animated&&(t.expr.filters.animated=function(e){return function(i){return!!t(i).data(f)||e(i)}}(t.expr.filters.animated)),t.uiBackCompat!==!1&&t.extend(t.effects,{save:function(t,e){for(var i=0,s=e.length;s>i;i++)null!==e[i]&&t.data(d+e[i],t[0].style[e[i]])},restore:function(t,e){for(var i,s=0,n=e.length;n>s;s++)null!==e[s]&&(i=t.data(d+e[s]),t.css(e[s],i))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},createWrapper:function(e){if (e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},s=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:e.width(),height:e.height()},o=document.activeElement;try{o.id}catch(a){o=document.body}return e.wrap(s),(e[0]===o||t.contains(e[0],o))&&t(o).trigger("focus"),s=e.parent(),"static"===e.css("position")?(s.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,s){i[s]=e.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(n),s.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).trigger("focus")),e}}),t.extend(t.effects,{version:"1.12.1",define:function(e,i,s){return s||(s=i,i="effect"),t.effects.effect[e]=s,t.effects.effect[e].mode=i,s},scaledDimensions:function(t,e,i){if (0===e)return{height:0,width:0,outerHeight:0,outerWidth:0};var s="horizontal"!==i?(e||100)/100:1,n="vertical"!==i?(e||100)/100:1;return{height:t.height()*n,width:t.width()*s,outerHeight:t.outerHeight()*n,outerWidth:t.outerWidth()*s}},clipToBox:function(t){return{width:t.clip.right-t.clip.left,height:t.clip.bottom-t.clip.top,left:t.clip.left,top:t.clip.top}},unshift:function(t,e,i){var s=t.queue();e>1&&s.splice.apply(s,[1,0].concat(s.splice(e,i))),t.dequeue()},saveStyle:function(t){t.data(p,t[0].style.cssText)},restoreStyle:function(t){t[0].style.cssText=t.data(p)||"",t.removeData(p)},mode:function(t,e){var i=t.is(":hidden");return"toggle"===e&&(e=i?"show":"hide"),(i?"hide"===e:"show"===e)&&(e="none"),e},getBaseline:function(t,e){var i,s;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=t[1]/e.width}return{x:s,y:i}},createPlaceholder:function(e){var i,s=e.css("position"),n=e.position();return e.css({marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()),/^(static|relative)/.test(s)&&(s="absolute",i=t("<"+e[0].nodeName+">").insertAfter(e).css({display:/^(inline|ruby)/.test(e.css("display"))?"inline-block":"block",visibility:"hidden",marginTop:e.css("marginTop"),marginBottom:e.css("marginBottom"),marginLeft:e.css("marginLeft"),marginRight:e.css("marginRight"),"float":e.css("float")}).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).addClass("ui-effects-placeholder"),e.data(d+"placeholder",i)),e.css({position:s,left:n.left,top:n.top}),i},removePlaceholder:function(t){var e=d+"placeholder",i=t.data(e);i&&(i.remove(),t.removeData(e))},cleanUp:function(e){t.effects.restoreStyle(e),t.effects.removePlaceholder(e)},setTransition:function(e,i,s,n){return n=n||{},t.each(i,function(t,i){var o=e.cssUnit(i);o[0]>0&&(n[i]=o[0]*s+o[1])}),n}}),t.fn.extend({effect:function(){function i(e){function i(){r.removeData(f),t.effects.cleanUp(r),"hide"===s.mode&&r.hide(),a()}function a(){t.isFunction(l)&&l.call(r[0]),t.isFunction(e)&&e()}var r=t(this);s.mode=c.shift(),t.uiBackCompat===!1||o?"none"===s.mode?(r[h](),a()):n.call(r[0],s,i):(r.is(":hidden")?"hide"===h:"show"===h)?(r[h](),a()):n.call(r[0],s,a)}var s=e.apply(this,arguments),n=t.effects.effect[s.effect],o=n.mode,a=s.queue,r=a||"fx",l=s.complete,h=s.mode,c=[],u=function(e){var i=t(this),s=t.effects.mode(i,h)||o;i.data(f,!0),c.push(s),o&&("show"===s||s===o&&"hide"===s)&&i.show(),o&&"none"===s||t.effects.saveStyle(i),t.isFunction(e)&&e()};return t.fx.off||!n?h?this[h](s.duration,l):this.each(function(){l&&l.call(this)}):a===!1?this.each(u).each(i):this.queue(r,u).queue(r,i)},show:function(t){return function(s){if (i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(t.fn.show),hide:function(t){return function(s){if (i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(t.fn.hide),toggle:function(t){return function(s){if (i(s)||"boolean"==typeof s)return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),s=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(s=[parseFloat(i),e])}),s},cssClip:function(t){return t?this.css("clip","rect("+t.top+"px "+t.right+"px "+t.bottom+"px "+t.left+"px)"):s(this.css("clip"),this)},transfer:function(e,i){var s=t(this),n=t(e.to),o="fixed"===n.css("position"),a=t("body"),r=o?a.scrollTop():0,l=o?a.scrollLeft():0,h=n.offset(),c={top:h.top-r,left:h.left-l,height:n.innerHeight(),width:n.innerWidth()},u=s.offset(),d=t("<div class='ui-effects-transfer'></div>").appendTo("body").addClass(e.className).css({top:u.top-r,left:u.left-l,height:s.innerHeight(),width:s.innerWidth(),position:o?"fixed":"absolute"}).animate(c,e.duration,e.easing,function(){d.remove(),t.isFunction(i)&&i()})}}),t.fx.step.clip=function(e){e.clipInit||(e.start=t(e.elem).cssClip(),"string"==typeof e.end&&(e.end=s(e.end,e.elem)),e.clipInit=!0),t(e.elem).cssClip({top:e.pos*(e.end.top-e.start.top)+e.start.top,right:e.pos*(e.end.right-e.start.right)+e.start.right,bottom:e.pos*(e.end.bottom-e.start.bottom)+e.start.bottom,left:e.pos*(e.end.left-e.start.left)+e.start.left})}}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}();var m=t.effects;t.effects.define("blind","hide",function(e,i){var s={up:["bottom","top"],vertical:["bottom","top"],down:["top","bottom"],left:["right","left"],horizontal:["right","left"],right:["left","right"]},n=t(this),o=e.direction||"up",a=n.cssClip(),r={clip:t.extend({},a)},l=t.effects.createPlaceholder(n);r.clip[s[o][0]]=r.clip[s[o][1]],"show"===e.mode&&(n.cssClip(r.clip),l&&l.css(t.effects.clipToBox(r)),r.clip=a),l&&l.animate(t.effects.clipToBox(r),e.duration,e.easing),n.animate(r,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("bounce",function(e,i){var s,n,o,a=t(this),r=e.mode,l="hide"===r,h="show"===r,c=e.direction||"up",u=e.distance,d=e.times||5,p=2*d+(h||l?1:0),f=e.duration/p,g=e.easing,m="up"===c||"down"===c?"top":"left",_="up"===c||"left"===c,v=0,b=a.queue().length;for(t.effects.createPlaceholder(a),o=a.css(m),u||(u=a["top"===m?"outerHeight":"outerWidth"]()/3),h&&(n={opacity:1},n[m]=o,a.css("opacity",0).css(m,_?2*-u:2*u).animate(n,f,g)),l&&(u/=Math.pow(2,d-1)),n={},n[m]=o;d>v;v++)s={},s[m]=(_?"-=":"+=")+u,a.animate(s,f,g).animate(n,f,g),u=l?2*u:u/2;l&&(s={opacity:0},s[m]=(_?"-=":"+=")+u,a.animate(s,f,g)),a.queue(i),t.effects.unshift(a,b,p+1)}),t.effects.define("clip","hide",function(e,i){var s,n={},o=t(this),a=e.direction||"vertical",r="both"===a,l=r||"horizontal"===a,h=r||"vertical"===a;s=o.cssClip(),n.clip={top:h?(s.bottom-s.top)/2:s.top,right:l?(s.right-s.left)/2:s.right,bottom:h?(s.bottom-s.top)/2:s.bottom,left:l?(s.right-s.left)/2:s.left},t.effects.createPlaceholder(o),"show"===e.mode&&(o.cssClip(n.clip),n.clip=s),o.animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("drop","hide",function(e,i){var s,n=t(this),o=e.mode,a="show"===o,r=e.direction||"left",l="up"===r||"down"===r?"top":"left",h="up"===r||"left"===r?"-=":"+=",c="+="===h?"-=":"+=",u={opacity:0};t.effects.createPlaceholder(n),s=e.distance||n["top"===l?"outerHeight":"outerWidth"](!0)/2,u[l]=h+s,a&&(n.css(u),u[l]=c+s,u.opacity=1),n.animate(u,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("explode","hide",function(e,i){function s(){b.push(this),b.length===u*d&&n()}function n(){p.css({visibility:"visible"}),t(b).remove(),i()}var o,a,r,l,h,c,u=e.pieces?Math.round(Math.sqrt(e.pieces)):3,d=u,p=t(this),f=e.mode,g="show"===f,m=p.show().css("visibility","hidden").offset(),_=Math.ceil(p.outerWidth()/d),v=Math.ceil(p.outerHeight()/u),b=[];for(o=0;u>o;o++)for(l=m.top+o*v,c=o-(u-1)/2,a=0;d>a;a++)r=m.left+a*_,h=a-(d-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-a*_,top:-o*v}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:_,height:v,left:r+(g?h*_:0),top:l+(g?c*v:0),opacity:g?0:1}).animate({left:r+(g?0:h*_),top:l+(g?0:c*v),opacity:g?1:0},e.duration||500,e.easing,s)}),t.effects.define("fade","toggle",function(e,i){var s="show"===e.mode;t(this).css("opacity",s?0:1).animate({opacity:s?1:0},{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("fold","hide",function(e,i){var s=t(this),n=e.mode,o="show"===n,a="hide"===n,r=e.size||15,l=/([0-9]+)%/.exec(r),h=!!e.horizFirst,c=h?["right","bottom"]:["bottom","right"],u=e.duration/2,d=t.effects.createPlaceholder(s),p=s.cssClip(),f={clip:t.extend({},p)},g={clip:t.extend({},p)},m=[p[c[0]],p[c[1]]],_=s.queue().length;l&&(r=parseInt(l[1],10)/100*m[a?0:1]),f.clip[c[0]]=r,g.clip[c[0]]=r,g.clip[c[1]]=0,o&&(s.cssClip(g.clip),d&&d.css(t.effects.clipToBox(g)),g.clip=p),s.queue(function(i){d&&d.animate(t.effects.clipToBox(f),u,e.easing).animate(t.effects.clipToBox(g),u,e.easing),i()}).animate(f,u,e.easing).animate(g,u,e.easing).queue(i),t.effects.unshift(s,_,4)}),t.effects.define("highlight","show",function(e,i){var s=t(this),n={backgroundColor:s.css("backgroundColor")};"hide"===e.mode&&(n.opacity=0),t.effects.saveStyle(s),s.css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(n,{queue:!1,duration:e.duration,easing:e.easing,complete:i})}),t.effects.define("size",function(e,i){var s,n,o,a=t(this),r=["fontSize"],l=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],h=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],c=e.mode,u="effect"!==c,d=e.scale||"both",p=e.origin||["middle","center"],f=a.css("position"),g=a.position(),m=t.effects.scaledDimensions(a),_=e.from||m,v=e.to||t.effects.scaledDimensions(a,0);t.effects.createPlaceholder(a),"show"===c&&(o=_,_=v,v=o),n={from:{y:_.height/m.height,x:_.width/m.width},to:{y:v.height/m.height,x:v.width/m.width}},("box"===d||"both"===d)&&(n.from.y!==n.to.y&&(_=t.effects.setTransition(a,l,n.from.y,_),v=t.effects.setTransition(a,l,n.to.y,v)),n.from.x!==n.to.x&&(_=t.effects.setTransition(a,h,n.from.x,_),v=t.effects.setTransition(a,h,n.to.x,v))),("content"===d||"both"===d)&&n.from.y!==n.to.y&&(_=t.effects.setTransition(a,r,n.from.y,_),v=t.effects.setTransition(a,r,n.to.y,v)),p&&(s=t.effects.getBaseline(p,m),_.top=(m.outerHeight-_.outerHeight)*s.y+g.top,_.left=(m.outerWidth-_.outerWidth)*s.x+g.left,v.top=(m.outerHeight-v.outerHeight)*s.y+g.top,v.left=(m.outerWidth-v.outerWidth)*s.x+g.left),a.css(_),("content"===d||"both"===d)&&(l=l.concat(["marginTop","marginBottom"]).concat(r),h=h.concat(["marginLeft","marginRight"]),a.find("*[width]").each(function(){var i=t(this),s=t.effects.scaledDimensions(i),o={height:s.height*n.from.y,width:s.width*n.from.x,outerHeight:s.outerHeight*n.from.y,outerWidth:s.outerWidth*n.from.x},a={height:s.height*n.to.y,width:s.width*n.to.x,outerHeight:s.height*n.to.y,outerWidth:s.width*n.to.x};n.from.y!==n.to.y&&(o=t.effects.setTransition(i,l,n.from.y,o),a=t.effects.setTransition(i,l,n.to.y,a)),n.from.x!==n.to.x&&(o=t.effects.setTransition(i,h,n.from.x,o),a=t.effects.setTransition(i,h,n.to.x,a)),u&&t.effects.saveStyle(i),i.css(o),i.animate(a,e.duration,e.easing,function(){u&&t.effects.restoreStyle(i)})})),a.animate(v,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){var e=a.offset();0===v.opacity&&a.css("opacity",_.opacity),u||(a.css("position","static"===f?"relative":f).offset(e),t.effects.saveStyle(a)),i()}})}),t.effects.define("scale",function(e,i){var s=t(this),n=e.mode,o=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"effect"!==n?0:100),a=t.extend(!0,{from:t.effects.scaledDimensions(s),to:t.effects.scaledDimensions(s,o,e.direction||"both"),origin:e.origin||["middle","center"]},e);e.fade&&(a.from.opacity=1,a.to.opacity=0),t.effects.effect.size.call(this,a,i)}),t.effects.define("puff","hide",function(e,i){var s=t.extend(!0,{},e,{fade:!0,percent:parseInt(e.percent,10)||150});t.effects.effect.scale.call(this,s,i)}),t.effects.define("pulsate","show",function(e,i){var s=t(this),n=e.mode,o="show"===n,a="hide"===n,r=o||a,l=2*(e.times||5)+(r?1:0),h=e.duration/l,c=0,u=1,d=s.queue().length;for((o||!s.is(":visible"))&&(s.css("opacity",0).show(),c=1);l>u;u++)s.animate({opacity:c},h,e.easing),c=1-c;s.animate({opacity:c},h,e.easing),s.queue(i),t.effects.unshift(s,d,l+1)}),t.effects.define("shake",function(e,i){var s=1,n=t(this),o=e.direction||"left",a=e.distance||20,r=e.times||3,l=2*r+1,h=Math.round(e.duration/l),c="up"===o||"down"===o?"top":"left",u="up"===o||"left"===o,d={},p={},f={},g=n.queue().length;for(t.effects.createPlaceholder(n),d[c]=(u?"-=":"+=")+a,p[c]=(u?"+=":"-=")+2*a,f[c]=(u?"-=":"+=")+2*a,n.animate(d,h,e.easing);r>s;s++)n.animate(p,h,e.easing).animate(f,h,e.easing);n.animate(p,h,e.easing).animate(d,h/2,e.easing).queue(i),t.effects.unshift(n,g,l+1)}),t.effects.define("slide","show",function(e,i){var s,n,o=t(this),a={up:["bottom","top"],down:["top","bottom"],left:["right","left"],right:["left","right"]},r=e.mode,l=e.direction||"left",h="up"===l||"down"===l?"top":"left",c="up"===l||"left"===l,u=e.distance||o["top"===h?"outerHeight":"outerWidth"](!0),d={};t.effects.createPlaceholder(o),s=o.cssClip(),n=o.position()[h],d[h]=(c?-1:1)*u+n,d.clip=o.cssClip(),d.clip[a[l][1]]=d.clip[a[l][0]],"show"===r&&(o.cssClip(d.clip),o.css(h,d[h]),d.clip=s,d[h]=n),o.animate(d,{queue:!1,duration:e.duration,easing:e.easing,complete:i})});var m;t.uiBackCompat!==!1&&(m=t.effects.define("transfer",function(e,i){t(this).transfer(e,i)}))});




function inherits(descendant, parent) {
	var keys = [];

	// Only iterate the keys if we were given an object, and
	// a special check for null, as typeof null == "object"
	if (typeof parent === "object" && parent !== null) {	
		// Use a standard for in loop
		for (var x in parent) {
			// A for in will iterate over members on the prototype
			// chain as well, but Object.getOwnPropertyNames returns
			// only those directly on the object, so use hasOwnProperty.
			if (parent.hasOwnProperty(x)) {
				keys.push(x);
			}
		}
	}
	
	for (var i=0; i<keys.length; i++){
		descendant[keys[i]]=parent[keys[i]];
	}
	
	descendant["parent"]=parent;
};



function idEquals(id1, id2){
	if (AP.data.isInt(id1) && AP.data.isInt(id2)){
		return parseInt(id1) === parseInt(id2);
	}
	
	return id1 === id2;
}


function isset(value){
	if (value === null || typeof(value) == "undefined"){
		return false;
	}
	
	return true;
};


function inverse(val){
	if (val && parseInt(val)){
		return 0;
	}
	
	return 1;
};

if (!String.prototype.padStart){
	String.prototype.padStart = function padStart(targetLength,padString) {
		targetLength = targetLength>>0; //truncate if number or convert non-number to 0;
		padString = String((typeof padString !== 'undefined' ? padString : ' '));
		if (this.length > targetLength) {
			return String(this);
		}
		else {
			targetLength = targetLength-this.length;
			if (targetLength > padString.length) {
				padString += padString.repeat(targetLength/padString.length); //append to original to ensure we are longer than needed
			}
			return padString.slice(0,targetLength) + String(this);
		}
	};
}
 



!function(a){function b(a){var b=a.length,d=c.type(a);return"function"===d||c.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===d||0===b||"number"==typeof b&&b>0&&b-1 in a}if (!a.jQuery){var c=function(a,b){return new c.fn.init(a,b)};c.isWindow=function(a){return null!=a&&a==a.window},c.type=function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?e[g.call(a)]||"object":typeof a},c.isArray=Array.isArray||function(a){return"array"===c.type(a)},c.isPlainObject=function(a){var b;if (!a||"object"!==c.type(a)||a.nodeType||c.isWindow(a))return!1;try{if (a.constructor&&!f.call(a,"constructor")&&!f.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(d){return!1}for(b in a);return void 0===b||f.call(a,b)},c.each=function(a,c,d){var e,f=0,g=a.length,h=b(a);if (d){if (h)for(;g>f&&(e=c.apply(a[f],d),e!==!1);f++);else for(f in a)if (e=c.apply(a[f],d),e===!1)break}else if (h)for(;g>f&&(e=c.call(a[f],f,a[f]),e!==!1);f++);else for(f in a)if (e=c.call(a[f],f,a[f]),e===!1)break;return a},c.data=function(a,b,e){if (void 0===e){var f=a[c.expando],g=f&&d[f];if (void 0===b)return g;if (g&&b in g)return g[b]}else if (void 0!==b){var f=a[c.expando]||(a[c.expando]=++c.uuid);return d[f]=d[f]||{},d[f][b]=e,e}},c.removeData=function(a,b){var e=a[c.expando],f=e&&d[e];f&&c.each(b,function(a,b){delete f[b]})},c.extend=function(){var a,b,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[i]||{},i++),"object"!=typeof h&&"function"!==c.type(h)&&(h={}),i===j&&(h=this,i--);j>i;i++)if (null!=(f=arguments[i]))for(e in f)a=h[e],d=f[e],h!==d&&(k&&d&&(c.isPlainObject(d)||(b=c.isArray(d)))?(b?(b=!1,g=a&&c.isArray(a)?a:[]):g=a&&c.isPlainObject(a)?a:{},h[e]=c.extend(k,g,d)):void 0!==d&&(h[e]=d));return h},c.queue=function(a,d,e){function f(a,c){var d=c||[];return null!=a&&(b(Object(a))?!function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;)a[e++]=b[d++];if (c!==c)for(;void 0!==b[d];)a[e++]=b[d++];return a.length=e,a}(d,"string"==typeof a?[a]:a):[].push.call(d,a)),d}if (a){d=(d||"fx")+"queue";var g=c.data(a,d);return e?(!g||c.isArray(e)?g=c.data(a,d,f(e)):g.push(e),g):g||[]}},c.dequeue=function(a,b){c.each(a.nodeType?[a]:a,function(a,d){b=b||"fx";var e=c.queue(d,b),f=e.shift();"inprogress"===f&&(f=e.shift()),f&&("fx"===b&&e.unshift("inprogress"),f.call(d,function(){c.dequeue(d,b)}))})},c.fn=c.prototype={init:function(a){if (a.nodeType)return this[0]=a,this;throw new Error("Not a DOM node.")},offset:function(){var b=this[0].getBoundingClientRect?this[0].getBoundingClientRect():{top:0,left:0};return{top:b.top+(a.pageYOffset||document.scrollTop||0)-(document.clientTop||0),left:b.left+(a.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0)}},position:function(){function a(){for(var a=this.offsetParent||document;a&&"html"===!a.nodeType.toLowerCase&&"static"===a.style.position;)a=a.offsetParent;return a||document}var b=this[0],a=a.apply(b),d=this.offset(),e=/^(?:body|html)$/i.test(a.nodeName)?{top:0,left:0}:c(a).offset();return d.top-=parseFloat(b.style.marginTop)||0,d.left-=parseFloat(b.style.marginLeft)||0,a.style&&(e.top+=parseFloat(a.style.borderTopWidth)||0,e.left+=parseFloat(a.style.borderLeftWidth)||0),{top:d.top-e.top,left:d.left-e.left}}};var d={};c.expando="velocity"+(new Date).getTime(),c.uuid=0;for(var e={},f=e.hasOwnProperty,g=e.toString,h="Boolean Number String Function Array Date RegExp Object Error".split(" "),i=0;i<h.length;i++)e["[object "+h[i]+"]"]=h[i].toLowerCase();c.fn.init.prototype=c.fn,a.Velocity={Utilities:c}}}(window),function(a){"object"==typeof module&&"object"==typeof module.exports?module.exports=a():"function"==typeof define&&define.amd?define(a):a()}(function(){return function(a,b,c,d){function e(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function f(a){return p.isWrapped(a)?a=[].slice.call(a):p.isNode(a)&&(a=[a]),a}function g(a){var b=m.data(a,"velocity");return null===b?d:b}function h(a){return function(b){return Math.round(b*a)*(1/a)}}function i(a,c,d,e){function f(a,b){return 1-3*b+3*a}function g(a,b){return 3*b-6*a}function h(a){return 3*a}function i(a,b,c){return((f(b,c)*a+g(b,c))*a+h(b))*a}function j(a,b,c){return 3*f(b,c)*a*a+2*g(b,c)*a+h(b)}function k(b,c){for(var e=0;p>e;++e){var f=j(c,a,d);if (0===f)return c;var g=i(c,a,d)-b;c-=g/f}return c}function l(){for(var b=0;t>b;++b)x[b]=i(b*u,a,d)}function m(b,c,e){var f,g,h=0;do g=c+(e-c)/2,f=i(g,a,d)-b,f>0?e=g:c=g;while(Math.abs(f)>r&&++h<s);return g}function n(b){for(var c=0,e=1,f=t-1;e!=f&&x[e]<=b;++e)c+=u;--e;var g=(b-x[e])/(x[e+1]-x[e]),h=c+g*u,i=j(h,a,d);return i>=q?k(b,h):0==i?h:m(b,c,c+u)}function o(){y=!0,(a!=c||d!=e)&&l()}var p=4,q=.001,r=1e-7,s=10,t=11,u=1/(t-1),v="Float32Array"in b;if (4!==arguments.length)return!1;for(var w=0;4>w;++w)if ("number"!=typeof arguments[w]||isNaN(arguments[w])||!isFinite(arguments[w]))return!1;a=Math.min(a,1),d=Math.min(d,1),a=Math.max(a,0),d=Math.max(d,0);var x=v?new Float32Array(t):new Array(t),y=!1,z=function(b){return y||o(),a===c&&d===e?b:0===b?0:1===b?1:i(n(b),c,e)};z.getControlPoints=function(){return[{x:a,y:c},{x:d,y:e}]};var A="generateBezier("+[a,c,d,e]+")";return z.toString=function(){return A},z}function j(a,b){var c=a;return p.isString(a)?t.Easings[a]||(c=!1):c=p.isArray(a)&&1===a.length?h.apply(null,a):p.isArray(a)&&2===a.length?u.apply(null,a.concat([b])):p.isArray(a)&&4===a.length?i.apply(null,a):!1,c===!1&&(c=t.Easings[t.defaults.easing]?t.defaults.easing:s),c}function k(a){if (a){var b=(new Date).getTime(),c=t.State.calls.length;c>1e4&&(t.State.calls=e(t.State.calls));for(var f=0;c>f;f++)if (t.State.calls[f]){var h=t.State.calls[f],i=h[0],j=h[2],n=h[3],o=!!n,q=null;n||(n=t.State.calls[f][3]=b-16);for(var r=Math.min((b-n)/j.duration,1),s=0,u=i.length;u>s;s++){var w=i[s],y=w.element;if (g(y)){var z=!1;if (j.display!==d&&null!==j.display&&"none"!==j.display){if ("flex"===j.display){var A=["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex"];m.each(A,function(a,b){v.setPropertyValue(y,"display",b)})}v.setPropertyValue(y,"display",j.display)}j.visibility!==d&&"hidden"!==j.visibility&&v.setPropertyValue(y,"visibility",j.visibility);for(var B in w)if ("element"!==B){var C,D=w[B],E=p.isString(D.easing)?t.Easings[D.easing]:D.easing;if (1===r)C=D.endValue;else{var F=D.endValue-D.startValue;if (C=D.startValue+F*E(r,j,F),!o&&C===D.currentValue)continue}if (D.currentValue=C,"tween"===B)q=C;else{if (v.Hooks.registered[B]){var G=v.Hooks.getRoot(B),H=g(y).rootPropertyValueCache[G];H&&(D.rootPropertyValue=H)}var I=v.setPropertyValue(y,B,D.currentValue+(0===parseFloat(C)?"":D.unitType),D.rootPropertyValue,D.scrollData);v.Hooks.registered[B]&&(g(y).rootPropertyValueCache[G]=v.Normalizations.registered[G]?v.Normalizations.registered[G]("extract",null,I[1]):I[1]),"transform"===I[0]&&(z=!0)}}j.mobileHA&&g(y).transformCache.translate3d===d&&(g(y).transformCache.translate3d="(0px, 0px, 0px)",z=!0),z&&v.flushTransformCache(y)}}j.display!==d&&"none"!==j.display&&(t.State.calls[f][2].display=!1),j.visibility!==d&&"hidden"!==j.visibility&&(t.State.calls[f][2].visibility=!1),j.progress&&j.progress.call(h[1],h[1],r,Math.max(0,n+j.duration-b),n,q),1===r&&l(f)}}t.State.isTicking&&x(k)}function l(a,b){if (!t.State.calls[a])return!1;for(var c=t.State.calls[a][0],e=t.State.calls[a][1],f=t.State.calls[a][2],h=t.State.calls[a][4],i=!1,j=0,k=c.length;k>j;j++){var l=c[j].element;if (b||f.loop||("none"===f.display&&v.setPropertyValue(l,"display",f.display),"hidden"===f.visibility&&v.setPropertyValue(l,"visibility",f.visibility)),f.loop!==!0&&(m.queue(l)[1]===d||!/\.velocityQueueEntryFlag/i.test(m.queue(l)[1]))&&g(l)){g(l).isAnimating=!1,g(l).rootPropertyValueCache={};var n=!1;m.each(v.Lists.transforms3D,function(a,b){var c=/^scale/.test(b)?1:0,e=g(l).transformCache[b];g(l).transformCache[b]!==d&&new RegExp("^\\("+c+"[^.]").test(e)&&(n=!0,delete g(l).transformCache[b])}),f.mobileHA&&(n=!0,delete g(l).transformCache.translate3d),n&&v.flushTransformCache(l),v.Values.removeClass(l,"velocity-animating")}if (!b&&f.complete&&!f.loop&&j===k-1)try{f.complete.call(e,e)}catch(o){setTimeout(function(){throw o},1)}h&&f.loop!==!0&&h(e),g(l)&&f.loop===!0&&!b&&(m.each(g(l).tweensContainer,function(a,b){/^rotate/.test(a)&&360===parseFloat(b.endValue)&&(b.endValue=0,b.startValue=360),/^backgroundPosition/.test(a)&&100===parseFloat(b.endValue)&&"%"===b.unitType&&(b.endValue=0,b.startValue=100)}),t(l,"reverse",{loop:!0,delay:f.delay})),f.queue!==!1&&m.dequeue(l,f.queue)}t.State.calls[a]=!1;for(var p=0,q=t.State.calls.length;q>p;p++)if (t.State.calls[p]!==!1){i=!0;break}i===!1&&(t.State.isTicking=!1,delete t.State.calls,t.State.calls=[])}var m,n=function(){if (c.documentMode)return c.documentMode;for(var a=7;a>4;a--){var b=c.createElement("div");if (b.innerHTML="<!--[if IE "+a+"]><span></span><![endif]-->",b.getElementsByTagName("span").length)return b=null,a}return d}(),o=function(){var a=0;return b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||function(b){var c,d=(new Date).getTime();return c=Math.max(0,16-(d-a)),a=d+c,setTimeout(function(){b(d+c)},c)}}(),p={isString:function(a){return"string"==typeof a},isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},isFunction:function(a){return"[object Function]"===Object.prototype.toString.call(a)},isNode:function(a){return a&&a.nodeType},isNodeList:function(a){return"object"==typeof a&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(Object.prototype.toString.call(a))&&a.length!==d&&(0===a.length||"object"==typeof a[0]&&a[0].nodeType>0)},isWrapped:function(a){return a&&(a.jquery||b.Zepto&&b.Zepto.zepto.isZ(a))},isSVG:function(a){return b.SVGElement&&a instanceof b.SVGElement},isEmptyObject:function(a){for(var b in a)return!1;return!0}},q=!1;if (a.fn&&a.fn.jquery?(m=a,q=!0):m=b.Velocity.Utilities,8>=n&&!q)throw new Error("Velocity: IE8 and below require jQuery to be loaded before Velocity.");if (7>=n)return void(jQuery.fn.velocity=jQuery.fn.animate);var r=400,s="swing",t={State:{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid:/Android/i.test(navigator.userAgent),isGingerbread:/Android 2\.3\.[3-7]/i.test(navigator.userAgent),isChrome:b.chrome,isFirefox:/Firefox/i.test(navigator.userAgent),prefixElement:c.createElement("div"),prefixMatches:{},scrollAnchor:null,scrollPropertyLeft:null,scrollPropertyTop:null,isTicking:!1,calls:[]},CSS:{},Utilities:m,Redirects:{},Easings:{},Promise:b.Promise,defaults:{queue:"",duration:r,easing:s,begin:d,complete:d,progress:d,display:d,visibility:d,loop:!1,delay:!1,mobileHA:!0,_cacheValues:!0},init:function(a){m.data(a,"velocity",{isSVG:p.isSVG(a),isAnimating:!1,computedStyle:null,tweensContainer:null,rootPropertyValueCache:{},transformCache:{}})},hook:null,mock:!1,version:{major:1,minor:2,patch:2},debug:!1};b.pageYOffset!==d?(t.State.scrollAnchor=b,t.State.scrollPropertyLeft="pageXOffset",t.State.scrollPropertyTop="pageYOffset"):(t.State.scrollAnchor=c.documentElement||c.body.parentNode||c.body,t.State.scrollPropertyLeft="scrollLeft",t.State.scrollPropertyTop="scrollTop");var u=function(){function a(a){return-a.tension*a.x-a.friction*a.v}function b(b,c,d){var e={x:b.x+d.dx*c,v:b.v+d.dv*c,tension:b.tension,friction:b.friction};return{dx:e.v,dv:a(e)}}function c(c,d){var e={dx:c.v,dv:a(c)},f=b(c,.5*d,e),g=b(c,.5*d,f),h=b(c,d,g),i=1/6*(e.dx+2*(f.dx+g.dx)+h.dx),j=1/6*(e.dv+2*(f.dv+g.dv)+h.dv);return c.x=c.x+i*d,c.v=c.v+j*d,c}return function d(a,b,e){var f,g,h,i={x:-1,v:0,tension:null,friction:null},j=[0],k=0,l=1e-4,m=.016;for(a=parseFloat(a)||500,b=parseFloat(b)||20,e=e||null,i.tension=a,i.friction=b,f=null!==e,f?(k=d(a,b),g=k/e*m):g=m;;)if (h=c(h||i,g),j.push(1+h.x),k+=16,!(Math.abs(h.x)>l&&Math.abs(h.v)>l))break;return f?function(a){return j[a*(j.length-1)|0]}:k}}();t.Easings={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},spring:function(a){return 1-Math.cos(4.5*a*Math.PI)*Math.exp(6*-a)}},m.each([["ease",[.25,.1,.25,1]],["ease-in",[.42,0,1,1]],["ease-out",[0,0,.58,1]],["ease-in-out",[.42,0,.58,1]],["easeInSine",[.47,0,.745,.715]],["easeOutSine",[.39,.575,.565,1]],["easeInOutSine",[.445,.05,.55,.95]],["easeInQuad",[.55,.085,.68,.53]],["easeOutQuad",[.25,.46,.45,.94]],["easeInOutQuad",[.455,.03,.515,.955]],["easeInCubic",[.55,.055,.675,.19]],["easeOutCubic",[.215,.61,.355,1]],["easeInOutCubic",[.645,.045,.355,1]],["easeInQuart",[.895,.03,.685,.22]],["easeOutQuart",[.165,.84,.44,1]],["easeInOutQuart",[.77,0,.175,1]],["easeInQuint",[.755,.05,.855,.06]],["easeOutQuint",[.23,1,.32,1]],["easeInOutQuint",[.86,0,.07,1]],["easeInExpo",[.95,.05,.795,.035]],["easeOutExpo",[.19,1,.22,1]],["easeInOutExpo",[1,0,0,1]],["easeInCirc",[.6,.04,.98,.335]],["easeOutCirc",[.075,.82,.165,1]],["easeInOutCirc",[.785,.135,.15,.86]]],function(a,b){t.Easings[b[0]]=i.apply(null,b[1])});var v=t.CSS={RegEx:{isHex:/^#([A-f\d]{3}){1,2}$/i,valueUnwrap:/^[A-z]+\((.*)\)$/i,wrappedValueAlreadyExtracted:/[0-9.]+ [0-9.]+ [0-9.]+( [0-9.]+)?/,valueSplit:/([A-z]+\(.+\))|(([A-z0-9#-.]+?)(?=\s|$))/gi},Lists:{colors:["fill","stroke","stopColor","color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","outlineColor"],transformsBase:["translateX","translateY","scale","scaleX","scaleY","skewX","skewY","rotateZ"],transforms3D:["transformPerspective","translateZ","scaleZ","rotateX","rotateY"]},Hooks:{templates:{textShadow:["Color X Y Blur","black 0px 0px 0px"],boxShadow:["Color X Y Blur Spread","black 0px 0px 0px 0px"],clip:["Top Right Bottom Left","0px 0px 0px 0px"],backgroundPosition:["X Y","0% 0%"],transformOrigin:["X Y Z","50% 50% 0px"],perspectiveOrigin:["X Y","50% 50%"]},registered:{},register:function(){for(var a=0;a<v.Lists.colors.length;a++){var b="color"===v.Lists.colors[a]?"0 0 0 1":"255 255 255 1";v.Hooks.templates[v.Lists.colors[a]]=["Red Green Blue Alpha",b]}var c,d,e;if (n)for(c in v.Hooks.templates){d=v.Hooks.templates[c],e=d[0].split(" ");var f=d[1].match(v.RegEx.valueSplit);"Color"===e[0]&&(e.push(e.shift()),f.push(f.shift()),v.Hooks.templates[c]=[e.join(" "),f.join(" ")])}for(c in v.Hooks.templates){d=v.Hooks.templates[c],e=d[0].split(" ");for(var a in e){var g=c+e[a],h=a;v.Hooks.registered[g]=[c,h]}}},getRoot:function(a){var b=v.Hooks.registered[a];return b?b[0]:a},cleanRootPropertyValue:function(a,b){return v.RegEx.valueUnwrap.test(b)&&(b=b.match(v.RegEx.valueUnwrap)[1]),v.Values.isCSSNullValue(b)&&(b=v.Hooks.templates[a][1]),b},extractValue:function(a,b){var c=v.Hooks.registered[a];if (c){var d=c[0],e=c[1];return b=v.Hooks.cleanRootPropertyValue(d,b),b.toString().match(v.RegEx.valueSplit)[e]}return b},injectValue:function(a,b,c){var d=v.Hooks.registered[a];if (d){var e,f,g=d[0],h=d[1];return c=v.Hooks.cleanRootPropertyValue(g,c),e=c.toString().match(v.RegEx.valueSplit),e[h]=b,f=e.join(" ")}return c}},Normalizations:{registered:{clip:function(a,b,c){switch(a){case"name":return"clip";case"extract":var d;return v.RegEx.wrappedValueAlreadyExtracted.test(c)?d=c:(d=c.toString().match(v.RegEx.valueUnwrap),d=d?d[1].replace(/,(\s+)?/g," "):c),d;case"inject":return"rect("+c+")"}},blur:function(a,b,c){switch(a){case"name":return t.State.isFirefox?"filter":"-webkit-filter";case"extract":var d=parseFloat(c);if (!d&&0!==d){var e=c.toString().match(/blur\(([0-9]+[A-z]+)\)/i);d=e?e[1]:0}return d;case"inject":return parseFloat(c)?"blur("+c+")":"none"}},opacity:function(a,b,c){if (8>=n)switch(a){case"name":return"filter";case"extract":var d=c.toString().match(/alpha\(opacity=(.*)\)/i);return c=d?d[1]/100:1;case"inject":return b.style.zoom=1,parseFloat(c)>=1?"":"alpha(opacity="+parseInt(100*parseFloat(c),10)+")"}else switch(a){case"name":return"opacity";case"extract":return c;case"inject":return c}}},register:function(){9>=n||t.State.isGingerbread||(v.Lists.transformsBase=v.Lists.transformsBase.concat(v.Lists.transforms3D));for(var a=0;a<v.Lists.transformsBase.length;a++)!function(){var b=v.Lists.transformsBase[a];v.Normalizations.registered[b]=function(a,c,e){switch(a){case"name":return"transform";case"extract":return g(c)===d||g(c).transformCache[b]===d?/^scale/i.test(b)?1:0:g(c).transformCache[b].replace(/[()]/g,"");case"inject":var f=!1;switch(b.substr(0,b.length-1)){case"translate":f=!/(%|px|em|rem|vw|vh|\d)$/i.test(e);break;case"scal":case"scale":t.State.isAndroid&&g(c).transformCache[b]===d&&1>e&&(e=1),f=!/(\d)$/i.test(e);break;case"skew":f=!/(deg|\d)$/i.test(e);break;case"rotate":f=!/(deg|\d)$/i.test(e)}return f||(g(c).transformCache[b]="("+e+")"),g(c).transformCache[b]}}}();for(var a=0;a<v.Lists.colors.length;a++)!function(){var b=v.Lists.colors[a];v.Normalizations.registered[b]=function(a,c,e){switch(a){case"name":return b;case"extract":var f;if (v.RegEx.wrappedValueAlreadyExtracted.test(e))f=e;else{var g,h={black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",red:"rgb(255, 0, 0)",white:"rgb(255, 255, 255)"};/^[A-z]+$/i.test(e)?g=h[e]!==d?h[e]:h.black:v.RegEx.isHex.test(e)?g="rgb("+v.Values.hexToRgb(e).join(" ")+")":/^rgba?\(/i.test(e)||(g=h.black),f=(g||e).toString().match(v.RegEx.valueUnwrap)[1].replace(/,(\s+)?/g," ")}return 8>=n||3!==f.split(" ").length||(f+=" 1"),f;case"inject":return 8>=n?4===e.split(" ").length&&(e=e.split(/\s+/).slice(0,3).join(" ")):3===e.split(" ").length&&(e+=" 1"),(8>=n?"rgb":"rgba")+"("+e.replace(/\s+/g,",").replace(/\.(\d)+(?=,)/g,"")+")"}}}()}},Names:{camelCase:function(a){return a.replace(/-(\w)/g,function(a,b){return b.toUpperCase()})},SVGAttribute:function(a){var b="width|height|x|y|cx|cy|r|rx|ry|x1|x2|y1|y2";return(n||t.State.isAndroid&&!t.State.isChrome)&&(b+="|transform"),new RegExp("^("+b+")$","i").test(a)},prefixCheck:function(a){if (t.State.prefixMatches[a])return[t.State.prefixMatches[a],!0];for(var b=["","Webkit","Moz","ms","O"],c=0,d=b.length;d>c;c++){var e;if (e=0===c?a:b[c]+a.replace(/^\w/,function(a){return a.toUpperCase()}),p.isString(t.State.prefixElement.style[e]))return t.State.prefixMatches[a]=e,[e,!0]}return[a,!1]}},Values:{hexToRgb:function(a){var b,c=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,d=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;return a=a.replace(c,function(a,b,c,d){return b+b+c+c+d+d}),b=d.exec(a),b?[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)]:[0,0,0]},isCSSNullValue:function(a){return 0==a||/^(none|auto|transparent|(rgba\(0, ?0, ?0, ?0\)))$/i.test(a)},getUnitType:function(a){return/^(rotate|skew)/i.test(a)?"deg":/(^(scale|scaleX|scaleY|scaleZ|alpha|flexGrow|flexHeight|zIndex|fontWeight)$)|((opacity|red|green|blue|alpha)$)/i.test(a)?"":"px"},getDisplayType:function(a){var b=a&&a.tagName.toString().toLowerCase();return/^(b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|var|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)$/i.test(b)?"inline":/^(li)$/i.test(b)?"list-item":/^(tr)$/i.test(b)?"table-row":/^(table)$/i.test(b)?"table":/^(tbody)$/i.test(b)?"table-row-group":"block"},addClass:function(a,b){a.classList?a.classList.add(b):a.className+=(a.className.length?" ":"")+b},removeClass:function(a,b){a.classList?a.classList.remove(b):a.className=a.className.toString().replace(new RegExp("(^|\\s)"+b.split(" ").join("|")+"(\\s|$)","gi")," ")}},getPropertyValue:function(a,c,e,f){function h(a,c){function e(){j&&v.setPropertyValue(a,"display","none")}var i=0;if (8>=n)i=m.css(a,c);else{var j=!1;if (/^(width|height)$/.test(c)&&0===v.getPropertyValue(a,"display")&&(j=!0,v.setPropertyValue(a,"display",v.Values.getDisplayType(a))),!f){if ("height"===c&&"border-box"!==v.getPropertyValue(a,"boxSizing").toString().toLowerCase()){var k=a.offsetHeight-(parseFloat(v.getPropertyValue(a,"borderTopWidth"))||0)-(parseFloat(v.getPropertyValue(a,"borderBottomWidth"))||0)-(parseFloat(v.getPropertyValue(a,"paddingTop"))||0)-(parseFloat(v.getPropertyValue(a,"paddingBottom"))||0);return e(),k}if ("width"===c&&"border-box"!==v.getPropertyValue(a,"boxSizing").toString().toLowerCase()){var l=a.offsetWidth-(parseFloat(v.getPropertyValue(a,"borderLeftWidth"))||0)-(parseFloat(v.getPropertyValue(a,"borderRightWidth"))||0)-(parseFloat(v.getPropertyValue(a,"paddingLeft"))||0)-(parseFloat(v.getPropertyValue(a,"paddingRight"))||0);return e(),l}}var o;o=g(a)===d?b.getComputedStyle(a,null):g(a).computedStyle?g(a).computedStyle:g(a).computedStyle=b.getComputedStyle(a,null),"borderColor"===c&&(c="borderTopColor"),i=9===n&&"filter"===c?o.getPropertyValue(c):o[c],(""===i||null===i)&&(i=a.style[c]),e()}if ("auto"===i&&/^(top|right|bottom|left)$/i.test(c)){var p=h(a,"position");("fixed"===p||"absolute"===p&&/top|left/i.test(c))&&(i=m(a).position()[c]+"px")}return i}var i;if (v.Hooks.registered[c]){var j=c,k=v.Hooks.getRoot(j);e===d&&(e=v.getPropertyValue(a,v.Names.prefixCheck(k)[0])),v.Normalizations.registered[k]&&(e=v.Normalizations.registered[k]("extract",a,e)),i=v.Hooks.extractValue(j,e)}else if (v.Normalizations.registered[c]){var l,o;l=v.Normalizations.registered[c]("name",a),"transform"!==l&&(o=h(a,v.Names.prefixCheck(l)[0]),v.Values.isCSSNullValue(o)&&v.Hooks.templates[c]&&(o=v.Hooks.templates[c][1])),i=v.Normalizations.registered[c]("extract",a,o)}if (!/^[\d-]/.test(i))if (g(a)&&g(a).isSVG&&v.Names.SVGAttribute(c))if (/^(height|width)$/i.test(c))try{i=a.getBBox()[c]}catch(p){i=0}else i=a.getAttribute(c);else i=h(a,v.Names.prefixCheck(c)[0]);return v.Values.isCSSNullValue(i)&&(i=0),t.debug>=2&&console.log("Get "+c+": "+i),i},setPropertyValue:function(a,c,d,e,f){var h=c;if ("scroll"===c)f.container?f.container["scroll"+f.direction]=d:"Left"===f.direction?b.scrollTo(d,f.alternateValue):b.scrollTo(f.alternateValue,d);else if (v.Normalizations.registered[c]&&"transform"===v.Normalizations.registered[c]("name",a))v.Normalizations.registered[c]("inject",a,d),h="transform",d=g(a).transformCache[c];else{if (v.Hooks.registered[c]){var i=c,j=v.Hooks.getRoot(c);e=e||v.getPropertyValue(a,j),d=v.Hooks.injectValue(i,d,e),c=j}if (v.Normalizations.registered[c]&&(d=v.Normalizations.registered[c]("inject",a,d),c=v.Normalizations.registered[c]("name",a)),h=v.Names.prefixCheck(c)[0],8>=n)try{a.style[h]=d}catch(k){t.debug&&console.log("Browser does not support ["+d+"] for ["+h+"]")}else g(a)&&g(a).isSVG&&v.Names.SVGAttribute(c)?a.setAttribute(c,d):a.style[h]=d;t.debug>=2&&console.log("Set "+c+" ("+h+"): "+d)}return[h,d]},flushTransformCache:function(a){function b(b){return parseFloat(v.getPropertyValue(a,b))}var c="";if ((n||t.State.isAndroid&&!t.State.isChrome)&&g(a).isSVG){var d={translate:[b("translateX"),b("translateY")],skewX:[b("skewX")],skewY:[b("skewY")],scale:1!==b("scale")?[b("scale"),b("scale")]:[b("scaleX"),b("scaleY")],rotate:[b("rotateZ"),0,0]};m.each(g(a).transformCache,function(a){/^translate/i.test(a)?a="translate":/^scale/i.test(a)?a="scale":/^rotate/i.test(a)&&(a="rotate"),d[a]&&(c+=a+"("+d[a].join(" ")+") ",delete d[a])})}else{var e,f;m.each(g(a).transformCache,function(b){return e=g(a).transformCache[b],"transformPerspective"===b?(f=e,!0):(9===n&&"rotateZ"===b&&(b="rotate"),void(c+=b+e+" "))}),f&&(c="perspective"+f+" "+c)}v.setPropertyValue(a,"transform",c)}};v.Hooks.register(),v.Normalizations.register(),t.hook=function(a,b,c){var e=d;return a=f(a),m.each(a,function(a,f){if (g(f)===d&&t.init(f),c===d)e===d&&(e=t.CSS.getPropertyValue(f,b));else{var h=t.CSS.setPropertyValue(f,b,c);"transform"===h[0]&&t.CSS.flushTransformCache(f),e=h}}),e};var w=function(){function a(){return h?B.promise||null:i}function e(){function a(){function a(a,b){var c=d,e=d,g=d;return p.isArray(a)?(c=a[0],!p.isArray(a[1])&&/^[\d-]/.test(a[1])||p.isFunction(a[1])||v.RegEx.isHex.test(a[1])?g=a[1]:(p.isString(a[1])&&!v.RegEx.isHex.test(a[1])||p.isArray(a[1]))&&(e=b?a[1]:j(a[1],h.duration),a[2]!==d&&(g=a[2]))):c=a,b||(e=e||h.easing),p.isFunction(c)&&(c=c.call(f,y,x)),p.isFunction(g)&&(g=g.call(f,y,x)),[c||0,e,g]}function l(a,b){var c,d;return d=(b||"0").toString().toLowerCase().replace(/[%A-z]+$/,function(a){return c=a,""}),c||(c=v.Values.getUnitType(a)),[d,c]}function n(){var a={myParent:f.parentNode||c.body,position:v.getPropertyValue(f,"position"),fontSize:v.getPropertyValue(f,"fontSize")},d=a.position===I.lastPosition&&a.myParent===I.lastParent,e=a.fontSize===I.lastFontSize;I.lastParent=a.myParent,I.lastPosition=a.position,I.lastFontSize=a.fontSize;var h=100,i={};if (e&&d)i.emToPx=I.lastEmToPx,i.percentToPxWidth=I.lastPercentToPxWidth,i.percentToPxHeight=I.lastPercentToPxHeight;else{var j=g(f).isSVG?c.createElementNS("http://www.w3.org/2000/svg","rect"):c.createElement("div");t.init(j),a.myParent.appendChild(j),m.each(["overflow","overflowX","overflowY"],function(a,b){t.CSS.setPropertyValue(j,b,"hidden")}),t.CSS.setPropertyValue(j,"position",a.position),t.CSS.setPropertyValue(j,"fontSize",a.fontSize),t.CSS.setPropertyValue(j,"boxSizing","content-box"),m.each(["minWidth","maxWidth","width","minHeight","maxHeight","height"],function(a,b){t.CSS.setPropertyValue(j,b,h+"%")}),t.CSS.setPropertyValue(j,"paddingLeft",h+"em"),i.percentToPxWidth=I.lastPercentToPxWidth=(parseFloat(v.getPropertyValue(j,"width",null,!0))||1)/h,i.percentToPxHeight=I.lastPercentToPxHeight=(parseFloat(v.getPropertyValue(j,"height",null,!0))||1)/h,i.emToPx=I.lastEmToPx=(parseFloat(v.getPropertyValue(j,"paddingLeft"))||1)/h,a.myParent.removeChild(j)}return null===I.remToPx&&(I.remToPx=parseFloat(v.getPropertyValue(c.body,"fontSize"))||16),null===I.vwToPx&&(I.vwToPx=parseFloat(b.innerWidth)/100,I.vhToPx=parseFloat(b.innerHeight)/100),i.remToPx=I.remToPx,i.vwToPx=I.vwToPx,i.vhToPx=I.vhToPx,t.debug>=1&&console.log("Unit ratios: "+JSON.stringify(i),f),i}if (h.begin&&0===y)try{h.begin.call(o,o)}catch(r){setTimeout(function(){throw r},1)}if ("scroll"===C){var u,w,z,A=/^x$/i.test(h.axis)?"Left":"Top",D=parseFloat(h.offset)||0;h.container?p.isWrapped(h.container)||p.isNode(h.container)?(h.container=h.container[0]||h.container,u=h.container["scroll"+A],z=u+m(f).position()[A.toLowerCase()]+D):h.container=null:(u=t.State.scrollAnchor[t.State["scrollProperty"+A]],w=t.State.scrollAnchor[t.State["scrollProperty"+("Left"===A?"Top":"Left")]],z=m(f).offset()[A.toLowerCase()]+D),i={scroll:{rootPropertyValue:!1,startValue:u,currentValue:u,endValue:z,unitType:"",easing:h.easing,scrollData:{container:h.container,direction:A,alternateValue:w}},element:f},t.debug&&console.log("tweensContainer (scroll): ",i.scroll,f)}else if ("reverse"===C){if (!g(f).tweensContainer)return void m.dequeue(f,h.queue);"none"===g(f).opts.display&&(g(f).opts.display="auto"),"hidden"===g(f).opts.visibility&&(g(f).opts.visibility="visible"),g(f).opts.loop=!1,g(f).opts.begin=null,g(f).opts.complete=null,s.easing||delete h.easing,s.duration||delete h.duration,h=m.extend({},g(f).opts,h);var E=m.extend(!0,{},g(f).tweensContainer);for(var F in E)if ("element"!==F){var G=E[F].startValue;E[F].startValue=E[F].currentValue=E[F].endValue,E[F].endValue=G,p.isEmptyObject(s)||(E[F].easing=h.easing),t.debug&&console.log("reverse tweensContainer ("+F+"): "+JSON.stringify(E[F]),f)}i=E}else if ("start"===C){var E;g(f).tweensContainer&&g(f).isAnimating===!0&&(E=g(f).tweensContainer),m.each(q,function(b,c){if (RegExp("^"+v.Lists.colors.join("$|^")+"$").test(b)){var e=a(c,!0),f=e[0],g=e[1],h=e[2];if (v.RegEx.isHex.test(f)){for(var i=["Red","Green","Blue"],j=v.Values.hexToRgb(f),k=h?v.Values.hexToRgb(h):d,l=0;l<i.length;l++){var m=[j[l]];g&&m.push(g),k!==d&&m.push(k[l]),q[b+i[l]]=m}delete q[b]}}});for(var H in q){var K=a(q[H]),L=K[0],M=K[1],N=K[2];H=v.Names.camelCase(H);var O=v.Hooks.getRoot(H),P=!1;if (g(f).isSVG||"tween"===O||v.Names.prefixCheck(O)[1]!==!1||v.Normalizations.registered[O]!==d){(h.display!==d&&null!==h.display&&"none"!==h.display||h.visibility!==d&&"hidden"!==h.visibility)&&/opacity|filter/.test(H)&&!N&&0!==L&&(N=0),h._cacheValues&&E&&E[H]?(N===d&&(N=E[H].endValue+E[H].unitType),P=g(f).rootPropertyValueCache[O]):v.Hooks.registered[H]?N===d?(P=v.getPropertyValue(f,O),N=v.getPropertyValue(f,H,P)):P=v.Hooks.templates[O][1]:N===d&&(N=v.getPropertyValue(f,H));var Q,R,S,T=!1;if (Q=l(H,N),N=Q[0],S=Q[1],Q=l(H,L),L=Q[0].replace(/^([+-\/*])=/,function(a,b){return T=b,""}),R=Q[1],N=parseFloat(N)||0,L=parseFloat(L)||0,"%"===R&&(/^(fontSize|lineHeight)$/.test(H)?(L/=100,R="em"):/^scale/.test(H)?(L/=100,R=""):/(Red|Green|Blue)$/i.test(H)&&(L=L/100*255,R="")),/[\/*]/.test(T))R=S;else if (S!==R&&0!==N)if (0===L)R=S;else{e=e||n();var U=/margin|padding|left|right|width|text|word|letter/i.test(H)||/X$/.test(H)||"x"===H?"x":"y";switch(S){case"%":N*="x"===U?e.percentToPxWidth:e.percentToPxHeight;break;case"px":break;default:N*=e[S+"ToPx"]}switch(R){case"%":N*=1/("x"===U?e.percentToPxWidth:e.percentToPxHeight);break;case"px":break;default:N*=1/e[R+"ToPx"]}}switch(T){case"+":L=N+L;break;case"-":L=N-L;break;case"*":L=N*L;break;case"/":L=N/L}i[H]={rootPropertyValue:P,startValue:N,currentValue:N,endValue:L,unitType:R,easing:M},t.debug&&console.log("tweensContainer ("+H+"): "+JSON.stringify(i[H]),f)}else t.debug&&console.log("Skipping ["+O+"] due to a lack of browser support.")}i.element=f}i.element&&(v.Values.addClass(f,"velocity-animating"),J.push(i),""===h.queue&&(g(f).tweensContainer=i,g(f).opts=h),g(f).isAnimating=!0,y===x-1?(t.State.calls.push([J,o,h,null,B.resolver]),t.State.isTicking===!1&&(t.State.isTicking=!0,k())):y++)}var e,f=this,h=m.extend({},t.defaults,s),i={};switch(g(f)===d&&t.init(f),parseFloat(h.delay)&&h.queue!==!1&&m.queue(f,h.queue,function(a){t.velocityQueueEntryFlag=!0,g(f).delayTimer={setTimeout:setTimeout(a,parseFloat(h.delay)),next:a}}),h.duration.toString().toLowerCase()){case"fast":h.duration=200;break;case"normal":h.duration=r;break;case"slow":h.duration=600;break;default:h.duration=parseFloat(h.duration)||1}t.mock!==!1&&(t.mock===!0?h.duration=h.delay=1:(h.duration*=parseFloat(t.mock)||1,h.delay*=parseFloat(t.mock)||1)),h.easing=j(h.easing,h.duration),h.begin&&!p.isFunction(h.begin)&&(h.begin=null),h.progress&&!p.isFunction(h.progress)&&(h.progress=null),h.complete&&!p.isFunction(h.complete)&&(h.complete=null),h.display!==d&&null!==h.display&&(h.display=h.display.toString().toLowerCase(),"auto"===h.display&&(h.display=t.CSS.Values.getDisplayType(f))),h.visibility!==d&&null!==h.visibility&&(h.visibility=h.visibility.toString().toLowerCase()),h.mobileHA=h.mobileHA&&t.State.isMobile&&!t.State.isGingerbread,h.queue===!1?h.delay?setTimeout(a,h.delay):a():m.queue(f,h.queue,function(b,c){return c===!0?(B.promise&&B.resolver(o),!0):(t.velocityQueueEntryFlag=!0,void a(b))}),""!==h.queue&&"fx"!==h.queue||"inprogress"===m.queue(f)[0]||m.dequeue(f)}var h,i,n,o,q,s,u=arguments[0]&&(arguments[0].p||m.isPlainObject(arguments[0].properties)&&!arguments[0].properties.names||p.isString(arguments[0].properties));if (p.isWrapped(this)?(h=!1,n=0,o=this,i=this):(h=!0,n=1,o=u?arguments[0].elements||arguments[0].e:arguments[0]),o=f(o)){u?(q=arguments[0].properties||arguments[0].p,s=arguments[0].options||arguments[0].o):(q=arguments[n],s=arguments[n+1]);var x=o.length,y=0;if (!/^(stop|finish|finishAll)$/i.test(q)&&!m.isPlainObject(s)){var z=n+1;s={};for(var A=z;A<arguments.length;A++)p.isArray(arguments[A])||!/^(fast|normal|slow)$/i.test(arguments[A])&&!/^\d/.test(arguments[A])?p.isString(arguments[A])||p.isArray(arguments[A])?s.easing=arguments[A]:p.isFunction(arguments[A])&&(s.complete=arguments[A]):s.duration=arguments[A]}var B={promise:null,resolver:null,rejecter:null};h&&t.Promise&&(B.promise=new t.Promise(function(a,b){B.resolver=a,B.rejecter=b}));var C;switch(q){case"scroll":C="scroll";break;case"reverse":C="reverse";break;case"finish":case"finishAll":case"stop":m.each(o,function(a,b){g(b)&&g(b).delayTimer&&(clearTimeout(g(b).delayTimer.setTimeout),g(b).delayTimer.next&&g(b).delayTimer.next(),delete g(b).delayTimer),"finishAll"!==q||s!==!0&&!p.isString(s)||(m.each(m.queue(b,p.isString(s)?s:""),function(a,b){p.isFunction(b)&&b()}),m.queue(b,p.isString(s)?s:"",[]))});var D=[];return m.each(t.State.calls,function(a,b){b&&m.each(b[1],function(c,e){var f=s===d?"":s;return f===!0||b[2].queue===f||s===d&&b[2].queue===!1?void m.each(o,function(c,d){d===e&&((s===!0||p.isString(s))&&(m.each(m.queue(d,p.isString(s)?s:""),function(a,b){p.isFunction(b)&&b(null,!0)
}),m.queue(d,p.isString(s)?s:"",[])),"stop"===q?(g(d)&&g(d).tweensContainer&&f!==!1&&m.each(g(d).tweensContainer,function(a,b){b.endValue=b.currentValue}),D.push(a)):("finish"===q||"finishAll"===q)&&(b[2].duration=1))}):!0})}),"stop"===q&&(m.each(D,function(a,b){l(b,!0)}),B.promise&&B.resolver(o)),a();default:if (!m.isPlainObject(q)||p.isEmptyObject(q)){if (p.isString(q)&&t.Redirects[q]){var E=m.extend({},s),F=E.duration,G=E.delay||0;return E.backwards===!0&&(o=m.extend(!0,[],o).reverse()),m.each(o,function(a,b){parseFloat(E.stagger)?E.delay=G+parseFloat(E.stagger)*a:p.isFunction(E.stagger)&&(E.delay=G+E.stagger.call(b,a,x)),E.drag&&(E.duration=parseFloat(F)||(/^(callout|transition)/.test(q)?1e3:r),E.duration=Math.max(E.duration*(E.backwards?1-a/x:(a+1)/x),.75*E.duration,200)),t.Redirects[q].call(b,b,E||{},a,x,o,B.promise?B:d)}),a()}var H="Velocity: First argument ("+q+") was not a property map, a known action, or a registered redirect. Aborting.";return B.promise?B.rejecter(new Error(H)):console.log(H),a()}C="start"}var I={lastParent:null,lastPosition:null,lastFontSize:null,lastPercentToPxWidth:null,lastPercentToPxHeight:null,lastEmToPx:null,remToPx:null,vwToPx:null,vhToPx:null},J=[];m.each(o,function(a,b){p.isNode(b)&&e.call(b)});var K,E=m.extend({},t.defaults,s);if (E.loop=parseInt(E.loop),K=2*E.loop-1,E.loop)for(var L=0;K>L;L++){var M={delay:E.delay,progress:E.progress};L===K-1&&(M.display=E.display,M.visibility=E.visibility,M.complete=E.complete),w(o,"reverse",M)}return a()}};t=m.extend(w,t),t.animate=w;var x=b.requestAnimationFrame||o;return t.State.isMobile||c.hidden===d||c.addEventListener("visibilitychange",function(){c.hidden?(x=function(a){return setTimeout(function(){a(!0)},16)},k()):x=b.requestAnimationFrame||o}),a.Velocity=t,a!==b&&(a.fn.velocity=w,a.fn.velocity.defaults=t.defaults),m.each(["Down","Up"],function(a,b){t.Redirects["slide"+b]=function(a,c,e,f,g,h){var i=m.extend({},c),j=i.begin,k=i.complete,l={height:"",marginTop:"",marginBottom:"",paddingTop:"",paddingBottom:""},n={};i.display===d&&(i.display="Down"===b?"inline"===t.CSS.Values.getDisplayType(a)?"inline-block":"block":"none"),i.begin=function(){j&&j.call(g,g);for(var c in l){n[c]=a.style[c];var d=t.CSS.getPropertyValue(a,c);l[c]="Down"===b?[d,0]:[0,d]}n.overflow=a.style.overflow,a.style.overflow="hidden"},i.complete=function(){for(var b in n)a.style[b]=n[b];k&&k.call(g,g),h&&h.resolver(g)},t(a,l,i)}}),m.each(["In","Out"],function(a,b){t.Redirects["fade"+b]=function(a,c,e,f,g,h){var i=m.extend({},c),j={opacity:"In"===b?1:0},k=i.complete;i.complete=e!==f-1?i.begin=null:function(){k&&k.call(g,g),h&&h.resolver(g)},i.display===d&&(i.display="In"===b?"auto":"none"),t(this,j,i)}}),t}(window.jQuery||window.Zepto||window,window,document)});



var AP=new function _AP(){
	this.config={};
	this.__printing=0;
	this.blockRedirection=null;
	this.transition="";
	
	this.histories = [window.location.href];
	
	this.key={enter: 13, tab: 9, backspace: 8, escape: 27, prev: 37, next: 39, left: 37, right: 39, up: 38, down: 40};
	this.keycode=function(e, str){
		return (e.keycode==this.key[str]);
	};

	window.onbeforeunload = null;
	
	this.EVENTS={PAGE_UNLOAD: 'page.unload',
		PAGE:{
			INIT: 'page.init',
			UNLOAD: 'page.unload',
			RELOAD: 'page.reload',
			AFTERLOAD: 'page.afterload'
	}};


	this.display=function(data, options){
		options=$.extend({},{emotion: false, tag: true, script: true}, options);
		return data;
	};




	/**
	 * @desc Call user function with parameter
	 */
	this.fn=function(fn, data){
		var __fn=eval(fn);
		__fn(data);
	};


	/**
	 * @desc Call user object function with parameter
	 */
	this.call=function(fn){
		fn();
	};


	this.__ts=[];
	this.__rts=[];

	/**
	 * @desc Temporary timeout (all timeouts are clear in the next page)
	 */
	this.timeout=function(fn, total_time){
		var tx=setTimeout(function(){
			fn();
		}, total_time);
		
		AP.__ts.push(tx);
		
		return tx;
	};


	/**
	 * @desc Temporary timeout (all timeouts are clear in the next page)
	 */
	this.rtimeout=function(fn, total_time){
		var intv=setInterval(function(){
			fn.apply(intv);
		}, total_time);
		
		AP.__rts.push(intv);
		return intv;
	};


	/**
	 * @desc Call a function once. The function is marked by its name, where fn is the actually
	 * function.
	 * @example
	 * 	AP.once("alertme", function(){alert(1)}); // This is called
	 *  AP.once("alertme", function(){alert(1)}); // This is not called as alertme has been called earlier.
	 */
	this.once_list=[];
	this.once=function(name, fn){
		if (this.array.within(name, this.once_list)){
			return;
		}
		this.once_list.push(name);
		fn();
	};



	this.alert=function(content, buttons, icon, opts){
		opts=$.extend({}, opts);

		if (!icon){
			icon='s48-ap-error';
		}

		var icon_html="<div class='icon' style='width:42px;'>"+icon+"</div>";
		if (AP.word.match(icon, /^([a-zA-Z0-9\s\-\_]+)$/)){
			icon_html="<span class='"+icon+"' style='font-size:42px;'></span>";
		}

		AP.dialog("#alert")
			.temp(false)
			.engine(AP.config.alertDialogEngine)
			.style("__apalert")
			.title("Success").temp(false)
			.buttons(buttons)
			.content("<table><tr><td class='icon'> "+icon_html+"</td> <td class='text'>"+content+"</td></tr></table>")
			.cond(Client.native, function(){
				this.width(450)
			})
			.closable(opts.closable)
			.show()
		;
	};



	this.alertSuccess=function(content, callback){
		var cb=function(){
			AP.dialog("#alert").hide();
		};
		if (callback){
			cb=function(){
				AP.dialog("#alert").hide();
				callback();
			};
		}
		AP.dialog("#alert")
			.temp(false)
			.engine(AP.config.alertDialogEngine)
			.style("__apalert")
			.title("Success").temp(false)
			.button("OK", cb,'ss')
			.content("<table><tr><td class='icon'> <span class='ficon ficon-check-circle' style='font-size:42px; color:#36b918'></span></td> <td class='text'>"+content+"</td></tr></table>")
			.show()
			;
	};



	this.alertWarning=function(content, callback){
		var cb=function(){
			AP.dialog("#alert").hide();
		};
		if (callback){
			cb=function(){
				AP.dialog("#alert").hide();
				callback();
			};
		}
		AP.dialog("#alert")
			.temp(false)
			.engine(AP.config.alertDialogEngine)
			.style("__apalert")
			.title("Success").temp(false)
			.button("OK", cb,'er')
			.content("<table><tr><td class='icon'> <span class='ficon ficon-exclamation-circle' style='font-size:42px; color:#c65144'></span></td> <td class='text'>"+content+"</td></tr></table>")
			.show();
	};


	this.alertError=function(content, extra_messages, callback){
		if (AP.word.empty(content)){
			content="The system is temporarily unable to process your request. We are working on it and we'll get it fixed as we can.";
		}

		var text=content;
		var cb=function(){
			AP.dialog("#alert").hide();
		};

		if (extra_messages && AP.isObject(extra_messages)){
			if (extra_messages[content]){
				text=extra_messages[content];
			}

			if (callback){
				cb=function(){
					AP.dialog("#alert").hide();
					callback();
				};
			}
		}else{
			if (extra_messages && !callback){
				cb=function(){
					AP.dialog("#alert").hide();
					extra_messages();
				};
			}
		}

		text=AP.error.translate(text);

		AP.dialog("#alert")
			.temp(false)
			.engine(AP.config.alertDialogEngine)
			.style("__apalert")
			.title("Error").temp(false)
			.button("OK", cb,'er alert-button')
			.content("<table><tr><td class='icon'> <span class='-ap icon-help-with-circle' style='font-size:40px; color:#666'></span></td> <td class='text'>"+text+"</td></tr></table>")
			.show()
		;
	};


	this.alertWaiting=function(content, fn){
		AP.dialog("#alert")
		.temp(false)
		.engine(AP.config.alertDialogEngine)
		.style("__apalert")
		.title("Waiting").temp(false)
		.button("Refresh", function(){
			AP.xRefresh();
		})
		.content("<table><tr><td class='icon'> <span class='s48-ap-question'></span></td> <td class='text'>"+content+"</td></tr></table>")
		.show()
		;

		if (fn){
			fn();
		}
	};



	this.confirm=function(content, fn){
		AP.dialog("#alert")
		.temp(false)
		.engine(AP.config.alertDialogEngine)
		.style("__apalert")
		.title("Confirm").temp(false)
		.button("Close", function(){
			AP.dialog("#alert").hide();
		},'er confirm-button')
		.button("OK", function(){
			AP.dialog("#alert").hide();
			fn();
		},'ss confirm-button')
		.content("<table><tr><td class='icon'> <span class='ficon ficon-exclamation-circle' style='font-size:42px; color:#c65144'></span></td> <td class='text'>"+content+"</td></tr></table>")
		.show()
		;
	};



	this.hideAlert=function(){
		AP.dialog("#alert").hide();
	};



	this.ajaxAlert=function(notShowTitle){
		if (!$('#ajaxalert').length){
			AP.add('ajaxalert');
			AP.dialog("#ajaxalert")
			.temp(false)
			.engine(AP.config.ajaxAlertDialogEngine)
			.show();
		}else{
			if (notShowTitle) {
				AP.dialog("#ajaxalert").title("").show();
			} else {
				AP.dialog("#ajaxalert").show();
			}
		}
	};

	this.ajaxShow=function(txt){
		if (!txt){
			txt="Processing";
		}
		this.ajaxAlert(true);
		// $.log(txt);
		$("#ajaxalert").prev().html(txt);
	};

	this.ajaxHide=function(){
		AP.dialog("#ajaxalert").hide();
	};



	/**
	 * @desc The default handler for ajax code returned from the server.
	 * @todo Add Dialog Here.
	 */
	this.handler=function(code){
		AP.alertError(code.message);
	};


	/**
	 * @desc The default success handler for ajax code returned from the server.
	 * @todo Add Dialog Here.
	 */
	this.successHandler=function(code){
		AP.alertSuccess(code.message);
	};


	/**
	 * @desc The default error handler for ajax code returned from the server.
	 * @todo Add Dialog Here.
	 */
	this.errorHandler=function(code){
		AP.alertError(code.message);
	};



	/**
	 * @desc Class's binary lock
	 */
	this.__lock=false;

	/**
	 * @desc Lock the ajax mechanisum.
	 */
	this.lock=function(){
		this.__lock=true;
	};

	this.undone_url="";
	this.undone_data="";


	this.ajax_data={};
	this.ajaxSetup=function(data){
		this.ajax_data=data;
	};

	
	/**
	 * @desc Making a post to the server.
	 * @param handler: The callback after retrieving the data from the server. if
	 * omitted, the default handler is called.
	 */
	this.post=function(url, data, handler, use_lock){
		if (!this.word.isURL(url)){
			if (Client.native){
				url=M.api()+'/'+url;

				if (data && AP.data.isObject(data)){
					var params=M.params();
					for (var key in params){
						M.formData(data, key, params[key]);
					}
				}

				M.formData(data, '__code', Client.code);
			}else{
				url=Client.ajax_url+'/'+url;
			}

		}

		var $this=null;

		if (use_lock && use_lock==true){
			if (this.__lock){
				if (Client.env==0 || Client.env=='0'){
					AP.alertError("Be patient! Your request is processed right now.");
				}
				return;
			}
			this.lock();
		}

		if (!handler){
			handler=this.hander;
		}

		if (AP.isAssocArray(data) && !Client.native){
			data.__code=Client.code;
			if (Client.base_network && Client.base_network.id){
				if (!data.__base_network){
					data.__base_network=Client.base_network.id;
				}
			}
			if (Client.network && Client.network.id){
				if (!data.__network){
					data.__network=Client.network.id;
				}
			}
			if (Client.user && Client.user.id){
				if (!data.__user){
					data.__user=Client.user.id;
				}
			}

			for (var key in this.ajax_data){
				data[key]=this.ajax_data[key];
			}
		}

		AP.sys.fire("ajax.pre.update",data);

		if (url==this.undone_url && AP.data.equal(data, this.undone_data)){
			// $.log(url);
			// AP.alertError("We are processing your request ....");
			$.log("[Abusive URL: "+url+"], with Data:");
			$.log(data);
			return false;
		}

		this.undone_url=url;
		this.undone_data=data;

		
		if (Client.native){
			var ajax_data={
				'url': url,
				'data': data,
				type: 'POST',
				success: function(text){
					AP.__lock=false;
					AP.undone_url="";
					AP.undone_data="";
					var c=parseCode(text);


					if (c.message=="FLAG.SYSTEM.REQUIRED.REFRESH" || c.command=="LOGIN"){
						return AP.alertError("Please refresh to continue.", function(){
							AP.refresh();
						});
					}
					handler(c);
				},
				error: function(text){
					AP.__lock=false;
					AP.undone_url="";
					AP.undone_data="";
					var c=parseCode(text);
					handler(c);
				}
			};

			if (isFormData(data)) {
				// hack to fix safari bug where ajax fails if file input is empty
				if ((navigator.userAgent.match(/iPhone|iPad|iPod/i)) || (navigator.userAgent.search("Safari") >= 0 && navigator.userAgent.search("Chrome") < 0)) {
					// Safari < 10.13.4 does not support FormData.entries()
					try {
						var formDataEntries = data.entries(), formDataIter = formDataEntries.next(), pair;
						while (!formDataIter.done) {
							pair = formDataIter.value;
							if (Object.prototype.toString.call(pair[1]) === '[object File]' && pair[1].name == '' && pair[1].size == 0) {
								data.delete(pair[0]);
								formDataEntries = data.entries();
								formDataIter = formDataEntries.next();
							} else {
								formDataIter = formDataEntries.next();
							}

						}
					} catch(e) {}
				}

				ajax_data.processData = false;
				ajax_data.contentType = false;

			}

			$.ajax(ajax_data);
		}else{
			$.post(url, data, function(text){
				AP.__lock=false;
				AP.undone_url="";
				AP.undone_data="";
				var c=parseCode(text);

				if (c.message=="FLAG.SYSTEM.REQUIRED.REFRESH" || c.command=="LOGIN"){
					return AP.alertError("Please refresh to continue.", function(){
						AP.refresh();
					});
				}
				
				handler(c);
			}).fail(function(text){
				AP.__lock=false;
				AP.undone_url="";
				AP.undone_data="";
				var c=parseCode(text);
				handler(c);
			});
		}
	};


	/**
	 * @desc Similar to post, but create a get method.
	 */
	this.get=function(url, handler, checker){
		return this.post(url, {}, handler, checker);
	};
	
	
	this.es6Post=function(url, data, handler){
		if (AP.isAssocArray(data) && !Client.native){
			data.__code=Client.code;
		}
		
		var formData = new FormData();
		for (var k in data) {
		    formData.append(k, data[k]);
		}
		
		if (!this.word.isURL(url)){
			url=Client.ajax_url+'/'+url;
		}
		
		fetch(url, {
			method: 'POST',
			headers: {"Content-Type": "application/x-www-form-urlencoded; charset=utf-8"},
			body:  new URLSearchParams(data)
		})
		.then(res => res.text()) // parse response as JSON (can be res.text() for plain response)
		.then(function(data){
			// $.log(data);
			// UI.ajaxHide();
			var c=parseCode(data);
			handler(c);
		})
		.catch(err => {
			console.log(err);
		});
	};



	this.crossPost=function(url, data, success_callback, error_handler){
		data.ext=url;
		data.ts=AP.T.timeStamp();
		data.__code=Client.code;
		$.ajax({
			  type: 'post',
			  url: Client.ajax_url+"/share/cross",
			  data: data,
			  success: function(obj){
				  success_callback(obj);
			  },
			  error: function(){
				  if (error_handler){
					  error_handler();
				  }
			  },
			  dataType: 'JSON'
		});
	};

	/**
	 * @desc Submit frame in the regular way.
	 */
	this.__submit=function(selector){
		ap_editSubmission(selector);
		$(selector).submit();
	};


	/**
	 * @desc Submit a form to the server using Ajax. Based on the elements of the form,
	 * the system will decide the corresponding method (DIRECT AJAX or FRAME).
	 * @param selector The form Selector.
	 * @returns Null
	 */
	this.submit=function(selector, callback, extra_data){
		var elem="";

		if (!AP.data.isString(selector)){
			var id;
			if (!$(selector).attr('id')){
				id=AP.uuid();
				$(selector).attr('id', id);
			}else{
				id=$(selector).attr('id');
			}

			elem="#"+id;
		}else{
			elem=selector;
		}


		if (!extra_data){
			extra_data={};
		}

		if (Client.native){
			var params=M.params();
			for (var key in params){
				extra_data[key]=params[key];
			}
		}

		for (var key in this.ajax_data){
			extra_data[key]=this.ajax_data[key];
		}
		
		if (AP.isset("Form")){
			Form.protection.onSubmit(selector);
		}

		if ($(elem).find('input[type=file]').length && !Client.native){
			return this.submitFrame(elem, callback, extra_data);
		}else{
			return this.submitAjax(elem, callback, extra_data);
		}
	};


	/**
	 * @desc Submit a form via ajax.
	 */
	this.submitAjax=function(selector, callback, extra_data){
		if (!extra_data){
			extra_data={};
		}

		var text="";
		if (!$(selector).flag("__init_code")){
			var text="<input type='hidden' name='__code' value='"+Client.code+"' /> ";
			$(selector).append(text);
			AP.sys.fire('form.pre.submit', selector);
		}

		if (!callback){
			callback=this.handler;
		}

		ap_editSubmission(selector);

		var data=$(selector).serialize();
		
		var target=$(selector).attr('action');



		if (Client.native){
			var formData = new FormData($(selector)[0]);
			if (extra_data){
				for (var k in extra_data){
					formData.append(k, extra_data[k]);
				}
			}

			this.post(target, formData, function(code){
				code.__form=assoc($(selector).serializeArray());
				for (var k in extra_data){
					code.__form[k]=extra_data[k];
				}
				callback(code);
				
				if (code.good()){
					ap_reeditSubmission(selector);
				}
			}, true);

		}else{
			if (extra_data){
				for (var k in extra_data){
					data+="&"+k+"="+extra_data[k];
				}
			}

			this.post(target, data, function(code){
				if (AP.isset("Form")){
					Form.protection.onSubmit(selector);
				}
				
				code.__form=assoc($(selector).serializeArray());
				callback(code);
				
				if (code.good()){
					ap_reeditSubmission(selector);
				}
			}, true);
		}
	};



	/**
	 * @desc Submit as iframe.
	 */
	this.submitFrame=function(selector, success, extra_data){
		if (!success){
			success=this.handler;
		}

		ap_setupFrameUpload(selector, function(code){
			$(selector).unlock();
			code.__form=assoc($(selector).serializeArray());
			success(code);
			ap_reeditSubmission(selector);
		}, extra_data);


		if ($(selector).lock()){
			this.__submit(selector);
		}else{
			AP.alertError("Be patient! Your request is processed right now.");
		}

	};



	this.getJSONP=function(url, success, error){
		var callback='APJSONCALLBACK';
		var uuid=AP.uuid();
		APJSONREG(uuid, success, error);
		var furl=url+"?callback="+callback+"&fx="+uuid;
		if (url.indexOf('?')>0){
			furl=url+"&callback="+callback+"&fx="+uuid;
		}

		$.apScript(furl,null,uuid);
	};



	/**
	 * @desc This is a very simple version of post, when we do not worry
	 * so much about callback function. The functions is very useful for case
	 * such as using AJAX to count pageview, or make a Like action.
	 */
	this.touch=function(url, success){
		if (!success){
			success=this.successHandler;
		}
		this.post(url,{}, function(code){
			if (code.good()){
				success(code);
			}else{
				AP.handler(code);
			}
		});
	};


	/**
	 * @desc This is a simpler version of touch with one exception: on error,
	 * the system doesn't notify the user.
	 */
	this.silent=function(url, success){
		if (!success){
			success=this.handler;
		}
		this.post(url,{}, function(code){
			if (code.good()){
				success(code);
			}
		});
	};




	/**
	 * @desc Redirect to a specific link. If link is not started with http, we
	 * makes it a valid link within the current host.
	 */
	this.redirect=function(link){
		if (!link){
			window.location.href=window.location.href;
		}

		if (Client.native){
			window.location.href=link;
			return;
		}

		if (this.word.prefix(link,'http')){
			window.location.href=link;
		}else{
			window.location.href=Client.url+"/"+link;
		}
	};


	/**
	 * @desc Refresh the whole page.
	 */
	this.refresh=function(){
		if (Client.native){
			location.reload();
		}

		return this.redirect(window.location.href);
	};


	/**
	 * @desc Refresh the whole page.
	 */
	this.xRefresh=function(callback){
		if (Client.native){
			return M.xRefresh();
		}

		var url=window.location.href;
		if (AP.word.prefix(url, Client.url)){
			AP.loadURL(url, {direct_load: true});
		}else{
			AP.loadURL(AP.current_url, {direct_load: true});
		}


		if (callback){
			AP.sys.once(AP.EVENTS.PAGE_UNLOAD, callback);
		}
	};



	this.__urlref=null;

	/**
	 * @desc To an internal URL. URL must be relative.
	 */
	this.toURL=function(url, callback, ref){
		if (ref){
			this.__urlref=ref;
		}

		if (Client.native){
			return AP.nativeRedirect(url);
		}

		if (AP.word.isURL(url)){
			
			if (!AP.word.prefix(url, Client.url)){
				window.open(url);
				return;
			}
		}

		// Remove the HTTP
		if (AP.word.prefix(url, Client.url)){
			url=url.substr(Client.url.length+1);
		}


		// Quick redirect

		if (!AP.word.isURL(url) && this.rewriteRedirect(url)){
			return;
		}

		if (AP.transition && AP.transition.length){
			AP.confirm(AP.transition, function(){
				AP.transition="";
				AP.toURL(url, callback, ref)
			});
			
			return;
		}
		
		if (AP.isset('Form')){
			if (!Form.protection.transition()){
				return;
			}
		}
		
		if (url.indexOf('__nhash=1')!=-1){
		}else{
			if (AP.__history){
				history.pushState({url: Client.url+"/"+url},"",Client.url+"/"+url);
			}else{
				AP.setHash(url);
			}
		}

		if (!AP.word.isURL(url)){
			url=Client.url+"/"+url;
		}

		if (this.__must_reset){
			if (AP.__reset_callback){
				AP.__reset_callback();
			}

			AP.redirect(url);
			return;
		}

		this.histories.push(url);
		AP.loadURL(url,{direct_load: true});

		if (callback){
			AP.sys.once(AP.EVENTS.PAGE_UNLOAD, callback);
		}
	};


	this.setHash=function(url){
		AP.current_url=Client.url+'/'+url;
		AP._last_hash=url;
		window.location.hash='!/'+url;
	};


	this.nativeRedirect=function(url, skip_hash_change){
		var parts=url.split("?");

		if (parts.length<2){
			Query.reset();
			M.redirect(url, skip_hash_change);
		}else{
			var d=queryStringToArray(parts[1]);
			Query.reset();
			for (var k in d){
				Query.set(k, d[k]);
			}
			M.redirect(parts[0], skip_hash_change);
		}
	};



	this._callback={};
	/**
	 * @desc Register a callback for a group. The group (name) will be
	 * the key of callback. When AP.triggerCallback is called, the set of
	 * callbacks will be cleared on the group.
	 */
	this.callback=function(group, fn){
		if (!this._callback[group]){
			this._callback[group]=[];
		}
		this._callback[group].push(fn);
	};


	/**
	 * @desc Trigger the callback on the group action.
	 */
	this.triggerCallback=function(group){
		if (!this._callback[group]){
			return;
		}
		for (var i=0; i<this._callback[group].length; i++){
			var fn=this._callback[group][i];
			fn();
		}
		this._callback[group]=[];
	};




	/**
	 * @desc Check if a variable name exists.
	 */
	this.isset=function(varname){
		return(typeof(window[varname])!='undefined');
	};


	/**
	 * @desc Apply a transform function on the array. It is very much
	 * similar to array_walk in PHP world.
	 */
	this.transform=function(arr, transform_fn){
		var b=[];
		for (var i=0; i<arr.length; i++){
			var temp=transform_fn(arr[i],i);
			if (temp!==null){
				b.push(temp);
			}
		}
		return b;
	};


	this.select=function(arr, transform_fn){
		if (!arr){
			return [];
		}
		return this.transform(arr, transform_fn);
	};


	/**
	 * @desc Apply a transform function on the array, append results at bottom
	 * to make a longer string.
	 */
	this.render=function(arr, transform_fn, limit){
		if (!limit){
			limit=0;
		}
		if (!this.isArray(arr) || !arr.length){
			return "";
		}
		var m=arr.length;
		if (limit >0 && limit <m){
			m=limit;
		}
		var text="";
		for (var i=0; i<m; i++){
			text+=transform_fn(arr[i],i, m);
		}
		return text;
	};


	/**
	 * @desc Apply a transform function on the object, append results at bottom
	 * to make a longer string.
	 */
	this.renderObject=function(obj, render_fn, limit){
		var text="";
		for (var key in obj){
			text+=render_fn(key, obj[key]);
		}
		return text;
	};



	/**
	 * @desc Apply function to each part of the array.
	 */
	this.each=function(data, callback){
		for (var i=0; i<data.length; i++){
			callback(data[i]);
		}
	};


	/**
	 * @desc Create an associate array, where key are variables.
	 * Keys and values are placed in sequence as arguments of the function.
	 */
	this.assoc=function(){
		var r={};
		for (var i=0; i<arguments.length/2; i++){
			r[arguments[2*i]]=arguments[2*i+1];
		}
		return r;
	};


	/**
	 * @desc Encode the data so that it's Okay to pass via AJAX and URL.
	 */
	this.encodeURI=function(str){
		try { return encodeURIComponent(str); } catch(e){}
		try { return encodeURI(str); } catch(e){}
		return espace(str);
	};

	
	this.urlEncode=this.encodeURI;
	

	/**
	 * @desc Move history forward.
	 */
	this.next=function(){
		return history.go(1);
	};

	/**
	 * @desc Move history forward - safely and smartly detect the right domain
	 */
	this.back=function(){
		var last = this.histories.pop();
		last = this.histories.pop();
		
		while (true){
			if (!last || !this.histories.length){
				break;
			}
			
			if (this.histories[this.histories.length-1] == last){
				last = this.histories.pop();
			}else{
				break;	
			}
		}
		
		if (last){
			return AP.toURL(last);
		}
		
		return AP.toURL("home");
	};

	
	this.pageError=function(){
		if (window.performance && window.performance.navigation.type == 2){
			// location.reload(true);
		}
	};
	

	/**
	 * @desc Create an event listener
	 */
	this.on=function(event, fx, $this){
		this.event.bind(event, fx, $this);
		return this;
	};


	this.rebind=function(event, fx, $this){
		this.event.rebind(event, fx, $this);
		return this;
	};



	/**
	 * @desc Create an event listener
	 */
	this.onAll=function(event, fx, $this){
		this.event.bindAll(event, fx, $this);
		return this;
	};


	/**
	 * @desc Trigger an event
	 */
	this.trigger=function(event){
		this.event.trigger(event);
		return this;
	};


	/**
	 * @desc Trigger an event
	 */
	this.fire=function(event, data){
		this.event.trigger(event, data);
		return this;
	};

	this.fireLate=function(event,time){
		if (!time){
			time=200;
		}
		var Event=this.event;
		setTimeout(function(){
			Event.trigger(event);
		},time);
		return this;
	};

	this.live=function(event, fx){
		this.on(event,fx);
		$.log(this.event.__fired);
		if (this.event.fired(event)){
			this.release(event);
		}
	};


	/**
	 * @desc Trigger an event (and dequeue)
	 */
	this.release=function(event){
		this.event.release(event);
		return this;
	};


	this.autoRelease=function(event, cond){
		if (cond){
			return this.release(event);
		};
	};


	this.removeListener=function(event){
		this.event.removeListener(event);
	};


	/**
	 * @desc Getting the url of the thumbnail.
	 */
	this.thumb=function(source, prefix){
		if (!prefix){
			prefix="1.";
		}else{
			prefix=prefix+".";
		}

		if (typeof source == 'undefined' || !source) {
			return "";
		}
		
		// modify directly if path already has file name
		if (source.indexOf("name=") > 0) {
			var re = new RegExp("([?&])name=([^\/&]+)(&|$)", "i");
			if (source.match(re)) {
				return source.replace(re, '$1' + "name=" + prefix + '$2');
			} else {
				return source;
			}
		}

		var path=source.split("/");
		if (path.length<=0){
			return source;
		}
		path[path.length-1]=prefix+path[path.length-1];
		return path.join("/");
	};

	this.xthumb=function(source){
		return this.thumb(source, "0");
	};

	this.zthumb=function(source){
		return this.thumb(source, "2");
	};


	/**
	 * @desc Check data type.
	 */
	this.isArray=function(data){
		return $.isArray(data);
	};
	this.isAssocArray=function(data){
		return typeof(data)=='object' && isNaN(data);
	};
	this.isObject=function(data){
		return typeof(data)=='object' && isNaN(data);
	};
	this.isFunction=function(data){
		return $.isFunction(data);
	};
	this.isInt=function(data){
		return !isNaN(data)&&parseInt(data)==data;
	};
	this.isString=function(data){
		return typeof(data)=='string' && isNaN(data);
	};
	this.isEmpty=function(data){
		if (!data || data.length <=0){
			return true;
		}
		return false;
	};


	this.js_list=Client.js;
	this.css_list=Client.css;


	/**
	 * @desc Loading external css.
	 */
	this.css=function(source){
		if (AP.array.within(source, this.css_list)){
			return;
		}
		this.css_list.push(source);

		if (!this.word.isURL(source)){
			source=Client.url+'/css/'+source;
		}

		$.log("[CSS: "+source+"]");

		var css = jQuery("<link>");
		css.attr({
			rel:  "stylesheet",
			type: "text/css",
			href: source
		});
		$("head").append(css);

	};


	this.cssx=function(css){
		if (Client.pageData.__lazycss && Client.pageData.__lazycss=="none"){
			return;
		}
		this.css(css);
	};

	/**
	 * @desc Loading external js file.
	 * @return Boolean
	 */
	this.js=function(source,callback,id){
		if (this.array.within(source, this.js_list)){
			return false;
		}


		this.js_list.push(source);

		if (!this.word.isURL(source)){
			source=Client.url+'/js/'+source;
		}
		$.log("[JS: "+source+"]");

		$.apScript(source,callback,id);
		return true;
	};


	this.jsx=function(source, callback, id){
		if (Client.pageData.__lazyjs && Client.pageData.__lazyjs=="none"){
			return;
		}
		if (this.array.within(source, this.js_list)){
			if (callback){
				callback();
			}
			return false;
		}


		this.js_list.push(source);

		if (!this.word.isURL(source)){
			source=Client.url+'/js/'+source;
		}
		$.log("[JS: "+source+"]");

		$.apScript(source,callback,id);
		return true;
	};



	/**
	 * @desc Setting continuous Request
	 */
	this._continuous=false;
	this._in_continuous_request=false;

	this._last_hash='';
	this.current_url=window.location.href;

	this.__history=false;
	if (history && history.pushState){
		this.__history=true;
	};

	this.adaptive=function(url1, url2){
		return true;
	};

	this.setURL=function(url){
		if (this.__history){
			history.pushState({url: Client.url+"/"+url},"",Client.url+"/"+url);
		}
	};

	this.updateURLParams=function(params){
		var ps=params;
		if (AP.data.isString(ps)){
			ps=queryStringToArray(params);
		}

		for (var key in ps){
			if (ps[key]==="null"){
				ps[key]=null;
			}
		}

		var checked={};

		var url=Client.path.current;
		url=url.replace(/(\&*)([\w\-]+)\=([\w\-]+)/g, function(match, p0, p1, p2){
			checked[p1]=1;

			if (p1 in ps && ps[p1]===null ){
				return "";
			}

			if (ps[p1]){
				return p0+p1+"="+ps[p1];
			}
			return p0+p1+"="+p2;
		});

		var extra="";
		for (var key in ps){
			if (!checked[key] && ps[key]!=null){
				extra+=key+"="+ps[key]+"&";
			}
		};

		if (extra.length){
			extra=extra.substr(0, extra.length-1);

			if (url.indexOf("?")==-1){
				url=url+"?"+extra;
			}else{
				url=url+"&"+extra;
			}
		}



		if (url.charAt(url.length-1)=="?"){
			url=url.substr(0, url.length-1);
		}


		return AP.toURL(url);
	}


	this.setURLParams=function(params, redirect){
		var ps=params;
		if (AP.data.isString(ps)){
			ps=queryStringToArray(params);
		}

		var orgs=shallowClone(ps);

		var checked={};

		var url=window.location.href;
		url=url.substr(Client.url.length+1);

		url=url.replace(/(\&*)([\w\-]+)\=([\w\-\%\(\)\.\@\/]+)/g, function(match, p0, p1, p2){
			checked[p1]=1;
			if (p1 in ps && ps[p1]===null){
				return "";
			}
			if (ps[p1]){
				return p0+p1+"="+ps[p1];
			}
			return p0+p1+"="+p2;
		});

		var extra="";

		for (var key in ps){
			if (!checked[key]){
				if (key in orgs && orgs[key]==null){
					Query.unset(key);
				}else{
					Query.set(key, ps[key]);
					extra+=key+"="+ps[key]+"&";
				}
			}else{
				Query.set(key, ps[key]);
			}
		};

		if (extra.length){
			extra=extra.substr(0, extra.length-1);

			if (url.indexOf("?")==-1){
				url=url+"?"+extra;
			}else{
				url=url+"&"+extra;
			}
		}


		if (url.charAt(url.length-1)=="?"){
			url=url.substr(0, url.length-1);
		}
		
		if (url && url.length && url[0]=="?"){
			url = "home"+url;
		}

		
		if (Client.url+"/"+url == document.location.href){
			if (redirect){
				return AP.xRefresh();
			}
			
			return;
		}
		
		if (redirect){
			return AP.toURL(url);
		}else{
			return AP.setURL(url);
		}

	}



	this.initContinuousRequest=function(){
		if (this._continuous==false){
			var hash=window.location.hash;
			if (hash && hash.substr(0,2)=='#!' && !AP._in_continuous_request ){
				hash=hash.substring(3);
				AP.redirect(Client.url+'/'+hash);
			}
		}

		this._continuous=true;
		if (!this.__history){
			setInterval(function(){
				if (AP._in_continuous_request){
					return;
				}
				var hash=window.location.hash;
				if (!hash){
					if (AP._last_hash && AP._last_hash.length>=2){
						var nhash=getHash(window.location.href);
						if (nhash){
							window.location.hash='!/'+nhash.join('/');
							return;
						}
					}
					return;
				}

				hash=hash.substring(3);
				if (hash && hash!=AP._last_hash){
					AP._in_continuous_request=true;
					AP.current_url=Client.url+'/'+hash;
					AP.loadURL(AP.current_url);
					AP._last_hash=hash;
				}
			},500);
		}
	};

	this.__popstate_set=false;


	this.setContinuousRequest=function(container){
		if (Client.continuous && Client.continuous==-1){
			return;
		}

		if (this.__history  && !this.__popstate_set){
			history.replaceState({url: window.location.href},'');

			window.onpopstate=function(e){
				if (e.state){
					// Check hostname
					var url=AP.current_url;
					var hostname=document.location.hostname;
					if (Client.https){
						hostname="https://"+hostname;
					}else{
						hostname="http://"+hostname;
					}

					if (!AP.word.prefix(url, hostname)){
						return;
					}else if (!AP.adaptive(url, e.state.url)){
						AP.redirect(e.state.url);
						return;
					}else{
						$.log("[State: "+url+" -> "+document.location.href+"]");
						AP.loadURL(e.state.url,{direct_load: true});
					}
				}
			};
			this.__popstate_set=true;
		}


		if (!container){
			container='';
		}

		$("a", container).each(function(){
			if ($(this).hasClass('blank') || ($(this).attr('target')=='_blank')|| $(this).hasClass('__ap_processed')){
				// No follow or well-done
				return true;
			}
			
			var href=$(this).attr("href");
			if (!href){
				return;
			}

			// Check hostname
			var hostname=$(this).prop('hostname');
			if (hostname!=document.location.hostname){
				return;
			}

			if (!AP.adaptive(href, AP.current_url)){
				return;
			}

			var curl=window.location.href;

			var url;
			var idx=href.indexOf('#');
			if (idx>=0){
				var hash=href.substr(idx+1);
				if (hash.substr(0,2)=='!/'){
					url=hash.substr(2);
				}
			}else{
				url=ap_getHash(href);
				if (!url){
					return;
				}
				url=url.join('/');
			}
			
			if (!url){
				return;
			}


			$(this).addClass('__ap_processed');
			$(this).click(function(event){
				if ($(this).data("href") && $(this).data("url")){
					// event.preventDefault();
					// return false;
				}
				
				event.preventDefault();
				if (url.indexOf('__nhash=1')!=-1){
				}else{
					if (AP.__history){
						history.pushState({url: Client.url+"/"+url},"",Client.url+"/"+url);
					}else{
						window.location.hash="!/"+url;
						AP._last_hash=url;
					}
				}

				AP.loadURL(Client.url+'/'+url,{direct_load: true});

				return false;
			});

		});
	};



	/**
	 * @desc Similar to continuous AJAX request, but this function load
	 * data to the overlay and don't reset the hash.
	 */
	this.load=function(url){
		return AP.loadURL(url, {model: 'overlay'});
	};


	this.__must_reset=false;
	this.__reset_callback=false;

	this.requireReset=function(reset_callback){
		this.__reset_callback=reset_callback;
		this.__must_reset=true;
	};


	this.loadURL=function(url, options){
		if (AP.isset('Form')){
			if (!Form.protection.transition()){
				return;
			}
		}
		
		
		AP._in_continuous_request=true;

		$("#ajax-load").show();
		$(document.body).addClass("__onload");
		AP.sys.fire("page.pre.transition");
		AP.sys.fire("base.pre.transition");

		var data;

		if (Client.__s){
			data={'from': AP._last_hash, '__s': Client.__s};
		}else{
			data={'from': AP._last_hash, '__s': '0'};
		}

		data._rt=Client.rt;

//		if (Client.pageData.accepted_caches && Client.pageData.accepted_caches.length){
//			$.extend(data, {'__lc':Client.pageData.accepted_caches.join()});
//		}

		// Get all current caches
		var cc=Client.getCurrentCachesKey();
		if (cc && cc.length){
			$.extend(data, {'__lc':cc.join()});
		}


		if (options){
			$.extend(data, options);
		}else{
			options={};
		}


		AP.post(url,data, function(code){
			if (code.direct_request_prevented && (code.direct_request_prevented==1 || code.direct_request_prevented=='1')){
				AP.redirect(url);
				return;
			}

			AP.current_url=url;

			if (!code.good() && (code.message=='FORCE_REFRESH' || code.message=='BAD_XCODE')){
				AP.redirect(url);
				return;
			}



			$(document.body).removeClass("__onload");

			if (code.good()){
				$.log('[Load URL: '+url+"]");

				// track the page view
				// track the page view
				if (typeof ga !== 'undefined'){
					ga('send','pageview', {
						page: url,
						title: code._title
					});
				}else if (typeof _gaq !== 'undefined'){
					_gaq.push(['_trackPageview', url]);
				}


				// First, loading calling the reset function
				var rs=code._init;
				var _rs=eval(rs);
				_rs(function(){
					if (!AP._in_continuous_request && !options.direct_load){
						return;
					}

					// Remove page data

					if (!options.keep_page_data){
						AP.pageData={};
						Client.pageData={};
					}
					
					window.onbeforeunload = null;
					
					AP.pageConfig.reset();
					SE.reset();
					
					if (code._log){
						console.log("[Log: "+url+"]");
						console.log(code._log);
					}

					AP.hotkey.clear();
					AP._in_continuous_request=false;
					AP.gb.clear();

					// Next, setting other components
					AP.html.title(code._title);

					// Next, loading css and javascript
					for (var i=0; i<code._css.length; i++){
						AP.css(code._css[i]);
					}

					// Accept only one javascript
					var called=false;


					if (code._js && code._js.length >0){
						called=AP.js(code._js[code._js.length-1], function(){
							if (code._page_data){
								eval(code._page_data);
							}

							AP.updatePageData();

							AP.fn(code._update, code._html);

							if (code._inpage_js){
								eval(code._inpage_js);
							}
						});
					}

					if (!called){
						if (code._page_data){
							eval(code._page_data);
						}

						AP.updatePageData();

						AP.fn(code._update, code._html);
						if (code._inpage_js){
							eval(code._inpage_js);
						}
					}


					if (Client.pageData.accepted_caches){
						Client.deleteCachesExcept(Client.pageData.accepted_caches);
					}else{
						Client.deleteCachesExcept();
					}

					$("#ajax-load").hide();
					
					AP.sys.fire(AP.EVENTS.PAGE.AFTERLOAD);
				});
			}else{
				$("#ajax-load").hide();

				if (code.data && code.data.force_redirect){
					AP.redirect(code.data.force_redirect);
					return;
				}

				AP._in_continuous_request=false;
			}
		}, true);
	};


	this.loadInlineURL=function(url, data, canvas, options){
		UI.ajaxShow();
		AP.post(url, data, function(code){
			UI.ajaxHide();

			if (!code.good()){
				if (options.error){
					options.error(code);
				}

				return AP.alertError(code.message);
			}

			if (options.start) options.start();
			AP.blockRediretion=null;
			
			AP.setTempData(code);
			$(canvas).html(code.html);

			if (code._page_data){
				for (var key in code._page_data){
					Client.pageData[key]=code._page_data[key];
				}
			}

			// AP.hotkey.clear();
			if (code.__js && code.__js.length){
				eval(code.__js);
			}

			if (options.end) options.end();
		});
	};


	this.initPageData=function(){
		return this.updatePageData();
	};


	this.updatePageData=function(){
		if (Client.pageData.network){
			Client.network=Client.pageData.network;
		}else{
			Client.network=null;
		}

		if (Client.pageData.user){
			Client.user=Client.pageData.user;
		}else{
			Client.user=null;
		}

		// Clear all events (notice: static event should be called via AP.sys
		AP.event.clear();
	};

	
	/**
	 * @desc Register garbage collector
	 */
	this._gcs = [];
	this.gc = function(fn){
		this._gcs.push(fn);
	};
	

	this.resetPageData=function(){
		// Clear MapData
		if (AP.mapData){
			AP.mapData={};
		}

		if (Client){
			Client.tempData={};
		}

		for (var i=0; i<this._gcs.length; i++){
			var _gc = this._gcs[i];
			_gc();
		}
		
		
		for (var i=0; i<AP.__ts.length; i++){
			if (AP.__ts[i]){
				clearTimeout(AP.__ts[i]);
			}
		}

		for (var i=0; i<AP.__rts.length; i++){
			if (AP.__rts[i]){
				clearTimeout(AP.__rts[i]);
			}
		}

		AP.__ts=[];
		AP.__rts=[];

		$("#ap-temp iframe.__temp").each(function(){
			$(this).remove();
		});

		$("#ap-temp").children('.__temp').remove();
		$(".__temp").remove();
		$(".__tempx").empty();

		$("#apdialogs").hide();

		$(document).unbind('keydown');

		$(document).unbind('.__temp');
		$(window).unbind('.__temp');
		
		AP.blockRediretion=null;
	};


	this.purify=function(txt){
		var temp=txt+"";
		
		if (!temp || !temp.length){
			return "";
		}

		temp=temp.replace(/<[^>]*>?/gm, '');
		temp=temp.replace(/<>/gm,'');
		temp=temp.replace(/^\s+|\s+$/gm,'');
		
		return temp;
	};


	/**
	 * Get HTML, and handle via a specific callback
	 */
	this.getHTML=function(url, callback, options){
		if (!options){
			options={};
		}

		options=$.extend({showAjaxLoader: true}, options);

		if (options.showAjaxLoader){
			$("#ajax-load").show();
		}
		if (!AP.word.prefix(url,'http')){
			url=Client.url+'/'+url;
		}

		AP.post(url,{}, function(code){
			if (code.direct_request_prevented && (code.direct_request_prevented==1 || code.direct_request_prevented=='1')){
				AP.redirect(url);
				return;
			}

			if (code.good()){
				$.log('[Loading] URL '+url);

				// Next, setting other components
				if (code._title){
					AP.html.title(code._title);
				}

				// Next, loading css and javascript
				for (var i=0; i<code._css.length; i++){
					AP.css(code._css[i]);
				}

				// Accept only one javascript
				var called=false;

				if (code._js && code._js.length >0){
					called=AP.js(code._js[code._js.length-1], function(){
						if (code._page_data){
							eval(code._page_data);
						}
						callback(code._html);
						if (code._inpage_js){
							eval(code._inpage_js);
						}
					});
				}
				if (!called){
					if (code._page_data){
						eval(code._page_data);
					}
					callback(code._html);
					if (code._inpage_js){
						eval(code._inpage_js);
					}
				}

				if (options.showAjaxLoader){
					$("#ajax-load").hide();
				}
			}else{
				if (options.showAjaxLoader){
					$("#ajax-load").hide();
				}
			}
		});
	};


	
	this.putTemplate=function(val, placeholder){
		$(placeholder).replaceWith(val);
	};
	
	this.putBaseBlock = function(val, placeholder){
		$(placeholder).replaceWith(val);
	};


	/**
	 * @desc Extend client with data
	 */
	this.appData = function(data){
		for (var key in data){
			// Client=$.extend({}, Client, data);
			if (key != 'user' && key != 'network'){
				Client[key]=data[key];
			}else{
				if (Client[key] && !Client['previous_'+key]){
					Client['previous_'+key]=Client[key];
				}
				Client[key]=data[key];
			}


			// Cleanup application data of previous request if needed
		}
	};



	/**
	 * @desc Add wrapper to the document.body. Wrapper is hidden.
	 * @example
	 * 		AP.add("#alert, #dialog");
	 * 		AP.add("alert, dialog");
	 *	  Both generate the same ids.
	 */
	this.add= function(){
		for (var i=0; i<arguments.length; i++){
			var id=arguments[i];
			if (AP.word.prefix(id,'#')){
				id=id.substr(1);
			}
			$(document.body).append("<div id='"+id+"' style='display:none'></div>");
		}
	};


	/**
	 * @desc Generate an unique ID. This is useful when we want to create random IDs
	 * without conflict.
	 */
	var uuidLists=[];
	this.uuid=function(){
		return '_uuid'+(Math.floor(Math.random()*100000))+"_"+(Math.floor(Math.random()*100000))+"_"+AP.time.timeStamp();
	};



	/**
	 * @desc Just a placeholder function.
	 */
	this.nothing=function(){
		return;
	};


	this.test=function(){
		if (Client.native ||parseInt(Client.env) || arguments.length<2){
			return;
		}

		var code=arguments[0];
		var fn=arguments[1];

		$(document).on('keypress', function(e){
			var tag = e.target.tagName.toLowerCase();
			if (tag != 'input' && tag != 'textarea'){
				if (e.keyCode==code+48){
					fn();
					e.preventDefault();
				}
			}
		});
	}



	/**
	 * @desc Apply an action consecutively on all action
	 */
	this.chain=function(data, fn){
		__chainUp(data, 0, fn);
	};


	function __chainUp(data, index, fn){
		if (index>=data.length){
			return;
		}

		fn(data[index], function(){
			chainUp(data, index+1, fn);
		});
	};



	/**
	 * @desc THE PRIVATE METHODS
	 */

	var ap_getHash=function(href){
		return getHash(href);
	};



	var ap_editSubmission=function(elem){
		// Refreshing editor
		$(elem).find('.__apeditor').each(function(){
			nicEditors.findEditor($(this).attr('id')).saveContent();
		});

		$(elem).find("input, textarea").each(function(){
			if ($(this)[0].title && $(this)[0].title==$(this).val()){
				$(this).val("");
			};
		});

		
		$(elem).find("input[name='__code']").val(Client.code);

		if (!$(elem).hasClass('__apform_fixed')){
			$(elem).addClass('__apform_fixed');
			var text="";
			if (Client.base_network && Client.base_network.id>=1 && !$("input[name='__base_network']", $(elem)).length){
				text+="<input type='hidden' name='__base_network' value='"+Client.base_network.id+"'/>";
			}
			if (Client.network && Client.network.id>=1 && !$("input[name='__network']", $(elem)).length){
				text+="<input type='hidden' name='__network' value='"+Client.network.id+"'/>";
			}
			$(elem).append(text);
		}
	};


	var ap_reeditSubmission=function(elem){

		$(elem).find("input, textarea, select").each(function(){
			if (!$(this).hasClass('__injected')){
				$(this).restore();
			}
		});
	};


	this.iframe_counter=0;


	var ap_setupFrameUpload=function(selector, callback, extra_data){
		if ($(selector).flag("iframe_setup")){
			// Still need to fix extra_data

			if (extra_data){
				for (var key in extra_data){
					if ($(selector).find("input[name="+key+"]").length){
						$(selector).find("input[name="+key+"]").val(extra_data[key]);
					}else{
						$("<input type='hidden' name='"+key+"' class='__injected' value='"+extra_data[key]+"'/>").appendTo(selector);
					}
				}
			}
			return;
		}

		var counter=$('iframe._upload').length;
		var action=$(selector).attr('action');

		var temp=true;
		if ($(selector).hasClass('__xtemp')){
			temp=false;
		}

		var name="__iframeupload_"+AP.iframe_counter;
		AP.iframe_counter++;

		var pm_token=null;
		if (!AP.word.prefix(action, "http://") && !AP.word.prefix(action, "https://")){
			$(selector).attr('action',Client.ajax_url+"/"+action);
		}else{
			if (!AP.word.prefix(action, Client.ajax_url)){
				pm_token=AP.uuid();
				extra_data["pm_token"]=pm_token;
				$(selector).data("pm_token", pm_token);
			}
		}


		var ec="";
		if (temp){
			ec=" __temp";
		}
		var elem="<iframe class='_upload "+ec+"' id='"+name+"' name='"+name+"' src='about:blank' onload='return false;'/>";

		if (pm_token){
			$(elem).appendTo($("#ap-temp")).bind("load", function(){
			});

			AP.cors.register(action, pm_token, callback);
		}else{
			$(elem).appendTo($("#ap-temp")).bind("load", function(){
			  	ap_handleFrame(name, callback);
			});
		}




		$(selector).attr('enctype', "multipart/form-data");
		$(selector).attr('target',name);
		$(selector).attr('method','POST');

		$(selector)[0].target=name;
		$(selector)[0].enctype="multipart/form-data";
		if (!AP.word.prefix(action, "http://") && !AP.word.prefix(action, "https://")){
			$(selector)[0].action=Client.ajax_url+"/"+action;
		}
		$(selector)[0].method='POST';

		var text="<input type='hidden' name='__code' class='__injected' value='"+Client.code+"' />";
		if (Client.user && Client.user.id>=1){
			text+="<input type='hidden' name='__user' class='__injected' value='"+Client.user.id+"' />";
		}
		if (Client.base_network && Client.base_network.id>=1){
			text+="<input type='hidden' name='__base_network' class='__injected' value='"+Client.base_network.id+"'/>";
		}
		if (Client.network && Client.network.id>=1){
			text+="<input type='hidden' name='__network' class='__injected' value='"+Client.network.id+"'/>";
		}

		if (extra_data){
			for (var key in extra_data){
				text+="<input type='hidden' name='"+key+"' class='__injected' value='"+extra_data[key]+"'/>";
			}
		}

		if (AP.sys.ie()){
			text+="<input type='hidden' class='__injected' name='__apupload' value='1'/>";
			text+="<input type='hidden' class='__injected' name='__apiefix' value='1'/>";
		}else{
			text+="<input type='hidden' class='__injected' name='__via' value='__frame'/>";
		}

		$(selector).append(text);

		AP.sys.fire("form.pre.submit", selector);
	};


	var ap_handleFrame=function(name, callback){
		var txt=ap_getFrameText(name);

		if (txt && txt.length && txt.length>=2){
			var obj=parseCode(txt);
			if (callback){
				callback(obj);
			}
		}else{
			callback(new Code({code:0, message:"Unknown error (*)", data:null}));
		}
	};


	var ap_getFrameText=function(name){
		return $("#"+name).contents().find('html').text();
		// return window.frames[name].document.getElementsByTagName("body")[0].innerHTML;
	};

};


var Query=new function __Query(){
	this.__data={};
	this.init=function(data){
		this.__data=data;
	};

	this.get=function(key){
		if (key in this.__data){
			return this.__data[key];
		}
		return null;
	};

	this.getFlat=function(key){
		var val=this.get(key);
		if (val==null){
			return "";
		}

		return val;
	};

	this.getInt=function(key){
		var val=this.get(key);
		if (!val){
			return 0;
		}
		return parseInt(val);
	};
	
	this.page=function(){
		var val=this.getInt("page");
		if (!val || val<=0){
			val=1;
		}
		
		return val;
	};

	this.set=function(key, val){
		this.__data[key]=val;
	};

	this.unset=function(key){
		delete this.__data[key];
	};

	this.setDefault=function(key, val){
		if (key in this.__data){
		}else{
			this.__data[key]=val;
		}
	};

	this.reset=function(){
		this.__data={};
	};

	this.all=function(){
		return this.__data;
	};

	
	/**
	 * @desc Safe release, to external variable, no side-effect
	 */
	this.release=function(){
		var obj= shallowClone(this.__data);
		delete obj.env;
		return obj;
	};
	
	this.text=function(){
		var txt="";

		for (var key in this.__data){
			if (key=="env"){
				continue;
			}

			txt+="&"+key+"="+this.__data[key];
		}

		return txt;
	};
};



AP.rules=[];

AP.rewrite=function(pattern, replace, callback, query_string_append){
	AP.rules.push({'pattern': pattern, 'replace': replace, 'callback': callback, 'qsa': query_string_append});
};


AP.rewriteModule = function(module, actions){
	var parts  = module.constructor.name.replace(/_/g,'').match(/[A-Z][a-z]+/g);
	var path = parts.join("/").toLowerCase();
	
	AP.rewrite(":"+(path)+"/-/([a-zA-Z0-9\.]+)", 'action?action=$1', function(qs){
		if (actions.indexOf(qs.action)==-1){
			return;
		}
		
		var f=module.form;
		
		if (qs.action=="create"){
			module.form.create();
		}
		
		if (qs.action=="import"){
			module.form.importer();
		}
	});
	
	
	AP.rewrite(":"+(path)+"/([0-9]+)/([a-zA-Z0-9\.]+)", 'action?id=$1&action=$2', function(qs){
		if (actions.indexOf(qs.action)==-1){
			return;
		}
		
		var obj = module.fromContext(qs.id);
		if (!obj){
			return;
		}
		
		var f=module.form;
		
		if (qs.action=="remove"){
			module.form.remove(obj);
		}
		
		if (qs.action=="edit"){
			module.form.edit(obj);
		}
		
	});
	
};



AP.rewriteCheck=function(url){
	for (var i=0; i<AP.rules.length; i++){
		var temp=AP.rules[i];

		if (url.match(RegExp(temp.pattern))){
			var next=url.replace(new RegExp(temp.pattern), temp.replace);
			var fn=temp.callback;
			var paths=next.split("?");
			if (paths.length<2){
				return true;
			}else{
				var qs=queryStringToArray(paths[1]);
				return true;
			}
		}

	}

	return null;
};



AP.rewriteRedirect=function(url){
	for (var i=0; i<AP.rules.length; i++){
		var temp=AP.rules[i];

		if (url.match(RegExp(temp.pattern))){
			var qs={};
			var original_qs=url.split("?");
			if (original_qs.length==2 && temp.qsa){
				qs=queryStringToArray(original_qs[1]);
			}

			var next=url.replace(new RegExp(temp.pattern), temp.replace);
			var fn=temp.callback;
			var paths=next.split("?");

			if (paths.length<2){
				fn.call(AP.__urlref, qs);
				return true;
			}else{
				var new_qs=queryStringToArray(paths[1]);
				for (var key in new_qs){
					qs[key]=new_qs[key];
				}
				fn.call(AP.__urlref, qs);
				return true;
			}
		}

	}

	return null;
};




AP.config={};


AP.event=new function __APEvent(){
	this.events={};
	this.__fired={};

	this.clear=function(){
		this.events={};
		this.__fired={};
	};

	this.removeListener=function(ev){
		if (this.events[ev] && this.events[ev].length){
			this.events[ev]=[];
			delete this.events[ev];
		}
	};

	this.trigger=function(ev, data){
		if (this.events[ev] && this.events[ev].length){
			for (var i=0; i<this.events[ev].length; i++){
				var fn=this.events[ev][i];
				if (!fn){
					break;
				}

				if (fn._caller){
					fn.apply(fn._caller, data);
				}else{
					if (AP.data.isArray(data)){
						fn.apply(undefined, data);
					}else{
						fn(data);
					}

				}
			}
		}

		this.__fired[ev]=1;
		return this;
	};


	this.release=function(ev){
		if (this.events[ev] && this.events[ev].length){
			while (true){
				var fn=this.events[ev].shift();
				if (!fn){
					break;
				}

				if (fn._caller){
					fn.apply(fn._caller);
				}else{
					fn();
				}
			}
		}

		this.__fired[ev]=1;
		return this;
	};


	this.bind=function(ev, fx, _caller){
		if (!this.events[ev]){
			this.events[ev]=[];
		}

		if (_caller){
			fx._caller=_caller;
		}

		this.events[ev].push(fx);

		return this;
	};


	/**
	 * @desc Reset all current binds and rebind
	 */
	this.rebind=function(ev, fx, _caller){
		this.events[ev]=[];

		if (_caller){
			fx._caller=_caller;
		}

		this.events[ev].push(fx);

		return this;
	};



	this.bindAll=function(ev, fx, _caller){
		if (!this.events[ev]){
			this.events[ev]=[];
		}

		if (_caller){
			fx._caller=_caller;
		}

		this.events[ev]=[fx]; // Replace

		return this;
	};


	this.fired=function(ev){
		if (this.__fired[ev]){
			return true;
		}
		return false;
	};
};






function range(from, to, space){
	if (!space || typeof space=="undefined"){
		space=1;
	}

	var r=[];
	if (from<to){
		for (var i=from; i<=to; i=i+space){
			r.push(""+i);
		}
		return r;
	}else{
		for (var i=from; i>=to; i=i-space){
			r.push(""+i);
		}
		return r;
	}

};


function undone(msg){
	if (msg){
		AP.alertError(msg);
	}else{
		AP.alertError("This feature is either disabled or not ready for public yet. Please try again later.");
	}
};



//GetPageScroll() by quirksmode.com
function getViewport() {
	var xScroll, yScroll;
	if (self.pageYOffset) {
	  yScroll = self.pageYOffset;
	  xScroll = self.pageXOffset;
	} else if (document.documentElement && document.documentElement.scrollTop) {
	  yScroll = document.documentElement.scrollTop;
	  xScroll = document.documentElement.scrollLeft;
	} else if (document.body) {
	  yScroll = document.body.scrollTop;
	  xScroll = document.body.scrollLeft;
	}
	return new Array(xScroll,yScroll);
}



function getUploadFN(str){
	str=str.replace(/\\/g,'/');
	var parts=str.split("/");
	if (!parts || parts.length<1){
		return false;
	}
	return parts[parts.length-1];
}




function getHash(href){
	if (!href){
		return null;
	}
	if (href.indexOf('#')!=-1){
		return null;
	}

	var path=href.split("//", 2);
	if (!path || path.length!=2){
		return;
	}
	var sub_path=path[1];
	var url=sub_path.split("/");
	if (!url || url.length<2){
		return;
	}
	url=AP.array.sub(url, 1);
	return url;
};


function safe(txt){
	return AP.purify(txt);
};

function inline(content, max_length, append_dots){
	if (!max_length){
		max_length=255;
	}
	
	if (content === null || typeof content == "undefined"){
		return '';
	}
	
	var _content = content.replace(/<\/p>\s*<p>/g, '</p> &#8628; </p>').replace(/<\/div>\s*<div>/g, '</div> &#8628; </div>').replace(/<br\/*>/g, ' &#8628; ');
	var extra = " ";
	if (append_dots){
		extra = " ...";
	}
	
	return AP.word.shorten(AP.purify(_content),max_length, extra);
};

function purify(txt){
	var str=safe(txt);
	var defaultDiacriticsRemovalMap = [
			{'base':'A', 'letters':/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},
			{'base':'AA','letters':/[\uA732]/g},
			{'base':'AE','letters':/[\u00C6\u01FC\u01E2]/g},
			{'base':'AO','letters':/[\uA734]/g},
			{'base':'AU','letters':/[\uA736]/g},
			{'base':'AV','letters':/[\uA738\uA73A]/g},
			{'base':'AY','letters':/[\uA73C]/g},
			{'base':'B', 'letters':/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},
			{'base':'C', 'letters':/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},
			{'base':'D', 'letters':/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},
			{'base':'DZ','letters':/[\u01F1\u01C4]/g},
			{'base':'Dz','letters':/[\u01F2\u01C5]/g},
			{'base':'E', 'letters':/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},
			{'base':'F', 'letters':/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},
			{'base':'G', 'letters':/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},
			{'base':'H', 'letters':/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},
			{'base':'I', 'letters':/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},
			{'base':'J', 'letters':/[\u004A\u24BF\uFF2A\u0134\u0248]/g},
			{'base':'K', 'letters':/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},
			{'base':'L', 'letters':/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},
			{'base':'LJ','letters':/[\u01C7]/g},
			{'base':'Lj','letters':/[\u01C8]/g},
			{'base':'M', 'letters':/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},
			{'base':'N', 'letters':/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},
			{'base':'NJ','letters':/[\u01CA]/g},
			{'base':'Nj','letters':/[\u01CB]/g},
			{'base':'O', 'letters':/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},
			{'base':'OI','letters':/[\u01A2]/g},
			{'base':'OO','letters':/[\uA74E]/g},
			{'base':'OU','letters':/[\u0222]/g},
			{'base':'P', 'letters':/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},
			{'base':'Q', 'letters':/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},
			{'base':'R', 'letters':/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},
			{'base':'S', 'letters':/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},
			{'base':'T', 'letters':/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},
			{'base':'TZ','letters':/[\uA728]/g},
			{'base':'U', 'letters':/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},
			{'base':'V', 'letters':/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},
			{'base':'VY','letters':/[\uA760]/g},
			{'base':'W', 'letters':/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},
			{'base':'X', 'letters':/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},
			{'base':'Y', 'letters':/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},
			{'base':'Z', 'letters':/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},
			{'base':'a', 'letters':/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},
			{'base':'aa','letters':/[\uA733]/g},
			{'base':'ae','letters':/[\u00E6\u01FD\u01E3]/g},
			{'base':'ao','letters':/[\uA735]/g},
			{'base':'au','letters':/[\uA737]/g},
			{'base':'av','letters':/[\uA739\uA73B]/g},
			{'base':'ay','letters':/[\uA73D]/g},
			{'base':'b', 'letters':/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},
			{'base':'c', 'letters':/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},
			{'base':'d', 'letters':/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},
			{'base':'dz','letters':/[\u01F3\u01C6]/g},
			{'base':'e', 'letters':/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},
			{'base':'f', 'letters':/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},
			{'base':'g', 'letters':/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},
			{'base':'h', 'letters':/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},
			{'base':'hv','letters':/[\u0195]/g},
			{'base':'i', 'letters':/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},
			{'base':'j', 'letters':/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},
			{'base':'k', 'letters':/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},
			{'base':'l', 'letters':/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},
			{'base':'lj','letters':/[\u01C9]/g},
			{'base':'m', 'letters':/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},
			{'base':'n', 'letters':/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},
			{'base':'nj','letters':/[\u01CC]/g},
			{'base':'o', 'letters':/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},
			{'base':'oi','letters':/[\u01A3]/g},
			{'base':'ou','letters':/[\u0223]/g},
			{'base':'oo','letters':/[\uA74F]/g},
			{'base':'p','letters':/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},
			{'base':'q','letters':/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},
			{'base':'r','letters':/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},
			{'base':'s','letters':/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},
			{'base':'t','letters':/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},
			{'base':'tz','letters':/[\uA729]/g},
			{'base':'u','letters':/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},
			{'base':'v','letters':/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},
			{'base':'vy','letters':/[\uA761]/g},
			{'base':'w','letters':/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},
			{'base':'x','letters':/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},
			{'base':'y','letters':/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},
			{'base':'z','letters':/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}
		  ];

	for (var i=0; i<defaultDiacriticsRemovalMap.length; i++) {
		str = str.replace(defaultDiacriticsRemovalMap[i].letters, defaultDiacriticsRemovalMap[i].base);
	}

	str=str.replace(/[\W_]+/g," ");
	str=$.trim(str);
	return str.toLowerCase();
};

function purifyStrict(str, sep){
	if (!sep){
		sep = "";
	}
	var s=purify(str);
	s=s.replace(/[\W_\s]+/g, sep);
	return s.toLowerCase();
};

function shallowClone(obj){
	if (!AP.data.isObject(obj)){
		return obj;
	}
	
	var temp={};
	for (var key in obj){
		temp[key]=obj[key];
	}

	return temp;
};





function getScrollbarWidth(){
	var jTest = $('<div style="display:none;height:50px;overflow: scroll"><div style="height:100px;"></div></div>');
    $('body').append(jTest);
    var w = jTest.innerWidth();
    jTest.css({
        overflow: 'auto',
        height: '200px'
    });
    var w2 = jTest.innerWidth();
    var c= w-w2;

	return (c > 0) ? c : 15; // fix invisible scrollbar on MacOSX
	
	var scrollbarWidth = 0;
	if (!scrollbarWidth) {
		if ( $.browser.msie ) {
			var $textarea1 = $('<textarea cols="10" rows="2"></textarea>')
					.css({ position: 'absolute', top: -1000, left: -1000 }).appendTo('body'),
				$textarea2 = $('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>')
					.css({ position: 'absolute', top: -1000, left: -1000 }).appendTo('body');
			scrollbarWidth = $textarea1.width() - $textarea2.width();
			$textarea1.add($textarea2).remove();
		} else {
			var $div = $('<div />')
				.css({ width: 100, height: 100, overflow: 'auto', position: 'absolute', top: -1000, left: -1000 })
				.prependTo('body').append('<div />').find('div')
					.css({ width: '100%', height: 200 });
			scrollbarWidth = 100 - $div.width();
			$div.parent().remove();
		}
	}
	return scrollbarWidth;
};







function parseCode(txt){
	if (AP.isObject(txt)){
		return new Code(txt);
	}

	try{
		var tmp = txt.substring(txt.indexOf('{"code"'));
		return new Code(eval("("+tmp+")"));
	}catch(e){
		return new Code({"code":0, "message":'Unknown Error',"data":null, "error":"parse error"});
	}
}




var ExitCode = new function _ExitCode(){
	this.fns={};

	/**
	 * @desc Register a callback on code
	 */
	this.reg=function(code, fn){
		this.fns[code]=fn;
	};


	/**
	 * @desc Execute the callback marked by code (and data is the param)
	 */
	this.execute=function(code, data){
		var fn=this.fns[code];
		if (fn){
			fn(data);
		}else{
			$.log("Unknown exitcode "+code);
		}
	}
};


function assoc(data){
	if (AP.data.isArray(data)){
		var obj={};
		for (var i=0; i<data.length; i++){
			obj[data[i].name]=data[i].value;
		}
		return obj;	
	}
	
	var obj={};
	obj[arguments[0]]=arguments[1];
	return obj;
};



function assoc2(data){
	if (AP.data.isArray(data)){
		var obj={};
		for (var i=0; i<data.length; i++){
			if (AP.word.suffix(data[i].name, '[]')){
				var n = data[i].name.substr(0, data[i].name.length-2);
				if (obj[n]){
					obj[n].push(data[i].value);
				}else{
					obj[n] = [data[i].value];
				}
			}else{
				obj[data[i].name]=data[i].value;	
			}
			
		}
		return obj;	
	}
	
	var obj={};
	obj[arguments[0]]=arguments[1];
	return obj;
};


function mobile(){
	return (Client.mobile && Client.mobile==1);
};


function __(str, cond){
	if (cond) return str;
	return "";
};


function ___(str, other){
	if (!str || !str.length){
		return other;
	}
	return str;
};





function Code(obj){
	this.code=0;
	this.message='';
	this.data=null;

	if (obj){
		$.extend(this, obj);
		this.code=parseInt(this.code);
	}


	/**
	 * @desc Check if a code is good.
	 */
	this.good=function(){
		if (this.hasCode(1)) return true;
		return false;
	};

	this.notEmpty=function(){
		return !this.empty;
	};

	this.hasCode=function(code){
		if (this.code==code){
			return true;
		}
		return false;
	};


	this.hasMessage=function(message){
		if (this.message==message){
			return true;
		}
		if (AP.isInt(message) && this.message && message==parseInt(this.message)){
			return true;
		}
		return false;
	};
};



Code.init=function(txt){
	try{
		return new Code(eval("("+txt+")"));
	}
	catch(e){
		return new Code({"code":0, "message":'Unknown error',"data":null, "error":"parse_error"});
	}
};


Code.error = function(msg){
	var c=new Code();
	c.message=msg;
	return c;
};





var fxs={};
var fxe={};

function APJSONCALLBACK(data){
	if (data.fx){
		var fn=fxs[data.fx];
		var code=new Code(data);
		if (code){
			fn(code);
		}else{
			var err=fxe[data.fx];
			if (err){
				err(code);
			}
		}
		$("#"+data.fx).remove();
	}
};


function APJSONREG(fx, fn, fn_error){
	fxs[fx]=fn;
	fxe[fx]=fn_error;
};


function queryStringToArray(qs){
	var parts=qs.split("&");
	var r={};
	for (var i=0; i<parts.length; i++){
		var data=parts[i].split("=");
		if (data && data.length==2){
			r[data[0]]=data[1];
		}
	}

	return r;
};


function isFormData(data){
	return (data && Client.native && data instanceof FormData);
};







function __selfcall(ref){
	var fn=$(ref).data("action");
	if (fn){
		fn();	
	}
};



function $$(fn){
	if (Client.env && !parseInt(Client.env)){
		fn();
	}
};




AP._locales={};

AP.locale=new function __APLocale(){
	this.get=function(key, df){
		if (AP._locales[key]){
			return AP._locales[key];
		}
		if (df){
			return df;
		}

		return null;
	}

	this.set=function(key, val){
		AP._locales[key]=val;
	};

};


AP.json = new function __APJSON(){
	this.parse = function(str){
		try {
			var a = JSON.parse(str);
			return a;
		} catch(e) {
			return null;
		}
	};
};


AP.cors=new function __APCORS(){
	this.url=null;
	this.pm_token=null;
	this.callback=null;
	this.__init=false;

	this.register=function(url, token, callback){
		this.init();
		this.url=url;
		this.pm_token=token;
		this.callback=callback;
	};


	this.init=function(){
		// INIT ONCE
		if (this.__init){
			return;
		}

		this.__init=true;

		var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
		var apeventer = window[eventMethod];
		var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";

		// Listen to message from child window
		apeventer(messageEvent, function(e) {
			if (typeof e.data.pm_token == 'undefined') return;
			if (e.data.pm_token!=AP.cors.pm_token){
				AP.alertError("Security error (invalid pm token)");
			}

			if (!AP.word.prefix(AP.cors.url, e.origin)){
				AP.alertError("Security error (invalid origin)");
			}

			var obj=parseCode(e.data);
			if (AP.cors.callback){
				AP.cors.callback(obj);
			}
		}, false);
	}
};



AP.postmessage=new function __APPostMessage(){
	this.__inited=false;
	this.__token = 0;
	this.events={};
	
	this.init=function(){
		if (this.__inited){
			return;
		}
		
		this.__inited=true;
		this.__token=AP.uuid();
		
		this.listen(function(data, domain){
			var event=data.event;
			var token=data.token;
			
			if (data && data.__exchange){
				token=data.base_token;
			}
			
			if (token!=AP.postmessage.token()){
				$.log("POST_MESSAGE_TOKEN_ERROR");
				return;
			}
			
			var fn=AP.postmessage.events[event];
			if (fn){
				if (data.__exchange){
					if (data.data && data.data.silent){
					}else{
						Base.api.closeDialog();	
					}
					
					fn(data.data);
				}else{
					fn(data);	
				}
				
			}
		});
	};
	
	this.register=function(event, callback){
		this.events[event]=callback;
	};
	
	this.token=function(){
		this.init();
		return this.__token;
	};
	
	
	this.toParent=function(data, parent_domain){
		data.token= Query.get("base_token");
		data.event= Query.get("event");
		
		parent.postMessage(data, parent_domain);
	};

	this.toAll=function(ifr_selector, data){
		$(document.body).find(ifr_selector).each(function(){
			$(this).on("load", function(){
				$(this).data("loaded", 1);
				var src=$(this).attr("src");
				var fr=$(this)[0].contentWindow;
				var domain=getDomain($(this).attr("src"));
				fr.postMessage(data, domain);
			});

			if (!$(this).is(":visible")){
				return;
			}

			var src=$(this).attr("src");
			var fr=$(this)[0].contentWindow;
			var domain=getDomain($(this).attr("src"));
			fr.postMessage(data, domain);

		});
	};

	this.toChild=function(ifr, data){
		$(ifr).each(function(){
			$(this).on("load", function(){
				$(this).data("loaded", 1);
				var src=$(this).attr("src");
				var fr=$(this)[0].contentWindow;
				var domain=getDomain($(this).attr("src"));
				fr.postMessage(data, domain);
			});

			if (!$(this).is(":visible")){
				return;
			}

			var src=$(this).attr("src");
			var fr=$(this)[0].contentWindow;
			var domain=getDomain($(this).attr("src"));
			fr.postMessage(data, domain);

		});
	};

	this.listen=function(handler){
		var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
		var eventer = window[eventMethod];
		var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";

		eventer(messageEvent,function(e){
			handler(e.data, e.origin);
		},false);
	};


	function getDomain(url){
		var part=AP.word.split("/", url);
		if (part.length<2){
			return "*";
		}

		return part[0]+"//"+part[1];
	};
};


AP.cmp=new function __APCmp(){
	this.int=function(a, b){
		return parseInt(a)==parseInt(b);
	};

	this.str=function(a,b){
		return a.toLowercase()==b.toLowercase();
	}
};



function explain(txt, opts){
	if (opts && opts===true){
		opts={icon: false};
	}

	opts=$.extend({direction: 'up', width: 200, icon: true}, opts);
	
	
	var align = '';
	if ('align' in opts){
		align = "-align-"+(opts.align)+"";
	}
	
	if (!opts.icon){
		return "<span class='-infobox -"+opts.direction+" "+align+" -w"+opts.width+"'><span class='-box block normal'>"+txt+"</span></span>";
	}

	return "&nbsp; <span class='inline relative -infow'><span class='-ap icon-help-with-circle'></span> <span class='-infobox -"+opts.direction+" "+align+" -w"+opts.width+"'><span class='-box block normal'>"+txt+"</span></span></span>";
};


function floatDiff(v1, v2){
	return (parseFloat(v1)*1000 - parseFloat(v2) * 1000)>=1;
};


(function() {
	var beforePrint = function() {
		AP.__printing=1;
	};
	var afterPrint = function() {
		AP.__printing=0;
	};

	if (window.matchMedia) {
		var mediaQueryList = window.matchMedia('print');
		mediaQueryList.addListener(function(mql) {
			if (mql.matches) {
				beforePrint();
			} else {
				afterPrint();
			}
		});
	}

	window.onbeforeprint = beforePrint;
	window.onafterprint = afterPrint;
}());


var CP = Client.pageData;




AP.time={
	
	/**
	 * @desc Please reset this if you want to use locale words
	 */	
	months:["{{January}}","{{February}}","{{March}}","{{April}}","{{May}}","{{June}}","{{July}}","{{August}}","{{September}}","{{October}}","{{November}}","{{December}}"],
	sMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],
	days:["{{Monday}}","{{Tuesday}}", "{{Wednesday}}", "{{Thursday}}","{{Friday}}","{{Saturday}}", "{{Sunday}}"],	
	sDays:["Mon","Tue", "Wed", "Thu","Fri","Sat","Sun"],  
	tDays:["T2", "T3", "T4", "T5", "T6", "T7", "CN"],
	tvDays:["{{Thá»© 2}}", "{{Thá»© 3}}", "{{Thá»© 4}}", "{{Thá»© 5}}", "{{Thá»© 6}}", "{{Thá»© 7}}", "{{Chá»§ Nháº­t}}"],
	
	mktime: function(ts){
		if (!ts){
			t = new Date();
		}else{
			t = new Date(parseInt(ts)*1000);
		}
		
		return t;
	},
	
	
	/**
	 * @desc Handler time function.
	 */
	time:function(pattern, time_stamp){
		var t = this.mktime(time_stamp);
		
		var _year = t.getFullYear();
		var _month= t.getMonth()+1;
				
		var month=_month;
		if (_month<10){
			month="0"+_month;
		}
		
		var _day=(t.getDay()||7)-1;
		
		var _date=t.getDate();
		
		var date=_date;
		if (_date<10){
			date="0"+_date;
		}
		
		var _hour=t.getHours();
		var _hour12=(_hour%12);
		var hour=_hour;
		if (_hour<10){
			hour="0"+_hour;
		}
		
		var _minute=t.getMinutes();	
		var _second=t.getSeconds();
		
		
		var r=pattern;
		var tday=AP.time.tDays[_day];
		var vday=AP.time.tvDays[_day];
		
		// Day & Date
		r=r.replace("%d", date);
		r=r.replace("%D", AP.time.sDays[_day]);
		r=r.replace("%j", _date);
		r=r.replace("%l", AP.time.days[_day]);
		r=r.replace("%N", _day+1);
		r=r.replace("%w", _day);
		r=r.replace("%T", tday);
		r=r.replace("%v", tday);
		r=r.replace("%V", vday);
		
		// Month
		r=r.replace("%F", AP.time.months[_month-1]);
		r=r.replace("%m", month);
		r=r.replace("%M", AP.time.sMonths[_month-1]);
		r=r.replace("%n", _month);
		r=r.replace("%t", new Date(_year, _month, 0).getDate());
		
		// Year
		r=r.replace("%L", (new Date(_year, 1,29).getMonth()==1));
		r=r.replace("%o", _year);
		r=r.replace("%Y", _year);
		r=r.replace("%y", _year.toString().substr(2));
		
		// Hour & Minute & Second
		r=r.replace("%a", (_hour<12)?"am":"pm");
		r=r.replace("%A", (_hour<12)?"AM":"PM");
		r=r.replace("%g", _hour12);
		r=r.replace("%G", _hour);
		r=r.replace("%h", (_hour12<10)?("0"+_hour12):_hour12);
		r=r.replace("%H", (_hour<10)?("0"+_hour):_hour);
		r=r.replace("%i", (_minute<10)?("0"+_minute):_minute);
		r=r.replace("%s", (_second<10)?("0"+_second):_second);
		r=r.replace("%u", t.getMilliseconds()*1000);
		
		// Timezone
		r=r.replace("%Z", -t.getTimezoneOffset()*60);
	
		return r;
	},
	
	hm: function(time){
		var h=AP.data.zeroPrefix(Math.floor(time/3600));
		var m=AP.data.zeroPrefix(Math.floor((time-h*3600)/60));
		return h+":"+m;
	},
	
	beginOfDay: function(time_stamp){
		var t = this.mktime(time_stamp);
		return AP.time.timeStamp(new Date(t.getFullYear(), t.getMonth(), t.getDate()));
	},
	
	beginOfMonth: function(time_stamp){
		var t = this.mktime(time_stamp);
		return AP.time.timeStamp(new Date(t.getFullYear(), t.getMonth(), 1));
	},
	
	endOfMonth: function(time_stamp){
		var t = this.mktime(time_stamp);
		return AP.time.timeStamp(new Date(t.getFullYear(), t.getMonth()+1, 0));
	},
	
	
	midnight: function(time_stamp){
		var t = this.mktime(time_stamp);
		return AP.time.timeStamp(new Date(t.getFullYear(), t.getMonth(), t.getDate(), 23, 59, 59));
	},
	
	beginOfWeek: function(time_stamp){
		return AP.time.firstDayOfWeek(time_stamp);
	},

	endOfWeek: function(time_stamp){
		return AP.time.firstDayOfWeek(time_stamp)+6*24*3600;
	},
	
	sameDay: function(ts1, ts2){
		return AP.time.beginOfDay(parseInt(ts1))==AP.time.beginOfDay(parseInt(ts2));
	},
	
	sameYear: function(ts1, ts2){
		return AP.time.time("%Y",ts1)==AP.time.time("%Y",ts2);
	},
	sameMonth: function(ts1, ts2){
		return AP.time.time("%m%Y",ts1)==AP.time.time("%m%Y",ts2);
	},
	sameWeek: function(ts1, ts2){
		return AP.time.firstDayOfWeek(parseInt(ts1))==AP.time.firstDayOfWeek(parseInt(ts2));
	},
	
	test: function(ts){
		return AP.time.time("%Y %m %d, %H:%i:%s", ts);
	},
	
	/**
	 * @desc Get the previous Monday
	 * @param time_stamp
	 * @returns
	 */
	firstDayOfWeek: function(time_stamp){
		var t = this.mktime(time_stamp);
		
		// Get the first day of week [Return timestamp]
		var day=(t.getDay() || 7)-1;

		t.setHours(-24 * day);
		t.setSeconds(0);
		t.setMinutes(0);
		t.setHours(0);
		
		return AP.time.timeStamp(t);
	},
	
	
	/**
	 * @desc Get the first day of the current month
	 * @param time_stamp
	 * @returns
	 */
	firstDayOfMonth: function(time_stamp){
		var t = this.mktime(time_stamp);
		
		t.setDate(1);
		t.setSeconds(0);
		t.setMinutes(0);
		t.setHours(0);
		
		return AP.time.timeStamp(t);
	},
	
	
	
	timeStamp:function(d){
		if (!d){
			d=new Date();
		}
		return Math.floor(d.getTime()/1000);
	},
	
	now: function(){
		return Math.floor((new Date()).getTime()/1000);
	},
	
	date: function(time_stamp){
		return this.mktime(time_stamp);
	},
	
	ago: function(time_stamp){
		time_stamp=parseInt(time_stamp);
		var t = this.timeStamp();
		var diff=t-time_stamp;
		
		if (diff<5){
			return "{{-- few seconds ago}}";
		}
		if (diff<60){
			return diff+" "+'{{-- seconds ago}}';
		}
		if (diff<3600){
			return Math.floor(diff/60)+" "+'{{-- minutes ago}}';
		}
		if (diff<3600*24){
			return Math.floor(diff/3600)+" "+'{{-- hours ago}}';
		}
		return Math.floor(diff/86400)+" "+'{{-- days ago}}';
	},
	
	
	late: function(actual_time, deadline){
		if (!deadline){
			deadline=0;
		}
		
		var diff=parseInt(actual_time)-parseInt(deadline);
		if (diff<0){
			return "---";
		}
		
		if (diff<5){
			return lang("few seconds");
		}
		if (diff<60){
			return diff+" "+lang('seconds');
		}
		
		if (diff<3600){
			return Math.floor(diff/60)+"m";
		}
		
		if (diff<3600*24){
			var h=Math.floor(diff/3600);
			var min=Math.floor((diff-h*3600)/60);
			return h+"h"+min+"m";
		}
		
		var h=Math.floor(diff/86400);
		
		if (h==1){
			return h+" "+lang('day');	
		}
		
		return h+" "+lang('days');
	},
	
	remain: function(deadline){
		return AP.time.late(-AP.time.now(), -deadline);
	},
	
	
	countdown: function(obj, __render){
		AP.rtimeout(function(){
			var ts="";
			
			var data=$(obj).data('timeremain');
			data=parseInt(data);
			
			if (data && data>=0){
				var d=Math.floor(data/(3600*24));
				var h=Math.floor((data -d*24*3600) /3600);
				var m=Math.floor((data-h*3600-d*24*3600)/60);
				var s=data-d*24*3600-h*3600-m*60;
				var ts=h+"h "+m+"m "+s+"s";
				if (d>0){
					ts=d+"d "+h+"h "+m+"m "+s+"s";
				}
				
				if (__render){
					ts=__render(d,h,m,s);
				}
			}
			
			
			
			$(obj).html(ts);
			
			if (data>=0){
				data=data-1;
				$(obj).data('timeremain', data);
			}
		}, 1000);
	},
	
	

	count: function(initial, callback, finish){
		var t=this.now();
		AP.rtimeout(function(){
			var c=AP.time.now();
			var rem=initial+t-c;
			if (rem<0){
				finish();
			}else{
				callback(rem);
			}
		},1000);
	},
	
	dow: function(index){
		return this.tvDays[index];
	},
	
	diff: function(from, to){
		from = parseInt(from);
		to = parseInt(to);

		if (to<=from){
			return {year: 0, day: 0, day_counts: 0};
		}
		
		
		from = this.beginOfDay(from);
		to = this.beginOfDay(to);
		
		var df = new Date(from * 1000);
		var dt = new Date(to * 1000);
		
		var r = {year: dt.getFullYear() - df.getFullYear(), day: 0, day_counts: Math.floor((to-from)/(24*3600))};
		
		var same_year = new Date(from*1000);
		same_year.setFullYear(dt.getFullYear());
		var sy_ts = this.timeStamp(same_year);
		
		if (sy_ts <= to){
			r.day = Math.floor((to - sy_ts)/(24*3600));
		}else{
			r.year = r.year-1;
			same_year.setFullYear(dt.getFullYear()-1);
			sy_ts = this.timeStamp(same_year);
			r.day = Math.floor((to - sy_ts)/(24*3600));
		}
		
		return r;
	}
};


AP.i18n=new function __APi18n(){
	this.confs={date_format: "dmy", time_format:"hm"};
	
	this.get=function(key){
		var confs=$.extend(this.confs, Client.i18n);
		return confs[key];
	};
	
	this.dateFormat=function(){
		var format=this.get("date_format");
		if (format=="dmy"){
			return "%d/%m/%Y";
		}else if (format=="full"){
			return "%l, %F %d, %Y";
		}else{
			return "%m/%d/%Y";
		}
	};
	
	this.date=function(ts){
		return AP.time.time(this.dateFormat(), ts);
	};
	
	this.safeDate=function(ts){
		if (!ts || !parseInt(ts)){
			return '<span>---</span>';
		}
		
		return this.date(ts);
	};
	
	this.datetime=function(ts){
		return AP.time.time("%H:%i "+this.dateFormat(), ts);
	};
	
	this.time=function(ts){
		return AP.time.time("%H:%i", ts);
	};
	
	this.readDate=function(str){
		var data=str.split("/");
		if (data.length!=3){
			return 0;
		}
		
		var day=parseInt(data[0]);
		var month=parseInt(data[1])-1;
		var year=parseInt(data[2]);
		
		var ts=new Date(year, month, day, 0, 0, 0, 0);
		return Math.floor(ts.getTime()/1000);
	};
	
	this.dateRange=function(stime, etime){
		stime=parseInt(stime);
		etime=parseInt(etime);
		
		if (etime){
			if (AP.time.sameYear(stime, etime)){
				return AP.time.time("%d/%m", stime)+" - " + AP.time.time("%d/%m/%y", etime);
			}else{
				return AP.time.time("%d/%m/%y", stime)+" - " + AP.time.time("%d/%m/%y", etime);
			}
		}else{
			if (parseInt(stime)){
				return AP.time.time("%d/%m/%y", stime)+" &#8702; ... ";
			}else{
				return "... "+" &#8702; ... ";	
			}
		}
	};
	
	
	this.timeRange=function(stime, etime){
		stime=parseInt(stime);
		etime=parseInt(etime);
		
		if (etime){
			if (AP.time.sameYear(stime, etime)){
				return AP.time.time("%H:%i %d/%m", stime)+" - " + AP.time.time("%H:%i %d/%m", etime);
			}else{
				return AP.time.time("%H:%i %d/%m", stime)+" - " + AP.time.time("%H:%i %d/%m", etime);
			}
		}else{
			return AP.time.time("%H:%i %d/%m/%y", stime)+" &#8702; ... ";
		}
	};
	
	this.range=this.dateRange;
	

	this.range2=function(stime, etime){
		stime=parseInt(stime);
		etime=parseInt(etime);
		
		if (etime){
			if (AP.time.sameYear(stime, etime)){
				return AP.time.time("%d/%m", stime)+" - " + AP.time.time("%d/%m/%Y", etime);
			}else{
				return AP.time.time("%d/%m/%Y", stime)+" - " + AP.time.time("%d/%m/%Y", etime);
			}
		}else{
			if (parseInt(stime)){
				return AP.time.time("%d/%m/%Y", stime)+" &#8702; ... ";
			}else{
				return "... "+" &#8702; ... ";	
			}
		}
	};
	
	
	
	this.duration=function(total_seconds, compact){
		if (compact){
			return this.durationCompact(total_seconds);
			
		}
		
		var s=parseInt(total_seconds);
		if (s<3600){
			var m=Math.floor(s/60);
			return "<em>"+(m)+"</em>m";
		}
		
		if (s<48*3600){
			var h=Math.floor(s/3600);
			var m=Math.floor((s-h*3600)/60);
			return "<em>"+(h)+"</em>h<em>"+(m)+"</em>m";
		}
		
		var d=Math.floor(s/(24*3600));
		var h=Math.floor((s-d*24*3600)/3600);
		var m=Math.floor((s-d*24*3600-h*3600)/60);
		return "<em>"+(d)+"</em>d<em>"+(h)+"</em>h<em>"+(m)+"</em>m";
	};
	
	
	this.durationCompact=function(total_seconds){
		var s=parseInt(total_seconds);
		if (s<3600){
			var m=parseFloat(s/60).toFixed(1);
			return "<em>"+(m)+"</em>m";
		}
		
		if (s<48*3600){
			var h=parseFloat(s/3600).toFixed(1);
			return "<em>"+(h)+"</em>h";
		}
		
		var d=parseFloat(s/(24*3600)).toFixed(1);
		return "<em>"+(d)+"</em>d";
	};
	
	
	
	function getTimezones(){
		var opts = range(-12, 12);
		var r = [];
		
		for (var i=0; i<opts.length; i++){
			var sign ='+';
			if (opts[i]<0){
				sign = '';
			}
			
			r.push({value: opts[i], label: "{{GMT ~timezone}}"+(sign)+""+(opts[i])+""})
		}
		
		return r;
	};
	
	
	function getMonths(){
		var opts = range(1, 12);
		var r = [];
		for (var i=0; i< opts.length; i++){
			r.push({value: opts[i], label: AP.time.months[opts[i]-1]})
		}
		
		return r;
	};
	
	
	this.options = {
		timezones: getTimezones(),
		monthes: getMonths(),
	}
	
};


AP.hotkey=new function __APHotKey(){
	this.__init=false;
	this.__dialog=false;
	this.events={};
	
	
	this.init=function(dialog){
		if (this.__init){
			return this;
		}
		
		if (!dialog){
			dialog=false;
		}
		
		this.__dialog=dialog;
		this.__init=true;
		this.bind();
		return this;
	};
	
	this.on=function(key, fn){
		this.events[key]=fn;
		return this;
	};
	
	this.clear=function(){
		this.__init=false;
		this.events={};
		
		return this;
	};
	
	
	this.moveable=function(elems, options){
		if (!options){
			options={};
		}
		
		options=$.extend({first: -1, activeClass: 'active'}, options);
		this.on("up", function(e){
			refocus(elems, -1, options);
		}).on("down", function(e){
			refocus(elems, 1, options);
		}).on("enter", function(e){
			$(elems).filter(".active").first().find(".url").click();
		});
		
		$(elems).first().addClass("active");

	};
	
	
	
	this.bind=function(){
		$(document).on('keydown.__temp', function(e){
			if (!AP.hotkey.__dialog && $("#apdialogs").is(":visible")){
				return;
			}
			
			var tag = e.target.tagName.toLowerCase();
			if (tag != 'input' && tag != 'textarea' && !$(e.target).hasClass("trumbowyg-editor")){

				var ev=findCb(AP.hotkey.events, e.which);
				if (ev){
					if (ev.delay){
						setTimeout(function(){
							ev(e);
						}, 250);	
					}else{
						ev(e);
					}
				}
			}
		});
		
		return this;
	};
	
	function findCb(evs, keycode){
		if (keycode==AP.key.right && evs["right"]){
			return evs["right"];
		}
		
		if (keycode==AP.key.left && evs["left"]){
			return evs["left"];
		}
		
		if (keycode==AP.key.down && evs["down"]){
			return evs["down"];
		}
		
		if (keycode==AP.key.up && evs["up"]){
			return evs["up"];
		}
		
		if (keycode==AP.key.enter && evs["enter"]){
			return evs["enter"];
		}
		
		var c=String.fromCharCode(keycode);
		if (c.match(/^[a-z0-9]+$/i)){
			if (evs[c.toLowerCase()]){
				evs[c.toLowerCase()].delay=1;
				return evs[c.toLowerCase()];
			}
		}
		
		return null;
	};
	
	
	function refocus(elems, pace, options){
		var $elems=$(elems);
		var $elem=$elems.filter(".active");
		var $c=null;
		
		if (!$elem.length){
			$elems.first().addClass("active");
			$c=$elems.first();
		}else{
			if (pace>0 && $elem.next().length){
				$elems.removeClass("active");
				$elem.next().addClass("active");
				$c=$elem.next();
			}else if (pace<0 && $elem.prev().length){
				$elems.removeClass("active");
				$elem.prev().addClass("active");
				$c=$elem.prev();
			}
		}
		
		if ($c && $c.length){
			var $box=$c.closest(".__apscrollbar_target");
			if (!$box.length){
				return;
			}
			var offset=$c.offset().top-$box.offset().top;
			// $.log([$c.offset().top, $box.offset().top, $box.scrollTop()]);
			// Layout.scrollTo($c, 150, 150);
		}
	};
};


function APCaret(ref){
	this.init=function(){
		
	};
};




function CaretHandler(selector){
	this.selector=selector;
	
	this.get=function(){
		if (!$(this.selector).length){
			return;
		}
		
		return plugin_get_caret_position(this.selector);
	};
	
	this.getChar = function(){
		var pos = this.get();
		var val=""+$(this.selector).val();
		if (pos<=0 || pos > val.length){
			return "";
		}
		
		return val.charAt(pos-1);
	};
	
	this.move=function(position){
		$(this.selector).setCursorPosition(position);
	};
	
	this.insert=function(str){
		if (!$(this.selector).length){
			return;
		}
		
		return plugin_textarea_insert(this.selector, str);
	};
	
	this.start=this.get();
};


AP.url=function(url){
	return new APURL(url);
};


function APURL(url){
	this.url=url;
	this.data={};
	
	this.q=function(key, val){
		if (val && val.length){
			this.data[key]=val;	
		}
		return this;
	};
	
	this.text=function(){
		var qs="";
		var total=0;
		for (var key in this.data){
			total++;
		}
		
		var cur=0;
		for (var key in this.data){
			cur++;
			if (cur<total){
				qs+=key+"="+this.data[key]+"&";	
			}else{
				qs+=key+"="+this.data[key];
			}
			
		}
		
		return this.url+"?"+qs;
	};
	
	
	this.current=function(){
		return window.location.href;
	};
	
	this.self=function(){
		return this.current;
	};
};


AP.currency=new function __APCurrency(){
	this.cur="vnd";
	
	/**
	 * @desc Init & set currency
	 */
	this.init=function(cur){
		this.cur=cur;
	};
	
	
	/**
	 * @desc Format a number by currency
	 */
	this.format=function(number, cur){
		if (!cur){
			cur=this.cur;
		}
		
		if (cur=="vnd"){
			return this.formatVND(number);
		}
	};
	
	
	this.full=function(number, cur){
		if (!cur){
			cur=this.cur;
		}
		
		if (cur=="vnd"){
			if (!number || number<0.001){
				return '&#8363;<em>0.00</em>';
			}
			
			return '&#8363;<em>'+AP.data.numberFormat(parseInt(number))+"</em>";
		}
	};
	
	
	/**
	 * @desc Alias of format()
	 */
	this.get=function(number, cur){
		return this.format(number, cur);
	};
	
	
	
	this.formatVND=function(number){
		if (AP.data.isNumber(number) && !AP.data.isInt(number)){
			number = parseInt(number);
		}
		
		if (!AP.data.isInt(number)){
			return "&#8363;0";
		}
		
		var n=parseInt(number);
		var txt=AP.data.numberFormat(n);
		
		if (n>=1000000*1000){
			txt="<b>"+(n/1000000000).toFixed(2)+"</b>B";
		}else if (n>=1000000){
			txt="<b>"+(n/1000000).toFixed(2)+"</b>M";
		}else if (n>=100000){
			txt="<b>"+(n/1000).toFixed(2)+"</b>K";
		}
		
		return "&#8363;"+txt;
	};
	
};


// Internal search and index engine to give O(n) operations on search
var SE=new function __SE(){
	this.data={};
	this.pdata={};
	
	this.reset=function(){
		this.data={};
	};
	
	
	this.get=function(key, id){
		if (this.pdata["__"+key] && this.pdata["__"+key]["k"+id]){
			return this.pdata["__"+key]["k"+id];
		}
		
		if (this.data["__"+key] && this.data["__"+key]["k"+id]){
			return this.data["__"+key]["k"+id];
		}
		
		return null;
	};
	
	
	/**
	 * @desc Init cache for O(1) finders
	 */
	this.cache=function(key, arr, index){
		if (!index){
			index='id';
		}
		
		this.data["__"+key]={};
		for (var i=0; i<arr.length; i++){
			this.data["__"+key]["k"+arr[i][index]]=arr[i];
		}
	};
	
	
	/**
	 * @desc Init persistent cache, not clean up after page transition
	 */
	this.pcache=function(key, arr, index){
		if (!index){
			index='id';
		}
		
		this.pdata["__"+key]={};
		for (var i=0; i<arr.length; i++){
			this.pdata["__"+key]["k"+arr[i][index]]=arr[i];
		}
	};
	
	
	this.cached=function(key){
		if (this.data["__"+key] || this.pdata["__"+key]){
			return true;
		}
		
		return false;
	};
	
	
	/**
	 * @desc API V2
	 */
	this.index=function(opts){
		opts=$.extend({
			key: "id",
			forced_rebuild: false,
			dataset: []
		}, opts);
		
		if (!opts.forced_rebuild && this.data["__"+opts.name]){
			return;
		}
		
		this.cache(opts.name, opts.dataset, opts.key);
	};
	
	
	this.find = function(name, value){
		return this.get(name, value);
	};
};


AP.gb = new function __APGB(){
	var __callbacks=[];
	
	this.clear = function(){
		while (true){
			if (!__callbacks || !__callbacks.length){
				break;
			}
			
			var fn = __callbacks.shift();
			if (fn && AP.data.isFunction(fn)){
				fn();
			}
		}
	};
	
	
	this.register = function(fn){
		__callbacks.push(fn);
	};
	
	
};


var Rewrite = new function __Rewrite(){
	
	this.general = function(pattern, callback){
		var actions=[];
		
		var str=pattern.replace(/\{([a-z]+)\}/g, function(ms, m){
			actions.push(m);
			
			if (m=="id" || m=="int"){
				return '([0-9]+)'
			}
			
			return '([a-zA-Z0-9\\.\\-]+)';
		});
		
		var actions_url = AP.render(actions, function(e, index){
			if (index==0){
				return ""+(e)+"=$"+(index+1)+"";
			}
			
			return "&"+(e)+"=$"+(index+1)+"";
		});
		
		actions_url="action?"+actions_url;
		
		AP.rewrite(str, actions_url, function(qs){
			callback.apply(this, [qs]);
		}, true);
	};
	
	
	this.v2 = this.general;
	this.add = this.general;
	this.on = this.general;
	
	
	this.module = function(module, handlers){
		var hx=getTrueHandlers(handlers, module);
		var path = getPath(module);
		
		AP.rewrite(":"+(path)+"/-/([a-zA-Z0-9\.]+)", 'action?action=$1', function(qs){
			if (AP.data.isFunction(hx)){
				hx.apply(this, [qs.action]);	
			}
			
			if (hx[qs.action]){
				hx[qs.action].apply(this);
			}
			
		});
		
	};
	
	
	this.obj=function(module, handlers){
		var path = getPath(module);
		var hx=getTrueHandlers(handlers, module);
		var pattern = ":"+(path)+"/([0-9]+)/([a-zA-Z0-9\.]+)";
		
		AP.rewrite(pattern, 'action?id=$1&action=$2', function(qs){
			var obj = module.fromContext(qs.id);
			
			if (AP.data.isFunction(hx)){
				hx.apply(this, [obj, qs.action, qs]);
				return;
			}
			
			if (hx[qs.action]){
				hx[qs.action].apply(this, [obj, qs]);
				return;
			}
			
			var nx = normalizedName(qs.action);
			
			if (hx[nx]){
				hx[nx].apply(this, [obj, qs]);
				return;
			}
		}, true);
	};
	
	this.unset = function(pattern){
		var rules = [];
		var r = new RegExp(pattern);
		for (var i=0; i<AP.rules.length; i++){
			var p=AP.rules[i].pattern;
			if (r.test(p) || p.indexOf(pattern)!=-1){
			}else{
				rules.push(AP.rules[i]);
			}
		};
		
		AP.rules = rules;
	};
	
	function getTrueHandlers(handlers, module){
		if (!AP.data.isArray(handlers)){
			return handlers;
		}
		
		var hx={};
		for (var i=0; i<handlers.length; i++){
			var name = normalizedName(handlers[i]);
			if (name == "show"){
				hx[name]= module[name];
			}else{
				hx[name]= module.form[name];	
			}
			
		}
		
		return hx;
	};
	
	
	function getPath(module){
		var parts  = module.constructor.name.replace(/_/g,'').match(/[A-Z][a-z]+/g);
		var path = parts.join("/").toLowerCase();
		return path;
	};
	
	
	function normalizedName(action){
		return action.replace(/\.(\w)/, function(txt, match){
			return match.toUpperCase();
		});
	};
	
};



!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Redux={})}(this,function(e){"use strict";var t=function(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()),r=function(){return Math.random().toString(36).substring(7).split("").join(".")},n={INIT:"@@redux/INIT"+r(),REPLACE:"@@redux/REPLACE"+r(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+r()}};function o(e,t){var r=t&&t.type;return"Given "+(r&&'action "'+r+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function i(e,t){return function(){return t(e.apply(this,arguments))}}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}e.createStore=function e(r,o,i){var u;if("function"==typeof o&&"function"==typeof i||"function"==typeof i&&"function"==typeof arguments[3])throw Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function");if("function"==typeof o&&void 0===i&&(i=o,o=void 0),void 0!==i){if("function"!=typeof i)throw Error("Expected the enhancer to be a function.");return i(e)(r,o)}if("function"!=typeof r)throw Error("Expected the reducer to be a function.");var a=r,c=o,f=[],s=f,d=!1;function l(){s===f&&(s=f.slice())}function p(){if(d)throw Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return c}function h(e){if("function"!=typeof e)throw Error("Expected the listener to be a function.");if(d)throw Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return l(),s.push(e),function(){if(t){if(d)throw Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,l();var r=s.indexOf(e);s.splice(r,1)}}}function y(e){if(!function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e))throw Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(d)throw Error("Reducers may not dispatch actions.");try{d=!0,c=a(c,e)}finally{d=!1}for(var t=f=s,r=0;t.length>r;r++)(0,t[r])();return e}return y({type:n.INIT}),(u={dispatch:y,subscribe:h,getState:p,replaceReducer:function(e){if("function"!=typeof e)throw Error("Expected the nextReducer to be a function.");a=e,y({type:n.REPLACE})}})[t]=function(){var e,r=h;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function t(){e.next&&e.next(p())}return t(),{unsubscribe:r(t)}}})[t]=function(){return this},e},u},e.combineReducers=function(e){for(var t=Object.keys(e),r={},i=0;t.length>i;i++){var u=t[i];"function"==typeof e[u]&&(r[u]=e[u])}var a,c=Object.keys(r);try{!function(e){Object.keys(e).forEach(function(t){var r=e[t];if(void 0===r(void 0,{type:n.INIT}))throw Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===r(void 0,{type:n.PROBE_UNKNOWN_ACTION()}))throw Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+n.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')})}(r)}catch(e){a=e}return function(e,t){if(void 0===e&&(e={}),a)throw a;for(var n=!1,i={},u=0;c.length>u;u++){var f=c[u],s=e[f],d=(0,r[f])(s,t);if(void 0===d){var l=o(f,t);throw Error(l)}i[f]=d,n=n||d!==s}return n?i:e}},e.bindActionCreators=function(e,t){if("function"==typeof e)return i(e,t);if("object"!=typeof e||null===e)throw Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var r=Object.keys(e),n={},o=0;r.length>o;o++){var u=r[o],a=e[u];"function"==typeof a&&(n[u]=i(a,t))}return n},e.applyMiddleware=function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),n=function(){throw Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},o={getState:r.getState,dispatch:function(){return n.apply(void 0,arguments)}},i=t.map(function(e){return e(o)});return function(e){for(var t=1;arguments.length>t;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){u(e,t,r[t])})}return e}({},r,{dispatch:n=a.apply(void 0,i)(r.dispatch)})}}},e.compose=a,e.__DO_NOT_USE__ActionTypes=n,Object.defineProperty(e,"__esModule",{value:!0})});


(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory(global):typeof define==="function"&&define.amd?define(factory):factory(global)})(typeof self!=="undefined"?self:typeof window!=="undefined"?window:typeof global!=="undefined"?global:this,function(global){"use strict";var _Base64=global.Base64;var version="2.5.0";var buffer;if(typeof module!=="undefined"&&module.exports){try{buffer=eval("require('buffer').Buffer")}catch(err){buffer=undefined}}var b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var b64tab=function(bin){var t={};for(var i=0,l=bin.length;i<l;i++)t[bin.charAt(i)]=i;return t}(b64chars);var fromCharCode=String.fromCharCode;var cb_utob=function(c){if(c.length<2){var cc=c.charCodeAt(0);return cc<128?c:cc<2048?fromCharCode(192|cc>>>6)+fromCharCode(128|cc&63):fromCharCode(224|cc>>>12&15)+fromCharCode(128|cc>>>6&63)+fromCharCode(128|cc&63)}else{var cc=65536+(c.charCodeAt(0)-55296)*1024+(c.charCodeAt(1)-56320);return fromCharCode(240|cc>>>18&7)+fromCharCode(128|cc>>>12&63)+fromCharCode(128|cc>>>6&63)+fromCharCode(128|cc&63)}};var re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g;var utob=function(u){return u.replace(re_utob,cb_utob)};var cb_encode=function(ccc){var padlen=[0,2,1][ccc.length%3],ord=ccc.charCodeAt(0)<<16|(ccc.length>1?ccc.charCodeAt(1):0)<<8|(ccc.length>2?ccc.charCodeAt(2):0),chars=[b64chars.charAt(ord>>>18),b64chars.charAt(ord>>>12&63),padlen>=2?"=":b64chars.charAt(ord>>>6&63),padlen>=1?"=":b64chars.charAt(ord&63)];return chars.join("")};var btoa=global.btoa?function(b){return global.btoa(b)}:function(b){return b.replace(/[\s\S]{1,3}/g,cb_encode)};var _encode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(u){return(u.constructor===buffer.constructor?u:buffer.from(u)).toString("base64")}:function(u){return(u.constructor===buffer.constructor?u:new buffer(u)).toString("base64")}:function(u){return btoa(utob(u))};var encode=function(u,urisafe){return!urisafe?_encode(String(u)):_encode(String(u)).replace(/[+\/]/g,function(m0){return m0=="+"?"-":"_"}).replace(/=/g,"")};var encodeURI=function(u){return encode(u,true)};var re_btou=new RegExp(["[Ã-Ã][Â-Â¿]","[Ã -Ã¯][Â-Â¿]{2}","[Ã°-Ã·][Â-Â¿]{3}"].join("|"),"g");var cb_btou=function(cccc){switch(cccc.length){case 4:var cp=(7&cccc.charCodeAt(0))<<18|(63&cccc.charCodeAt(1))<<12|(63&cccc.charCodeAt(2))<<6|63&cccc.charCodeAt(3),offset=cp-65536;return fromCharCode((offset>>>10)+55296)+fromCharCode((offset&1023)+56320);case 3:return fromCharCode((15&cccc.charCodeAt(0))<<12|(63&cccc.charCodeAt(1))<<6|63&cccc.charCodeAt(2));default:return fromCharCode((31&cccc.charCodeAt(0))<<6|63&cccc.charCodeAt(1))}};var btou=function(b){return b.replace(re_btou,cb_btou)};var cb_decode=function(cccc){var len=cccc.length,padlen=len%4,n=(len>0?b64tab[cccc.charAt(0)]<<18:0)|(len>1?b64tab[cccc.charAt(1)]<<12:0)|(len>2?b64tab[cccc.charAt(2)]<<6:0)|(len>3?b64tab[cccc.charAt(3)]:0),chars=[fromCharCode(n>>>16),fromCharCode(n>>>8&255),fromCharCode(n&255)];chars.length-=[0,0,2,1][padlen];return chars.join("")};var _atob=global.atob?function(a){return global.atob(a)}:function(a){return a.replace(/\S{1,4}/g,cb_decode)};var atob=function(a){return _atob(String(a).replace(/[^A-Za-z0-9\+\/]/g,""))};var _decode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(a){return(a.constructor===buffer.constructor?a:buffer.from(a,"base64")).toString()}:function(a){return(a.constructor===buffer.constructor?a:new buffer(a,"base64")).toString()}:function(a){return btou(_atob(a))};var decode=function(a){return _decode(String(a).replace(/[-_]/g,function(m0){return m0=="-"?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};var noConflict=function(){var Base64=global.Base64;global.Base64=_Base64;return Base64};global.Base64={VERSION:version,atob:atob,btoa:btoa,fromBase64:decode,toBase64:encode,utob:utob,encode:encode,encodeURI:encodeURI,btou:btou,decode:decode,noConflict:noConflict,__buffer__:buffer};if(typeof Object.defineProperty==="function"){var noEnum=function(v){return{value:v,enumerable:false,writable:true,configurable:true}};global.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",noEnum(function(){return decode(this)}));Object.defineProperty(String.prototype,"toBase64",noEnum(function(urisafe){return encode(this,urisafe)}));Object.defineProperty(String.prototype,"toBase64URI",noEnum(function(){return encode(this,true)}))}}if(global["Meteor"]){Base64=global.Base64}if(typeof module!=="undefined"&&module.exports){module.exports.Base64=global.Base64}else if(typeof define==="function"&&define.amd){define([],function(){return global.Base64})}return{Base64:global.Base64}});

Base64.safeDecode = function(str){
	var r="";
	try{
		r = Base64.decode(str);
	}catch (e){
		return "[Base64 Invalid]";
	}
	
	return r;
};


function md5cycle(x, k) {
var a = x[0], b = x[1], c = x[2], d = x[3];

a = ff(a, b, c, d, k[0], 7, -680876936);
d = ff(d, a, b, c, k[1], 12, -389564586);
c = ff(c, d, a, b, k[2], 17,  606105819);
b = ff(b, c, d, a, k[3], 22, -1044525330);
a = ff(a, b, c, d, k[4], 7, -176418897);
d = ff(d, a, b, c, k[5], 12,  1200080426);
c = ff(c, d, a, b, k[6], 17, -1473231341);
b = ff(b, c, d, a, k[7], 22, -45705983);
a = ff(a, b, c, d, k[8], 7,  1770035416);
d = ff(d, a, b, c, k[9], 12, -1958414417);
c = ff(c, d, a, b, k[10], 17, -42063);
b = ff(b, c, d, a, k[11], 22, -1990404162);
a = ff(a, b, c, d, k[12], 7,  1804603682);
d = ff(d, a, b, c, k[13], 12, -40341101);
c = ff(c, d, a, b, k[14], 17, -1502002290);
b = ff(b, c, d, a, k[15], 22,  1236535329);

a = gg(a, b, c, d, k[1], 5, -165796510);
d = gg(d, a, b, c, k[6], 9, -1069501632);
c = gg(c, d, a, b, k[11], 14,  643717713);
b = gg(b, c, d, a, k[0], 20, -373897302);
a = gg(a, b, c, d, k[5], 5, -701558691);
d = gg(d, a, b, c, k[10], 9,  38016083);
c = gg(c, d, a, b, k[15], 14, -660478335);
b = gg(b, c, d, a, k[4], 20, -405537848);
a = gg(a, b, c, d, k[9], 5,  568446438);
d = gg(d, a, b, c, k[14], 9, -1019803690);
c = gg(c, d, a, b, k[3], 14, -187363961);
b = gg(b, c, d, a, k[8], 20,  1163531501);
a = gg(a, b, c, d, k[13], 5, -1444681467);
d = gg(d, a, b, c, k[2], 9, -51403784);
c = gg(c, d, a, b, k[7], 14,  1735328473);
b = gg(b, c, d, a, k[12], 20, -1926607734);

a = hh(a, b, c, d, k[5], 4, -378558);
d = hh(d, a, b, c, k[8], 11, -2022574463);
c = hh(c, d, a, b, k[11], 16,  1839030562);
b = hh(b, c, d, a, k[14], 23, -35309556);
a = hh(a, b, c, d, k[1], 4, -1530992060);
d = hh(d, a, b, c, k[4], 11,  1272893353);
c = hh(c, d, a, b, k[7], 16, -155497632);
b = hh(b, c, d, a, k[10], 23, -1094730640);
a = hh(a, b, c, d, k[13], 4,  681279174);
d = hh(d, a, b, c, k[0], 11, -358537222);
c = hh(c, d, a, b, k[3], 16, -722521979);
b = hh(b, c, d, a, k[6], 23,  76029189);
a = hh(a, b, c, d, k[9], 4, -640364487);
d = hh(d, a, b, c, k[12], 11, -421815835);
c = hh(c, d, a, b, k[15], 16,  530742520);
b = hh(b, c, d, a, k[2], 23, -995338651);

a = ii(a, b, c, d, k[0], 6, -198630844);
d = ii(d, a, b, c, k[7], 10,  1126891415);
c = ii(c, d, a, b, k[14], 15, -1416354905);
b = ii(b, c, d, a, k[5], 21, -57434055);
a = ii(a, b, c, d, k[12], 6,  1700485571);
d = ii(d, a, b, c, k[3], 10, -1894986606);
c = ii(c, d, a, b, k[10], 15, -1051523);
b = ii(b, c, d, a, k[1], 21, -2054922799);
a = ii(a, b, c, d, k[8], 6,  1873313359);
d = ii(d, a, b, c, k[15], 10, -30611744);
c = ii(c, d, a, b, k[6], 15, -1560198380);
b = ii(b, c, d, a, k[13], 21,  1309151649);
a = ii(a, b, c, d, k[4], 6, -145523070);
d = ii(d, a, b, c, k[11], 10, -1120210379);
c = ii(c, d, a, b, k[2], 15,  718787259);
b = ii(b, c, d, a, k[9], 21, -343485551);

x[0] = add32(a, x[0]);
x[1] = add32(b, x[1]);
x[2] = add32(c, x[2]);
x[3] = add32(d, x[3]);

}

function cmn(q, a, b, x, s, t) {
a = add32(add32(a, q), add32(x, t));
return add32((a << s) | (a >>> (32 - s)), b);
}

function ff(a, b, c, d, x, s, t) {
return cmn((b & c) | ((~b) & d), a, b, x, s, t);
}

function gg(a, b, c, d, x, s, t) {
return cmn((b & d) | (c & (~d)), a, b, x, s, t);
}

function hh(a, b, c, d, x, s, t) {
return cmn(b ^ c ^ d, a, b, x, s, t);
}

function ii(a, b, c, d, x, s, t) {
return cmn(c ^ (b | (~d)), a, b, x, s, t);
}

function md51(s) {
txt = '';
var n = s.length,
state = [1732584193, -271733879, -1732584194, 271733878], i;
for (i=64; i<=s.length; i+=64) {
md5cycle(state, md5blk(s.substring(i-64, i)));
}
s = s.substring(i-64);
var tail = [0,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,0];
for (i=0; i<s.length; i++)
tail[i>>2] |= s.charCodeAt(i) << ((i%4) << 3);
tail[i>>2] |= 0x80 << ((i%4) << 3);
if (i > 55) {
md5cycle(state, tail);
for (i=0; i<16; i++) tail[i] = 0;
}
tail[14] = n*8;
md5cycle(state, tail);
return state;
}


function md5blk(s) { /* I figured global was faster.   */
var md5blks = [], i; /* Andy King said do it this way. */
for (i=0; i<64; i+=4) {
md5blks[i>>2] = s.charCodeAt(i)
+ (s.charCodeAt(i+1) << 8)
+ (s.charCodeAt(i+2) << 16)
+ (s.charCodeAt(i+3) << 24);
}
return md5blks;
}

var hex_chr = '0123456789abcdef'.split('');

function rhex(n)
{
var s='', j=0;
for(; j<4; j++)
s += hex_chr[(n >> (j * 8 + 4)) & 0x0F]
+ hex_chr[(n >> (j * 8)) & 0x0F];
return s;
}

function hex(x) {
for (var i=0; i<x.length; i++)
x[i] = rhex(x[i]);
return x.join('');
}

function md5(s) {
return hex(md51(s));
}



function add32(a, b) {
return (a + b) & 0xFFFFFFFF;
}

if (md5('hello') != '5d41402abc4b2a76b9719d911017c592') {
function add32(x, y) {
var lsw = (x & 0xFFFF) + (y & 0xFFFF),
msw = (x >> 16) + (y >> 16) + (lsw >> 16);
return (msw << 16) | (lsw & 0xFFFF);
}
}

 

AP.data=new function _APData(){
	this.isArray=function(data){
		return $.isArray(data);
	};
	this.isAssocArray=function(data){
		return typeof(data)=='object' && isNaN(data);	
	};
	this.isObject=function(data){
		return typeof(data)=='object' && isNaN(data);
	};
	this.isFunction=function(data){
		return $.isFunction(data);
	};
	this.isInt=function(data){
		return !isNaN(data)&&parseInt(data)==data;	
	};
	this.isNumber=function(data){
		return !isNaN(data)&& !isNaN(parseFloat(data));	
	};
	this.isString=function(data){
		return typeof(data)=='string' && isNaN(data);
	};
	this.isEmpty=function(data){
		if (!data || data.length <=0){
			return true;
		}
		return false;
	};
	
	this.int=function(val){
		return parseInt(val);
	};
	
	/**
	 * Get a random integer from min to max-1
	 * @param min
	 * @param max
	 * @returns int
	 */
	this.randomInteger=function(min, max){
		return Math.floor(Math.random() * (max - min)) + min;
	};
	
	this.randomNumber=this.randomInteger;
	
	
	this.numberFormat=function(ival){
		var parts=ival.toString().split(".");
		return parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",") + (parts[1] ? "." + parts[1].substr(0,2) : "");
	};
	
	
	this.currencyFormat=function(v){
		var c=Client.pageData.currency;
		if (!c || !c.length){
			c="VND";
		}
		if (c=="VND"){
			return AP.data.numberFormat(v)+" <sup>Ä</sup>";	
		}else if (c=="GBP PENNY"){
			return "<b>&pound;"+this.globalMoneyFormat(v/100,2,".",",")+"</b>";	
		}else if (c=="USD CENT"){
			return "<b>$"+this.globalMoneyFormat(v/100,2,".",",")+"</b>";	
		}else{
			alert("Unsupported currency");
		}
		
	};
	
	
	
	this.globalMoneyFormat=function(n, c, d, t){
		var  c = isNaN(c = Math.abs(c)) ? 2 : c, 
		d = d == undefined ? "." : d, 
		t = t == undefined ? "," : t, 
		s = n < 0 ? "-" : "", 
		i = parseInt(n = Math.abs(+n || 0).toFixed(c)) + "", 
		j = (j = i.length) > 3 ? j % 3 : 0;
	   return s + (j ? i.substr(0, j) + t : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t) + (c ? d + Math.abs(n - i).toFixed(c).slice(2) : "");
	 };
	
	
	
	this.realFormat=function(val){
		return Math.round(parseFloat(val)*10000)/10000;
	};
	
	
	this.zeroIndex=function(ival){
		ival=parseInt(ival);
		if (ival === 0){
			return "0";
		}
		
		if (ival<10){
			ival="0"+ival;
		}
		return ival;
	}
	
	this.zeroPrefix=function(ival){
		return this.zeroIndex(ival);
	}
	
	/**
	 * @desc Compare two string/number x,y.
	 * @return True/false
	 */
	this.equal=function(x, y){
		if (AP.data.isInt(x)){
			x=x.toString();
		}
		if (AP.data.isInt(y)){
			y=y.toString();
		}
		
		if (AP.data.isAssocArray(x) && AP.data.isAssocArray(y)){
			return (JSON.stringify(x)==JSON.stringify(y));
		}
		
		if (AP.data.isArray(x) && AP.data.isArray(y)){
			if (x.length!=y.length){
				return false;
			}
			for (var i=0; i<x.length; i++){
				if (!AP.data.equal(x[i], y[i])){
					return false;
				}
			}
			return true;
		}
		
		return (x==y);
	};
	
	
	
	this.assoc=function(){
		return new APAssoc();
	};
};



function APAssoc(){
	this.data={};
	this.add=function(key, value){
		this.data[key]=value;
		return this;
	};
	
	this.assoc=function(){
		return this.data;
	};
};

function safeEquals(x, y){
	return AP.data.equal(x, y);
};


var se = safeEquals;


	/**
	 * @desc Array manipulation and verification
	 */

	AP.array={
			
		fromObject: function(obj){
			var r=[];
			for (var key in obj){
				r[key]=obj[key];
			}
			
			return r;
		},
	
		/**
		 * @desc Check if element is an element of arr.
		 */
		within: function(element, arr, compare_fn){
			if (!arr || arr.length==0) return false;
			for (var i=0; i<arr.length; i++){
				if (compare_fn && typeof compare_fn!="undefined"){
					if (compare_fn(arr[i], element)){
						return true;
					}
				}else{
					if (arr[i]==element) return true;
					if (AP.data.isInt(arr[i]) && AP.data.isInt(element)){
						if (parseInt(arr[i]) === parseInt(element)){
							return true;
						}
					}
				}
				
			}
			return false;
		},
		
		/**
		 * @desc Check if the array contains the element
		 */
		contain: function(arr, element, compare_fn){
			return AP.array.within(element, arr, compare_fn);
		},
		
		/**
		 * @desc exclude an array from the original array
		 * @param {arr} arr describe The original array 
		 * @param {excluded} array describe the list of array to be excluded 
		 * @return array
		 */
		exclude: function(arr, excluded, compare_fn){
			var r = [];
			for (var i = 0; i < arr.length; i++){
				if (AP.array.contain(excluded, arr[i], compare_fn)){
				} else{
					r.push(arr[i]);
				}
			}

			return r;
		},
		
		count: function(arr, fn){
			var t=0;
			for (var i=0; i<arr.length; i++){
				var r=arr[i];
				if (fn){
					r=fn(arr[i]);	
				}else{
					if (AP.data.isInt(r)){
						r=parseInt(r);
					}else if (AP.data.isNumber(r)){
						r=parseFloat(r);
					}
				}
				
				if (r===true){
					r=1;
				}else if (r===false){
					r=0;
				}
				
				t+=r;
			}
			
			return t;
		},
		
		sum: function(arr, fn){
			var t=0;
			if (!arr || !arr.length){
				return 0;
			}
			for (var i=0; i<arr.length; i++){
				if (!fn){
					if (AP.data.isInt(arr[i])){
						t+=parseInt(arr[i]);	
					}else{
						t+=parseFloat(arr[i]);
					}
				}else{
					t+=fn(arr[i]);	
				}
			}
			
			return t;
		},
		
		avg: function(arr, fn){			
			var count = arr.length;
			if (!count){
				return 0;
			}
			
			var total = this.count(arr, fn);
			return total/count;
		},
		
		/**
		 * @desc Making a subarray, from start. If length is too big, or null, it
		 * return the subarray of maximum length.
		 */
		sub: function(arr, start, length){
			if (!length || start+length>arr.length){
				length=arr.length-start;
			}
			var b=[];
			for (var i=start; i<start+length; i++){
				b.push(arr[i]);
			}
			return b;
		},
		
		unique: function(arr, compare_fn){
			if (!compare_fn){
				compare_fn=function(e, f){
					return (parseInt(e)==parseInt(f));
				};
			}
			var r=[];
			for (var i=0; i<arr.length; i++){
				if (AP.array.contain(r, arr[i], function(e1, e2){
					return compare_fn(e1, e2);
				})){}else{
					r.push(arr[i]);
				}
			}
			
			return r;
		},
		
		uniqueObjects: function(arr, compare_fn){
			return AP.array.unique(arr, function(e1, e2){
				return e1.id==e2.id || (AP.data.isInt(e1.id) && AP.data.isInt(e2.id) && parseInt(e1.id) == parseInt(e2.id));
			});
		},
		
		extract: function(arr, key){
			return ARR.select(arr, function(e){
				if (key in e){
					return e[key];
				}
				
				return null;
			});
		},
		
		find: function(arr, id){
			if (!arr || !arr.length){
				return false;
			}
			
			if (typeof id =="function"){
				for (var i=0; i<arr.length; i++){
					if (id(arr[i])){
						return arr[i];
					}
				}
				
				return null;
			}
			
			
			for (var i=0; i<arr.length; i++){
				if (arr[i]==id){
					return arr[i];
				}
			}
			return null;
		},
		
		single: function(arr, filter){
			return this.find(arr, filter); 
		},
		
		exist: function(arr, elem){
			if ($.isFunction(elem)){
				var obj=this.find(arr, elem);
				if (obj){
					return true;
				}
				return false;
			}else{
				var obj= AP.array.find(arr, function(e){
					return e==elem;
				});
				
				if (!obj){
					return false;
				}
				
				return true;
			}
		},
		
		indexOf: function(arr, elem, cmp){
			for (var i=0; i<arr.length; i++){
				if (cmp(arr[i], elem)){
					return i;
				}
			}
			
			return -1;
		},
		
		
		findObj: function(arr, id){
			if (!arr){
				return null;
			}
			
			for (var i=0; i<arr.length; i++){
				if (parseInt(arr[i].id)==parseInt(id)){
					return arr[i];
				}
				
				if (arr[i].id===id){
					return arr[i];
				}
			}
			return null;
		},
		
		
		findObjWithStringID: function(arr, id){
			if (!arr){
				return null;
			}
			
			for (var i=0; i<arr.length; i++){
				if (String(arr[i].id) === String(id)){
					return arr[i];
				}
			}
			return null;
		},
		
		updateObjects:function(arr, obj){
			for (var i=0; i<arr.length; i++){
				if (!AP.data.isInt(arr[i]) && !AP.data.isInt(obj.id)){
					if (arr[i].id == obj.id){
						arr[i]=obj;
						return arr;
					}
				}else{
					if (parseInt(arr[i].id)==parseInt(obj.id)){
						arr[i]=obj;
						return arr;
					}	
				}
				
			}
			
			arr.push(obj);
			
			return arr;
		},
		
		updateByID: function(arr, obj){
			return this.updateObjects(arr, obj);
		},
		
		updateFieldsByID: function(arr, obj, transform){
			for (var i=0; i<arr.length; i++){
				if (idEquals(arr[i].id, obj.id)){
					transform(arr[i], obj);
				}
			}
		},
		
		insertByID: function(arr, obj){
			return this.updateObjects(arr, obj);
		},
		
		replaceObject: function(arr, obj){
			for (var i=0; i<arr.length; i++){
				if (parseInt(arr[i].id)==parseInt(obj.id)){
					arr[i]=obj;
					return true;
				}
			}
			
			arr.push(obj);
			
			return false;
		},
		
		
		
		/**
		 * @desc Check if prefix is a subarray of arr, starting from beginning
		 */
		prefix: function(arr, prefix){
			if (prefix.length>arr.length){
				return false;
			}
			for (var i=0; i<prefix.length; i++){
				if (!AP.data.equal(prefix[i], arr[i])){
					return false;
				}
			}
			return true;
		},
		
		
		/**
		 * @desc Check if prefix is a subarray of arr, starting from beginning
		 */
		equal: function(arr1, arr2){
			if (arr1.length!=arr2.length){
				return false;
			}
			for (var i=0; i<arr1.length; i++){
				if (!AP.data.equal(arr1[i], arr2[i])){
					return false;
				}
			}
			return true;
		},
		
		ids: function(arr){
			return this.select(arr, function(e){
				return e.id;
			});
		},
		
		cut: function(arr, max){
			if (arr.length<max){
				return arr;
			}
			
			return arr.slice(0, max);
		},
		
		each: function(arr, cb){
			for (var i=0; i<arr.length; i++){
				cb(arr[i], i, arr.length);
			}
		},
		
		
		usort: function(arr, sorter){
			for (var i=0; i<arr.length-1; i++){
				for (var j=i+1; j<arr.length; j++){
					if (sorter(arr[i], arr[j])>0){
						var x=arr[i];
						arr[i]=arr[j];
						arr[j]=x;
					}
				}
			}
			return arr;
		},
		
		sortObj: function(arr, field, multiplier){
			if (!multiplier){
				multiplier=1;
			}
			
			return this.usort(arr, function(e1, e2){
				return multiplier*(parseInt(e1[field]) - parseInt(e2[field]));
			}) 
		},
		
		/**
		 * @desc Sort array by the value of sorter(fn) 
		 */
		sort: function(arr, sorter){
			for (var i=0; i<arr.length; i++){
				arr[i].__fs=sorter(arr[i], i);
			}
			
			return this.usort(arr, function(e, f){
				return e.__fs - f.__fs;
			})
		},
		
		sortOnRefIDs: function(arr, ref_ids, append_missing_refs){
			var r=[];
			
			var refs={};
			for (var i=0; i<arr.length; i++){
				var a = arr[i];
				refs["e"+a.id]=a;
			}
			
			var missing=[];
			
			for (var i=0; i<ref_ids.length; i++){
				if ("e"+ref_ids[i] in refs){
					r.push(refs["e"+ref_ids[i]]);
				}else{
					missing.push(refs["e"+ref_ids[i]]);
				}
			}
			
			if (append_missing_refs){
				for (var i=0; i< missing.length; i++){
					var m = missing[i];
					r.push(m);
				}
			}
			
			return r;
		},
		
		reorder: function(arr, order){
			if (!order){
				order=1;
			}
			arr.sort(function(e1, e2){
				return (parseInt(e2.order)-parseInt(e1.order))*order;
			})
		},
		
		realOrder: function(arr, order){
			if (!order){
				order=1;
			}
			arr.sort(function(e1, e2){
				return (parseInt(e2.real_order)-parseInt(e1.real_order))*order;
			});
			
			return arr;
		},
		
		
		move: function(arr, elem, dir){
			for (var i=0; i<arr.length; i++){
				if (arr[i].id==elem.id){
					if (dir=="up" && i>0){
						var temp=arr[i-1];
						arr[i-1]=arr[i];
						arr[i]=temp;
					}else if (dir=="down" && i< arr.length-1){
						var temp=arr[i+1];
						arr[i+1]=arr[i];
						arr[i]=temp;
					}
						
					return;
				}
			}
		},
		
		
		
		/**
		 * @desc Unserialized a serialized string to an array.
		 */
		unserialize: function(str){
			var r={};
			var parts=str.split('&');
			for (var i=0; i<parts.length; i++){
				var x=parts[i].split("=");
				if (x.length==2){
					r[x[0]]=x[1];
				}
			}
			return r;
		},
		
		
		/**
		 * @desc Insert a value to the end of the array if the value DOES NOT existed
		 */
		insert: function(arr, value, cmp_fn){
			if (ARR.contain(arr, value, cmp_fn)){
				return arr;
			}
			
			var na = arr.slice();
			na.push(value);
			
			return na;
		},
		
		
		/**
		 * @desc Remove an element from an array
		 */
		remove: function(arr, elem, cmp_fn){
			var na=[];
			for (var i=0; i<arr.length; i++){
				if (AP.isFunction(elem)){
					if (elem(arr[i])){
					}else{
						na.push(arr[i]);
					}
				}else{
					if (cmp_fn){
						if (!cmp_fn(arr[i],elem)){
							na.push(arr[i]);
						}
					}else{
						if (!AP.data.equal(arr[i],elem)){
							na.push(arr[i]);
						}	
					}	
				}
			}
			return na;
		},
		
		removeByID: function(arr, id){
			return this.filter(arr, function(e){
				if (!AP.data.isInt(e.id) && !AP.data.isInt(id)){
					if (e.id === id){
						return false;
					}
					
					return true;
				}
				
				
				if (parseInt(e.id)==parseInt(id)){
					return false;
				}
				
				return true;
			});
		},
		
		filter: function(arr, filter){
			var na=[];
			for (var i=0; i<arr.length; i++){
				if (filter(arr[i], i, arr.length)){
					na.push(arr[i]);
				}
			}
			return na;
		},
		
		select: function(arr, fn){
			var na=[];
			if (!arr || !arr.length){
				return na;
			}
			
			for (var i=0; i<arr.length; i++){
				var e=fn(arr[i], i, arr.length);
				if (e!==null){
					na.push(e);
				}
			}
			return na;
		},
		
		selectObj: function(obj, fn){
			var na=[];
			var i=0;
			for (var key in obj){
				var e=fn(obj[key], i, key);
				if (e!==null){
					i++;
					na.push(e);
				}
			}
			return na;
		},
		
		loop: function(arr, fn){
			for (var i=0; i<arr.length; i++){
				fn(arr[i], i, arr.length);
			}
		},
		
		max: function(arr, fn){
			var _m=null;
			var _c=-1;
			
			for (var i=0; i<arr.length; i++){
				var val = fn(arr[i]);
				if (_m == null || val>_m){
					_m=val;
					_c=i;
				}
			}
			
			if (_c==-1){
				return null;
			}
			
			return arr[_c];
		},
		
		selectMax: function(arr, num_elems, fn){
			var temp=[];
			for (var i=0; i<arr.length; i++){
				temp.push({value: fn(arr[i]), index: i});
			}
			
			temp.sort(function(e, f){
				if (f.value==null){
					return -1;
				}
				
				if (e.value==null){
					return 1;
				}
				
				return f.value-e.value;
			});
			
			temp=this.cut(temp, num_elems);
			
			var r=[];
			for (var i=0; i<temp.length; i++){
				if (temp[i].value!==null){
					r.push(arr[temp[i].index]);	
				}
			}
			
			return r;
		},
		
		
		update: function(arr, fn){
			for (var i=0; i<arr.length; i++){
				fn(arr[i])
			}
		},
		
		join: function(array, joiner, fn){
			return AP.render(array, function(e){
				if (fn){
					return fn(e)+joiner;	
				}
				return fn(e)+joiner;
			});
		},
		
		clone: function(arr){
			return arr.slice(0);
		},
		
		deepClone: function(arr){
			return ARR.select(arr, function(e){
				return shallowClone(e);
			})
		},
		
		filterQuery: function(array, keys){
			var a=array.slice(0);

			for (var i=0; i<keys.length; i++){
				var k=keys[i];
				if (Query.get(k)){
					var val=Query.get(k);
					a=AP.array.filter(a, function(e){
						return e[k]==val || e[k+"_id"]==val;
					});
				}
			}
			
			return a;
		},
		
		
		group: function(array, group_maker, group_sorter){
			var gs={};
			for (var i=0; i<array.length; i++){
				var g;
				if (AP.data.isString(group_maker)){
					g={id: array[i][group_maker]};
				}else{
					g=group_maker(array[i]);	
				}
				
				
				if (!g){
					continue;
				}
				
				if (!gs["g"+g.id]){
					gs["g"+g.id]=shallowClone(g);
					gs["g"+g.id].items=[array[i]];
				}else{
					gs["g"+g.id].items.push(array[i]);
				}
			}
			
			var r=[];
			for (var key in gs){
				r.push(gs[key]);
			}
			
			if (group_sorter){
				for (var i=0; i<r.length; i++){
					r[i].__sorter=group_sorter(r[i]);
				}
				
				return AP.array.sortObj(r, "__sorter", -1);
			}
			
			
			return r;
		},
		
		buckets: function(arr, buckets, key){
			if (!arr){
				return [];
			}
			
			for (var i=0; i<buckets.length; i++){
				buckets[i].items = ARR.filter(arr, function(e){
					if (AP.data.isFunction(key)){
						return key(e, buckets[i]);
					}else{
						return parseInt(e[key])==parseInt(buckets[i].id);	
					}
				});
			}
		},
		
		ranking: function(arr, fn){
			for (var i=0; i<arr.length; i++){
				var count = 0;
				
				for (var j=0; j<arr.length; j++){
					if (j!=i && fn(arr[j]) > fn(arr[i])){
						count++;
					}
				}
				
				arr[i]._ranking = count+1;
			}
		},
		
		merge: function(){
			var r=[];
			for (var i=0; i<arguments.length; i++){
				if (AP.data.isObject(arguments[i]) && !AP.data.isArray(arguments[i])){
					r.push(arguments[i]);
				}else{
					for (var j=0; j<arguments[i].length; j++){
						r.push(arguments[i][j]);	
					}
				}
			}
			
			return r;
		},
		
		
		randomElems: function(arr, limit){
			var r=[];
			
			for (var i=0; i<limit; i++){
				var val= AP.data.randomNumber(0, arr.length-1);
				if (this.contain(r, val)){
					continue;
				}else{
					r.push(val);
				}
			}
			
			return ARR.select(r, function(e){
				return arr[e];
			});
		},
		
		pcmp: function(){
			for (var i=0; i<arguments.length; i++){
				var x = parseInt(parseFloat(arguments[i][0])*1000);
				var y = parseInt(parseFloat(arguments[i][1])*1000);
				
				if (x>y){
					return 1;
				}
				
				if (x<y){
					return -1;
				}
			}
			
			return 0;
		}
	};

	
	var ARR = AP.array;
 


AP.sys={
	initAjax: function(){
		jQuery.ajaxSetup({async:false});
	},
			
	back: function(){
		return history.back();
	},	
	ie: function(){
		return $.browser.msie;
	},
	
	isTablet: function(){
		var ua = navigator.userAgent.toLowerCase();
		var isAndroid = ua.indexOf("android") > -1;
		var isiPad = ua.indexOf("ipad")>-1;
		return (isAndroid || isiPad);
	},
	
	isMobile:function(){
		if ('ontouchstart' in document.documentElement && navigator.userAgent.match(/Mobi/)){
			return true;
		}

		return (/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()));
	},
	
	isTouch: function(){
		return !!('ontouchstart' in window) ? 1 : 0;
	},
	
	
	/**
	 * @desc Detect flash. AP.B.flash() return true if flash is enabled, false otherwise.
	 */
	flash: function(){
		var hasFlash = false;
		try {
		  var fo = new ActiveXObject('ShockwaveFlash.ShockwaveFlash');
		  if (fo) hasFlash = true;
		}catch(e){
		  if (navigator.mimeTypes ["application/x-shockwave-flash"] != undefined) hasFlash = true;
		}
	}, 
	
	
	/**
	 * @desc Check if the browser support file API.
	 */
	file: function(){
		if (document.querySelector && window.File && window.FileReader && window.FileList){
			return true;
		}
		return false;
	},
	
	captchaReload: function(obj){
		$(obj).attr("src", Client.url+"/captcha?ts="+new Date().getTime());
	},
	
	
	/**
	 * @desc Set and get cookie,
	 * @copyright 2006 Klaus Hartl (stilbuero.de)
	 */
	cookie:function(name, value, options){
		if (typeof value == 'undefined'){
			var cookieValue = null;
			if (document.cookie && document.cookie != '') {
				var cookies = document.cookie.split(';');
				for (var i = 0; i < cookies.length; i++) {
					var cookie = jQuery.trim(cookies[i]);
					if (cookie.substring(0, name.length + 1) == (name + '=')) {
						cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						break;
					}
				}
			}
			return cookieValue;
		}else{
			options = options || {};
			if (value === null) {
				value = '';
				options.expires = -1000;
			}
			var expires = '';
			if (options.expires && (typeof options.expires == 'number' || options.expires.toUTCString)) {
				var date;
				if (typeof options.expires == 'number') {
					date = new Date();
					date.setTime(date.getTime() + (options.expires * 1000));
				} else {
					date = options.expires;
				}
				expires = '; expires=' + date.toUTCString();
			}
			
			
			var path = options.path ? '; path=' + (options.path) : '';
			var domain = options.domain ? '; domain=' + (options.domain) : '; domain='+ Client.domain;
			var secure = options.secure ? '; secure' : '';

			document.cookie = [name, '=', AP.encodeURI(value), expires, path, domain, secure].join('');
		}
	},
	
	
	/**
	 * @desc Create an event listener
	 */
	on :function(event, fx, $this){
		AP.sysEvent.bind(event, fx, $this);
		return this;
	},
	
	off: function(event){
		AP.sysEvent.off(event);
		return this;
	},
	
	
	/**
	 * @desc Create an event listener
	 */
	once :function(event, fx, $this){
		AP.sysEvent.bindOnce(event, fx, $this);
		return this;
	},
	
	
	/**
	 * @desc Trigger an event 
	 */
	fire: function(event, data){
		AP.sysEvent.trigger(event, data);
		return this;
	},
	
	
	/**
	 * @desc Trigger an event 
	 */
	trigger: function(event, data){
		return AP.sys.fire(event, data);
	},
	
	
	/**
	 * @desc Trigger an event (and dequeue)
	 */
	release: function(event){
		AP.sysEvent.release(event);
		return this;
	}
};	











AP.sysEvent=new function __APSysEvent(){
	this.events={};
	this.__fired={};
	
	this.clear=function(){
		this.events={}
	};
	
	
	this.trigger=function(ev, data){
		if (this.events[ev] && this.events[ev].length){
			for (var i=0; i<this.events[ev].length; i++){
				var fn=this.events[ev][i];
				if (!fn){
					break;
				}

				
				if (fn._once){
					// Remove fn from event queues
					this.events[ev].splice(i, 1);
				}
				
				if (fn._caller){
					fn.apply(fn._caller, data);
				}else{
					if (AP.data.isArray(data)){
						fn.apply(undefined, data);
					}else{
						fn(data);	
					}
				}
			}
		}
		
		return this;
	};
	
	
	this.bind=function(ev, fx, _caller){
		if (!this.events[ev]){
			this.events[ev]=[];
		}
		
		if (_caller){
			fx._caller=_caller;
		}
		
		this.events[ev].push(fx);
		
		return this;
	};
	
	
	this.off=function(ev){
		if (!this.events[ev]){
			this.events[ev]=[];
		}
		
		this.events[ev]=[];
		return this;
	};
	
	this.bindOnce=function(ev, fx, _caller){
		if (!this.events[ev]){
			this.events[ev]=[];
		}
		
		if (_caller){
			fx._caller=_caller;
		}
		
		fx._once=1;
		
		this.events[ev].push(fx);
		
		return this;
	};
	
	this.release=function(ev){
		if (this.events[ev] && this.events[ev].length){
			while (true){
				var fn=this.events[ev].shift();
				if (!fn){
					break;
				}
				
				if (fn._caller){
					fn.apply(fn._caller);
				}else{
					fn();
				}
			}
		}
		
		this.__fired[ev]=1;
		return this;
	};
	
};
 


AP.word={
	/**
	 * @desc Check if the data is an empty string or not.
	 * @param data
	 * @return True/False
	 */
	empty: function(data){ 
		if (typeof data=='undefined'){
			return true;
		}
		if (data===false) return true;
		if (data==="") return true;
		if (data===null) return true;
		if (data.length==0) return true;
		return false;
	},
	
	/**
	 * @desc Check if data is a valid data of type string.
	 * @param data
	 * @return True/False
	 */
	good: function(data){
		return typeof(data)=='string' && isNaN(data);
	},
	
	/**
	 * @desc Check if s1 is a part of s2 somewhere.
	 * @param s1 child string
	 * @param s2 parent string
	 */
	within:function(element,origin){
		if (!element) return false;
		if (origin.indexOf(element)>=0){
			return true;
		}
		return false;
	},
	
	extractLast: function(word){
		if (!word){
			return false;
		}
		var ws=word.split("-");
		return ws[ws.length-1];
	},
	
	/**
	 * @desc Check if $pre is the prefix of $origin
	 */
	prefix:function(origin, pre){
		if (!pre || !origin){
			return false;
		}
		if (origin.substring(0, pre.length)==pre){
			return true;
		}
		return false;
	},
	
	
	/**
	 * @desc Check if $suf is the suffix of $origin
	 */
	suffix:function(origin, suf){
		if (!suf || !origin || origin.length<suf.length){
			return false;
		}
		
		if (origin.substr(origin.length-suf.length, suf.length)==suf){
			return true;
		}
		return false;
	},
	
	
	
	/**
	 * @desc Check if a string is a valid url. The test is very simple, it check
	 * if the prefix is actually http
	 */
	isURL:function(url){
		if (this.prefix(url, 'http:') || this.prefix(url, 'https:')){
			return true;
		}
		return false;
	},
	
	
	shorten: function(word, max_length, tail){
		word=safe(word);
		
		if (!tail){
			tail='...';
		}
		if (word.length <max_length){
			return word;
		}
		return word.substr(0, max_length-1)+tail;
	},
	
	
	ucw: function(data){
		return data.replace( /(^|\s)([a-z])/g , function(m,p1,p2){ return p1+p2.toUpperCase(); } );
	},
	
	ucf: function(data){
		return data.charAt(0).toUpperCase() + data.slice(1);
	}, 
	upper: function(data){
		return data.toUpperCase();
	},
	
	
	/**
	 * @desc Replace all function
	 */
	replace: function(str, search, replace){
		return str.replace(new RegExp(search, 'g'),replace);
	},
	
	replaceAll:function(search, replace, str){
		return str.split(search).join(replace);
	},

	join: function(arr, joiner, fn){
		var html="";
		for (var i=0; i<arr.length; i++){
			if (i<arr.length-1){
				html+=fn?fn(arr[i]):arr[i];
				html+=joiner;
			}else{
				html+=fn?fn(arr[i]):arr[i];
			}
		}
		return html;
	},
	
	
	/**
	 * @desc Check if filename has extension belongging to fileX.
	 */
	fileX: function(filename, allowExt){
		var parts=filename.split(".");
		if (!parts || parts.length<1){
			return false;
		}
		var ext=parts[parts.length-1];
		ext=ext.toLowerCase();
		allowExt=allowExt.toLowerCase();
		
		if (allowExt.indexOf(ext)==-1){
			return false;
		}
		return true;
	},
	
	/**
	 * @desc Split a string into array.
	 * @param splitter The string splitter
	 * @param str The original string
	 * @param boolean no_spaces Allow spacings (and ends) in result or not? Default false
	 */
	split: function(splitter, str, no_spaces){
		if (!no_spaces){
			no_spaces=false;
		}
		var parts=str.split(splitter);
		var results=[];
		for (var i=0; i<parts.length; i++){
			 var s=parts[i];
			 if (no_spaces){
				 s=$.trim(parts[i]);
			 }
			 if (s && s.length>=1){
				 results.push(s);
			 }
		}
		return results;
	},
	
	safeSplit: function(splitter, str){
		return this.split(splitter, str, true);
	},
	
	ssplit: function(str){
		return str.split( /[\s,]/ );
	},
	
	plural:function(word, count){
		if (!AP.data.isInt(count)){
			index=parseInt(count);
		}
		
		if (count<2){
			return word;
		}
		
		if (Client.applang && Client.applang == "vi"){
			return word;
		}
		
		switch (word){
			case "person": 
				return "people";
			case "activity":
				return "activities";
			case "reply":
				return "replies";
			default:
				return word+"s";
		};
	},
	
	safeChar: function(word){
		var regex=/^[a-z0-9]+$/i;
		return word.match(regex);
	},
	
	match: function(word, pattern){
		return word.match(pattern);
	},
	
	quickMatch: function(w, q){
		return w.toLowerCase().indexOf(q.toLowerCase())!=-1;
	},
	
	fulltextMatch: function(w, q){
		var haystack=purify(w.toLowerCase()).replace(/\s/g,'');
		var neddle=purify(q.toLowerCase()).replace(/\s/g,'');
		
		return haystack.indexOf(neddle)!=-1;
	},
	
	capitalize: function(str){
		return str.charAt(0).toUpperCase() + str.slice(1);
	},
	
	leadingChars: function(str){
		var r="";
		var parts = this.split(" ", str);
		for (var i=0; i<parts.length; i++){
			r+=purify(parts[i][0]).toUpperCase();
		}
		
		return r;
	},
	
	random: function(len){
		return AP.random.word(len);
	},
	
	compare: function(w1, w2){
		if (!w1){
			return 0;
		}
		
		return w1.localeCompare(w2)	
	}
};

 


AP.html={	
	data:{},
	
	/**
	 * @desc Check if the document has some specific selector.
	 */
	contain:function(selector){
		if ($(selector).length>=1){
			return true;
		}
		return false;
	},
	
	/**
	 * @desc Alias of contain
	 */
	exist:function(selector){
		return this.contain(selector);
	},
	
	
	/**
	 * @desc Save html by caching it to data
	 * @param key
	 * @param selector
	 */
	save: function(key, selector){
		this.data[key]=$(selector).html();
	},
	
	update: function(key, selector){
		$(selector).html(this.data[key]);
	},
	
	
	/**
	 * @desc Setting the document title
	 */
	title:function(str){
		document.title = str;
	},	
	input:function(element, name){
		var $input;
		if (!name){
			$input=$(element);
		}else{
			$input=$("*[name="+name+"]", element);
		}
		
		if ($input[0] && $input[0].title==$input.val()){
			return  "";
		}else{
			return $input.val();
		}
	},
	select: function(selector, value){
		$(selector+" option[value='"+value+"']").attr('selected', 'selected');	
	},
	
	/**
	 * @desc Return the value of an input (encoded before return).
	 */
	inputAjax:function(elem,name){
		return AP.encodeURI(this.D.input(elem,name));
	},
	
	/**
	 * @desc Making input hints for all input/textarea within a given
	 * selector.
	 */
	inputHint: function(selector){
		if (!selector){
			selector='';
		}
		$(' input, textarea', selector).each(function(){
			if ($(this)[0].title || $(this).data('hint') && !$(this).hasClass('autocomplete') && !$(this).hasClass('__apcomplete_marked')){
				ap_inputHint(this);
			}
		});
	},
	
	
	hidden: function(name, value){
		return "<input type='hidden' name='"+name+"' value='"+value+"'/>";
	},
	
	focus: function(selector){
		$(selector).focus();
		this.scrollTo(selector);
	},
	
	scrollTo: function(selector, base, data){
		if (!data){
			data={};
		}
		var xoffset=0;
		data=$.extend({},{offset:0, time: 400},data);
		if (!base){
			base=ap_getScrollElement(document.body, 'html','body');
		}else{
			// xoffset=$(base).scrollTop();
		}
		
		
		var targetOffset=$(selector).position().top+xoffset+data.offset;
		if (targetOffset<=0){
			targetOffset=0;
		}
		
		// $.log(targetOffset);
		
		$(base).animate({scrollTop: targetOffset}, data.time, function() {});
	},
	
	/**
	 * @desc Binding a keypress event on a specific element.
	 */
	bind:function(selector,_key, action){
		$(selector).keydown(function (e){			
			key=0;
			if (e && e.which) key=e.which;
			else if (e && e.keyCode) key=e.keyCode;
			if (key == _key){
				action();
			}
		});
	},
	
	
	/**
	 * @desc Binding a keypress on window element.
	 */
	dbind: function(_key, action){
		$(document).keydown(function (e){
			if (AP.html.inActiveState()){
				return;
			}
			key=0;
			if (e && e.which) key=e.which;
			else if (e && e.keyCode) key=e.keyCode;
			if (key == _key){
				action();
			}
		});
	},
	
	/**
	 * @desc Bind a resize action on document.body 
	 * @param action Callback function
	 * @param persistent Boolean/ Persistent or not (over page transistion). Default is false.
	 */
	resize: function(action, persistent){		
		action();
		
		if (persistent){
			$(window).resize(function(){
				action();
			});
		}else{
			$(window).bind('resize.__temp',function(){
				action();
			});
		}
	},
	
	resizeEnd: function(action, timer, persistent){
		var doit;
		action();
		
		if (persistent){
			window.onresize = function(){
				clearTimeout(doit);
				doit = setTimeout(action, timer);
			};
		}else{
			window.on("resize.__temp", function(){
				clearTimeout(doit);
				doit = setTimeout(action, timer);
			});
		}
	},
	
	
	/**
	 * @desc Reset stuffs when they are added to the DOM tree.
	 */
	reset: function(container){
		$("button").click(function(event){
			event.preventDefault();
		});
	},
	
	
	/**
	 * @desc Flagging some input/select being in focus.
	 */
	activeState: false,
	
	/**
	 * @desc Check if the element is in active state or not.
	 */
	inActiveState:function(){
		return this.activeState;
	},
	
	/**
	 * @desc Initializing the active state of the document.
	 */
	initState:function(selector){
		if (!selector){
			selector="";
		}
		$(selector+" textarea,"+selector+" input").bind("focus", function(){
			AP.html.activeState=true;
		});
		$(selector+" textarea,"+selector+" input").bind("blur", function(){
			AP.html.activeState=false;
		});
	},
	
	/**
	 * @desc Embedding data (passed from sever) to HTML element.
	 */
	initData: function(selector){
		if (!selector){
			selector="";
		}
		$(" > .__data", selector).each(function(){
			var text=$(this).html();
			try{
				var obj=eval("("+text+")");
				if (obj!==null){
					for (var key in obj){
						$(this).parent().data(key, obj[key]);
					}
				}
			}catch(e){
				
			}
		});
	},
	
	
	initContextMenu: function(){
		$("<div id='__ctm'><div id='__ctmi' class='__contextmenu'></div></div>").appendTo('#master');
		$("#__ctm").clickOut(function(){
			$('#__ctm').hide();
		});
	},
	
	initTransition: function(wrapper){
		if (wrapper){
			AP.setContinuousRequest(wrapper);
		}else{
			AP.setContinuousRequest();
		}
	},
	
	initDialog: function(){
		$(document.body).append("<div id='apdialogs'></div>");
		AP.html.resize(function(){
			$("#apdialogs").css("width",$(window).width()+$.sbWidth());
		}, true);
	},
	
	
	initTooltip: function(selector){
		setTimeout(function(){
			$(".tt_auto", selector).parent().tooltip('.tt');
		},1000);
	},
	
	/**
	 * @desc Create some simple transformation on the dom tree specifically
	 * for AP JS Framework.
	 */
	init: function(selector){
		if (!selector){
			selector='';
		}
		this.initState(selector);
		setTimeout(function(){
			AP.html.inputHint(selector);
		},500);
		this.initData(selector);
		this.initTooltip(selector);
		
		this.reset(selector);
		if (!selector){
			this.initContextMenu();
			this.initDialog();
		}
	},
	
	/**
	 * @desc Init selector after insert
	 */
	initInsert: function(selector){
		this.inputHint(selector);
		this.initData(selector);
		this.initTransition(selector);
		this.initTooltip(selector);
	},
	
	options: function(selector, options){
		$(selector).html(AP.render(options, function(e){
			return "<option value='"+e.value+"'>"+e.label+"</option>";
		}));
		
		if ($(selector).data("value")){
			$(selector).val($(selector).data("value"));
		}
	},
};




var ap_getScrollElement=function(){
	for (var i = 0, argLength = arguments.length; i <argLength; i++) {
		var el = arguments[i], $scrollElement = $(el);
		
		if ($scrollElement.scrollTop()> 0) {
				return el;
		}else {
				$scrollElement.scrollTop(1);
				var isScrollable = $scrollElement.scrollTop()> 0;
				$scrollElement.scrollTop(0);
				if (isScrollable) {
					return el;
				}
		}
	}
	return [];
};


var ap_inputHint=function(element, target){
	if (!target){
		target=element;
	}
	
	if ($(element).hasClass('__hinited') || $(element).hasClass('__apcomplete_marked')){
		return;
	}
	
	$(element).addClass('__hinited');
	var $parent=$(element).parent();
	
	var pos=$parent.css("position");
	if (pos !="relative" && pos!="absolute"){
		$parent.addClass("relative");
	}
	

	var fz=$(element).css("font-size");
	var pos=$(element).position();
	var pl=$parent.css("padding-left");
	var pt=$parent.css("padding-top");
	
	var txt=$(element)[0].title;
	if ($(element).data("hint")){
		txt=$(element).data("hint");
	}
	
	$(element).before("<span class='__hinited_data __blur' style='top:"+pt+"; left:"+pl+"; font-size:"+fz+"'>"+txt+"</span>");
	
	
	setTimeout(function(){
		if ($(element).data('auto')){
			$(element).prev('.__hinited_data').css("left","auto").css("right", pl).show();
		}else{
			$(element).prev().css({top: pt, left: pl});	
		}
	},200);
	
	$(element).on('focus keyup change', function(){
		if ($(this).hasClass('apcomplete')){
			return;
		}
		if (!AP.word.empty($(this).val())){
			$(this).addClass('__activated');
			
			if ($(this).data('auto')){
				$(this).prev('.__hinited_data').css("left","auto").css("right", pl);	
			}else{
				$(this).prev('.__hinited_data').hide();
			}
			
		}else{
			$(this).removeClass('__activated');
			$(this).prev('.__hinited_data').css("left",pl).show();
		}
	}).blur(function(){
		if ($(this).hasClass('apcomplete')){
			return;
		}
		
		if (AP.word.empty($(this).val())){
			$(this).prev('.__hinited_data').show();
		}
	});

	$(element).blur();
	
};

 

AP.error={
	code:{
	CONFLICT_DATA:997, INVALID_DATA: 998, INCOMPLETE_DATA:999, 
	INVALID_USER:1001, INVALID_AUTHENTICATION:1002, LOGIN_REQUIRED:10033, DB_ERROR:1005, SV_ERROR:1006,
	INVALID_PASSWORD: 1021,
	INVALID_USERNAME:1022,
	INVALID_CHARACTER:1023,
	INVALID_CAPTCHA: 1024,
	INVALID_EMAIL:1020,
	UNKNOWN_ERROR: 990},
	
	messages:{},
	
	translate:function(msg){
		if (AP.error.messages[msg]){
			return AP.error.messages[msg];
		}
		return msg;
	}	
};


AP.random=new function __APRandom(){
	this.word=function(length){
		var text = "";
		var possible = "abcdefghjklmnpqrstuvwxyz";

		for (var i = 0; i < length; i++){
			text += possible.charAt(Math.floor(Math.random() * possible.length));
		}

		return text;
	};
	
	this.avatar=function(){
		return "<img src='http://localhost/lamp/avatars/"+this.int(1,10)+".svg'/>";
	};
	
	this.int=function(f, t_inclusive){
		return f+Math.floor(Math.random() * (t_inclusive+1-f));
	};
	
	this.number=function(from_number, to_number_inclusive){
		if (!from_number){
			from_number=0;
		}
		
		if (!to_number_inclusive){
			to_number_inclusive=100;
		}
		return this.int(from_number, to_number_inclusive);
	};
};




(function($){
	
	/**
	 * @desc jQuery 1.8 fix
	 */
	if (!$.curCSS){
		$.curCSS=$.css;
	};
	
	
	
	/**
	 * @desc log to the console.
	 */
	$.log=function(msg){
		if (Client.env==1 || Client.env=='1'){
			return;
		}
		if (!window.console || !window.console.log){
			
		}else{
			try{
				window.console.log(msg);
			}catch(e){
			}
		}
	};
	
	
	$.logMe=function(element){
		var str = $("<div />").append($(element).clone()).html();
		$.log(str);
	};
	
	$.cookie=function(name, value, options){
		return AP.sys.cookie(name, value, options);
	};

	
	/**
	 * @desc Adding an element to the document root when the element
	 * is not exists.
	 */
	$.adding=function(selector, options, callback){
		if (!$(selector).length){			
			options=$.extend({global: false, element: "div", 'class':'', action:'', title:''},options);
			
			var s=selector.substring(1);
			$(document.body).append("<"+options.element+" id='"+s+"'></"+options.element+">");
			if (options.css){
				$(selector).css(options.css);
			}
			
			if (options.title){
				$(selector).attr('title', options.title);
			}
			if (options.action){
				$(selector).attr('action', options.action);
			}
			if (options['class']){
				$(selector).addClass(options['class']);
			}
			if (!options.global){
				$(selector).addClass('__temp');
			}
			
			if (callback){
				callback();
			}
		}
	};
	
	
	/**
	 * @desc Creating a simple scalar object from a complicated object. 
	 */
	$.scalar=function(obj){
		var s={"id": obj.id, "dbk": obj.dbk};
		
		return s;
	};
	
	
	
	$.fn.max=function(field, multiple){
		var tm=null;
		var m=null;
		
		$(this).each(function(){
			var v=$(this).data(field);
			
			
			if (v){
				v=parseInt(v);
				var tv=v;
				
				if (multiple){
					if (AP.data.isInt(multiple)){
						tv=tv*multiple;
					}else{
						tv=multiple(tv);
					}
				}
				
				if (tm===null || tm<tv){
					tm=tv;
					m=v;
				}
			}
		});
		
		return m;
	};
	
	
	/**
	 * @desc Return the maximum width
	 */
	$.maxWidth=function(){
		return Math.max($(window).width(), $(document.body).width());
	};
	
	
	/**
	 * @desc Return the maximum width
	 */
	$.maxHeight=function(){
		var m= Math.max($(window).height(), $(document.body).height()+30);
		if ($("#overlay").length>=1){
			return Math.max(m, $("#overlay").height());
		}
		return $m;
	};
	
	
	$.scrollEnd=function(callback){
		
	};
	
	
	var _scrollbarWidth=0;
	$.sbWidth=function(){
		if (!_scrollbarWidth){
			_scrollbarWidth=getScrollbarWidth();
		}
		return _scrollbarWidth;
	};
	
	
	
	$.fn.reverse = [].reverse;
	
	
	/**
	 * Example:
	 * 
	 * $(window).onFinish('scroll', 250, function(event){
	 * 	
	 * });
	 */
	
	var __off_timer;
	$.fn.onFinish=function(event, delay, callback){
		return $(this).on(event, $.debounce(delay, function(event){
			callback(event);
		}));
	};
	
	
	$.fn.autofocus=function(){
		if (!mobile()){
			if ($(this).is(":visible")){
				$(this).focus();	
			}
		}
		
		return this;
	};
	
	
	$.fn.scrollOver=function(fn){
		$(this).on('scroll.__temp', function(){
			var stop=$(this).scrollTop();
			var h=$(this)[0].scrollHeight;
			var diff=h-stop-$(this).height();
			if (Math.abs(diff)<=1){
				fn();
			}
		});
	};
	
	
	$.fn.scrollDown=function(offset){
		AP.html.scrollTo(this, null, {'offset': offset});
	};
	
	$.fn.scrollToBottom=function(){
		var h=$(this)[0].scrollHeight;
		$(this).scrollTop(h);
	};
	
	$.fn.scrollToTop=function(){
		$(this).scrollTop(0);
	};
	
	
	$.fn.contentWidth=function(){
		var w=0;
		$(this).children().each(function(){
			w+=$(this).outerWidth();
		});
		
		return w;
	};
	

	$.fn.apAppend=function(html){
		$(this).append(html);
		AP.html.initInsert(this);
		return this;
	};
	
	
	$.fn.apPrepend=function(html){
		$(this).prepend(html);
		AP.html.initInsert(this);
		return this;
	};
	
	
	$.fn.linkify=function(){
		 $(this).each(function(){
			 var el=$(this);
			 if (el.jquery) {
				 el = el[0];
			 }
			 el.normalize();
			 __linkifyNode(el);
			 return el;
		});
	};
	
	
	
	$.fn.move=function(dir, anim){
		dir=dir.toLowerCase();
		if (dir=="up" || dir=="prev"){
			var $prev=$(this).prev();
			if ($prev && $prev.length){
				if (anim){
					$(this).slideUp(200, function(){
						$(this).insertBefore($prev).slideDown(200);
					});
				}else{
					$(this).insertBefore($prev);
				}
			}
		}
		
		if (dir=="down" || dir=="next"){
			var $next=$(this).next();
			if ($next && $next.length){
				if (anim){
					$(this).slideUp(200, function(){
						$(this).insertAfter($next).slideDown(200);
					});
				}else{
					$(this).insertAfter($next);	
				}
			}
		}
	};
	
	
	/**
	 * @desc Clone css from another selector
	 */
	$.fn.cloneCSS=function(selector, properties){
		var ps=AP.word.split(",", properties);
		for (var i=0; i<ps.length; i++){
			ps[i]=$.trim(ps[i]);
			$(this).css(ps[i], $(selector).css(ps[i]));
		}
	};
	
	
	$.fn.autoExpand=function(options){
		autosize($(this));
		return this;
		
		$(this).each(function(){
			var $this=$(this);
			
			var lh=$this.data("lh");
			if (!lh) lh=22;
			var ih=$(this).height();
			
			$this.css("line-height",lh+"px").css("overflow-y", "hidden");
			$this.data("minh", $(this)[0].scrollHeight).on("keydown", function(e){
				var elem=this;
				setTimeout(function(){
					var minh=$(elem).data("minh");
					// @todo Carefully check this
					if (ih>40){
						$(elem)[0].style.height="auto";
					}
					
					$(elem)[0].style.height=Math.max($(elem)[0].scrollHeight,lh)+"px";
				},0);
			}).keydown();
		});
		
		return this;
	};
	
	
	$.fn.angular=function(options){
		var df={color:"#aaa", bg:"#fff", arc: false, stroke: 10};
		if ($(this).data("color")){
			df.color=$(this).data("color");
		}
		
		if ($(this).data("angle")){
			df.angle=$(this).data("angle");
		}
		
		if ($(this).data("bg")){
			df.bg=$(this).data("bg");
		}
		
		if ($(this).data("text")){
			df.text=$(this).data("text");
		}
		
		if ($(this).data("stroke")){
			df.stroke=$(this).data("stroke");
		}
		
		if ($(this).data("cut") || $(this).data("arc")){
			df.arc=true;
		}
		
		if ($(this).data("percent")){
			df.angle=360*parseFloat($(this).data("percent"))/100;
		}
		
		options=$.extend({}, df, options);
		
		var sektor = new Sektor(this, {
			angle: options.angle,
			sectorColor: options.color,
			circleColor: options.bg,
			arc: options.arc,
			stroke: options.stroke,
			fillCircle: !options.arc
		});
		
		if (options.text){
			$(this).append("<div class='inner-text'>"+options.text+"</div>");
		}
	};
	
	$.fn.screencopy=function(url, success, __data){
		if (!__data){
			__data={};
		}
		
		$(this).bind("paste", function(ev){
			var $this = $(this);
			var original =  ev.originalEvent;
			if (!original.clipboardData || !original.clipboardData.items || !original.clipboardData.items.length){
				return;
			}
			var raw=original.clipboardData.items[0];
			if (typeof raw !='object'){
				return;
			}
			
			var file =  raw.getAsFile();
			if (!file || !file.size || !file.type){
				return;
			}
			
			var reader = new FileReader();
			
			reader.onload = function (evt) {
				var result = evt.target.result; 
				var arr = result.split(",");
				var data = arr[1]; // raw base64
				var contentType = arr[0].split(";")[0].split(":")[1];
				
				// this needs to post to a server route that can accept raw base64 content and save to a file
				var temp=__data;
				temp.contentType=contentType;
				temp.data=data;
				temp.__ss=1;
				
				$this.parent().ajaxShow();
				AP.post(url, temp, function(code){
					$this.parent().ajaxHide();
					
					if (!code.good()){
						return AP.alertError(code.message);
					}
					
					success(code, $this);
				});
			};
			
			reader.readAsDataURL(file);
		});
		
		return this;
	};
	
	
	$.fn.textPasted=function(callback){
		$(this).bind("paste", function(ev){
			var $this = $(this);
			var original =  ev.originalEvent;
			if (!original.clipboardData || !original.clipboardData.items || !original.clipboardData.items.length){
				return;
			}
			var raw=original.clipboardData.items[0];
			if (raw && raw.type=="text/plain"){
				raw.getAsString(function(str){
					callback(str);
				});
			}
		});
		return this;
	};
	
	
	
	$.fn.selectChoices=function(){
		AP.formRender().choiceList(this);
		return this;
	};
	
	
	
	$.fn.selectRadios=function(){
		AP.formRender().radioList(this);
		return this;
	};
	
	

	$.fn.selectDate=function($format){
		var val=$(this).val();
		if (!val || val=="0"){
			$(this).val("");
		}
		
		if ($(this).data("ts")){
			var ts=$(this).data("ts");
			if (ts && ts!="0"){
				$(this).val(AP.time.time(AP.i18n.dateFormat(),ts));	
			}
		}
		
		AP.UI.dateSelect(this, $format);
		return this;
	};
	
	
	$.fn.selectTime=function(options){
		AP.UI.timeSelect(this, options);
		return this;
	};
	
	
	$.fn.selectYear=function(){
		$(this).autocomplete({source: range(2010, 1900)});
	};
	
	
	$.fn.getDialog=function(){
		var $elem=$(this).closest('.__apdialog');
		return AP.dialog('#'+$elem.attr('id'));
	};
	
	
	/**
	 * @desc Modified version of autocomplete
	 * @param sources Array
	 * @param multi_value True/False. Default is false.
	 */
	$.fn.apcomplete=function(source, multi_value, callback, filter_fn){
		if (source==":clean"){
			$(this).val("");
			$(this).siblings('input').val("");
			
			$(this).siblings('.apc-selected').remove();
			return new APComplete(this, source, multi_value, callback);
		}
		
		if (!$(this).hasClass("__apcomplete_marked")){
			$(this).addClass("__apcomplete_marked");
		}else{
			return new APComplete(this, source, multi_value, callback);
		}
		
		if (AP.isString(source)){
			if (multi_value){
				$(this).addClass("__apcomplete_multi");
				var ref=AP.UI.autocompleteComplex($(this), source, callback,filter_fn);
				return new APComplete(this, source, multi_value, callback, ref);
			}
			var ref=AP.UI.autocomplete($(this), source, callback, filter_fn);
			return new APComplete(this, source, multi_value, callback, ref);
		}else{			
			if (multi_value){
				var ref=AP.UI.acx($(this), source, callback,filter_fn);
				return new APComplete(this, source, multi_value, callback, ref);
			}
			var ref= AP.UI.ac($(this), source, callback, filter_fn);
			return new APComplete(this, source, multi_value, callback, ref);
		}
	};
	
	
	/**
	 * @desc String complete, great to use for things like tag autocompletion
	 */
	$.fn.scomplete=function(strings, callback){	
		$(this).on("keydown", function( event ) {
			if (event.keyCode === $.ui.keyCode.TAB && $(this).data("ui-autocomplete").menu.active){
				event.preventDefault();
			}
		})
		.autocomplete({
			minLength: 0,
			classes: {
				 "ui-autocomplete": "base-string-complete"
			},
			source: function(request, response){
				var last=request.term.split(/,\s*/).pop();
				response($.ui.autocomplete.filter(strings,last));
			},
			focus: function(){
				return false;
			},
			select: function(event, ui){
				var terms = this.value.split(/,\s*/);
				terms.pop();
				terms.push(ui.item.value);
				terms.push("");
				this.value = terms.join(", ");
				if (callback){
					callback(ui.item.value);
				}
				return false;
			}
		});
	};
	
	
	$.fn.livesearch=function(url, options){
		if (!options.filter){
			options.filter=null;
		}

		if (options.render){
			
		}
		
		var acc=$(this).apcomplete(url, false, options.select, options.filter);
		
		if (options.render){
			acc.aco.data("ui-autocomplete")._renderItem = function(ul,item) {
				return $("<li>").data("item.autocomplete", item).append(options.render(item)).appendTo(ul);
			};
		}
	};
	
	
	$.fn.stringcomplete=function(url){
		return AP.UI.stringcomplete(this, url);
	};
	
	
	
	$.fn.hasEmbedData=function(key){
		var obj=$(this).data(key);
		if (obj && obj!="" && typeof obj !="undefined"){
			return true;
		}
		
		return false;
	};
	
	var delay_timer=null;
	$.fn.quickFilter=function(selectors, filter_fn){
		$(this).on("input change", function(){
			var $this = $(this);
			clearTimeout(delay_timer);
			
			delay_timer = setTimeout(function(){
				var val=$this.val();
				if (!val || !val.length){
					return $(selectors).show();
				}
				
				val=val.toLowerCase();
				
				$(selectors).each(function(){
					if (filter_fn($(this), val)){
						$(this).show();
					}else{
						$(this).hide();
					}
				});
			}, 300);
		});
		
		var q =$(this).data("query");
		if (q && q.length && Query.get(q)){
			$(this).val(Query.get(q)).trigger("change");
		}
	};
	
	
	$.fn.search=function(cb){
		$(this).attr('autocomplete','off');
		
		$(this).on("input change", function(){
			var $this = $(this);
			clearTimeout(delay_timer);
			
			delay_timer = setTimeout(function(){
				var val=$this.val();
				val=val.toLowerCase();
				cb(val);
				
			}, 500);
		});
	};
	
	
	$.fn.rposition=function(target){
		if (!$(this).closest(target).length){
			return {top:0, left: 0};
		}
		
		var $e=$(this);
		var top=0;
		var left=0;
		
		while (true){
			if (!$e.length){
				break;
			}
			
			if ($e.is(target)){
				break;
			}
			
			var p=$e.position();
			
			if ($e.css("position")=="static" || !$e.css("position")){
			}else{
				top+=p.top;
				left+=p.left;	
			}
			
			$e=$e.parent();
		}
		
		return {top:top, left: left};
	};
	
	$.fn.quickSort=function(selectors, cmp_fn){
		var $elems=$(this).find(selectors).remove();
		$elems.sort(function(a,b){
			return cmp_fn($(a), $(b));
		}).prependTo(this);
	};
	
	
	
	$.fn.suggest=function(data, options){
		options=$.extend({placeholder: $(this).attr('placeholder'), restricted: true}, {}, options);
		
		for (var i=0; i<data.length; i++){
			var e=data[i];
			if (!AP.data.isObject(e) && AP.data.isString(e)){
				data[i]={id: purify(e), label: e};
			}
		}
		
		var $p=$(this).parent();
		var name=$(this).attr("name");
		
		if ($p.hasClass("__suggest_canvas")){
			
		}else{
			$p.addClass("__suggest_canvas").data("options", options);
			
			$(this).addClass("__input-suggestion-target").hide().before("<input class='__input-suggestion-fake' autocomplete='off' placeholder='"+options.placeholder+"' name='"+name+"-ipfk'/>");
			
			var html=AP.render(data, function(e){
				var val;
				if ("id" in e){
					val=e.id;	
				}else{
					val=e.value;
				}
				
				var icon="";
				if (options.multi){
					icon= "<span class='__icon'></span>";
				}
				
				return "<div class='__input-suggestion-row' onclick='__fn_input_suggest(this);' data-id='"+val+"'>"+icon+e.label+"</div>";
			});

			if (options.maxHeight){
				// html="<div class='__iwh' style='max-height:"+options.maxHeight+"px; overflow-y:scroll; overflow-x:hidden'>"+html+"</div>";
			}
			
			if (options.all){
				html="<div class='__input-suggestion-row -is-all' onclick='__fn_input_suggest(this);' data-all='1' data-id='"+options.all.value+"'>"+options.all.label+"</div>"+html;
			}
			
			if (data && data.length >=10){
				html="<div style='max-height:300px; overflow-y:scroll'><div class='__iw'>"+html+"</div></div>";
			}else{
				html="<div class='__iw'>"+html+"</div>";	
			}

			
			if (!options.restricted){
				html+="<div class='__input-extra'><input type='text' class='__input-extra-fx' placeholder='Or type another option here and press Enter'/> <div class='__input-enter'>Enter</div></div>";
			}
			
			
			
			var w=$(this).width()-2;
			html="<div class='__input-suggestion-canvas unselectable'>"+html+"</div>";
			
			$(this).after(html);
			
			$("<div class='__input-suggestion-ph'><div class='__labels'></div><span class='arrow -ap icon-triangle-down'></span></div>").insertAfter(this).click(function(){
				$(this).parent().addClass("__iss");
				$(this).closest(".row").addClass("__ft");
			}).parent().find(".__input-suggestion-fake").focus(function(){
				$(this).parent().addClass("__iss");
				$(this).closest(".row").addClass("__ft");
			});
			
			
			
			$p.clickOut(function(){
				$(this).removeClass("__iss");
				$(this).closest(".row").removeClass("__ft");
			});
	
		
			var v=$(this).val();
			
			if (options.multi){
				var vs=options.df;
				var ls="";
				if (vs && vs.length){
					for (var i=0; i<vs.length; i++){
						$p.parent().find(".__input-suggestion-row").each(function(){
							if ($(this).data("id")==vs[i]){
								$(this).addClass("active");
								ls+=$(this).text()+", ";
							}
						});
					}
					
					$(this).val(vs.join(","));
					$p.find(".__input-suggestion-fake").val(ls);
				}
			}else{
				if (v){
					$p.find(".__input-suggestion-row").each(function(){
						if ($(this).text()==v){
							$(this).addClass("active");
						}else{
							$(this).removeClass("active");
						}
					});
					$(this).val(v);
				}	
			}
			
			$(this).parent().find(".__input-extra-fx").enter(function(){
				var v=$(this).val();
				if (v){
					$p.find(".__input-successtion-row").each(function(){
						if ($(this).text()==v){
							$(this).addClass("active");
						}else{
							$(this).removeClass("active");
						}
					});
					
					$p.find(".__input-suggestion-target").val(v);
					$p.removeClass("__iss");
					$p.closest(".row").removeClass("__ft");
					$p.children().removeClass("active");
				}
			});
			
	
			$(this).parent().find(".__input-enter").click(function(){
				var v=$(this).parent().find("input").val();
				if (v){
					$p.find(".__input-successtion-row").each(function(){
						if ($(this).text()==v){
							$(this).addClass("active");
						}else{
							$(this).removeClass("active");
						}
					});
					
					$p.find(".__input-suggestion-target").val(v);
					$p.removeClass("__iss");
					$p.closest(".row").removeClass("__ft");
					$p.children().removeClass("active");
				}
			});
		}
		
		if (options.value && options.value.length){
			for (var i=0; i<options.value.length; i++){
				$p.find(".__input-suggestion-row").each(function(){
					if ($(this).data("id")==options.value[i]){
						$(this).click();
					}
				});
			}
		}
	};
	
	
	
	$.fn.textSuggest=function(data, options){
		options=$.extend({placeholder: $(this).attr('placeholder'), restricted: true}, {}, options);
		
		for (var i=0; i<data.length; i++){
			var e=data[i];
			if (!AP.data.isObject(e) && AP.data.isString(e)){
				data[i]={id: purify(e), label: e};
			}
		}
		
		var $p=$(this).parent();
		var name=$(this).attr("name");
		
		if ($p.hasClass("__suggest_canvas")){
			
		}else{
			$p.addClass("__suggest_canvas").data("options", options);
			
			var html=AP.render(data, function(e){
				var val;
				if ("id" in e){
					val=e.id;	
				}else{
					val=e.value;
				}
				
				var icon="";
				if (options.multi){
					icon= "<span class='__icon'></span>";
				}
				
				return "<div class='__input-suggestion-row' onclick='__fn_input_text_suggest(this);' data-id='"+val+"'>"+icon+e.label+"</div>";
			});

			if (options.maxHeight){
				// html="<div class='__iwh' style='max-height:"+options.maxHeight+"px; overflow-y:scroll; overflow-x:hidden'>"+html+"</div>";
			}
			
			if (data && data.length >=10){
				html="<div style='max-height:300px; overflow-y:scroll'><div class='__iw'>"+html+"</div></div>";
			}else{
				html="<div class='__iw'>"+html+"</div>";	
			}
		
			var w=$(this).width()-2;
			$(this).after("<div class='__input-suggestion-canvas unselectable'>"+html+"</div>");
			
			
			$(this).on("input focus", function(){
				$(this).next().show();
				var v=$(this).val();
				if (v && v.length){
					
				}
			}).on("blur", function(){
				var $that=$(this);
				setTimeout(function(){
					$that.next().hide();
				}, 300);
			}).enter(function(){
				var $that=$(this);
				setTimeout(function(){
					$that.next().hide();
				}, 100);
			});
		}
	};
	
	
	
	$.fn.tagName=function(){
		return $(this)[0].nodeName.toLowerCase();
	};
	
	
	$.fn.tag=function(url, render_fn, filter_fn, reorder_fn, select_fn){
		if (url=="reset"){
			// RESET TAGGING
			var id=$(this).attr('id');
			var new_id=id+"__temptextarea";
			if ($("#"+new_id).length){
				$("#"+new_id).remove();
			}
			
			var tid="__tag_"+id;
			
			if ($("#"+tid).length){
				$("#"+tid).remove();
			}
			
			return;
		}
		
		
		if ($(this).hasClass("__autoc")){
			return;
		}
		
		$(this).addClass("__autoc");
		
		$(this).data("reorder_fn", reorder_fn);
		
		var id=$(this).attr('id');
		if (!id){
			id=AP.uuid();
			$(this).attr('id', id);
		}

		var pos=$(this).position();
		var tagdir=$(this).data('tagdir');
		var tid="__tag_"+id;
		
		if ($("#"+tid).length){
			$("#"+tid).remove();
		}
		
		
		var item="";
		var tagname=$(this)[0].nodeName.toLowerCase();
		$(this).data("tagname", tagname);
		
		plugin_textarea_init("#"+id);
		
		if (tagdir=="bottom"){
			$("<div class='tags absolute __temp' id='"+tid+"'> "+item+"</div>").appendTo("#context-tag-bottom");
		}else{
			$("<div class='tags absolute __temp' id='"+tid+"'> "+item+"</div>").appendTo("#context-tag");
		}
		
		var $tagbox=$("#"+tid);
		if (tagdir){
			$tagbox.data("tagdir", tagdir);
		}
		
		$tagbox.data("onselect", select_fn);
		
		if ($(this).data("theme")){
			$tagbox.addClass("theme-"+$(this).data("theme"));
		}
		
		$(this).on('keydown', function(e){
			var key=e.keycode? e.keycode:e.which;
			if (key==AP.key.up || key==AP.key.down || key==AP.key.enter){
				if ($tagbox.is(':visible')){
					e.preventDefault();
					e.stopPropagation();
					return false;
				}
			}
		}).data("tagbox", $tagbox);
		
		var compact=false;
		if ($(this).data("compacttagging")){
			compact=true;
		}
		

		$(this).on('keyup', function(e){
			var $tagbox=$(this).data("tagbox");
			
			var key=e.keycode? e.keycode:e.which;
			
			if ($tagbox.is(':visible')){
				if (key==AP.key.down){
					plugin_select_updown_down($tagbox);
					return;
				}else if (key==AP.key.up){
					plugin_select_updown_up($tagbox);
					return;
				}else if (key==AP.key.enter){
					plugin_select_updown_enter($tagbox);
					return;
				}
			}else{
				if (key==AP.key.down || key==AP.key.up){
					return;
				}
			}
			
			var v=$(this).val();
			if (!compact && (!v.length || v.charAt(v.length-1)==' ')){
				fn_cancel_tag(id);
				return;
			}
			
			
			var single=$(this).data("single-tag");
			
			var term=$(this).val();
			if (!single){
				term=$.trim($(this).data("current_word"));	
			}
			
			if (term && term.length>=1){
				if (term.charAt(0)=='@' || compact){
					var q=term;
					if (term.charAt(0)=='@'){
						q=term.substr(1);
					} 				
					
					if (!q.length){
						return;
					}
					
					var data={q: q, rand: AP.uuid()};
					
					data.__code=Client.code;
					if (Client.network){
						data.__network=Client.network.id;	
					}
					
					var tdata=$(this).data("aptag");
					
					if (tdata && tdata.lock && tdata.since && tdata.q){
						if (tdata.lock){
							return;
						}
						if ((tdata.q==q && AP.time.now() - tdata.since<2)){
							return;
						}
					}
					
					$(this).data("aptag",{q: q, since: AP.time.now(), lock: 1});
				
					if (AP.data.isArray(url)){
						var tdata=$("#"+id).data("aptag");
						if (!tdata){
							tdata={};
						}
						
						tdata.lock=0;
						$("#"+id).data("aptag", tdata);
						var code=AP.array.filter(url, function(item){
							return filter_fn(item, q);
						});
						
						var reorder=$(this).data("reorder_fn");
						
						if (reorder){				
							if (code && code.length){
								code.sort(function(a,b){
									return -reorder(a, q)+reorder_fn(b, q);
								});
							}
						}
						
						if (code && code.length && code.length>=1){
							var items=AP.render(code, function(item){
								if (!render_fn){
									return "<span class='item' data-value='"+item.value+"' onclick=\"plugin_tag_select('#"+id+"','"+item.value+" '); fn_cancel_tag('"+id+"');\">"+item.name+"</span>";
								}
								return "<span class='item' data-value='"+item.value+"' onclick=\"plugin_tag_select('#"+id+"','"+item.value+" '); fn_cancel_tag('"+id+"'); \">"+render_fn(item)+"</span>";
							});
							

							var pos=$("#"+id).offset();
							var tagname=$("#"+id).data('tagname');
							
							var tw=$("#"+id).width()+8;
							if (tw<240){
								tw=240;
							}
							
							if (tagname=='textarea' && !Client.native){
								var cpos=plugin_tag_textareacursor("#"+id);
								if (tagdir=="bottom"){
									var bt=$(window).height()-pos.top-$("#"+id).height();
									if (bt<0){
										bt=0;
									}
									
									$tagbox.html(items).show().css({"left": pos.left, "width": tw, bottom: bt+20});
								}else{
									$tagbox.html(items).show().css({"left": pos.left+cpos.left, top: pos.top + cpos.top});
								}
							}else{
								if (tagdir=="bottom"){
									$tagbox.html(items).show().css({"left": pos.left, "width": tw, bottom: $("#"+id).height()+20});
								}else{
									$tagbox.html(items).show().css({"left": pos.left, "width": tw, top: pos.top +10});
								}
							}
							
							plugin_select_updown_first($tagbox);
						}else{
							fn_cancel_tag(id);
						}
					}else{
						$.post(Client.url+'/ajax/'+url, data, function(code){
							var tdata=$("#"+id).data("aptag");
							if (!tdata){
								tdata={};
							}
							tdata.lock=0;
							$("#"+id).data("aptag", tdata);
							
							
							var reorder=$(this).data("reorder_fn");
							
							if (reorder){
								if (code && code.length){
									code.sort(function(a,b){
										return -reorder(a, q)+reorder_fn(b, q);
									});
								}
							}
							
							if (code && code.length && code.length>=1){
								var items=AP.render(code, function(item){
									if (!render_fn){
										return "<span class='item' data-value='"+item.value+"' onclick=\"plugin_tag_select('#"+id+"','"+item.value+" '); fn_cancel_tag('"+id+"');\">"+item.name+"</span>";
									}
									return "<span class='item' data-value='"+item.value+"' onclick=\"plugin_tag_select('#"+id+"','"+item.value+" '); fn_cancel_tag('"+id+"'); \">"+render_fn(item)+"</span>";
								});
								

								var pos=$("#"+id).offset();
								var tagname=$("#"+id).data('tagname');
								
								if (tagname=='textarea' && !Client.native){
									var cpos=plugin_tag_textareacursor("#"+id);
									$tagbox.html(items).show().css({"left": pos.left+cpos.left, top: pos.top + cpos.top});	
								}else{
									if (tagdir=="bottom"){
										$tagbox.html(items).show().css({"left": pos.left, "width": $("#"+id).width()+8, bottom: $("#"+id).height()+20});
									}else{
										$tagbox.html(items).show().css({"left": pos.left, "width": $("#"+id).width()+8, top: pos.top +10});
									}
								}
								
								plugin_select_updown_first($tagbox);
							}else{
								fn_cancel_tag(id);
							}
						},"json");
					}
				}else{
					fn_cancel_tag(id);
				}
			}else{
				fn_cancel_tag(id);
			}
		});
		
	
		return $(this);
	};
	

	
	$.fn.renderEngine=function(fn){
		$(this).data("ui-autocomplete")._renderItem=function(ul, item){
			return $("<li></li>")
			.data("item.autocomplete", item)
			.append("<a class='rerender ap-acitem'>"+ fn(item)+"</a>")
			.appendTo(ul);
		};
		
		return $(this);
	};
	
	
	
	/**
	 * @desc Bind multiple-events
	 */
	$.fn.xbind=function(events, event_data, fn){
		if (!fn){
			fn=event_data;
			event_data={};
		}
		var lists=events.split(" ");
		for (var i=0; i<lists.length; i++){
			$(this).bind(lists[i], event_data, fn);
		}
	};
	
	
	/**
	 * @desc Set a flag on variable. If flag is not set, set it to 1.
	 * @return True if the flag is already set, false otherwhise.
	 */
	$.fn.flag=function(flag_name){
		if (!flag_name){
			flag_name='__flag';
		}
		
		var data=$(this).data(flag_name);
		if (!data){
			$(this).data(flag_name, 1);
			return false;
		}
		if (data==1){
			return true;
		}
		return false;
	};
	
	
	/**
	 * @desc Put a lock on a particular element. Return true if the lock
	 * is put on an unlocked element. False otherwise.
	 */
	$.fn.lock=function(){
		var data=$(this).data("__b_lock");
		if (!data || data===0){
			$(this).data("__b_lock", 1);
			return true;
		}
		return false;
	};
	
	

	/**
	 * @desc Put a lock on a particular element. Return true if the lock
	 * is put on an unlocked element. False otherwise.
	 */
	$.fn.unlock=function(){
		 // release binary lock
		$(this).data("__b_lock", 0);
	};
	
	
	
	/**
	 * @desc Cleanup a particular element.
	 */
	$.fn.cleanUp=function(){
		$(this).children().remove();
		$(this).empty();
		return $(this);
	};

	
	$.fn.preventAutoSubmit=function(){
		$(this).find(":input").on("keypress", function(e){
			if (event.keyCode == 13) {
				event.preventDefault();
				return false;
			}
		});
	};
	
	$.fn.mclick=function(click, dbclick){
		var timer;
		var clicks=0;
		
		$(this).on("click", function(e){
			var $this=$(this);
			clicks++;
			
			if (clicks==1){
				$(this).data("clicked", 1);
				timer=setTimeout(function(){
					click.apply($this[0]);
					clicks=0;
				}, 500);
			}else{
				clearTimeout(timer);
				dbclick.apply(this);
				clicks=0;
			}
		}).on("dbclick", function(e){
			e.preventDefault();
		});
	};
	
	
	$.fn.enter=function(action){
		var $this=$(this);
		$this.data("enter", action);
		$this.addClass("__ap_enter_binded");
		
		$(this).keydown(function(e){
			// Enter was pressed without shift key
			var key=e.keyCode? e.keyCode:e.which;
			if (key == AP.key.enter && !e.shiftKey){
				var id=$this.attr('id');
				if (id){
					var $tid=$("#__tag_"+id);
					if ($tid.length && $tid.is(":visible")){
						return;
					}
				}
				
				// prevent default behavior
				e.preventDefault();
				action.apply(this);
			}
		});
		
		return $this;
	};
	
	
	$.fn.updown=function(selections, select){
		var $this=$(this);
		$(selections).eq(0).addClass("active");
		$this.data("__updown", 0);
		
		$this.keydown(function(e){
			// Enter was pressed without shift key
			var key=e.keyCode? e.keyCode:e.which;
			var move=0;
			if (key==AP.key.up){
				move=-1;
			}
			if (key==AP.key.down){
				move=1;
			}
			
			if (move){
				e.preventDefault();
				var cur=$this.data("__updown");
				if (!cur){
					cur=0;
				}
				
				cur=parseInt(cur)+move;
				if (cur>=$(selections).filter(":visible").length){
					cur=$(selections).filter(":visible").length-1;
				}
				
				if (cur<0){
					cur=0;
				}
				
				if (cur<0 || !$(selections).length){
				}else{
					$this.data("__updown", cur);
					$(selections).removeClass("active");
					$(selections).filter(":visible").eq(cur).addClass("active");
					var $cx = $(selections).filter(":visible").eq(cur);
					
					if ($cx.parent().hasClass("scroll-y")){
						var current_s = $cx.parent().scrollTop();
						var current_o = $cx.position().top;
						var ch = $cx.parent().height();
						
						if (current_s + current_o + $cx.height() > ch){
							$cx.parent().scrollTop(current_o+current_s+$cx.height());
						}else if (current_o <0){
							$cx.parent().scrollTop(0);
						}
						
					}
				}
			}
			
			if (key==AP.key.enter){
				var x=$this.data("__updown");
				var elem=$(selections).eq(x);
				select.apply($this, [elem, x]);
			}
		});
		
		
		$(selections).each(function(){
			$(this).click(function(){
				select.apply($this, [this, $(this).index()]);
			})
		});
		
		return $this;
	};
	
	
	$.fn.triggerEnter=function(){
		var action=$(this).data("enter");
		action.apply(this);
	};
	
	
	$.fn.disableTab=function(){
		$(this).keydown(function(e) {
			if (e.keyCode === 9) {
				// get caret position/selection
				var start = this.selectionStart;
					end = this.selectionEnd;

				var $this = $(this);

				// set textarea value to: text before caret + tab + text after caret
				$this.val($this.val().substring(0, start)
							+ "	"
							+ $this.val().substring(end));

				// put caret at right position again
				this.selectionStart = this.selectionEnd = start + 4;

				// prevent the focus lose
				return false;
			}
		});
	};
	
	
	$.fn.caret2=function(){
		return new APCaret(this);
	};
	
	
	$.fn.ajaxShow=function(){
		$(this).addClass("__disabled").append("<div class='__ajaxshow "+(Client.darkmode?'-dark':'')+"'><span class='__icon -ap icon-spinner7 ficon-spinner'></div></div>");
	};
	
	$.fn.ajaxHide=function(){
		$(this).removeClass("__disabled").find(".__ajaxshow").remove()
	};
	
	$.fn.ajaxOn=function(){
		return $(this).hasClass("__disabled");
	};
	
	$.fn.ajaxFake = function(callback, duration){
		if (!duration){
			duration = 200;
		}
		
		var $this = $(this);
		
		$this.ajaxShow();
		setTimeout(function(){
			$this.ajaxHide();
			if (callback){
				callback();
			}
		}, duration);
	};
	
	
	$.fn.shortlist=function(opts){
		if (AP.data.isInt(opts)){
			opts = {max: opts};
		}
		
		$.extend({max: 10}, opts);
		
		if ($(this).children().length <= opts.max){
			return;
		}
		
		var rem=$(this).children().length-opts.max;
		
		$(this).data("max", opts.max).after("<div class='js-show-more show-more is-more'><span>{{Show more}} ("+(rem)+")</span></div>");
		$(this).children().each(function(index){
			if (index<opts.max){
			}else{
				$(this).addClass("hidden");
			}
		});
		
		$(this).next().click(function(){
			var $prev=$(this).prev();
			$prev.children().each(function(index){
				if (index<$prev.data("max")){
				}else{
					$(this).toggleClass("hidden");
				}
			});
			
			if ($(this).hasClass("is-more")){
				$(this).removeClass("is-more");
				$(this).find("span").html("{{Show less}}");
			}else{
				var rem=$prev.children().length-$prev.data("max");
				$(this).addClass("is-more");
				$(this).find("span").html("{{Show more}} ("+rem+")"); 
			}
		});
	};
	
	
	/**
	 * @desc Animate and back to the original state
	 */
	$.fn.animateX=function(styles, seconds, xstyles){
		if (!xstyles){
			xstyles={};
		}
		var cstyles={};
		for (var s in styles){
			cstyles[s]=$(this).css(s);
		}
		
		xstyles=$.extend({}, cstyles, xstyles);
		
		$(this).animate(styles, seconds*1000, function(){
			$(this).animate({opacity: "1.0"}, seconds*3000, function(){
				$(this).animate(xstyles, seconds*1000);
			});
		});
	};
	
	
	
	/**
	 * @desc Simplified version of AP.loadURL. Only load html with inline CSS. No change on
	 * the state of the document. Put the html directly to the given element.
	 */
	$.fn.loadHTML=function(url, callback, data){
		$("#ajax-load").show();
		
		var $this=$(this);
		if (!AP.word.prefix(url,'http')){
			url=Client.url+'/'+url;
		}
		
		AP.post(url,{},function(code){
			if (code.good()){
				$.log('Loading HTML '+url);
				
				// Loading css
				for (var i=0; i<code._css.length; i++){
					AP.css(code._css[i]);
				}
				
				$this.html(code._html);
				if (code._inpage_js){
					eval(code._inpage_js);
				}
				if (callback){
					callback(data);
				}
				$("#ajax-load").hide();
			}else{
				if (code.data && code.data.force_redirect){
					AP.redirect(code.data.force_redirect);
					return;
				}
				$("#ajax-load").hide();
			}
		}, true);
		
		return $this;
	};
	
	
	
	/**
	 * @desc Set a flag on variable. If flag is not set, set it to 1.
	 */
	$.fn.apv=function(){
		return AP.html.input(this);
	};
	
	
	/**
	 * @desc Set a flag on variable. If flag is not set, set it to 1.
	 */
	$.fn.xval=function(name, value){
		if (typeof value =='undefined'){
			return AP.html.input(this, name);
		}
		
		return $("*[name="+name+"]", this).val(value);
	};
	
	
	$.fn.restore=function(){
		$(this).each(function(){
			$(this).blur();
			if ($(this).hasClass('__autoresized') && $(this).attr('id')){
				var id=$(this).attr('id');
				var newid='#'+id+"__temptextarea";
				$(newid).html("");
				plugin_textarea_update('#'+id, newid);
				
				var orgh=$('#'+id).data("orgheight");
				if (orgh && parseInt(orgh) && $(this).tagName()!="input"){
					$('#'+id).css("height", orgh);
				}
			}
		});
		
		return this;
	};
	

	/**
	 * @desc Event when a child element is dragged outside its container.
	 */
	$.fn.dragOut=function(container, callback){
		$(this).draggable({
			start: function(event, ui) {
				ui.helper.removeMe = true;
			},
			stop: function(event, ui) {
				if (ui.helper.removeMe) {
					callback(this);
				}
			},  
			revert: true,
			stack:'body',
			zIndex:9999
		});
		
		
		$(container).droppable({
			drop: function(event, ui) {
				// unset removeMe flag as child is still inside parent
			   ui.helper.removeMe = false;
			}
		});
	};
	
	
	
	/**
	 * @desc Trigger an action when click outside.
	 */
	$.fn.clickOut=function(callback, canvas){
		var $elem=$(this);
		if (canvas){
			$(canvas).on('click',function(event){
				if (!$(event.target).closest($elem).length){
					callback.apply($elem, event);
				}
			});
			
			return;
		}
		
		$(document.body).on('click.__temp',function(event){
			if (!$(event.target).closest($elem).length){
				callback.apply($elem, [event]);
			}
		});
	};
	
	
	$.fn.loadedAll=function(callback, params){
		var total_images=$(this).length;
		var num_loaded=0;
		
		$(this).each(function(){
			if ($(this).height()>0){
				num_loaded++;
				if (num_loaded==total_images){
					callback(params);
				}
			}else{
				$(this).bind('load.__temp, error.__temp', {all_callback: callback, all_params:params}, function(event){
					num_loaded++;
					if (num_loaded==total_images){
						var cb=event.data.all_callback;
						cb(event.data.all_params);
					}
				});
			}
		});
	};
	
	
	/**
	 * @desc Get the smallest matched data-{name}
	 */
	$.fn.lastID=function(name){
		if (!name){
			name="id";
		};
		
		var last=0;
		
		$(this).each(function(){
			var val=parseInt($(this).data(name));
			if (!val){
				return;
			}
			
			if (val < last || last==0){
				last=val;
			}
		});
		
		return last;
	};
	
	/**
	 * Set Active. Matching either index or classname.
	 */
	$.fn.setActive=function(chosen){
		if (AP.isInt(chosen)){
			$(this).each(function(index){
				$(this).removeClass('active');
				if (index==chosen){
					$(this).addClass('active');
				}
			});
		}else{
			if (chosen == ":first"){
				$(this).first().addClass("active");
				return;
			}
			
			if (chosen == ":last"){
				$(this).last().addClass("active");
				return;
			}
			
			$(this).each(function(){
				$(this).removeClass('active');
				if ($(this).is(chosen)){
					$(this).addClass('active');
				}
			});
		}
	};
	
	
	/**
	 * Set Active. Matching either index or classname.
	 */
	$.fn.getActive=function(){
		var found=null;
		$(this).each(function(){
			if ($(this).hasClass('active')){
				found=$(this);
				return;
			}
		});
			
		return found;
	};
	
	
	$.fn.setActiveURL=function(url){
		if (AP.data.isFunction(url)){
			var fn=url;
			$(this).each(function(){
				var curl=$(this).data("url");
				if (!curl || !curl.length){
					curl=$(this).data("xurl");
				}
				if (!curl){
					curl="";
				}
				
				var data={};
				var parts=curl.split("?");
				if (parts.length==2){
					data=queryStringToArray(parts[1]);
				}
				
				if (fn.apply(this, [curl, data])){
					$(this).addClass("active");
				}else{
					$(this).removeClass("active");
				}
			});
			return;
		}
		
		var base="";
		var fallback=null;
		if (AP.data.isObject(url) && url.base){
			base=url.base+"/";
		}
		
		if (AP.data.isObject(url) && url.fallback){
			fallback=url.fallback;
		}
		
		var maxscore=-1;
		var set=0;
		if (url && url.length && !AP.data.isObject(url)){
			
			$(this).each(function(){
				var curl=$(this).data("url");
				if (!curl || !curl.length){
					curl=$(this).data("xurl");
					curl=base+curl;
				}
				
				if (curl==url){
					// set = 1;
					$(this).addClass("active");
				}else{
					$(this).removeClass("active");
				}
			});
		
			return;
		}
		
		$(this).each(function(){
			var turl=$(this).data("url");
			if (!turl){
				turl=base+$(this).data("xurl");
			}
			var score=computeURLSimilarity(turl);
			
			$(this).data("active-score", score);
			if (score>maxscore){
				maxscore=score;
			}
		});
		
		
		$(this).each(function(){
			if (set){
				// return;
			}
			
			if ($(this).data("active-score")== maxscore && maxscore>0){
				set=1;
				$(this).addClass('active');
			}else{
				$(this).removeClass('active');
			}
		});
		
		if (!set && fallback){
			
			if (fallback==":first"){
				$(this).first().addClass("active");
				return;
			}
			
			$(this).each(function(){
				var turl=$(this).data("url");
				if (!turl){
					turl=$(this).data("xurl");
				}
				
				if (turl==fallback){
					$(this).addClass('active');
				}else{
					$(this).removeClass('active');
				}
			});	
		}
	};
	
	
	$.fn.setActiveURLParam=function(param, df){
		var _df=df;
		
		if (AP.data.isObject(df)){
			if ("fallback" in df){
				_df=df.fallback;
			}
			
			if ("df" in df){
				_df=df.df;
			}
		}
		
		var found=0;
		$(this).each(function(){
			var curl=$(this).data('url');
			if (!curl || !curl.length){
				curl=$(this).data("xurl");
			}
			
			if (!curl || !curl.length){
				curl=$(this).data("updateurl");
			}
			
			if (!curl && $(this).data("urlparam")==param){
				curl=param+"="+$(this).data("value");
			}
			
			
			if (!curl){
				$(this).removeClass('active');
				return;
			}
			
			var cq=Query.get(param);
			if (typeof(cq) == 'undefined' || cq===null){
				if (AP.data.isObject(df)){
					cq= df.value;
				}
			}
			
			
			var reg=new RegExp(param+"="+cq+"$"); 
			var reg2=new RegExp(param+"="+cq+"[\&\?]");
			
			var df_reg1=null;
			var df_reg2=null;
			
			if (df && AP.data.isString(df)){
				df_reg1=new RegExp(param+"="+_df+"$"); 
				df_reg2=new RegExp(param+"="+_df+"[\&\?]");	
			}
			
			if (curl.match(reg) || curl.match(reg2)){
				found=1;
				$(this).addClass('active');
			}else if (df_reg1 && df_reg2 && curl.match(df_reg1) || curl.match(df_reg2)){
				found=1;
				$(this).addClass('active');
			}else{
				$(this).removeClass('active');
			}
		});
		
		if (!found){
			if (_df==""){
				$(this).each(function(){
					if ($(this).data("value")=="" || typeof $(this).data("value") == "undefined"){
						$(this).addClass("active");
					}
				});
			}else{
				$(this).setActive(_df);	
			}
			
			
		}

		
		return this;
	};
	
	
	
	$.fn.setActiveURLQuery=function(param, defaults){
		var maxscore=-1;
		var set=0;
		
		if (param && defaults){
			$(this).each(function(){
				var curl=$(this).data("url");
				if (!curl || !curl.length){
					curl=$(this).data("xurl");
				}
				if (!curl || !curl.length){
					curl=$(this).data("updateurl");
				}
				
				var qs=Query.get(param);
				if (!qs){
					qs=defaults;
				}
				
				qs=param+"="+qs;
				
				if (curl.indexOf(qs)!=-1){
					$(this).addClass('active');
				}else{
					$(this).removeClass('active');
				}
			});
			return;
		}
	};
	
	
	/**
	 * @desc Set active based on data-{key}={value}
	 */
	$.fn.setActiveData=function(key, value){
		$(this).each(function(){
			var v=$(this).data(key);
			if ((!v && !value) || AP.data.equal(v, value)){
				$(this).addClass("active")
			}else{
				$(this).removeClass("active")
			}
		});
	};
	
	
	
	/**
	 * Set Active. Matching either index or classname.
	 */
	$.fn.setChecked=function(chosen){
		if (AP.isInt(chosen)){
			$(this).each(function(index){
				$(this).removeClass('checked');
				if (index==chosen){
					$(this).addClass('checked');
				}
			});
		}else{
			$(this).each(function(){
				$(this).removeClass('checked');
				if ($(this).is(chosen)){
					$(this).addClass('checked');
				}
			});
		}
	};
	
	
	/**
	 * Show only element with index or classname. Hide all others.
	 */
	$.fn.showOnly=function(chosen){
		if (AP.isInt(chosen)){
			$(this).each(function(index){
				if (index==chosen){
					$(this).show('active');
				}else{
					$(this).hide();
				}
			});
		}else{
			$(this).each(function(){
				if ($(this).is(chosen)){
					$(this).show();
				}else{
					$(this).hide();
				}
			});
		}
	};
	
	
	
	/**
	 * Toggle Active. Matching either index or classname.
	 */
	$.fn.toggleActive=function(chosen){ 
		if (AP.isInt(chosen)){
			$(this).each(function(index){
				if (index==chosen){
					$(this).toggleClass('active');
				}else{
					$(this).removeClass('active');
				}
			});
		}else{
			$(this).each(function(){
				if ($(this).is(chosen)){
					$(this).toggleClass('active');
				}else{
					$(this).removeClass('active');
				}
			});
		}
	};
	   
	
	
	/**
	 * Set Active. Matching either index or classname.
	 */
	$.fn.setPage=function(chosen){
		if (AP.isInt(chosen)){
			$(this).children().each(function(index){
				$(this).hide();
				if (index==chosen){
					$(this).show();
				}
			});
		}else{
			$(this).children().each(function(index){
				$(this).hide();
				if ($(this).hasClass(chosen)){
					$(this).show();
				}
			});
		}
	};
	
	
	/**
	 * @desc Set the tooltip value of an element, provided that the tooltip is
	 * already enabled for that element
	 */
	$.fn.setTooltip=function(val){
		$(this).each(function(){
			$(this).find('.__tooltip_inner').html(val);
		});
	};
	
	$.fn.tooltip=function(child, _options){
		if (!_options){
			_options={};
		}
		

		// $(this).addClass('__hblock');
		
		$(this).each(function(){
			var $p=$(this);
			$p.find(child).each(function(){
				var options=$.extend({},{dir: 'down', color: 'black', align: 'center', padding: 8},_options);
				if ($(this).hasClass('__tooltip')){
					return;
				}
				
				var v_color=$(this).data("color");
				if (v_color){
					options.color=v_color;
				}
				
				var v_align=$(this).data("align");
				if (v_align){
					options.align=v_align;
				}
				
				var v_dir=$(this).data("dir");
				if (v_dir){
					options.dir=v_dir;
				}
				
				var v_pad=$(this).data("padding");
				if (v_pad){
					options.padding=v_pad;
				}
				
				var padding=options.padding;
				
				if ($(this).hasClass('padding_less')){
					padding=4;
				}
				$(this).addClass('__tooltip').addClass('__tooltip'+options.color);
				$(this).wrapInner("<div class='__tooltip_inner' style='padding: "+padding+"px'/>");
				
				
				
				var align;
				if (options.align=='right' || $(this).hasClass('align_right')){
					align='right';
					$(this).css('right', -20);
				}else if (options.align=='left' || $(this).hasClass('align_left')){
					align='left';
					$(this).css('left', -20);
				}else if (options.align=='center' || $(this).hasClass('align_center')){
					align='center';
					var tl=$(this).outerWidth(true)- $p.outerWidth(true);
					$(this).css('left', -tl/2.0);
				}
				
				$(this).addClass('__tooltip'+align);
				
				if (options.dir=='down'){
					$("<div class='__ttarr_down2'></div>").appendTo($(this)).css('bottom', 7);
					$("<div class='__ttarr_down'></div>").appendTo($(this)).css('bottom', 9);
				}
			});
			$(this).addClass('__tooltipw');
		});
		
		// $(this).removeClass('__hblock');
	};
	
	
	
	$.fn.contextMenu=function(selector){
		if (!selector){
			selector=".__ctm";
		}
		$(this).each(function(){
				$(this).bind("contextmenu",function(e){
				e.stopPropagation();
				e.preventDefault();
				$("#__ctm").cleanUp().css({top: e.pageY, left: e.pageX}).show();
				
				var elem=$(this).find(selector).first();
				elem.addClass('__contextmenu');
				$(elem).clone().appendTo('#__ctm').show();
			});
			$(this).find(selector).hide();
		});
		return $(this);
	};
	
	

	$.fn.nodeName=function(){
		return $(this)[0].nodeName.toLowerCase();
	};
	
	
	$.fn.xMenu=function(selector){
		$(this).addClass('ap-pointer').addClass('ap-relative');
		$(this).find(selector).first().addClass('__contextmenu').hide();
		$(this).each(function(){
				$(this).bind("click",function(e){
				e.stopPropagation();
				e.preventDefault();
				$(this).find(selector).first().toggle();
			});
		});
	};
	
	
	$.fn.place=function(data){
		$(this).find(".__ph").each(function(){
			var name=$(this).data("name");
			if (data[name]){
				$(this).html(data[name]);
			}
		});
		
		return this;
	};
	
	
	
	$.fn.showCode=function(lang){
		$(this).each(function(){
			var $this=$(this);
			var id=$this.attr('id');
			if (!id){
				id=AP.uuid();
				$this.attr('id', id);
			}
			
			var text=$this.text();
			
			text=AP.word.replaceAll("&#8216;","'", text);
			text=AP.word.replaceAll("&#8217;","'", text);
			text=AP.word.replaceAll("â","'", text);
			text=AP.word.replaceAll("â","'", text);
			text=AP.word.replaceAll("\t","	", text);
			
			
			$this.html("<pre><code></code></pre></div>");
			var $code=$this.find('code');
			$code.text(text);
			
			
			// $this.html(text);
			
			
			if (!lang){
				lang="php";
			}
			$code.addClass(lang);
			$code.parent().addClass('__codehl compact');
			
			SyntaxHighlighter.highlightDocument($code[0],false);
			
//			text=$this.html();
//			
//			if (text){
//				text=AP.word.replaceAll("\t","&nbsp;&nbsp;&nbsp;", text);
//				text=AP.word.replaceAll("\n","<br>", text);
//				$this.html(text);
//			}
			
			$("li:first-child",$this).addClass('first');
			$("li:last-child",$this).addClass('last');
			
			var $p=$code.parent();
			$p.parent().prepend("<div class='codeheader'>" +
				"<div class='code-title'>Embedded code</div>" +
				"<div class='code-button' onclick=\"$('#"+id+"').toggleClass('__codehlx');\">Highlighted code</div> " +
				"<div class='code-button' onclick=\"$('#"+id+"').toggleClass('__codehlx');\">View sources</div> " +
			"</div>");
			
			var h=$this.height();
			var lx="";
			for (var i=0; i< h/25+1; i++){
				var ln=i;
				if (ln<10){
					ln='00'+ln;
				}else if (ln<100){
					ln='0'+ln;
				}
				if (ln==0){
					lx+="<div class='number-sep'></div>";	
				}else{
					lx+="<div class='number'><div>"+ln+"</div></div>";	
				}
			}
			$code.append("<div class='linenumbers'>"+lx+"</div>");
		});
	};
	
	
	$.fn.setCursorPosition = function(pos) {
		if ($(this).get(0).setSelectionRange) {
			$(this).get(0).setSelectionRange(pos, pos);
		}else if ($(this).get(0).createTextRange) {
			var range = $(this).get(0).createTextRange();
			range.collapse(true);
			range.moveEnd('character', pos);
			range.moveStart('character', pos);
			range.select();
		}
	 };
	
	 
	 $.fn.chartjs=function(data, options){
		if (!options){
			options={};
		}
		 
		if ($(this).data('cheight')){
			options.height=$(this).data('cheight');
		}
		
		options=$.extend({},{width:$(this).width(), type: "line"}, options);
		var optx="";
		for (var key in options){
			optx+=key+"="+options[key]+" ";
		}
		
		
		$(this).children().remove();
		var id=AP.uuid();
		$("<canvas id='"+id+"' "+optx+"></canvas>").appendTo(this);
		
		var ctx = $('#'+id).get(0).getContext("2d");
		
		var myChart = new Chart(ctx, {
			type: options.type,
			data: data,
			options: options
		});
		var myChart = new Chart(ctx);
		return myChart;
	};
	
	

	$.fn.chartjsv2 = function(options, data, extOptions){
		if (!options){
			options={};
		}
		 
		if ($(this).data('cheight')){
			options.height=$(this).data('cheight');
		}
		
		options=$.extend({},{width:$(this).width()},options);
		var optx="";
		for (var key in options){
			optx+=key+"="+options[key]+" ";
		}
		
		
		$(this).children().remove();
		var id=AP.uuid();
		$("<canvas id='"+id+"' "+optx+"></canvas>").appendTo(this);
		
		var ctxP = $('#'+id).get(0);
		
		if (typeof ctxP == 'undefined' || !ctxP) {
			return null;
		}
		var ctx = ctxP.getContext("2d");
		var myNewChart = new Chart(ctx, {
			type: 'line',
			data: data,
			options: extOptions
		});
		return myNewChart;
	};
	
	
	$.fn.caret=function(){
		return new CaretHandler(this);
	};
	
})(jQuery);



function __linkifyNode(node) {
	var _len = node.childNodes.length;
	for (var i=0; i<_len; i++) {
	  if (node.childNodes[i].nodeType == document.ELEMENT_NODE) {
		__linkifyNode(node.childNodes[i]);
	  }
	}
	
	var texts = [];
	for (i=0; i<_len; i++) {
	  if (node.childNodes[i].nodeType == document.TEXT_NODE) {
		if (node.nodeName.toLowerCase()!="a"){
			texts.push(node.childNodes[i]);	
		}else{
			node.setAttribute("target","_blank");
			node.className += " _linkify";
		}
	  }
	}
	
	texts.forEach(function (item) {
	  if (item.nodeType == document.ELEMENT_NODE) {
		  __linkifyNode(item);
	  } else if (item.nodeType == document.TEXT_NODE) {
		while (true) {
		  var text = item.nodeValue;
		  var regex = /\bhttps?:\/\/[a-z0-9\.\-_](:\d+)?[^ \n\t<>()\[\]]*/i;
		  var match = regex.exec(text);
		  if (! match) {
			break;
		  }
		  var leadingNode = document.createTextNode(text.substr(0, match.index));
		  node.replaceChild(leadingNode, item);
		  var anchor = document.createElement("a");
		  anchor.setAttribute("target", "_blank");
		  anchor.className += " _linkify";
		  anchor.href = match[0];
		  anchor.appendChild(document.createTextNode(match[0]));
		  node.insertBefore(anchor, leadingNode.nextSibling);
		  var trailing = document.createTextNode(text.substr(match.index + match[0].length));
		  node.insertBefore(trailing, anchor.nextSibling);
		  item = trailing;
		}
	  }
	});
}









jQuery.extend({
	apScript: function(url, callback, id) {
	   var head = document.getElementsByTagName("head")[0];
	   var script = document.createElement("script");
	   script.src = url;
	   if (id){
		   script.id=id;
	   }
	
	   // Handle Script loading
	   {
		  var done = false;
	
		  // Attach handlers for all browsers
		  if (script.addEventListener){
			  script.addEventListener("load",function(){
				  if (done){
					  return;
				  }
				  done = true;
				  if (callback) callback();
			  },false);
		  }else if (script.readyState){
			  script.onreadystatechange = function(){
				 if (!done && (this.readyState == "loaded" || this.readyState == "complete" || this.readyState==4)) {
					done = true;
					if (callback)
					   callback();
		
					// Handle memory leak in IE
					script.onload = script.onreadystatechange = null;
				 }
			  };
		  }
	   }
	
	   head.appendChild(script);
	
	   // We handle everything using the script element injection
	   return undefined;
	}

});




function __fn_input_text_suggest(ref){
	var text=$(ref).text();
	
	$box=$(ref).closest(".__input-suggestion-canvas").parent();
	$box.find("input").val(text);
	// $box.find(".__input-suggestion-canvas").hide();
};



function __fn_input_suggest(ref){
	var $box=$(ref).closest(".__input-suggestion-canvas").parent();
	var options=$box.data("options");
	
	
	if (!options.multi || $(ref).data("all")){
		$box.removeClass("__iss");
		$box.closest(".row").removeClass("__ft");
		$box.find(".__input-suggestion-row").removeClass("active");
		
		$(ref).addClass("active");
		var val=$(ref).data("id");
		var text=$(ref).text();
		$box.find("input.__input-suggestion-target").val(val);
		$box.find("input.__input-suggestion-fake").val($(ref).text());
		$box.find("input.__input-extra-fx").val("");
		
		return;
	}
	
	
	var vals=$box.find("input.__input-suggestion-target").val().split(",");
	var id=$(ref).data("id");
	
	

	var found=false;
	for (var i=0; i<vals.length; i++){
		if ($.trim(vals[i])==id){
			found=1;
			break;
		}
	}
	
	if (found){
		$(ref).removeClass("active");
	}else{
		$(ref).addClass("active");
	}
	
	
	var ids=[];
	var ts=[];
	$box.find(".__input-suggestion-row").each(function(){
		if ($(this).data("all")){
			$(this).removeClass("active");
			return;
		}
		
		if ($(this).hasClass("active")){
			ts.push($(this).text());
			ids.push($(this).data("id"));
		}
	});
	
	
	$box.find("input.__input-suggestion-target").val(ids.join(", "));
	$box.find("input.__input-suggestion-fake").val(ts.join(", "));
	$box.find("input.__input-extra-fx").val("");
};


function computeURLSimilarity(url){
	if (!url){
		return 0;
	}
	
	if (!AP.data.isString(url)){
		url=""+url;
	}
	
	var data={};
	var parts=url.split("?");
	if (parts.length==2){
		data=queryStringToArray(parts[1]);
	}
	
	var current=Client.path.current;
	
	if (!current){
		current="home";
	}
	
	var base=0;
	
	if (parts.length==1){
		if (parts[0]==current){
			return 2;
		}
		
		var cindex = current.indexOf(parts[0]);
		
		if (cindex!=-1){
			if (parts[0].length){
				return 1+(1.0*parts[0].length/(parts[0].length+1))*(1/(cindex+1));
			}
			return 1;
		}
	}else{
		if (url==current){
			return 3;
		}
	}
	
	var score=0;
	if (parts[0]==Client.path.full.join("/")){
		score=1;
	}
	
	var same=true;
	for (var key in data){
		if (data[key]!=Query.get(key)){
			same=false;
			break;
		}
	}
	
	if (!same){
		return 0;
	}
	

	for (var key in Query.all()){
		if (data[key] && data[key]===Query.get(key)){
			score++;
		}
	}
	
	return score;
};



function fn_cancel_tag(id){
	var tid="__tag_"+id;
	$("#"+tid).hide();
};



function plugin_textarea_init(id, xtemp){
	var temp='__temp ';
	if (xtemp){
		temp='';
	}
	
	var newid=id.substr(1)+"__temptextarea";
	var tagflag=$(id).data("tag");
	if (!AP.html.exist("#"+newid)){
		$(id).css("overflow","hidden").addClass('__autoresized');
		$(id).data("orgheight", $(id).height());
		
		if (tagflag=="none"){
			$("<div class='"+temp+" ap-block' id='"+newid+"'></div>").appendTo("#ap-invs");
		}else{
			$("<pre class='"+temp+" ap-block' id='"+newid+"'></pre>").appendTo("#ap-invs");	
		}
		$("#"+newid).cloneCSS(id, "lineHeight, fontSize, fontFamily, fontWeight, boxModel");
		
		$("#"+newid).css("width", $(id).width());
		$("#"+newid).css("min-height", $(id).height());
		

		$(id).on('keypress keyup keydown', function(){
			if ($(id).data('tagname')=='textarea'){
				$("#"+newid).css("width", $(id).width());
				$("#"+newid).css("fontSize", $(id).css('fontSize'));	
			}
			plugin_textarea_update(id, "#"+newid);
		});	
	}else{
		console.error("EXIST #"+newid);
	}
};



function plugin_textarea_update(id, newid){
	if (!newid){
		newid="#"+id.substr(1)+"__temptextarea";
	}
	
	var $this=$(id);
	
	var taggable=$this.data("tag");
	var v=$this.val();
	var tagname=$this[0].nodeName.toLowerCase();
	
	if ($(id).data("autoexpand") && $(id).data("maxheight")){
		var orgh=$(newid).height();
		var maxh=$(id).data("maxheight");
		var pd=parseInt($(id).css('padding-top').replace(/[^-\d\.]/g, ''));
		
		if (orgh<maxh){
			$(id).css("height", orgh+2*pd);
		}else{
			$(id).css("height", maxh);
		}
	}
	
	if (taggable=='none' && tagname!='input'){
		v=AP.word.replaceAll("\n","<br>", v);
		v=AP.word.replaceAll("<","&lt;", v);
		v=AP.word.replaceAll(">","&gt;", v);
		
		$(newid).html(v+"&nbsp;");
		
		var mh=$this.data("max-height");
		var ch=$this.height();
		
		var h=$(newid).height();

		if (ch!=h){
			$this.trigger("expand",[ch, h]);
		}
		
		if (!mh || h<mh){
			$this.css("height",h).css("overflow","hidden");
		}else{
			$this.css("height",mh).css("overflow","auto");
		}
	}else{
		var pos=plugin_get_caret_position(id);
		
		if (pos>=0 && pos<=v.length){
			var ch="";
			// Set current word to data("current.word");
			var head="";
			for (var j=pos-1; j>=0; j--){
				var ch=v.charAt(j);
				if (ch!=' ' && ch!="\n" && ch!='>'  && ch!='<' && ch!=',' && ch!='.'){
					head=ch+head;
					if (ch=='@'){
						break;
					}
				}else{
					break;
				}
			}
			
			var tail="";
			for (var j=pos; j<v.length; j++){
				var ch=v.charAt(j);
				if (ch!=' ' && ch!="\n" && ch!='>'  && ch!='<' && ch!=',' && ch!='.'){
					tail=tail+ch;
					if (ch=='@'){
						break;
					}
				}else{
					break;
				}
			}
			
			
			$this.data("current_word",head+tail);
		}
		
		if (pos<v.length){
			v=v.substr(0,pos+1)+"<span></span>"+v.substr(pos+1, v.length-pos-1);
		}else{
			if (v.charAt(v.length-1)!='\n'){
				v=v+"<span></span>";
			}else{
				v=v+"<span></span>&nbsp;";
			}
		}
		
		if (tagname!='input'){
			v=AP.word.replaceAll("<","&lt;", v);
			v=AP.word.replaceAll(">","&gt;", v);
			v=AP.word.replaceAll("\n","<br>", v);
			v=AP.word.replaceAll("&lt;span&gt","<span>", v);
			v=AP.word.replaceAll("&lt;/span&gt","</span>", v);
			
			$(newid).html(v);
			var mh=$this.data("max-height");
			
			var h=$(newid).height();
			if (!mh || h<mh){
				if (Client.native){
					$(id).css("overflow","hidden");
				}else{
					$(id).css("overflow","hidden");	
				}
			}else{
				$(id).css("overflow","auto");
			}	
		}
	}
};



function plugin_textarea_update_simple(id, newid){	
	if (!newid){
		newid="#"+id.substr(1)+"__temptextarea";
	}
	
	var v=$(id).val();
	v=AP.word.replaceAll("\n","<br>", v);
	$(newid).html(v);
	
	var mh=$(id).data("max-height");
	var h=$(newid).height()+32;
	
	
	if (!mh || h<mh){
		$(id).css("height",h).css("overflow","hidden");
	}else{
		$(id).css("height",mh).css("overflow","auto");
	}
};




function plugin_tag_textareacursor(id){
	var newid=id.substr(1)+"__temptextarea";
	var pos=$("#"+newid+" span").position();
	
	return {top: pos.top, left: pos.left, width: $("#"+newid).width(), height: $("#"+newid).height()};
};



function plugin_select_updown_first($obj){
	if (!$obj.is(":visible")){
		return;
	}
	
	$obj.children().each(function(index){
		if (index==0){
			$(this).addClass('__tagactive');
		}
	});
	
	$obj.data('aptag_cindex', 0);
};


function plugin_select_updown_down($obj){
	if (!$obj.is(":visible")){
		return;
	}
	
	var cindex=$obj.data('aptag_cindex');
	var maxlen=$obj.children().length;
	
	if (maxlen==0){
		return;
	}
	
	if (cindex<maxlen-1){
		cindex++;
	}else{
		cindex=0;
	}
	
	var val='';
	$obj.children().each(function(index){
		if (AP.data.equal(index,cindex)){
			val=$(this).data('value');
			$(this).addClass('__tagactive');
		}else{
			$(this).removeClass('__tagactive');
		}
	});
	
	$obj.data('aptag_cindex', cindex);
	
	var id="#"+$obj.attr('id').substr(6);
	plugin_tag_select(id, val);
};



function plugin_select_updown_up($obj){
	if (!$obj.is(":visible")){
		return;
	}
	var cindex=$obj.data('aptag_cindex');
	var maxlen=$obj.children().length;
	
	if (maxlen==0){
		return;
	}
	
	if (cindex>0){
		cindex--;
	}else{
		cindex=maxlen-1;
	}
	
	var val='';
	
	$obj.children().each(function(index){
		if (index==cindex){
			val=$(this).data('value');
			$(this).addClass('__tagactive');
		}else{
			$(this).removeClass('__tagactive');
		}
	});
	
	$obj.data('aptag_cindex', cindex);
	
	var id="#"+$obj.attr('id').substr(6);
	plugin_tag_select(id, val);
};



function plugin_select_updown_enter($obj){
	if (!$obj.is(":visible")){
		return;
	}
	
	var cindex=$obj.data('aptag_cindex');
	var maxlen=$obj.children().length;
	
	if (maxlen==0 || cindex>=maxlen){
		return;
	}
	
	$obj.children().eq(cindex).click();
	$obj.hide();
	
	var select_fn=$obj.data("onselect");
	
	if (select_fn){
		select_fn($obj.children().eq(cindex).data("value"));
	}
};



function plugin_tag_select(id, replaced){
	if ($(id).data("single-tag")){
		$(id).val($.trim(replaced));
		return;
	}
	
	// $(id).next('.__ap_xauto').hide();
	if (!$(id).length){
		return;
	}
	
	var v=$(id).apv();
	var pos=plugin_get_caret_position(id);
	
	var compact=($(id).data("compacttagging")==1 || $(id).data("compacttagging")=='1');
	
	var start=-1;
	var end=v.length;
	if (!v){
		return;
	}
	
	if (compact){
		if (v.indexOf(' ')==-1){
			start=0;
		}else{
			if (pos>=0 && pos<=v.length){
				var ch="";
				// Set current word to data("current.word");
				var head="";
				for (var j=pos-1; j>=0; j--){
					ch=v.charAt(j);
					if (ch!="\n" && ch!='>'  && ch!='<' && ch!=',' && ch!='.'){
						if (ch==' '){
							start=j;
							break;
						}
					}else{
						break;
					}
				}
				
				for (var j=pos; j<v.length; j++){
					var ch=v.charAt(j);
					if (ch!=' ' && ch!="\n" && ch!='>'  && ch!='<' && ch!=',' && ch!='.' && ch!='@'){
					}else{
						end=j;
						break;
					}
				}
			}	
		}
	}else{
		if (pos>=0 && pos<=v.length){
			var ch="";
			// Set current word to data("current.word");
			var head="";
			for (var j=pos-1; j>=0; j--){
				ch=v.charAt(j);
				if (ch!=' ' && ch!="\n" && ch!='>'  && ch!='<' && ch!=',' && ch!='.'){
					if (ch=='@'){
						start=j;
						break;
					}
				}else{
					break;
				}
			}
			
			for (var j=pos; j<v.length; j++){
				var ch=v.charAt(j);
				if (ch!=' ' && ch!="\n" && ch!='>'  && ch!='<' && ch!=',' && ch!='.' && ch!='@'){
				}else{
					end=j;
					break;
				}
			}
		}

	}
		
	
	
	if (start!=-1){
		v=v.substr(0,start)+((compact&&start>0)?" ":"")+replaced+v.substr(end, v.length-end);
		$(id).val(v);
		$(id).setCursorPosition(start+replaced.length+((compact&&start>0)?1:0));
		$(id).trigger("base-focus");
	}
};



function plugin_actual_tag_select(id, replaced){
	$(id).next('.__ap_xauto').hide();
	var v=$(id).apv();
	var pos=plugin_get_caret_position(id);
	
	var start=-1;
	var end=v.length;
	if (!v){
		return;
	}
	
	if (pos>=0 && pos<=v.length){
		var ch="";
		// Set current word to data("current.word");
		var head="";
		for (var j=pos-1; j>=0; j--){
			ch=v.charAt(j);
			if (ch!=' ' && ch!="\n" && ch!='>'  && ch!='<' && ch!=',' && ch!='.'){
				if (ch=='@'){
					start=j;
					break;
				}
			}else{
				break;
			}
		}
		
		for (var j=pos; j<v.length; j++){
			var ch=v.charAt(j);
			if (ch!=' ' && ch!="\n" && ch!='>'  && ch!='<' && ch!=',' && ch!='.'){
			}else{
				end=j;
				break;
			}
		}
	}
	
	if (start!=-1){
		v=v.substr(0,start)+replaced+v.substr(end, v.length-end-1);
		$(id).val(v);
		$(id).setCursorPosition(start+replaced.length);
	}
};



function plugin_get_caret_position(id){	
	var el = $(id)[0];
	var pos = 0;
	if ('selectionStart' in el){
		el.focus();
		pos = el.selectionStart;
	} else if ('selection' in document) {
		el.focus();
		var Sel = document.selection.createRange();
		var SelLength = document.selection.createRange().text.length;
		Sel.moveStart('character', -el.value.length);
		pos = Sel.text.length - SelLength;
	}
	return pos;
};


function plugin_textarea_insert(id, str){
	var pos=plugin_get_caret_position(id);
	var val=$(id).val();
	$(id).val(val.substr(0, pos)+str+val.substr(pos+1));
	$(id).setCursorPosition(pos+str.length);
};





(function($){
	  $.event.special.destroyed = {
		remove: function(o) {
		  if (o.handler) {
			o.handler();
		  }
		}
	  };
})(jQuery);





function choose(a, if_null){
	if (AP.data.isEmpty(a)){
		return if_null;
	}
	return a;
};





(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if (typeof f!=="boolean"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if (i&&!h){l()}h&&clearTimeout(h);if (i===c&&m>e){l()}else{if (f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if ($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);













!function(e,t){if ("function"==typeof define&&define.amd)define(["exports","module"],t);else if ("undefined"!=typeof exports&&"undefined"!=typeof module)t(exports,module);else{var n={exports:{}};t(n.exports,n),e.autosize=n.exports}}(this,function(e,t){"use strict";function n(e){function t(){var t=window.getComputedStyle(e,null);"vertical"===t.resize?e.style.resize="none":"both"===t.resize&&(e.style.resize="horizontal"),s="content-box"===t.boxSizing?-(parseFloat(t.paddingTop)+parseFloat(t.paddingBottom)):parseFloat(t.borderTopWidth)+parseFloat(t.borderBottomWidth),isNaN(s)&&(s=0),l()}function n(t){var n=e.style.width;e.style.width="0px",e.offsetWidth,e.style.width=n,e.style.overflowY=t}function o(e){for(var t=[];e&&e.parentNode&&e.parentNode instanceof Element;)e.parentNode.scrollTop&&t.push({node:e.parentNode,scrollTop:e.parentNode.scrollTop}),e=e.parentNode;return t}function r(){var t=e.style.height,n=o(e),r=document.documentElement&&document.documentElement.scrollTop;e.style.height="";var i=e.scrollHeight+s;return 0===e.scrollHeight?void(e.style.height=t):(e.style.height=i+"px",u=e.clientWidth,n.forEach(function(e){e.node.scrollTop=e.scrollTop}),void(r&&(document.documentElement.scrollTop=r)))}function l(){r();var t=Math.round(parseFloat(e.style.height)),o=window.getComputedStyle(e,null),i="content-box"===o.boxSizing?Math.round(parseFloat(o.height)):e.offsetHeight;if (i!==t?"hidden"===o.overflowY&&(n("scroll"),r(),i="content-box"===o.boxSizing?Math.round(parseFloat(window.getComputedStyle(e,null).height)):e.offsetHeight):"hidden"!==o.overflowY&&(n("hidden"),r(),i="content-box"===o.boxSizing?Math.round(parseFloat(window.getComputedStyle(e,null).height)):e.offsetHeight),a!==i){a=i;var l=d("autosize:resized");try{e.dispatchEvent(l)}catch(e){}}}if (e&&e.nodeName&&"TEXTAREA"===e.nodeName&&!i.has(e)){var s=null,u=e.clientWidth,a=null,c=function(){e.clientWidth!==u&&l()},p=function(t){window.removeEventListener("resize",c,!1),e.removeEventListener("input",l,!1),e.removeEventListener("keyup",l,!1),e.removeEventListener("autosize:destroy",p,!1),e.removeEventListener("autosize:update",l,!1),Object.keys(t).forEach(function(n){e.style[n]=t[n]}),i.delete(e)}.bind(e,{height:e.style.height,resize:e.style.resize,overflowY:e.style.overflowY,overflowX:e.style.overflowX,wordWrap:e.style.wordWrap});e.addEventListener("autosize:destroy",p,!1),"onpropertychange"in e&&"oninput"in e&&e.addEventListener("keyup",l,!1),window.addEventListener("resize",c,!1),e.addEventListener("input",l,!1),e.addEventListener("autosize:update",l,!1),e.style.overflowX="hidden",e.style.wordWrap="break-word",i.set(e,{destroy:p,update:l}),t()}}function o(e){var t=i.get(e);t&&t.destroy()}function r(e){var t=i.get(e);t&&t.update()}var i="function"==typeof Map?new Map:function(){var e=[],t=[];return{has:function(t){return e.indexOf(t)>-1},get:function(n){return t[e.indexOf(n)]},set:function(n,o){e.indexOf(n)===-1&&(e.push(n),t.push(o))},delete:function(n){var o=e.indexOf(n);o>-1&&(e.splice(o,1),t.splice(o,1))}}}(),d=function(e){return new Event(e,{bubbles:!0})};try{new Event("test")}catch(e){d=function(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!1),t}}var l=null;"undefined"==typeof window||"function"!=typeof window.getComputedStyle?(l=function(e){return e},l.destroy=function(e){return e},l.update=function(e){return e}):(l=function(e,t){return e&&Array.prototype.forEach.call(e.length?e:[e],function(e){return n(e,t)}),e},l.destroy=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],o),e},l.update=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],r),e}),t.exports=l});










(function($) {  
	
	$.fn.selectFiles=function(options){
		if (!options){
			options={};
		}
		options=$.extend({},{label:"Select Files","icon":null},options);
		if ($(this).data("label")){
			options.label=$(this).data("label");
		}
		if ($(this).data("alt-label")){
			options.alt_label=$(this).data("alt-label");
		}
		
		
		if ($(this).data("icon")){
			options.icon=$(this).data("icon");
		}

		if (!options.alt_label){
			options.alt_label=options.label;
		}
		
		
		$(this).each(function(){
			if (options.multi){
				$(this).addClass("__multi");
			}
			$(this).addClass('__file_org');
			
			var name=$(this).attr('name');
			var p=$(this).parent();
			p.addClass('__file');
			p.parent().addClass('rowfile');
			if (!p.attr('id')){
				p.attr('id',AP.uuid());
			}
			var pid=$(p).attr('id');
			
			$(this).hide();
			var temp=AP.uuid();
		
			var icon="";
			if (options.icon){
				icon="<span class='ap-f14 "+options.icon+"'></span>&nbsp; "
			}
			
			if ($(this).hasClass("__multi") || options.multi){
				$("<div class='__files hidden'></div> <div class='fl hidden'></div><div class='browse'><em data-alt_label='"+options.alt_label+"' data-prim_label='"+options.label+"'>"+icon+options.label+"</em> <input type='file' name='__tmp"+name+"' class='__browse' onchange=\"__apupload_AddFiles(this, '"+pid+"','"+name+"');\"></div>").appendTo(p);
			}else{
				$("<div class='__files hidden'></div> <div class='fl hidden'></div><div class='browse'><em data-alt_label='"+options.alt_label+"' data-prim_label='"+options.label+"'>"+icon+options.label+"</e> <input type='file' name='__tmp"+name+"' class='__browse' onchange=\"__apupload_AddOneFile(this, '"+pid+"','"+name+"');\"></div>").appendTo(p);
			}
		});
	};
	
	
	
	
	
	/**
	 * @desc Multiupload/select file
	 */
	$.fn.multiUpload=function(options, callback){
		if (options && AP.isString(options) && typeof options!='undefined'){
			return upload_apply(this, options);
		}
		
		options=$.extend({}, {show: true, close_button: false, title: "Upload Files", browse_label: "Browse", submit_label:"Finish Browsing", reset_label:"Reset Selections", hint:"Hint: You can drag your mouses or use CTRL key to select multiple files at once.", clean: false, upload_on_close: false, filename_max_length: 40, max_items: 10, name: 'file', allow:'jpg, jpeg, png, gif, pdf, doc, docx'}, options);
		if (typeof callback!='undefined'){
			options.callback=callback;
		}else{
			options.callback=null;
		}
		
		if (!$(this).flag()){
			// Setup Multi Upload
			options.queue=[];
			upload_setup(this, options);
		}
		
		if (options.clean){
			$(this).multiUpload('clean');
		};
		
		if (options.upload_on_close){
			$(this).addClass('hidden');
		}
		
		if (options.close_button){
			AP.dialog("#"+upload_container($(this).attr('id'))).canvas().find(".__dialogclose").show();
		}
		
		AP.dialog("#"+upload_container($(this).attr('id'))).show();
		
		if (options.show==false){
			AP.dialog("#"+upload_container($(this).attr('id'))).hide();
		};
		
	};
	
	
	/**
	 * @desc Add new file from input[type=file] <param fi or file input>
	 */
	$.fn.multiUpload_addFile=function(fi){
		var options=$(this).data('__ap_upload_data');
		if (!options){
			return false;
		}
		var val=$(fi).val();
		if (val && val.length>1){
			// Get filename
			var name=upload_filename(val);
			if (name){
				upload_displayFile(this, {'name': name, size:''});
			}
		}

	};
	
	
	/**
	 * @desc Add new file from input[type=file] <param fi or file input>
	 */
	$.fn.multiUpload_addMFiles=function(fi, lists){
		// Marking that we are using fileAPI.
		if ($(".__fileapi", this).length==0){
			$(this).append("<input type='hidden' name='fileapi' class='__fileapi' value='1'/>");
		}
		
		$(this).multiUpload('clean');
		
		var options=$(this).data('__ap_upload_data');
		if (!options){
			return false;
		}
		var selector=$(this).attr('id');
		
		for (var i=0; i<lists.length; i++){
			var file=lists[i];
			var name=file.name;
			if (name){
				if (name.length>=options.filename_max_length){
					name=name.substr(0, options.filename_max_length-1)+"...";
				}
				var size='';
				if (file.size){
					size=Math.floor(parseInt(file.size)/1000)+"KB";
				}
				
				// Validation
				if (options.allow && !AP.word.fileX(name, options.allow)){
					return AP.alertError("Invalid file extensions.");
				}
				
				if (options.queue.length >= options.max_items){
					$(this).multiUpload('clean');
					return AP.alertError("You've selected too many files.");
				}
				
				$("#"+upload_container(selector)+" .upload-place").append("<div class='upload-item ap-clear-fix'><div class='index'><div class='i32 i32-circle'><span>"+(options.queue.length+1)+"</span></div></div><div class='name'>"+name+"</div><div class='size'>"+size+"&nbsp;</div><div class='upload-buttons hidden'><span class='s16 s16-apb-close pointer' title='Remove this file?'></span></div><div class='ap-1fix left'></div></div>");
				options.queue.push(file.name);
			}
		}
		
		
		$("#"+upload_container(selector)+" div.browser-button input[name=ap-browser]").attr('name',''+options.name+'[]').unbind('change').appendTo(upload_area(selector));		
		$("#"+upload_container(selector)+" div.browser-button").append("<input type='file' name='ap-browser' multiple=''>");		
		
		$("#"+upload_get_counter_wrapper_id(selector)).html(options.queue.length);
		upload_setChangeHandler(selector);
		
		AP.dialog("#"+upload_container(selector)).balance();
	};
	
	
	
	var upload_apply=function(obj, fn){
		if (fn=='show'){
			AP.dialog("#"+upload_container($(obj).attr('id'))).show();
			return;
		}else if (fn=='get'){
			var options=$(obj).data('__ap_upload_data');
			if (options && options.queue){
				return options.queue;
			}
			return [];
		}else if (fn=='hide'){
			AP.dialog("#"+upload_container($(obj).attr('id'))).hide();
			upload_callback($(obj).attr('id'));
			return;
		}else if (fn=='close'){
			var options=$(obj).data('__ap_upload_data');
			if (!options){
				$.log('multi-upload fails to add file');
				return false;
			}
			if (options.upload_on_close){
				var _fn=AP.nothing;
				if (options.close_callback){
					_fn=options.close_callback;
				}
				AP.submitFrame('#'+$(obj).attr('id'), function(code){
					_fn(code);
				});
			}else{
				AP.dialog("#"+upload_container($(obj).attr('id'))).hide();
			}
			upload_callback($(obj).attr('id'));
		}else if (fn=='clean'){
			var selector=$(obj).attr('id');
			var options=$(obj).data('__ap_upload_data');
			if (!options){
				$.log('multi-upload fails to add file');
				return false;
			}
			
			// When FileAPI is not supported
			if (!AP.sys.file()){
				$("#"+upload_container(selector)+" .upload-place").empty();
				$(upload_area(selector)).empty().html("<input type='hidden' name='max-"+options.name+"' value='"+options.max_items+"'/>");
				$("#"+upload_container(selector)+" div.browser-button").empty().html('Browser').append("<input type='file' name='ap-browser' multiple=''>");
				
				upload_setChangeHandler(selector);
				
				options.queue=[];
				$(obj).data('__ap_upload_data', options);
				$("#"+upload_get_counter_wrapper_id(selector)).html(0);
			}else{
				// We won't remove the input file.
				
				$("#"+upload_container(selector)+" .upload-place").empty();
				$(upload_area(selector)).empty().html("<input type='hidden' name='max-"+options.name+"' value='"+options.max_items+"'/>");
				
				options.queue=[];
				$(obj).data('__ap_upload_data', options);
				$("#"+upload_get_counter_wrapper_id(selector)).html(0);
			}
			
			
		}else{
			$.log('unknown flag '+fn);
		}
	};

	
	
	var upload_callback=function(id){
		var id="#"+id;
		var options=$(id).data('__ap_upload_data');
		if (options.callback){
			options.callback(options.queue);
		}
	};
		
	
	/**
	 * @desc Setup the multi-upload Platform
	 */
	var upload_setup=function(element, options){
		
		$(element).data("__ap_upload_data", options);
		
		var selector=$(element).attr('id');
		var container=upload_container(selector);
		var submit=options.submit_label;

		var buttons="<div class='upload-bt' onclick=\"$('#"+selector+"').multiUpload('close');\">"+submit+"</div>";
		
		var extra_class='';
		if (options.upload_on_close){
			buttons="<div class='upload-bt upload-btd' onclick=\"$('#"+selector+"').multiUpload('hide');\">Cancel</div>"
				+"<div class='upload-bt upload-btd' onclick=\"$('#"+selector+"').multiUpload('close');\">"+submit+"</div>" +
				"<div class='upload-bts'></div>";
		}else{
			extra_class='has_close_button';
		}
		
		
		$("#ap-temp").append("<div id='"+container+"' class='multi-upload ap-mh200'>" +
				"<div class='upload-title ap-clearfix'><span id='"+upload_get_counter_wrapper_id(selector)+"'>0</span> "+"files have been selected"+" <span class='reset' onclick=\"$('#"+selector+"').multiUpload('clean');\">"+options.reset_label+"</span> <div class='button browser-button'>"+options.browse_label+"</div></div>" +
				"<div class='upload-place'></div>" +
				"<div class='upload-extra'></div>" +
				"<div class='upload-buttons relative'>" +
				buttons+
				"</div>"+
			"</div>");
		
		AP.dialog("#"+container)
			.data('form', $(element).attr('id'))
			.engine(AP.config.uploadDialogEngine)
			.title(options.title).width(600)
			.style(extra_class)
			.show();
			
		$("#"+selector).append("<div class='__ap-upload-area hidden'><input type='hidden' name='max-"+options.name+"' value='"+options.max_items+"'/></div>");
		
		$("#"+container+" div.browser-button").append("<input type='file' name='ap-browser' multiple=''>");
		
		
		if (AP.sys.file()){
			$("#"+container+" .upload-extra").append("<div class='desc'>"+options.hint+"</div>");
		}
		
		upload_setChangeHandler(selector);
		
	};
	
	
	/**
	 * @desc Setting up the onChange handler for the input button.
	 */
	var upload_setChangeHandler=function(selector){
		var container=upload_container(selector);
		$("#"+container+" div.browser-button input").bind("change", function(){
			if (AP.sys.file()){
				var s=document.querySelector("#"+container+" div.browser-button input");
				return $('#'+selector).multiUpload_addMFiles(this, s.files);
			}else{
				$('#'+selector).multiUpload_addFile(this);
			}
		});
	};
	
	
	/**
	 * @desc After adding a file, displaying it to dialog
	 */
	var upload_displayFile=function(element, file){
		var options=$(element).data('__ap_upload_data');
		if (!options){
			$.log('multi-upload fails to add file');
			return false;
		}
			
		
		var name=file.name;
		if (name.length>=options.filename_max_length){
			name=name.substr(0, options.filename_max_length-1)+"...";
		}
		var size='';
		if (file.size){
			size=file.size;
		}
		
		// Validation
		if (options.allow && !AP.word.fileX(name, options.allow)){
			return AP.alertError('Invalid file extension.');
		}
		
		if (options.queue.length >= options.max_items){
			return AP.alertError("You've selected too many files.");
		}
		
		var selector=$(element).attr('id');
		$("#"+upload_container(selector)+" .upload-place").append("<div class='upload-item ap-clear-fix'><div class='index'><div class='i32 i32-circle'><span>"+(options.queue.length+1)+"</span></div></div><div class='name'>"+name+"</div><div class='size'>"+size+"&nbsp;</div><div class='upload-buttons'><span class='i12 i12-close pointer' title='Remove this file?'></span></div><div class='ap-1fix left'></div></div>");
		
		$("#"+upload_container(selector)+" div.browser-button input[name=ap-browser]").attr('name',''+options.name+'-'+options.queue.length).unbind('change').appendTo(upload_area(selector));		
		$("#"+upload_container(selector)+" div.browser-button").append("<input type='file' name='ap-browser' multiple=''>");		
		upload_setChangeHandler(selector);
		
		
		options.queue.push(file.name);
		
		$("#"+upload_get_counter_wrapper_id(selector)).html(options.queue.length);
	};
	
	
	
	/**
	 * @desc Return the container ID 
	 */
	var upload_container=function(id){
		return "__upload_"+id;
	};
	
	
	
	/**
	 * @desc Getting the upload wrapper ID to count the items
	 */
	var upload_get_counter_wrapper_id=function(selector){
		return selector+'__upload_counter';
	};
	
	
	/**
	 * @desc Getting the upload area ID
	 */
	var upload_area=function(selector){
		return "#"+selector+" div.__ap-upload-area";
	};
	
	
	/**
	 * @desc Getting the upload filename from some posted sources
	 */
})(jQuery);



var upload_filename=function(str){
	return getUploadFN(str);
};


var __apupload_AddFiles=function(obj, pid, name){
	var $p=$('#'+pid);
	var $files=$('.__files', $p);
	var f=$(obj).val();
	if (f && f.length>1){
		// Get filename
		var tmpname=getUploadFN(f);
		var tempid=AP.uuid();
			
		if (tmpname){
			$('.fl', $p).append("<div class='fi' id='__tmp"+tempid+"'> <div class='remove' onclick=\"__apupload_RemoveFile('"+tempid+"');\"> <div class='tt hidden padding_less' style='width:140px; bottom:20px; font-weight:normal'>Remove file "+tmpname+"?</div> <span class='ticon-cancel entypo'></span></div> <span class='ticon-doc entypo'></span> "+tmpname+"</div>").show();
		}
		$('.__browse',$p).unbind('change').attr('name',name+'[]').attr('id',tempid).appendTo($files);
		$('.browse', $p).append("<input title='Click to select files' type='file' class='__browse' name='__tmp"+name+"' onchange=\"__apupload_AddFiles(this, '"+pid+"','"+name+"');\"/>");
		
		$('.remove',$p).tooltip('.tt');
		
		var alt=$('.browse em', $p).data("alt_label");
		var prim=$('.browse em', $p).data("prim_label");
		
		if ($('.fl .fi', $p).length && $('.fl .fi', $p).length>=1){
			$('.browse > em', $p).html(alt);
		}else{
			$('.browse > em', $p).html(prim);
		}
	}
};


var __apupload_AddOneFile=function(obj, pid, name){
	var $p=$('#'+pid);
	var $files=$('.__files', $p);
	var f=$(obj).val();
	if (f && f.length>1){
		// Get filename
		var tmpname=getUploadFN(f);
		var tempid=AP.uuid();
			
		if (tmpname){
			$('.fl', $p).html("<div class='fi' id='__tmp"+tempid+"'> <div class='remove' onclick=\"__apupload_RemoveFile('"+tempid+"');\"> <div class='tt hidden padding_less' style='width:140px; bottom:20px; font-weight:normal'>Remove file "+tmpname+"?</div> <span class='ticon-cancel entypo ap-f16'></span></div> <span class='ticon-upload ap-f16 entypo'></span> "+tmpname+"</div>").show();
		}
		$files.cleanUp();
		$('.__browse',$p).unbind('change').attr('name',name+'').attr('id',tempid).appendTo($files);
		$('.browse', $p).append("<input title='Click to select a file' type='file' class='__browse' name='__tmp"+name+"' onchange=\"__apupload_AddOneFile(this, '"+pid+"','"+name+"');\"/>");
		
		$('.remove',$p).tooltip('.tt');
		var alt=$('.browse em', $p).data("alt_label");
		var prim=$('.browse em', $p).data("prim_label");
		
		if ($('.fl .fi', $p).length && $('.fl .fi', $p).length>=1){
			$('.browse > em', $p).html(alt);
		}else{
			$('.browse > em', $p).html(prim);
		}
	}
};


var __apupload_RemoveFile=function(id){
	var $p=$('#__tmp'+id).parent();
	
	$('#'+id).remove();
	$('#__tmp'+id).remove();
	
	if (!$p.has('div').length){
		$p.hide();
	}
	
	var $px=$p.closest('.__file');
	
	var alt=$('.browse em', $px).data("alt_label");
	var prim=$('.browse em', $px).data("prim_label");
	var icon="";
	if ($('.__file_org',$px).data("icon")){
		icon="<span class='ap-f14 "+options.icon+"'></span>&nbsp; "
	}
	
	if ($('.fl .fi', $px).length && $('.fl .fi', $px).length>=1){
		$('.browse > em', $px).html(icon+alt);
	}else{
		$('.browse > em', $px).html(icon+prim);
	}
};



var BasicFormEngine=new function __BasicFormEngine(){	
	this.show=function(canvas, form){
		var id=AP.uuid();
		var extra=form.getStyles().join(" ");
		var css=form.getCss().join(";");
		var text="<div class='__form "+extra+"' id='"+id+"' style='"+css+"'> <form method='post' action='"+form.getURL()+"' id='"+form.getID(true)+"'>" +
		this.getRows(form)+
		"<div class='row buttons __buttons'></div>"+
		"</form></div>";
		$(canvas).append(text);
		
		for (var button in form.getButtons()){
			$("<div class='button'>"+button+"</div>").bind('click',{fn: form.getButton(button)},function(event){
				event.data.fn();
			}).appendTo($("#"+id).find('.__buttons').first());
		};
	};
	
	
	this.html=function(form){
		var id=AP.uuid();
		var extra=form.getStyles().join(" ");
		var css=form.getCss().join(";");
		var handler=form.getHandlerInline();
		
		var text="<div class='__form "+extra+"' id='"+id+"' style='"+css+"' "+handler+"> <form method='post' action='"+form.getURL()+"' id='"+form.getID(true)+"'>" +
		this.getRows(form)+
		"</form></div>";
		return text;
	};
	
	
	
	
	/**
	 * @desc Rendering rows
	 */
	this.getRows=function(form){
		var text="";
		for (var i=0; i<form.getData().length; i++){
			var elem=form.getData(i);
			if (!elem.meta.value){
				elem.meta.value="";
			}
			
			var hint="";
			if (elem.meta.hint){
				hint="<div class='hint'>"+elem.meta.hint+"</div>";
			}
			
			
			if (elem.type=='hidden'){
				text+="<input type='hidden' name='"+elem.meta.name+"' value='"+elem.meta.value+"'/>";
			}
			if (elem.type=='text'){
				text+="<div class='row'> <label>"+elem.meta.label+"</label> <div class='input'><input type='text' name='"+elem.meta.name+"' value='"+elem.meta.value+"'/></div>"+hint+"</div>";
			}
			if (elem.type=='file'){
				var _class='';
				if (elem.meta.multi){
					_class=" class='__multi' ";
				}
				text+="<div class='row'> <label>"+elem.meta.label+"</label> <div class='file'><input type='file' "+_class+"name='"+elem.meta.name+"'/></div>"+hint+"</div>";
			}
			if (elem.type=='select'){
				text+="<div class='row'> <label>"+elem.meta.label+"</label> <div class='select'><select class='__multi' name='"+elem.meta.name+"'>"+this.getSelectOptions(elem.meta.options, elem.meta.value)+"</select></div>"+hint+"</div>";
			}
			if (elem.type=='choice'){
				text+="<div class='row'> <label>"+elem.meta.label+"</label> <div class='select'><select class='__choice' name='"+elem.meta.name+"'>"+this.getSelectOptions(elem.meta.options)+"</select></div></div>";
			}
			if (elem.type=='textarea'){
				if (!elem.meta.value){
					elem.meta.value="";
				}
				text+="<div class='row'> <label>"+elem.meta.label+"</label> <div class='input'><textarea name='"+elem.meta.name+"'>"+elem.meta.value+"</textarea></div>"+hint+"</div>";
			}
			if (elem.type=='info'){
				text+="<div class='row'> <label>"+elem.meta.label+"</label> <div class='info'><div>"+elem.meta.value+"</div></div></div>";
			}
			if (elem.type=='hint'){
				text+="<div class='row'><div class='hint'><div>"+elem.meta.value+"</div></div></div>";
			}
		}
		return text;
	};
	
	
	/**
	 * @desc Get options for a select input
	 */
	this.getSelectOptions=function(opts, value){
		var text="";
		for (var opt in opts){
			if (AP.data.equal(opt,value)){
				text+="<option value='"+opt+"' selected>"+opts[opt]+"</option>";
			}else{
				text+="<option value='"+opt+"'>"+opts[opt]+"</option>";
			}
		}
		return text;
	};
};

 

AP.config.form={engine: BasicFormEngine, dialogEngine: BasicDialogEngine};

AP.form=function(id, url, engine, dialogEngine){
	if (!url){
		url='';
	}
	if (!engine){
		engine=AP.config.form.engine;
	}
	if (!dialogEngine){
		dialogEngine=AP.config.form.dialogEngine;
	}
	return new APForm(id, url, engine, dialogEngine);
};



function APForm(id, url, engine, dialogEngine){
	this._id=id;
	if (AP.word.prefix(id, "#")){
		this._id=id.substr(1);
	};
	
	this._url=url;
	this._data=[];
	this._classes=[];
	this._buttons={};
	this._title="";
	this._engine=engine;
	this._dialogEngine=dialogEngine;
	this._dialog=false;
	this._callbacks=[];
	this._css=[];
	this._handlers={};
	
	this.handler=function(event, handler){
		this._handlers[event]=handler;
		return this;
	};
	
	
	this.getHandlerInline=function(){
		var handler="";
		for (var event in this._handlers){
			handler+=" "+event+"=\""+this._handlers[event]+"\"";
		}
		return handler;
	};
	
	
	/**
	 * @desc Get data (input) of the form.
	 */
	this.getData=function(index){
		if (index==undefined){
			return this._data;
		}
		return this._data[index];
	};
	
	
	/**
	 * @desc Get all buttons
	 */
	this.getButtons=function(){
		return this._buttons;
	};
	
	
	/**
	 * @desc Get single button
	 */
	this.getButton=function(label){
		return this._buttons[label];
	};
	
	
	/**
	 * @desc Get all styles
	 */
	this.getStyles=function(){
		return this._classes;
	};
	
	
	/**
	 * @desc Get css
	 */
	this.getCss=function(){
		return this._css;
	};
	
	
	/**
	 * @desc Get form ID. Set no_hash to true (call getID(true)) if you want the ID
	 * without the hash at the begining.
	 */
	this.getID=function(no_hash){
		if (!no_hash){
			return "#"+this._id;
		}
		return this._id;
	};
	
	
	/**
	 * @desc Get form title
	 */
	this.getTitle=function(){
		return this._title;
	};
	
	
	/**
	 * @desc Get form action URL
	 */
	this.getURL=function(){
		return this._url;
	};
	


	
	/**
	 * @desc Set the engine for rendering.
	 */
	this.engine=function(engine){
		this._engine=engine;
		return this;
	};
	
	
	/**
	 * @desc Set the engine for rendering.
	 */
	this.dialogEngine=function(dialogEngine){
		this._dialogEngine=dialogEngine;
		return this;
	};
	
	/**
	 * @desc Directly inject css to .__form
	 */
	this.css=function(css){
		this._css.push(css);
		return this;
	};
	
	/**
	 * @desc Alias of adding row.
	 */
	this.row=function(type, meta){
		this._data.push({type: type, meta: meta});
		return this;
	};
	
	
	/**
	 * @desc Set form title
	 */
	this.title=function(title){
		this._title=title;
		return this;
	};
	
	
	/**
	 * @desc Add a new button form button
	 */
	this.button=function(label, fn){
		this._buttons[label]=fn;
		return this;
	};
	
	
	/**
	 * @desc Add a new class
	 */
	this.style=function(style){
		this._classes.push(style);
		return this;
	};
	
	
	
	this.val=function(name){
		return $("#"+this._id+" *[name="+name+"]").apv();
	};
	
	
	/**
	 * @desc Get the HTML representing the form [NO BUTTONS]
	 */
	this.html=function(){
		return this._engine.html(this);
	};
	
	
	
	/**
	 * @desc Show form (inline) 
	 */
	this.release=function(canvas){
		if (!this._dialog){
			this._engine.show(canvas, this);
		}else{
			this.dialog();	
		}
		
		for (var i=0; i<this._callbacks.length; i++){
			this._callbacks[i]();
		}
		return this;
	};
	
	
	/**
	 * @desc Show form in dialog
	 * @param dengine Optional. If set, it will be the dialogEngine.
	 */
	this.dialog=function(dengine){
		if (engine){
			this.dialogEngine(dengine);
		}
		var id=this.getID()+"__dialog";
		AP.dialog(id).title(this.getTitle()).show();
		this._engine.show(AP.dialog(id, this._dialogEngine).find("content"), this);
		AP.dialog(id, this._dialogEngine).balance();
		
		for (var i=0; i<this._callbacks.length; i++){
			this._callbacks[i]();
		}
		
		return this;
	};
	
	
	/**
	 * @desc Hide (close form) for dialog.
	 */
	this.hide=function(){
		AP.dialog(this.getID()+"__dialog").hide();
		return;
	};
	
	
	
	/**
	 * @desc Add callback function (after release)
	 */
	this.callback=function(fn){
		this._callbacks.push(fn);
		return this;
	};
};




var Textarea=new function __TextArea(){
	this.simple=function(str){
		if (!str){
			return "";
		}
		
		return AP.word.replaceAll("<br>","\n", str);
	};
	
	this.clean=function(_str){
		if (!_str){
			return "";
		}
		
		if (!AP.data.isString(_str)){
			return _str;
		}
		
		var str = (' '+_str).slice(1);
		
		var regex = /<br\s*[\/]?>/gi;
		str = str.replace(regex, "\n").replace(/&#8220;/g, "\"").replace(/&#8221;/g, "\"").replace(/&#8216;/g, "'").replace(/&#8217;/g, "'");
		str = str.replace(/{{@[a-zA-Z][a-zA-Z]+}}/g, function(m){
			return m.substr(2, m.length-4);
		});
		
		return str;
	};
	
	
	this.raw=function(str){
		if (!AP.data.isString(str)){
			return str;
		}
		
		var temp=this.clean(str);
		return temp.replace(/\&#126;/g, '~').replace(/\&gt;/g, '>').replace(/\&lt;/g, '<');
	};
	
	
	this.editor = function(val){
		var str = (' '+val).slice(1);
		
		str = str.replace(/{{@[a-zA-Z][a-zA-Z]+}}/g, function(m){
			return m.substr(2, m.length-4);
		});
		
		return str;
	};
};


var BasicDialogEngine=new function __BasicDialogRender(){
	this.canvas=function(){
		return $("#apdialogs");
	};
	
	/**
	 * @desc Render the dialog.
	 */
	this.render=function(dialog){
		dialog.canvas().append("" +
			"<div class='xdialog __dialog' id='"+dialog.w(true)+"'>" +
				"<div class='__dialogwrapper'>" +
					"<div class='__dialogwrapper-inner'>" +
						"<div class='main'>" +
							"<div class='__dialogtitle'>"+"&nbsp;</div>"+
							"<div class='__dialogclose' onclick=\"AP.dialog('"+dialog.id()+"').hide();\"><div class='entypo ticon-cancel'></div> </div>"+
							"<div class='__dialogcontent'></div>" +
							"<div class='__dialogbuttons xo'></div>"+
						"</div>"+
					"</div>"+
				"</div>"+
			"</div>");
	};
	
	
	/**
	 * @desc Balancing the dialog.
	 */
	this.balance=function(dialog){
		var wid=dialog.w();
		var l=$(window).width()/2- $(wid+' .__dialogwrapper').outerWidth(true)/2;
		var t=$(window).height()/2- $(wid+' .__dialogwrapper').outerHeight(true)/2-30;
		
		$(wid+' .__dialogwrapper').css({'top': t,'left': l});
		$(wid+' .dialogwrapper .__buttons .button:last').focus();
		
		if (window.Render){
			Render.finish();
		}
	};

};


AP.BSUCCESS='ss';
AP.BSTD='std';
AP.BERROR='er';


function initEscape(){
	$(document).keyup(function(e) {
		 if (e.keyCode == 27) { // escape key maps to keycode "27"
			 $("#apdialogs > .__dialog.__canvas_closable").each(function(){
				if ($(this).hasClass("__dialog_ontop") && !$(this).hasClass("__xesc")){
	 				AP.closeDialog($(this).find('.__dialogwrapper'));
				} 
			 });
		}
	});
};

initEscape();


AP.closeAllDialog=function(){
	$("#apdialogs > .__dialog .__dialogwrapper").each(function(){
		AP.closeDialog(this);
	});
};

AP.closeAllDialogs=AP.closeAllDialog;


AP.dialog=function(id, engine){
	if (!engine){
		var _engine = $(id).data("_engine");
		
		if (_engine){
			return new APDialog(id, _engine);	
		}
		
		engine=AP.config.dialog.engine;
	}
	
	return new APDialog(id, engine);
};

AP.dialog.get=function(ref){
	if ($(ref).closest(".__apdialog")){
		var id = $(ref).closest(".__apdialog").attr("id");
		return AP.dialog("#"+id);
	}
	
	return AP.dialog(ref);
};


AP.dialog.close=function(ref){
	return AP.closeDialog(ref);
};


AP.closeDialog=function(ref){
	if ($(ref).closest(".__dialog").hasClass("__fdialog")){
		if (AP.isset('Form')){
			var rt = Form.protection.runtime();
			if (!rt){
				return false;
			}
		}
	}
	
	var dx=$(ref).closest('.__dialog').find(".__apdialog").attr("id");
	$("#"+dx).html("").empty();
	AP.dialog("#"+dx).hide();
	
	AP.fire("dialog-close-"+dx);
	
	var $w=$(ref).closest('.__dialog');
	var events=$w.data("apevents");
	if (events && events.close){
		events.close.apply($w);
	}
};



AP.destroyDialog=function(id){
	var $dx=$("#__apdialog_"+id.substr(1));
	if (!$dx.length){
		return;
	}
	
	var events=$dx.data("apevents");
	if (events && events.close){
		events.close.apply($w);
	}
	
	if ($(id).length){
		AP.dialog(id.substr(1)).hide();
	}
	
	$dx.html("").empty();
	
	$dx.remove();
};





function APDialog(id, engine){
	this._rendered=false;
	this._temp=true;
	this._buttons={};
	this._bs={};
	this._title="Untitled";
	this._content="";
	this._classes=[];
	this._css={};
	this._data={};
	this._config={};
	this._icon=null;
	this._closable=false;
	this._close_button=true;
	
	this._engine=engine;
	if (AP.word.prefix(id,"#")){
		id=id.substr(1);
	}
	
	if (!AP.html.exist("#"+id)){
		$(document.body).append("<div id='"+id+"'></div>");
	}else{
		var title=$("#"+id).attr('title');
		if (title){
			this._title=title;
		}
	}
	
	if (engine){
		$("#"+id).data("__engine", engine);	
	}else{
		engine=$("#"+id).data("__engine");
		this._engine=engine;
	}
	
	if ($("#"+id).data("icon")){
		this._icon=$("#"+id).data("icon");
	}
	
	this._id=id;
	
	
	this.data=function(key, value){
		if (typeof value=="undefined"){
			if (key in this._data){
				return this._data[key];
			}
			return null;
		}else{
			this._data[key]=value;
			return this;
		}
	};
	
	
	this.setData=function(data){
		this._data=data;
	};
	
	this.closable=function(flag){
		this._closable=flag;
		return this;
	};
	
	this.closeButton=function(flag){
		this._close_button=flag;
		return this;
	};
	
	/**
	 * @desc Set _temp flag (flag to indicate the existance of the dialog between page transition)
	 */
	this.temp=function(flag){
		this._temp=flag;
		return this;
	};
	
	
	/**
	 * @desc Adding CSS class
	 */
	this.style=function(css_style){
		if (css_style){
			this._classes.push(css_style);
		}
		return this;
	};
	

	
	this.addClass=function(css_style){
		return this.style(css_style);
	};
	
	
	/**
	 * @desc Adding CSS class
	 */
	this.css=function(key, value){
		this._css[key]=value;
		return this;
	};
	
	this.icon=function(icon_class){
		this._icon=icon_class;
	}
	
	/**
	 * @desc Setting engine for rendering
	 */
	this.engine=function(engine){
		this._engine=engine;
		return this;
	};
	
	
	this.config=function(config){
		this._config=$.extend({}, this._config, config);
		return this;
	};
	
	
	
	/**
	 * @desc Add button
	 * @param label The text to be appeared in button
	 * @param fn Callback function 
	 * @param style [Optional] The specific style. If not defined, style will be '__default'
	 */
	this.button=function(label, fn, style){
		var counter=0;
		for (button in this._buttons){
			counter++;
		}
		if (counter==0){
			this.find("buttons").cleanUp();
		}
		var ec='__default';
		if (style){
			ec=style;
		}
		
		
		this._buttons[label]=fn;
		this._bs[label]={'style':ec,'fn':fn};
		
		
		
		if (this.initialized()){
			$("<div class='button "+ec+"'>"+label+"</div>").bind('click',{fn: fn},function(event){
				event.data.fn();
			}).appendTo(this.find("buttons"));
		}
		return this;
	};
	
	
	
	/**
	 * @desc Set title of the dialog
	 */
	this.title=function(title){
		if (title==undefined){
			title=this._title;
		}
		this._title=title;
		if (this.initialized()){
			if (this._icon){
				title="<span class='dialog-icon ap-f14 "+this._icon+"'></span>&nbsp; "+title;
			}
			this.fix('title', title);
		}
		return this;
	};
	
	
	/**
	 * @desc Set content of the dialog
	 */
	this.content=function(content){
		if (content != undefined){
			this._content=content;
		}
		
		if (this.initialized() && !AP.isEmpty(this._content)){
			$(this.id()).children().empty();
			$(this.id()).html(this._content);
		}
		
		return this;
	};
	
	
	this.append=function(id){
		$(id).appendTo($(this.id()));
		return this;
	};
	
	
	
	/**
	 * @desc Set width
	 */
	this.width=function(width){
		if (Client.native || Client.mobile){ 
			this.balance();
			return this;
		}
		
		if (AP.data.isInt(width)){
			if (Client.native || Client.mobile){ 
				$.log(width);
			}else{
				$(this.id()).css("width", width+"px");	
			}
		}else{
			$(this.id()).css("width", width);
		}
		this.balance();
		return this;
	};
	
	
	/**
	 * @desc Get the id (with # at the begining).
	 */
	this.id=function(){
		return "#"+this._id;
	};
	
	
	/**
	 * @desc Get the wrapper id.
	 * @param short Flag to mark whether we should omit the # at the begining.
	 */
	this.w=function(omit){
		if (omit){
			return "__apdialog_"+this._id;
		}
		return "#__apdialog_"+this._id;
	};
	
	
	/**
	 * @desc Return the canvas to contain all dialogs.
	 */
	this.canvas=function(){
		return this._engine.canvas();
	};
	
	
	/**
	 * @desc Check to see if the dialog is fully rendered. If yes, then future
	 * rendering will be progressive.
	 */
	this.initialized=function(){
		if (!AP.html.exist(this.id()) || !$(this.id()).hasClass('__apdialog')){
			return false;
		}
		return true;
	};
	
	
	/**
	 * @desc Render the dialog
	 */
	this.render=function(){
		if (!this.initialized()){
			this._engine.render(this);
			$(this.id()).data("config", this._config);
			$(this.id()).data("_engine", this._engine);
			$(this.id()).show().addClass('__apdialog').appendTo($(this.find('content'))).attr("title","");
			
			var classes=this._classes.join(" ");
			if (classes){
				$(this.w()).addClass(classes);
			}
			
			for (var k in this._css){
				$(this.id()).css(k, this._css[k]);
			}
			
			if (this._temp){
				$(this.w()).addClass("__temp");
			}
			$(this.w()).addClass("__dialog");
		}
		
		this._rendered=true;
		this.title();
		this.content();
		this.buttons();
		this.balance();
		
		if (this._temp){
		}else{
			var $this=this;
			AP.html.resize(function(){
				$this.balance();
			}, true);
		}
		
		
		return this;
	};
	
	
	/**
	 * @desc Setting buttons
	 */
	this.buttons=function(buttons){
		if (buttons && typeof buttons!=undefined){
			if (AP.data.isArray(buttons)){	
				for (var i=0; i<buttons.length; i++){
					if (!buttons[i].style){
						buttons[i].style='__ap_default_button';
					}
					
					this.button(buttons[i].label, buttons[i].action, buttons[i].style);
				}
			}else{
				for (var button in buttons){
					this.button(button, buttons[button],'__ap_default_button');
				}
			}
		}
		
		if (!this._rendered){
			this.find("buttons").cleanUp();
		}
		
		for (var button in this._buttons){	
			this.button(button, this._bs[button].fn, this._bs[button].style);
		}
		return this;
	};
	
	
	/**
	 * @desc Balance the dialog.
	 */
	this.balance=function(timeout){
		if (!timeout){
			this._engine.balance(this);
			// $.log(this._id); 
			// $.log(this._engine);
		}else{
			var $this=this;
			setTimeout(function(){
				$this._engine.balance($this);
			},timeout);
		}
		return this;
	};
	
	
	/**
	 * @desc Find elements of the dialog
	 */
	this.find=function(comp){
		var c=this.w()+" .__dialog"+comp;
		return $(c).first();
	};
	
	
	this.cond=function(cond, fn){
		if (cond){
			fn.apply(this);
		}
		
		return this;
	};
	
	
	/**
	 * @desc Show the dialog.
	 */
	this.show=function(){
		if (!this.initialized()){
			this.render();
		}
		
		
		$(this.canvas()).show();
		$(this.canvas()).children().each(function(){
			$(this).removeClass('__dialog_ontop');
		});
		
		$(".__ontop").removeClass("__ontop");
		$(this.w()).show().addClass('__dialog_ontop').appendTo($(this.canvas()));
		
		
		this.balance();
		
		if (AP.config.disableParentScrolling && AP.sys.isTablet()){
			$("html, body").addClass("xo");
		}else if (this._config.disableParentScrolling){
			$("html, body").addClass("xo");
		}
		
		
		if (this._closable && !$(this.w()).hasClass("__canvas_closable")){
			$(this.w()).addClass("__canvas_closable");
			$("<div class='__closable'></div>").prependTo($(this.w())).click(function(){
				var id=$(this).closest(".__dialog").find(".__apdialog");
				AP.dialog("#"+id.attr("id")).hide();
			});
		}
		return this;
	};
	
	
	this.on=function(events){
		$(this.w()).data("apevents", events);
	};
	
	
	/**
	 * @desc Hide the dialog.
	 */
	this.hide=function(){
		$(this.w()).hide();
		var config=$(this.id()).data("config");
		var counter=0;
		$(this.canvas()).children().each(function(){
			if ($(this).is(":visible")){
				counter++;
				return;
			}
		});
		if (counter==0){
			$(this.canvas()).hide();
		}
		
		if (AP.config.disableParentScrolling && AP.sys.isTablet()){
			$("html, body").removeClass("xo");
		}else if (config && config.disableParentScrolling){
			$("html, body").removeClass("xo");
		}
		
		if (AP.isset('Form')){
			Form.protection.disable();
		}
		return this;
	};
	
	
	/**
	 * @desc Hide and destroy the full dialog
	 */
	this.close = function(){
		if (AP.isset('Form')){
			var rt = Form.protection.runtime(this.w());
			if (!rt){
				return false;
			}
		}
		
		this.hide();
		AP.destroyDialog(this.id());
	};
	
	
	
	this.formatForm=function(){
		$(this.id()+' input[type=file]').selectFiles({label:"Select File"});
		$(this.id()+' textarea').disableTab();
		return this;
	};
	
	
	
	/**
	 * @desc Set flag to request re-rendering. This is not
	 * to show the dialog. 
	 */
	this.rerender=function(){
		this._rendered=false;
	};
	
	
	
	/**
	 * @desc Fix component. Key could be title or content.
	 */
	this.fix=function(key, val){
		this.find(key).html(val);
	};
};


AP.pageData={};
AP.localData={};
Client.tempData={};

AP.lc=new function __APLC(){
	
	this._check=false;
	this._enable=false;
	this.enable=function(){
		if (Client.native){
			return true;
		}
		
		if (!this._check){
			this.check=true;
			if (typeof localStorage !== "undefined" && AP.isset('localStorage')){
				localStorage.setItem('__apc', '__apc');
				if (localStorage.getItem('__apc') == '__apc'){
					this._enable=true;
					return true;
				}else{
					return false;
				}
			}
			
			return false;
		}
		
		return this._enable;
	};
	
	
	this.set=function(key, data){
		if (!this.enable()){
			return false;
		}
		
		localStorage.setItem(key, data);
	};
	
	
	this.get=function(key){
		if (!this.enable()){
			return null;
		}
		
		return localStorage.getItem(key);
	};
	
	
	this.clear=function(key){
		if (!this.enable()){
			return false;
		}
		
		return localStorage.removeItem(key);
	};
};


AP.setTempData=function(code){
	if (!Client.tempData){
		Client.tempData={};
	}
	
	for (var key in code){
		if (key == "message" || key=="code" || key=="html" || key=="__js" || key=="good" || key=="notEmpty" || key=="hasCode" || key=="hasMessage" || key=="___stats" || key=="data"){
			continue;
		}
		
		Client.tempData[key]=code[key];
	}
};




 


Client.addCache=function(data){
	for (var key in data){
		Client.cache[key]=data[key];
	}
};

Client.getCurrentCachesKey=function(){
	var ks=[];
	for (var key in Client.cache){
		ks.push(key); 
	}
	return ks;
};



Client.deleteCachesExcept=function(exs){
	var ks=Client.getCurrentCachesKey();
	for (var i=0; i<ks.length; i++){
		if (!exs){
			delete Client.cache[ks[i]];
		}else{
			if (exs.indexOf(ks[i])<0){
				delete Client.cache[ks[i]];
			}
		}
	};
};


AP.UI= new function _UI(){
	this.icon=function(icon){		
		var color="#000";
		if (icon=="doc" || icon=="docx"){
			color="#0689d5";
		}
		
		if (icon=="png" || icon=="jpg" || icon=="jpeg" || icon=="gif"){
			color="#e48a0f";
		}
		
		if (icon=="xls" || icon=="xlsx"){
			color="#5caa0f";
		}
		
		if (icon=="txt" || icon=="note"){
			color="#00c1cd";
		}
		
		if (icon=="pdf"){
			color="#dc0c12";
		}
		
		
		
		return "<span class='s32-mime-blank __mimeblank'><span class='__mimename' style='background-color: "+color+"'>"+icon+"</span></span>";
	};
	
	
	this.form=function(id, url, engine, dialogEngine){
		if (!engine){
			engine=AP.config.form.engine;
		}
		if (!dialogEngine){
			dialogEngine=AP.config.form.dialogEngine;
		}
		return new APForm(id, url, engine, dialogEngine);
	};

	
	/**
	 * @desc Generate options for year selection
	 */
	this.selectYears=function(start_year, end_year, selected_year){
		if (!selected_year){
			selected_year=0;
		}
		var text="";
		for (var i=end_year; i>start_year; i--){
			if (i==selected_year){
				text+="<option value='"+i+"' selected>"+i+"</option>";
			}else{
				text+="<option value='"+i+"'>"+i+"</option>";
			}
		}
		
		return text;
	};
	
	
	
	/**
	 * @desc Create a hashed link
	 */
	this.hash=function(){
	
		if (arguments.length==1){
			var url=arguments[0];
			if (url.indexOf('http')!=-1){
				var hash=getHash(url);
				if (hash){
					// window.location.hash="!/"+hash.join('/');
					window.location.hash="!/"+hash.join('/');
					AP._last_hash=hash.join('/');
					AP.loadURL(Client.url+'/'+hash.join('/'),{direct_load: true});
					return;
				}
			}
		}
		var path=""; 
		for (var i=0; i<arguments.length; i++){
			if (i>0){
				path=path+"/"+arguments[i];
			}else{
				path=arguments[0];
			}
		}
		// window.location.hash="!"+path;
		window.location.hash="!/"+path;
		AP._last_hash=path;
		AP.loadURL(Client.url+'/'+path,{direct_load: true});
	};
			

	/**
	 * @desc Create a regular link
	 */
	this.link=function(){
		var path="";
		for (var i=0; i<arguments.length; i++){
			path=path+"/"+arguments[i];
		}
		return "#!"+path;
	};
				
			
	/**
	 * @desc Create a time selector
	 */
	this.timeSelect = function(selector, options){
		if (!options){
			options={};
		}
		
		
		$(selector).each(function(){
			$(this).data("ts", options).addClass("__timeselect");
			if (!$(this).data('__timeselect')){
				$(this).data('__timeselect',1);
				var p=$(this).position();
				
				
//				var html='';
//				for (var i=0; i<source.length/4; i++){
//					html+="<div class='items relative'><div class='item' onclick='AP.UI.timeSelectNow(this)'><span>"+source[4*i]+"</span></div><div class='item' onclick='AP.UI.timeSelectNow(this)'><span>"+source[4*i+1]+"</span></div> <div class='item' onclick='AP.UI.timeSelectNow(this)'><span>"+source[4*i+2]+"</span></div>  <div class='item last' onclick='AP.UI.timeSelectNow(this)'><span>"+source[4*i+3]+"</span></div></div>";	
//				}
				
				
				var val=$(this).val();
				var hh=0;
				var mm=0;
				if (val && val.length){
					var hm=getCurrentHM(this);
					hh=hm[0];
					mm=hm[1];
				}else{
					var now=options.value;
					if (!now){
						now=$(this).data("value");
					}
					
					if (!now){
						now=AP.time.now();
					}
					
					if (now){
						$(this).val(AP.time.time("%H:%i", now));
					}
					
					hh=AP.time.time("%H", now);
					mm=AP.time.time("%i", now);
				}

				
				var hhtml="<div class='-tsbox -first' data-name='hour'> <div class='-tsn -up'><span class='-ap icon-chevron-thin-up'></span></div> <div class='-tsn -down'><span class='-ap icon-chevron-thin-down'></span></div> <div class='-tslabel'><div class='-tsinput -hour'>"+(hh)+"</div></div> </div>";
				
				var msrc=range(0,59,5);
				
				var mhtml="";
				mhtml="<div class='-tsbox -second' data-name='min'>" +
						"<div class='-tsn -up'><span class='-ap icon-chevron-thin-up'></span></div>" +
						"<div class='-tsn -down'><span class='-ap icon-chevron-thin-down'></span></div>" +
						"<div class='-tslabel'><div class='-tsinput -min'>"+mm+"</div></div> " +
					"</div>";
				
				
				
				var html="<div class='-tstitle'>Select time <span class='-tsclose'><span class='-ap icon-close'></span></span></div>"+hhtml + mhtml + "<div class='-tsr'>:</div> <div class='clear'></div>";
				
				
				var pos="top: "+p.top+"px; left: "+p.left+"px'";
				if (options && options.align=='bottom'){
					pos="bottom:38px; left: "+p.left+"px'";
				}
				
				$(this).parent().addClass('__timeselectw').append("<div class='__hiddenselect' style='position:absolute; "+pos+">"+html+"</div>");
				
				
				var $canvas=$(this).parent().find('.__hiddenselect');
				$canvas.find("input").on("input focus", function(){
					$canvas.find(".-tsbox").removeClass("active");
					$(this).closest(".-tsbox").addClass("active");
				});
				
				$(this).parent().clickOut(function(){
					$(this).find('.__hiddenselect').hide();
				});
				
				$canvas.find(".-tsclose").click(function(){
					$(this).closest('.__hiddenselect').hide();
				});
				
				$canvas.find(".-tsbox").each(function(){
					$(this).on("mousewheel", function(e){
						e.stopPropagation();
						if (e.originalEvent.wheelDelta / 120 > 0){
							moveTSUp(this);
						}else{
							moveTSDown(this);
						}
					});
					
					$(this).find(".-tsn.-up").click(function(){
						moveTSUp(this);
					});
					
					$(this).find(".-tsn.-down").click(function(){
						moveTSDown(this);
					});
				});
			}
			
			// AP.UI.timeSelectFocus(this);
			
			$(this).on("input focus", function(){
				var options=$(this).data("ts");
				if (!options){
					options={};
				}
				
				if (options.align && options.align=='bottom'){
					$(this).parent().find('.__hiddenselect').css('bottom', 38).show();
				}else{
					var p=$(this).position();
					$(this).parent().find('.__hiddenselect').css('top', p.top).css('left', p.left).show();	
				}
				
				$(this).parent().find('.__hiddenselect .-first .-tslabel input').focus();
				
				// AP.UI.timeSelectFocus(this);
				
				var hm=getCurrentHM(this);
				var $box=$canvas=$(this).parent().find('.__hiddenselect');
				$box.find(".-tsinput.-hour").html(hm[0]);
				$box.find(".-tsinput.-min").html(hm[1]);
				
			}).blur(function(){
				$(this).find('.__hiddenselect').hide();

				var hm=getCurrentHM(this);
				$(this).val(hm[0] + ":" + hm[1]);
			});
			
			
		});
		
		
		
		function moveTSUp(ref){
			var type=$(ref).closest(".-tsbox").data("name");
			if (type=="hour"){
				var hour=getCurrentTS(ref, 'hour');
				hour++;
				if (hour>=24){
					hour=23;
				}
				
				setCurrentTS(ref, 'hour', hour);
			}else{
				var min=getCurrentTS(ref, 'min');
				min=min+5;
				if (min>=60){
					min=min-5;
				}
				
				setCurrentTS(ref, 'min', min);
			}
		};
		
		function moveTSDown(ref){
			var type=$(ref).closest(".-tsbox").data("name");
			if (type=="hour"){
				var hour=getCurrentTS(ref, 'hour');
				hour--;
				if (hour<0){
					hour=0;
				}
				
				setCurrentTS(ref, 'hour', hour);
			}else{
				var min=getCurrentTS(ref, 'min');
				min=min-5;
				if (min<0){
					min=min=5;
				}
				
				setCurrentTS(ref, 'min', min);
			}
		};
		
		
		function getCurrentTS(ref, type){
			var $input=$(ref).closest(".__hiddenselect").prev("input");
			if (!$input.length){
				return 0;
			}
			
			var val=$input.val();
			if (!val){
				val="00:00";
			}
			
			
			var hm=val.split(":");
			if (hm.length!=2){
				return 0;
			}
			
			if (type=='hour'){
				return parseInt(hm[0]);
			}else{
				return parseInt(hm[1]);
			}
		};
		
		
		function setCurrentTS(ref, type, val){
			var $box=$(ref).closest(".__hiddenselect");
			$box.find(".-tsinput.-"+type).html(AP.data.zeroPrefix(val));
			
			
			var hh=0;
			var mm=0;
			
			var $input=$(ref).closest(".__hiddenselect").prev("input");
			var ip="00:00";
			if (!$input.length){
			}else{
				ip=$input.val();
				if (!ip){
					ip="00:00";
				}
			}
			
			var hm=ip.split(":");
			if (hm.length!=2){
			}else{
				hh=hm[0];
				mm=hm[1];
				
				if (type=='hour'){
					hh=val;
				}else{
					mm=val;
				}
			}
			
			hh=parseInt(hh);
			mm=parseInt(mm);

			$input.val(safeNum(hh) + ":" + safeNum(mm));
		};
		
		
		function getCurrentHM(ref){
			var hh=0;
			var mm=0;
			
			var ip=$(ref).val();
			
			if (!ip || !ip.length){
				ip="00:00";
			}
			
			var hm=ip.split(":");
			if (hm.length!=2){
				
			}else{
				hh=parseInt(hm[0]);
				mm=parseInt(hm[1]);	
			}
			
			return [safeNum(hh), safeNum(mm)];
		};
		
		function  safeNum(num){
			if (AP.data.isInt(num)){
				if (parseInt(num) === 0) {
					return "00";
				}
				return AP.data.zeroPrefix(num);
			}
			
			return "00";
		};
	};

	
	
	this.timeSelectNow=function(ref){
		$(ref).addClass('chosen');
		var val=$("span", ref).html();
		var $p=$(ref).closest('.__timeselectw');
		var $input=$p.find('input.__timeselect');
		$input.val(val);
		$p.find('.__hiddenselect').fadeOut();
	};
	
	
	this.timeSelectFocus=function(selector){
		return;
		
		var val=$(selector).val();
		if (!val || !val.length){
			return;
		}
		
		var t=0;
		
		$(selector).parent().find('.__hiddenselect:first').find('.item').each(function(){
			if ($('span',this).html()==val){
				$(this).addClass('chosen');
				t=$(this).parent().position().top+$(this).closest('.__hiddenselect').scrollTop();
			}else{
				$(this).removeClass('chosen');
			}
		});
		
		if (t){
			t=t-32;
			if (t<0){
				t=0;
			}
			$(selector).parent().find('.__hiddenselect:first').animate({scrollTop: t}, 300);
		}
	};
	
			
	/**
	 * @desc Create a date selector. Require datepicker Jquery Plugin
	 */
	this.dateSelect = function(selector, format){
		if (!format){
			format=AP.locale.get("date-format-jquery","DD, MM d, yy");
		}
		
		$(selector).each(function(){
			$(this).datepicker({"dateFormat": format, firstDay: 1});
		});
	};
			
		
	
	this.stringcomplete=function(ref, url, extra_post_params){
		var $this=$(ref);
		
		$this.autocomplete({
			source: function(request, response) {
				request.__code=Client.code;
				if (extra_post_params){
					for (var key in extra_post_params){
						request[key]=extra_post_params[key];
					}
				}
				
				request.q=ap_extractCurrentString(ref),
				// console.log(request.q);
				
				$.ajax({
				  url: Client.ajax_url+"/"+url,
				  data: request,
				  dataType: "json",
				  type: "POST",
				  success: function(data){
					  response(data);
				  }
				});
			},

			search: function(){
				// custom minLength
				var term = ap_extractCurrentString(ref);
				if (term===null || (typeof term=='undefined') || term.length < 2 ) {
					return false;
				}
			},
			focus: function() {
				// prevent value inserted on focus
				return false;
			},
			select: function( event, ui ) {
				// Check for value
				var v=ap_extractInsertString(ref, ui.item.value);
				if (v && v.length>1){
					$(this).val(v);
				}
				return false;
			}
		});
	};
			
			
	/**
	 * @desc Create a jQuery autocomplete box
	 */
	this.autocomplete = function(selector, url, callback){	
		var id=ap_createAutoComplete(selector);
		var $this=$("#"+id);
		
		if (!$this.length){
			return;
		}
		
		$this.change(function(){
			if ($(this).val().length==0){
				$(selector).val('');
			}
		});
		
		var acc=$("#"+id).autocomplete({
			source: function(request, response) {
				var onAjaxStart=$this.data('onajaxstart_callback');
				var onAjaxEnd=$this.data('onajaxend_callback');
				
				request.__code=Client.code;
				request.q=ap_extractLast(request.term);
				request.time=AP.time.now();
				
				// Set more data
				if (Client.native){
					var params=M.params();
					for (var key in params){
						M.formData(request, key, params[key]);
					}
				}
				
				if (!request.q || request.q.length <2){
					return null;
				}
				
				for (var key in AP.ajax_data){
					request[key]=AP.ajax_data[key];
				}
				
				var ajax_url=Client.ajax_url+"/"+url+"/"+Client.code;
				if (AP.word.isURL(url)){
					ajax_url=url+"/"+Client.code;
				}
				
				if (onAjaxStart) onAjaxStart();
				
				$("#"+id).parent().addClass("-on-searching");
				
				$.ajax({
				  url: ajax_url,
				  data: request,
				  dataType: "json",
				  type: "POST",
				  success: function(data){
					  $("#"+id).parent().removeClass("-on-searching");
					  
					  if (!data || !AP.data.isArray(data)){
						  return;
					  }
					  
					  if (onAjaxEnd) onAjaxEnd();
					  response(data);
				  }
				});
			},

			select: function( event, ui ){		
				$(selector).val(ui.item.id);
				if (!callback && $('#'+id).data('select_callback')){
					callback=$('#'+id).data('select_callback');
				}
				if (callback){
					callback(ui.item);
				}
				
				$("#"+id).val(ui.item.name);
			}
		});
		 
		acc.data("ui-autocomplete")._renderItem = function( ul, item ){
			var label=item.value;
			if (item.label && item.label.length){
				label=item.label;
			}
			return $("<li>").data("item.autocomplete", item).append("<a>" + label + "</a>").appendTo(ul);
			
		};
		
		return acc;
	};
			
	this.autocompleteComplex = function(selector, url, callback, extra_post_params){
		var id=ap_createAutoComplete(selector, true);
		var $this=$("#"+id);
		
		$this.autocomplete({
			source: function(request, response) {
				var onAjaxStart=$this.data('onajaxstart_callback');
				var onAjaxEnd=$this.data('onajaxend_callback');
			
				request.__code=Client.code;
				if (extra_post_params){
					for (var key in extra_post_params){
						request[key]=extra_post_params[key];
					}
				}
				request.q=ap_extractLast(request.term);
				request.time=AP.time.now();
				
				if (onAjaxStart) onAjaxStart();
				
				$.ajax({
				  url: Client.ajax_url+"/"+url,
				  data: request,
				  dataType: "json",
				  type: "POST",
				  success: function(data){
					  response(data);
					  if (onAjaxEnd) onAjaxEnd();
				  }
				});
			},

			search: function() {
				// custom minLength
				var term = ap_extractLast( this.value );
				if ( term.length < 2 ) {
					return false;
				}
			},
			focus: function() {
				// prevent value inserted on focus
				return false;
			},
			select: function( event, ui ){
				// Check for value
				var results=AP.word.split(",",$(selector).val());
				if (AP.array.within(ui.item.id, results)){
					// Do nothing
					$(this).val("");
					return false;
				}
				
				results.push(ui.item.id);
				$(selector).val(results.join(","));
				$("<div class='apc-selected'> <span class='apc-text'>"+ui.item.value+"</span> <span class='apc-close' onclick=\"AP.UI.acxRemoveItem(this,'"+ui.item.id+"');\">x</span></div>").insertBefore(this);
				
				$(this).val("");
				return false;
			},
			
			classes: {
				"ui-autocomplete": $(selector).data("ul-class")
			},
					
		});
		

		return $this;
	};
			
			
	/**
	 * @desc Autocomplete regularly.
	 */
	this.ac= function(selector, resource, callback, filter_fn){
		var acc=$(selector).autocomplete({source: resource, select: function(a, b){
			callback(b.item);
		}});
		
		acc.data("ui-autocomplete")._renderItem = function( ul, item ) {
			var label=item.value;
			if (item.label && item.label.length){
				label=item.label;
			}
			
			return $("<li>").data("item.autocomplete", item).append("<a>" + label + "</a>").appendTo(ul);
			
		};
		
		return acc;
	};
			
			
	/**
	 * @desc Autocomplate with multivalue
	 */
	this.acx= function(selector, sources, filter_fn){
		var id=ap_createAutoComplete(selector, true); 

		var $this=$("#"+id);
		$this.bind("keydown", function( event ) {
			if ( event.keyCode === $.ui.keyCode.TAB &&
					$( this ).data( "autocomplete" ).menu.active ) {
				event.preventDefault();
			}
		})
		.autocomplete({
			minLength: 0,
			source: function(request, response){
				// delegate back to autocomplete, but extract the last term
				response($.ui.autocomplete.filter(
					sources, ap_extractLast( request.term)));
			},
			focus: function() {
				// prevent value inserted on focus
				return false;
			},
			select: function( event, ui ) {
				// Check for value
				var results=AP.word.split(",",$(selector).val());
				if (AP.array.within(ui.item.id, results)){
					// Do nothing
					$(this).val("");
					return false;
				}
				
				results.push(ui.item.id);
				$(selector).val(results.join(","));
				
				$("<div class='apc-selected xfill'> <span class='apc-text'>"+ui.item.value+"</span> <span class='apc-close' onclick=\"AP.UI.acxRemoveItem(this,'"+ui.item.id+"');\">x</span></div>").insertBefore(this);
				
				$(this).val("");
				
				return false;
			}
		});
		
		return $this;
	};
			
	
	
	
	/**
	 * @desc Autocomplate with tagcloud, multiple color
	 */
	this.tagcloud= function(selector, sources, selected){
		var id=ap_createAutoComplete(selector, true); 

		var $this=$("#"+id);
		var acc=$this.bind("keydown", function( event ) {
			if ( event.keyCode === $.ui.keyCode.TAB &&
					$( this ).data( "autocomplete" ).menu.active ) {
				event.preventDefault();
			}
		})
		.autocomplete({
			minLength: 0,
			source: function(request,response){
				// delegate back to autocomplete, but extract the last term
				response($.ui.autocomplete.filter(
					sources, ap_extractLast( request.term)));
			},
			focus: function() {
				// prevent value inserted on focus
				return false;
			},
			select: function( event, ui ) {
				// Check for value
				var results=AP.word.split(",",$(selector).val());
				if (AP.array.within(ui.item.name, results)){
					// Do nothing
					$(this).val("");
					return false;
				}
				
				results.push(ui.item.name);
				$(selector).val(results.join(","));
				
				$("<div class='apc-selected fill -bg-alt"+ui.item.color+"-less text-alt"+ui.item.color+"-less'> <span class='apc-text'>"+ui.item.name+"</span> <span class='apc-close' onclick=\"AP.UI.acxRemoveItem(this,'"+ui.item.name+"');\">x</span></div>").insertBefore(this);
				
				$(this).val("");
				
				return false;
			}
		}).focus(function () {
			$(this).autocomplete('search', $(this).val())
		}).enter(function(){
			var v=$(this).val();
			if (!v.length){
				return;
			}
			
			// Check for value
			var results=AP.word.split(",",$(selector).val());
			if (AP.array.within(v, results)){
				// Do nothing
				$(this).val("");
				return false;
			}
			
			results.push(v);
			$(selector).val(results.join(","));
			
			$("<div class='apc-selected fill -bg-alt0'> <span class='apc-text'>"+v+"</span> <span class='apc-close' onclick=\"AP.UI.acxRemoveItem(this,'"+v+"');\">x</span></div>").insertAfter(this);
			
			$(this).val("");
			
			return false;
		});
		
		acc.data("ui-autocomplete")._renderItem = function(ul,item) {
			return $( "<li></li>" ).data("item.autocomplete", item)
				.append( "<span class='ap-acx'><span class='ap-acx-square -bg-alt"+item.color+"'></span> "+item.name+"</span>") 
				.appendTo(ul);
		};
		
		
		if (selected && selected.length){
			$(selector).val(selected.join(","));
			
			for (var i=0; i<selected.length; i++){
				var v=selected[i];
				$("<div class='apc-selected fill -bg-alt0'> <span class='apc-text'>"+v+"</span> <span class='apc-close' onclick=\"AP.UI.acxRemoveItem(this,'"+v+"');\">x</span></div>").insertBefore(selector);
			}
		}
		
		return $this;
	};
	
	
	this.acxRemoveItem= function(selector, item){
		// Check for input
		var input=$(selector).closest('.apcomplete').children("input.marked");
		$(selector).parent().remove();
		var values=AP.word.split(",",$(input).val());
		var newvals=[];
		for (var i=0; i<values.length; i++){
			if (values[i]!=item){
				newvals.push(values[i]);
			}
		}
		$(input).val(newvals.join(","));
	};
			
			
			
			
			
	/**
	 * @desc Get the meta value.
	 */
	this.displayInt= function(v){
		if (v){
			return v;
		}
		return 0;
	};
	
	
	this.copyTextToClipboard = function(text) {
		var textArea = document.createElement("textarea");

		// Place in top-left corner of screen regardless of scroll position.
		textArea.style.position = 'fixed';
		textArea.style.top = 0;
		textArea.style.left = 0;

		// Ensure it has a small width and height. Setting to 1px / 1em
		// doesn't work as this gives a negative w/h on some browsers.
		textArea.style.width = '2em';
		textArea.style.height = '2em';

		// We don't need padding, reducing the size if it does flash render.
		textArea.style.padding = 0;

		// Clean up any borders.
		textArea.style.border = 'none';
		textArea.style.outline = 'none';
		textArea.style.boxShadow = 'none';

		// Avoid flash of white box if rendered for any reason.
		textArea.style.background = 'transparent';


		textArea.value = text;

		document.body.appendChild(textArea);

		textArea.select();

		try {
			var successful = document.execCommand('copy');
			
			UI.flash("{{Copied to clipboard}}");
		} catch (err) {
			return AP.alertSuccess(text);
		}

		document.body.removeChild(textArea);
	};
};



function APComplete(obj, url, multi, callback, ref, filter_fn){
	this.$obj=$(obj);
	this.url=url;
	this.multi=multi;
	this.callback=callback;
	this.__error=false;
	
	var ul_class = '';
	ul_class = this.$obj.data("ul-class") || '';
	
	if (ref && this.$obj){
		this.$target=this.$obj.siblings('.__apc_marked_class');
		
		if (ref.data("ui-autocomplete")){
			this.ref=ref.data("ui-autocomplete").menu.element;
		}else{
			this.ref=null;
		}
	}else{
		this.__error=true;
	}
	
	
	
	this.aco=ref;
	
	this.addClass=function(classname){
		this.$target.data("ui-autocomplete").addClass(classname);
	};
	
	this.render=function(fn){
		if (this.__error){
			return this;
		}
		
		this.$target.data("ui-autocomplete")._renderItem=function(ul, item){
			if (ul_class){
				ul.addClass(ul_class);
			}
			
			return $("<li></li>")
			.data("item.autocomplete", item)
			.append("<a class='rerender ap-acitem'>"+ fn(item)+"</a>")
			.appendTo(ul);
		};
		
		return this;
	};
	
	this.renderEngine=function(fn){
		return this.render(fn);
	};
	
	this.addClass=function(classes){
		if (this.__error){
			return this;
		}
		
		this.ref.addClass(classes);
		return this;
	};
	
	this.css=function(key,val){
		this.ref.css(key,val);
		return this;
	};
	
	this.val=function(value, label){
		if (this.__error){
			return;
		}
		
		if (!this.multi){
			this.$obj.val(value);
			this.$target.val(label);
			return this;
		}else{
			var results=AP.word.split(",",this.$obj.val());
			if (AP.array.within(value, results)){
				this.$target.val("");
				return false;
			}
			results.push(value);
			this.$obj.val(results.join(","));
			$("<div class='apc-selected'> <span class='apc-text'>"+label+"</span> <span class='apc-close' onclick=\"AP.UI.acxRemoveItem(this,'"+value+"');\">x</span></div>").insertBefore(this.$target);
			this.$target.val("");
		}
	};
	
	this.select=function(callback){
		this.$target.data('select_callback', callback);
		return this;
	};
	
	this.onAjaxStart=function(callback){
		this.$target.data('onajaxstart_callback', callback);
		return this;
	};
	
	this.onAjaxEnd=function(callback){
		this.$target.data('onajaxend_callback', callback);
		return this;
	};
};



function ap_createAutoComplete(selector, multivalues){	
	var p=$(selector).parent();
	var id=AP.uuid();
	
	if (!$(p).hasClass('apcomplete')){
		$(selector).data("apcomplete_ref",id);
		
		if ($(selector).hasClass('__hinited')){
			$(selector).prev().hide();
		}
		
		$(p).css("min-height", $(selector).height());
		
		var all_classes="temp disabled __apc_marked_class";
		if (multivalues){
			all_classes="temp disabled _multivalues __apc_marked_class";
		}
		
		$(p).addClass('apcomplete');
		$(p).append("<input type='text' name='"+AP.uuid()+"' id='"+id+"' class=' "+all_classes+"' value='"+$(selector).val()+"'/>");
		
		if ($(selector).attr("title")){
			$('.temp',p).data("htext",$(selector).attr("title"));
			if (!$('.temp',p).val()){
				$('.temp',p).val($('.temp',p).data("htext")).addClass("__blur");
			}
			
			$('.temp',p).blur(function(){
				if (!$('.temp',p).val() || $('.temp',p).val()=="" || $('.temp',p).val()==$('.temp',p).data("htext")){
					$('.temp',p).val($('.temp',p).data("htext")).addClass("__blur");
				}
			}).focus(function(){
				if ($('.temp',p).val()==$('.temp',p).data("htext")){
					$('.temp',p).val("");
				}
				$('.temp',p).removeClass("__blur");
			});
			
			var val=$(selector).val();
			if (val=="" || val==$(selector).attr("title")){
				$(selector).val("");
			}
			
			$('.temp',p).blur();
		}else if ($(selector).data("htext")){
			$('.temp',p).data("htext",$(selector).data("htext"));
			if (!$('.temp',p).val()){
				$('.temp',p).val($('.temp',p).data("htext")).addClass("__blur");
			}
			
			$('.temp',p).blur(function(){
				if (!$('.temp',p).val() || $('.temp',p).val()==""){
					$('.temp',p).val($('.temp',p).data("htext")).addClass("__blur");
				}
			}).focus(function(){
				if ($('.temp',p).val()==$('.temp',p).data("htext")){
					$('.temp',p).val("");
				}
				$('.temp',p).removeClass("__blur");
			});
			$('.temp',p).blur();
		}
		
		$(selector).hide().addClass('marked');
		
		if ($(selector).data('label') && $(selector).data('label').length){
			$('.temp',p).val($(selector).data('label'));
		}
		
		// Add focus when click on parent.
		$(p).click(function(){
			if (!$("#"+id).is(":focus")){
				$("#"+id).focus();
			}
		});
		
		var ph=$(selector).attr('placeholder');
		if (ph && ph.length){
			$("#"+id).attr('placeholder', ph);
		}
		
		return id;
	}else{
		return $("input.temp", p).attr("id");
	}
};





function ap_split( val ) {
	return val.split( /,\s*/ );
};

function ap_extractLast(term){
	return ap_split(term).pop();
};


function ap_extractCurrentString(obj){
	var term=$(obj).val();
	
	if (!term || term.length<2){
		return null;
	}
	var pos=plugin_get_caret_position(obj)-1;
	if (pos <0 || pos>term.length){
		return null;
	}
	var start=pos, end=pos;
	if (term.charAt(start)==','){
		start--;
		if (start<0){
			return null;
		}
	}
	
	while (start>=0){
		if (term.charAt(start)==','){
			start++;
			break;
		}
		start--;
		if (start==0){
			break;
		}
	}
	
	while (end<term.length){
		if (term.charAt(end)==','){
			break;
		}
		end++;
		if (end>=term.length){
			break;
		}
	}

	if (end-start<1){
		return;
	}
	
	var r=$.trim(term.substring(start, end));
	if (!r.length || r.length<1){
		return null;
	}
	return r;
};



function ap_extractInsertString(obj, insert){
	var term=$(obj).val();
	
	if (!term || term.length<1){
		return null;
	}
	var pos=plugin_get_caret_position(obj)-1;
	if (pos <0 || pos>term.length){
		return null;
	}
	var start=pos, end=pos;
	if (term.charAt(start)==','){
		start--;
		if (start<0){
			return null;
		}
	}
	
	while (start>=0){
		if (term.charAt(start)==','){
			start++;
			break;
		}
		start--;
		if (start==0){
			break;
		}
	}
	
	while (end<term.length){
		if (term.charAt(end)==','){
			break;
		}
		end++;
		if (end>=term.length){
			break;
		}
	}

	if (end-start<1){
		return;
	}
	
	var s_end="";
	if (end+1<term.length){
		term.substring(end+1)
	}
	
	var r=$.trim(term.substring(0, start)+' '+insert+', '+s_end);
	return r;
};



function ap_getTimeOptions(){ 
	var hours=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"];
	var mins=["00","15","30","45"];
	var a=[];
	for (var i=0; i<hours.length; i++){
		for (var j=0; j<mins.length; j++){
			a.push(hours[i]+":"+mins[j]);
		}
	}
	return a;
};


















'use strict';

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function Sektor(selector, options) {
  this.element = $(selector)[0];

  var defaultOptions = {
	size: 100,
	stroke: 10,
	arc: false,
	angle: 225,
	sectorColor: '#789',
	circleColor: '#DDD',
	fillCircle: true
  };

  // Merge options with default ones
  options = _extends(defaultOptions, options);

  // Reset stroke to 0 if drawing full sector
  options.stroke = options.arc ? options.stroke : 0;

  // Circle dimenstions
  options.center = options.size / 2;
  options.radius = options.stroke ? options.center - options.stroke / 2 : options.center;

  this.options = options;

  this.checkAngle();

  var svg = '<svg class=\'Sektor\' viewBox=\'0 0 ' + options.size + ' ' + options.size + '\'>\n	  ' + this.getCircle() + '\n	  ' + this.getSector() + '\n	</svg>';

  this.element.innerHTML = svg;
  this.sector = this.element.querySelector('.Sektor-sector');
}

Sektor.prototype.checkAngle = function () {
  if (this.options.angle > 360) {
	this.options.angle = this.options.angle % 360;
  }
};

Sektor.prototype.changeAngle = function (angle) {
  this.options.angle = angle;
  this.checkAngle();
  this.sector.setAttribute('d', this.getSector(true));
};

Sektor.prototype.step = function (angleOffset, endAngle, time, endTime) {
  var _this = this;

  var now = new Date().valueOf();
  var timeOffset = endTime - now;

  if (timeOffset <= 0) {
	this.changeAngle(endAngle);
  } else {
	var angle = endAngle - angleOffset * timeOffset / time;

	this.changeAngle(angle);
	requestAnimationFrame(function () {
	  return _this.step(angleOffset, endAngle, time, endTime);
	});
  }
};

Sektor.prototype.animateTo = function (angle) {
  var _this2 = this;

  var time = arguments.length <= 1 || arguments[1] === undefined ? 300 : arguments[1];

  if (angle > 360) {
	angle = angle % 360;
  }

  var startTime = new Date().valueOf();
  var endTime = startTime + time;
  var angleOffset = angle - this.options.angle;

  requestAnimationFrame(function () {
	return _this2.step(angleOffset, angle, time, endTime);
  });
};

Sektor.prototype.getSector = function () {
  var returnD = arguments.length <= 0 || arguments[0] === undefined ? false : arguments[0];

  var options = this.options;

  // Colors
  var sectorFill = options.arc ? 'none' : options.sectorColor;
  var sectorStroke = options.arc ? options.sectorColor : 'none';

  // Arc angles
  var firstAngle = options.angle > 180 ? 90 : options.angle - 90;
  var secondAngle = -270 + options.angle - 180;

  // Arcs
  var firstArc = this.getArc(firstAngle, options);
  var secondArc = options.angle > 180 ? this.getArc(secondAngle, options) : '';

  // start -> starting line
  // end -> will path be closed or not
  var end = '';
  var start = null;

  if (options.arc) {
	start = 'M' + options.center + ',' + options.stroke / 2;
  } else {
	start = 'M' + options.center + ',' + options.center + ' L' + options.center + ',' + options.stroke / 2;
	end = 'z';
  }

  var d = start + ' ' + firstArc + ' ' + secondArc + ' ' + end;

  if (returnD) {
	return d;
  }

  return '<path\n	class=\'Sektor-sector\'\n	stroke-width=\'' + options.stroke + '\'\n	fill=' + sectorFill + '\n	stroke=' + sectorStroke + '\n	d=\'' + d + '\' />';
};

Sektor.prototype.getCircle = function () {
  var options = this.options;
  var circleFill = options.fillCircle || !options.arc ? options.circleColor : 'none';

  return '<circle\n	  class=\'Sektor-circle\'\n	  stroke-width=\'' + options.stroke + '\'\n	  fill=' + circleFill + '\n	  stroke=' + options.circleColor + '\n	  cx=\'' + options.center + '\'\n	  cy=\'' + options.center + '\'\n	  r=\'' + options.radius + '\' />';
};

// Generates SVG arc string
Sektor.prototype.getArc = function (angle) {
  var options = this.options;

  var x = options.center + options.radius * Math.cos(this.radians(angle));
  var y = options.center + options.radius * Math.sin(this.radians(angle));

  return 'A' + options.radius + ',' + options.radius + ' 1 0 1 ' + x + ',' + y;
};

// Converts from degrees to radians.
Sektor.prototype.radians = function (degrees) {
  return degrees / 180 * Math.PI;
};


AP.scrollBar=function __APScrollBar(selector){
	return new APScrollBar($(selector));
};


function APScrollBar($obj){
	this.$obj=$obj;
	
	this.init=function(temp){
		temp=false;
		if (temp){
			temp=true;
		}
		
		
		if (AP.sys.isTablet() || AP.sys.isMobile() || AP.__printing || Client.mobile){
			$obj.addClass("__mscroll");
			return this;
		}
		
		
		if (this.$obj.hasClass('__apscrollbar_target')){
			plugin_scrollbar_onscroll(this.$obj);
			return this;
		}
		
		var id=this.$obj.attr('id');
		if (!id){
			id=AP.uuid();
			this.$obj.attr('id', id);
		}
		
		this.$obj.addClass('__apscrollbar_target');
		if (this.$obj.parent().data('autoscroll')){
			this.$obj.addClass('__scrolled');
		}
		
		
		if (this.$obj.parent().hasClass('__apscrollbar_parent')){
			return this;
		}
		
		this.$obj.parent().addClass('__apscrollbar_parent');
		
		
		if (this.$obj.parent().data("autohide")){
			this.$obj.parent().addClass("__autohide");
			this.$obj.wrapInner("<div class='__apscrollbar_wrap __autohide' style='padding-right:0px'></div>");
		}else{
			this.$obj.addClass("__regular").wrapInner("<div class='__apscrollbar_wrap'></div>");	
		}
		
		$("<div id='"+id+"__apscrollbar' class='__apscrollbar'> <div class='scroller'>" +
					"<div class='sinner'></div> "+
				"</div> </div>").appendTo(this.$obj.parent());

		
		$("#"+id+"__apscrollbar .scroller").draggable({
			axis:"y",
			start: function(){
				$("#"+id).addClass('__scrollprevented');
			},
			drag: function(){
				plugin_scrollbar_update($(this));
			},
			stop: function(){
				plugin_scrollbar_update($(this));
				$("#"+id).removeClass('__scrollprevented');
			},
			containment: "parent"
		});
		
		
		this.$obj.on("scroll", function(){
			if ($(this).hasClass('__scrollprevented')){
				// $(this).removeClass('__scrollprevented')
				return;
			}

			return plugin_scrollbar_onscroll($(this));			
		});
		
		plugin_scrollbar_update($('#'+id+'__apscrollbar .scroller'));
		
		setTimeout(function(){
			plugin_scrollbar_update($('#'+id+'__apscrollbar .scroller'));
		},1000);
		
		setTimeout(function(){
			plugin_scrollbar_update($('#'+id+'__apscrollbar .scroller'));
		},5000);
		
		return this;
	};
	
	
	/**
	 * @desc ScrollTo a specific pixel height
	 */
	this.scrollTo=function(num){
		// var h=this.$obj.height();
		// var maxh=this.$target[0].scrollHeight;
		
		this.$obj.scrollTop(num);
	};
	
	
	this.update=function(){
		if (AP.sys.isTablet() || AP.sys.isMobile() || AP.__printing || Client.mobile){
			return this;
		}
		
		plugin_scrollbar_update($("#"+this.$obj.attr('id')+"__apscrollbar .scroller"));
		return this;
	};
};



function plugin_scrollbar_update($obj){
	var offset=$obj.position();
	
	var $scroller=$obj.parent();	
	var $scroller_rec=$obj;
	
	var $target=$scroller.prevAll('.__apscrollbar_target');
	if (!$target || !$target.length){
		return;
	}
	
	var h=$target.height();
	var maxh=$target[0].scrollHeight;
	
	var auto=$obj.closest('.__apscrollbar_parent').data('autoscroll');
	
	
	if (maxh<=h){
		if (!auto){
			$scroller.hide();
			$target.scrollTop(0);
			$target.scrollLeft(0);
			$target.removeClass('__scrolled');
			$scroller.hide();
			return;	
		}else{
			$scroller_rec.hide();
			$target.addClass('__scrolled');
			return;
		}
	}
	
	$scroller.show();
	$scroller_rec.show();
	
	if (maxh<10 || h<10){
		/**
		 * @todo Finish this weird case 
		 */
		return;
	}
	
	var sh=$scroller.height();
	
	if (sh<=$obj.height()){
		$target.scrollTop(maxh-h);
		return;
	}
	
	var scale=$scroller.parent().data("scale");
	if (!scale){
		scale=1.0;
	}else{
		scale=parseFloat(scale);
	}
	
	scale=1.0;
	
	var ttop=(maxh-h)*offset.top*1.0/(sh-$obj.height());
	ttop=Math.floor(ttop);
	
	$target.scrollTop(ttop);
	$target.scrollLeft(0);
};



function plugin_scrollbar_onscroll($obj){
	var alwayshown=$obj.parent().data('autoscroll');
	var autohide=$obj.parent().data('autohide');
	
	if (!$obj.is(':visible')){
		return;
	}
	
	// $obj.scrollLeft(0);
	// return;
	
	var t=$obj.scrollTop();
	var h=$obj.height();
	
	if (!('scrollHeight' in $obj[0])){
		return;
	}
	
	
	
	var maxh=$obj[0].scrollHeight;
	var $scroller=$("#"+$obj.attr('id')+"__apscrollbar");
	
	if (maxh<h || maxh<10){
		if (!alwayshown){
			$obj.removeClass('__scrolled');
			$scroller.hide();	
		}
		return;
	}
	
	
	if (maxh==h){
		if (!alwayshown){
			$obj.removeClass('__scrolled');
			$scroller.hide();	
		}
		return;
	}
	
	
	if (!$obj.hasClass('__scrolled')){
		$obj.addClass('__scrolled');
	}
	
	
	$scroller.show();
	
	if (h<0){
		return;
	}
	
	
	
	var sh=$scroller.height();
	var scale=$scroller.parent().data("scale");
	
	if (!scale || typeof scale=="undefined"){
		scale=1.0;
	}else{
		scale=parseFloat(scale);
	}
	
	var scroller={}; 
	scroller.height=Math.floor((h*1.0/maxh)*(h*1.0/maxh) *sh)*scale;
	if (autohide){
		scroller.height=Math.floor((h*1.0/maxh)*sh)*scale;
	}
	
	if (scroller.height<50){
		scroller.height=50;
	}
	
	scroller.top=Math.floor(Math.min(t*1.0/(maxh-h), 1) * (sh-scroller.height));

	
	$scroller.children('.scroller').css({'top': scroller.top, 'height': scroller.height}).addClass('active').show();
	$scroller.find('.sinner').css('height',scroller.height-1);
};


AP.pageConfig=new function __APPageConfig(){
	this.data={};
	this.__data={};
	
	this.init=function(data){
		this.__data=shallowClone(data);
		this.data=data;
	};
	
	this.reset=function(){
		this.data=shallowClone(this.__data);
		if (!this.data){
			this.data={};
		}
	};
	
	this.set=function(key, val){
		if (typeof val=="undefined"){
			val=1;
		}
		
		this.data[key]=val;
	};
	
	this.get=function(key){
		if (key in this.data){
			return this.data[key];
		}
		
		return null;
	};
	
	
	this.test=function(){
		$.log(this.data);
		$.log(this.__data);
	}
};



var APViewer = new function _APViewer(){
	this.auth=function(){
		if (Client.viewer && Client.viewer.id && Client.viewer.id>0){
			return true;
		}
		return false;
	};
};
var Support = new function () {

	this.init = function () {
		var _return = Query.get('return');
		var _q = Query.get("job");

		$('input[name="search-string"]').val(_q);

		if (_return && _return !== "") {
			$('html, body').animate({
				scrollTop: $("#alljobs").offset().top-150
			}, 500, 'linear');
		}
	};


	this.searchLocation = function (ref) {
		var value = purify($(ref).val());

		var list_location = $("#locations").find('.option');

		$.each(list_location, function (index, element) {
			var option_value = purify($(element).data('value')).toLowerCase();
			if (option_value.indexOf(value) >= 0) {
				$(element).show();
			} else {
				$(element).hide();
			}
		});
	};

	/**
	 * @desc search office of opening
	 *
	 * @param ref
	 */
	this.searchOffice = function (ref) {
		var $select = $(ref);
		var value = purifyStrict($select.val());

		var list_option = $("#offices").find('.option');

		$.each(list_option, function (index, element) {
			var option_search = purifyStrict($(element).data('search'));
			if (option_search.indexOf(value) >= 0) {
				$(element).show();
			} else {
				$(element).hide();
			}
		});
	};


	this.search = function (ref, e, need_set_url) {
		var $canvas = $(ref);
		var _event = (typeof e !== "undefined") ? e : false;
		var _need_set_url = (typeof need_set_url !== "undefined") ? need_set_url : false;
		var _q = null;
		var search_type = $canvas.data('search-type');
		var search_key = "job";
		var params = {
			return: 1
		};

		if (_need_set_url  === true) {
			AP.setURL('jobs');
		}

		if (typeof search_type !== "undefined") {
			search_key = "q";
		}

		if ($canvas.is("input") && _event.keyCode === 13) {
			_q = $canvas.val();

			if (_q !== '' && _q !== null) {
				params[search_key] = encodeURIComponent(_q).toLowerCase();
				AP.setURLParams(params);
			} else {
				params[search_key] = null;
				AP.setURLParams(params);
			}
	
			return AP.refresh();
		} else if ($canvas.is("button")) {
			_q = $('input[name="search-string"]').val();

			if (_q !== '' && _q !== null) {
				params[search_key] = encodeURIComponent(_q).toLowerCase();
				AP.setURLParams(params);
			} else {
				params[search_key] = null;
				AP.setURLParams(params);
			}

			return AP.refresh();
		}
	};

};var Career = new function __Career() {

	this.init = function () {
		var locationSelected = Query.get('location');
		var jtypeSelected = Query.get('type');
		var deptSelected = Query.get('dept');

		if (locationSelected) {
			var locations = locationSelected.split(',');
			$.each(locations, function (index, value) {
				$('.js-loc-' + value).prop('checked', true);
			});
		}

		if (deptSelected) {
			var depts = deptSelected.split(',');
			$.each(depts, function (index, value) {
				$('.js-dept-' + value).prop('checked', true);
			});
		}

		if (jtypeSelected) {
			var types = jtypeSelected.split(',');
			$.each(types, function (index, value) {
				$('.jobtype[value="' + value + '"]').prop('checked', true);
			});
		}
	};

	this.searchName = function () {
		var q = $('input[name="search-string"]').val();
		AP.setURL('careers/jobs');

		if (q != '' && q != null) {
			AP.setURLParams({
				"job": encodeURIComponent(q).toLowerCase(),
				"return": "1"
			});
		} else {
			AP.setURLParams({
				"job": null,
				"return": "1"
			});
		}

		return AP.refresh();
	};

	this.action = function (ref, event) {
		if (event.keyCode == 13) {
			var q = $(ref).val();
			AP.setURL('careers/jobs');

			if (q != '' && q != null) {
				AP.setURLParams({
					"job": encodeURIComponent(q).toLowerCase(),
					"return": "1"
				});
			} else {
				AP.setURLParams({
					"job": null,
					"return": "1"
				});
			}

			return AP.refresh();
		}
	};

	this.initV1 = function () {
		$('#locations').append(AP.render(Client.pageData.offices, function (e) {
			return "<div class='li'><div class='check-action dpb ap-xdot'><input type='checkbox' class='check_row location js-loc-"+e.id+"' name='job-location' value='"+e.id+"'><span class='icon'></span>"+e.name+"</div></div>";
		}));

		$("input[type='checkbox']").change(function () {
			$('.button.main').removeClass('disabled');
		});

		$("#location-search").on("input", function(){
			var q = $(this).val();
			Career.search(q, 'location');
		});

		$("#department-search").on("input", function(){
			var q = $(this).val();
			Career.search(q, 'department');
		});

		this.init();
	};

	this.checkAll = function (ref) {
		if (typeof ref != 'undefined') {
			if ($(ref).data('check') == 'location') {
				if ($(ref).prop('checked') == false) {
					$('.location').prop('checked', false);
				} else {
					$('.location').prop('checked', true);
				}
			} else if ($(ref).data('check') == 'jobtype') {
				if ($(ref).prop('checked') == false) {
					$('.jobtype').prop('checked', false);
				} else {
					$('.jobtype').prop('checked', true);
				}
			} else if ($(ref).data('check') == 'department') {
				if ($(ref).prop('checked') == false) {
					$('.department').prop('checked', false);
				} else {
					$('.department').prop('checked', true);
				}
			}
		}
	};

	this.filter = function (ref) {
		var location = $("input[name='job-location']:checked");
		var type = $("input[name='job-type']:checked");
		var dept = $("input[name='job-dept']:checked");
		var queryL = '';
		var queryT = '';
		var queryD = '';

		if (location.length > 0) {
			$.each(location, function (index, e) {
				var office_id = $(e).val();
				queryL += office_id + ',';
			});
		}

		queryL = queryL.substring(0, queryL.length - 1);

		if (dept.length > 0) {
			$.each(dept, function (index, e) {
				queryD += $(e).val() + ',';
			});
		}

		queryD = queryD.substring(0, queryD.length - 1);

		if (type.length > 0) {
			$.each(type, function (index, e) {
				queryT += $(e).val() + ',';
			});
		}

		queryT = queryT.substring(0, queryT.length - 1);

		return AP.redirect('jobs?location=' + queryL + '&type=' + queryT + '&dept=' + queryD + '&return=1');
	};

	this.filterAll = function (ref) {
		var location = $("input[name='job-location']:checked");
		var type = $("input[name='job-type']:checked");
		var dept = $("input[name='job-dept']:checked");
		var queryL = '';
		var queryT = '';
		var queryD = '';
		if (location.length > 0) {
			$.each(location, function (index, e) {
				queryL += $(e).val() + ',';
			});
		}

		queryL = queryL.substring(0, queryL.length - 1);

		if (dept.length > 0) {
			$.each(dept, function (index, e) {
				queryD += $(e).val() + ',';
			});
		}

		queryD = queryD.substring(0, queryD.length - 1);

		if (type.length > 0) {
			$.each(type, function (index, e) {
				queryT += $(e).val() + ',';
			});
		}

		queryT = queryT.substring(0, queryT.length - 1);

		return AP.redirect('alljobs?location=' + queryL + '&type=' + queryT + '&dept=' + queryD + '&return=1');
	};

	this.resetAll = function (ref) {
		return AP.redirect('alljobs');
	};


	this.search = function (query, type) {

		if (!query || !query.length) {
			$("#locations > .li").show();
			$("#departments > .li").show();
			return;
		}

		query = query.toLowerCase();

		if (typeof type != 'undefined') {
			if (type == 'location') {
				$("#locations > .li").each(function () {
					var input = $(this).find(".check-action").text().toLowerCase();

					if (input.indexOf(purify(query)) >= 0) {
						$(this).show();
					} else {
						$(this).hide();
					}
				});
			} else if (type == 'department') {
				$("#departments > .li").each(function () {
					var input = $(this).find(".check-action").text().toLowerCase();

					if (input.indexOf(purify(query)) >= 0) {
						$(this).show();
					} else {
						$(this).hide();
					}
				});
			}
		}
	};

	/**
	 * @desc get openings of office
	 *
	 * @param office_id
	 * @returns []
	 */
	function getOpenings(office_id) {
		var office = AP.array.findObj(Client.pageData.offices, office_id);

		if (!office || !office.data.openings || office.data.openings.length === 0) {
			return [];
		}

		return office.data.openings;
	}
}();


"use strict";

function _instanceof(left, right) { if (right != null && typeof Symbol !== "undefined" && right[Symbol.hasInstance]) { return right[Symbol.hasInstance](left); } else { return left instanceof right; } }

function _classCallCheck(instance, Constructor) { if (!_instanceof(instance, Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var Opening =
	/*#__PURE__*/
	function () {
		function Opening(options) {
			var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Client.pageData.openings;

			_classCallCheck(this, Opening);

			this.data = data;
			var defaultOptions = {
				lang: "vi",
				dept: true,
				paginate: {
					limit: 10,
					loadMoreText: "Náº¡p thÃªm tin tuyá»n dá»¥ng"
				}
			};

			if (typeof options !== 'undefined') {
				this.options = Object.assign(defaultOptions, options);
			} else {
				this.options = defaultOptions;
			}

			if (data.length >= this.options.paginate.limit) {
				this.limit = this.options.paginate.limit;
				this.hasMore = true;
			} else {
				this.limit = data.length;
				this.hasMore = false;
			}

			if (this.options.lang === "vi") {
				this.jobTypes = {
					"ft": "Fulltime (toÃ n thá»i gian)",
					"pt": "Parttime (bÃ¡n thá»i gian)",
					"it": "Intern (thá»±c táº­p)",
					"cs": "Contract (há»£p Äá»ng ngáº¯n háº¡n)",
					"fl": "Freelancer",
					"vl": "Volunteer"
				};
			} else if (this.options.lang === 'en') {
				this.jobTypes = {
					"ft": "Fulltime",
					"pt": "Parttime",
					"it": "Intern",
					"cs": "Contract",
					"fl": "Freelancer",
					"vl": "Volunteer"
				};
			}

			this.searchInput = 'input[name="search-string"]';
			var go = Query.get('return');

			if (go != null && go !== '') {
				$(document).scrollTop($("#alljobs").offset().top);
			}

			this.fillInput();
		}

		_createClass(Opening, [{
			key: "fillInput",
			value: function fillInput() {
				var query = Query.all();
				var queryInput = document.querySelector(this.searchInput);

				if (typeof query.job !== "undefined") {
					queryInput.value = query.job;
				}
			}
		}, {
			key: "load",
			value: function load() {
				var _this = this;

				var canvas = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '#load-more';
				var loadMoreButton = document.querySelector(canvas);
				loadMoreButton.addEventListener('click', function () {
					loadMoreButton.style.display = "none";

					_this.renderFull("#alljobs .jobs");
				});
			}
		}, {
			key: "renderTo",
			value: function renderTo() {
				var canvas = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '#jobs';
				var element = document.querySelector(canvas);

				for (var i = 0; i < this.limit; i++) {
					element.insertAdjacentHTML("beforeend", this.htmlOpening(this.data[i]));
				}

				if (this.hasMore === true) {
					element.insertAdjacentHTML("beforeend", Opening.htmlLoad(this.options));
					this.load();
				}
			}
		}, {
			key: "renderFull",
			value: function renderFull() {
				var canvas = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '#jobs';
				var element = document.querySelector(canvas);

				for (var i = this.limit; i < this.data.length; i++) {
					element.insertAdjacentHTML("beforeend", this.htmlOpening(this.data[i]));
				}
			}
		}, {
			key: "htmlOpening",
			value: function htmlOpening(opening) {
				var department = '';

				if (typeof this.options.dept !== "undefined" && this.options.dept === true) {
					department = opening.department.link + "<span class='icon -ap icon-dot-single'></span>";
				}

				return "\n        <div class='item'>\n            <h3 class='title'>\n                <a href='".concat(opening.url, "'>").concat(opening.name, "</a>\n            </h3>\n\n            <div class='info'>\n                ").concat(department).concat(opening.offices_link_full, "            </div>\n            <div class='info'>").concat(opening.display.type, " <span class=\"icon -ap icon-dot-single\"></span> ").concat(opening.display.salary, "</div>\n\n\n            <div class='side'>\n                <a href='").concat(opening.url, "?apply=1' class='cta'>").concat(this.translate("á»¨ng tuyá»n", "Apply now"), "</a>\n            </div>\n        </div>\n        ");
			}
		}, {
			key: "getJobType",
			value: function getJobType(val) {
				return this.jobTypes[val];
			}
		}, {
			key: "getSalary",
			value: function getSalary(salary) {
				if (parseInt(salary.display) === 1) {
					return "\n                ".concat(parseInt(salary.min).toLocaleString('en-US'), " \u2014 ").concat(parseInt(salary.max).toLocaleString('en-US'), " ").concat(salary.currency_text, "\n            ");
				} else {
					return "\n                <b>".concat(this.translate("LÆ°Æ¡ng thá»a thuáº­n", "Negotiation"), "</b>\n            ");
				}
			}
		}, {
			key: "translate",
			value: function translate(vi, en) {
				if (this.options.lang === "en") {
					return en;
				} else {
					return vi;
				}
			}
		}], [{
			key: "htmlLoad",
			value: function htmlLoad(options) {
				return "\n            <div class='item more' id=\"load-more\">\n                <i class=\"icon ficon-caret-down\"></i> ".concat(options.paginate.loadMoreText, "\n            </div>\n        ");
			}
		}]);

		return Opening;
	}();

var WTAjaxDialogEngine=new function __WTAjaxDialogEngine(){
	
	this.canvas=function(){
		return $("#apdialogs");
	};
	
	/**
	 * @desc Render the dialog.
	 */
	this.render=function(dialog){	
		$(dialog.canvas()).append("" +
			"<div class='__wtajaxdialog' id='"+dialog.w(true)+"'>" +
				"<div class='__dialogwrapper'>" +
					"<div class='__dialogwrapper-inner'>" +
						"<div class='__dialogmain'>" +
							"<div class='__dialogtitle'>"+"&nbsp;</div>"+
							"<div class='__dialogcontent'><span style='font-size:32px' class='ficon-spinner ficon-spin'></span> <p>Processing</p></div>" +
						"</div>"+
					"</div>"+
				"</div>"+
			"</div>");
	};
	
	
	/**
	 * @desc Balancing the dialog.
	 */
	this.balance=function(dialog){
		var wid=dialog.w();
		var t=$(window).height()/2- $(wid+' .__dialogwrapper').outerHeight(true)/2-45;
		var l=$(window).width()/2- $(wid+' .__dialogwrapper').outerWidth(true)/2;
		if (t<50){
			t=50;
		}
		
		$(wid+' .__dialogwrapper').css('top', t).css('left', l);
	};
};





var WTDialogEngine=new function __DialogEngine(){
	this.canvas=function(){
		return $("#apdialogs");
	};
	
	/**
	 * @desc Render the dialog.
	 */
	this.render=function(dialog){	
		$(dialog.canvas()).append("" +
			"<div class='__wtdialog' id='"+dialog.w(true)+"'>" +
				"<div class='__dialogwrapper'>" +
					"<div class='__dialogwrapper-inner'>" +
						"<div class='__dialogmain'>" +
							"<div class='__dialogtitle unselectable' onclick=\"AP.dialog('"+dialog.id()+"').balance();\">"+"&nbsp;</div>"+
							"<div class='__dialogclose' onclick=\"AP.dialog('"+dialog.id()+"').hide();\"><span class='-ap icon-close'></span> </div>"+
							"<div class='__dialogcontent'></div>" +
							"<div class='__dialogbuttons unselectable'></div>"+
						"</div>"+
					"</div>"+
				"</div>"+
			"</div>");
	};
	
	
	/**
	 * @desc Balancing the dialog.
	 */
	this.balance=function(dialog){
		var wid=dialog.w();
		var t=$(window).height()/2- $(wid+' .__dialogwrapper').outerHeight(true)/2-30;
		var l=$(window).width()/2- $(wid+' .__dialogwrapper').outerWidth(true)/2;
		if (t<50){
			t=50;
		}
		
		$(wid+' .__dialogwrapper').css('top', t).css('left', l);
		$(wid+' .__dialogwrapper .__buttons .button:last').focus();
	};
};









var FormDialogEngine=new function __FormDialogEngine(){
	this.canvas=function(){
		return $("#apdialogs");
	};
	
	/**
	 * @desc Render the dialog.
	 */
	this.render=function(dialog){	
		$(dialog.canvas()).append("" +
			"<div class='__fdialog' id='"+dialog.w(true)+"'>" +
				"<div class='__dialogwrapper'>" +
					"<div class='__dialogwrapper-inner'>" +
						"<div class='__dialogmain'>" +
							"<div class='__dialogtitlewrap'><div class='left relative'><div class='__dialogtitle unselectable ap-xdot' onclick=\"AP.dialog('"+dialog.id()+"').balance();\">"+"&nbsp;</div><div class='__dialogtitlerender tx-fill'></div></div> <div class='clear'></div></div>"+
							"<div class='__dialogclose' onclick=\"AP.dialog('"+dialog.id()+"').hide();\"><span class='-ap icon-close'></span> </div>"+
							"<div class='__dialogcontent'></div>" +
						"</div>"+
					"</div>"+
				"</div>"+
			"</div>");
	};
	
	
	/**
	 * @desc Balancing the dialog.
	 */
	this.balance=function(dialog){
		var wid=dialog.w();
		var t=$(window).height()/2- $(wid+' .__dialogwrapper').outerHeight(true)/2-30;
		var l=$(window).width()/2- $(wid+' .__dialogwrapper').outerWidth(true)/2;
		if (t<50){
			t=50;
		}
		
		$(wid+' .__dialogwrapper').css('top', t).css('left', l);
		$(wid+' .__dialogwrapper .__buttons .button:last').focus();
	};
};






var FormDialogEngine2=new function __FormDialogEngine(){
	this.canvas=function(){
		return $("#apdialogs");
	};
	
	/**
	 * @desc Render the dialog.
	 */
	this.render=function(dialog){	
		$(dialog.canvas()).append("" +
			"<div class='__fdialog' id='"+dialog.w(true)+"'>" +
				"<div class='__dialogwrapper'>" +
					"<div class='__dialogwrapper-inner'>" +
						"<div class='__dialogmain'>" +
							"<div class='__dialogtitlewrap nd'><div class='__dialogtitle unselectable' onclick=\"AP.dialog('"+dialog.id()+"').balance();\"></div></div>"+
							"<div class='__dialogclose' onclick=\"AP.dialog('"+dialog.id()+"').hide();\"><span class='-ap icon-close'></span> </div>"+
							"<div class='__dialogcontent'></div>" +
						"</div>"+
					"</div>"+
				"</div>"+
			"</div>");
	};
	
	
	/**
	 * @desc Balancing the dialog.
	 */
	this.balance=function(dialog){
		var wid=dialog.w();
		var t=$(window).height()/2- $(wid+' .__dialogwrapper').outerHeight(true)/2-30;
		var l=$(window).width()/2- $(wid+' .__dialogwrapper').outerWidth(true)/2;
		if (t<50){
			t=50;
		}
		
		$(wid+' .__dialogwrapper').css('top', t).css('left', l);
		$(wid+' .__dialogwrapper .__buttons .button:last').focus();
	};
	
	
	
};







var FormDialogMobile=new function __FormDialogMobile(){
	this.canvas=function(){
		return $("#apdialogs");
	};
	
	
	/**
	 * @desc Render the dialog.
	 */
	this.render=function(dialog){	
		$(dialog.canvas()).append("" +
			"<div class='__mobiledialog' id='"+dialog.w(true)+"'>" +
				"<div class='__dialogwrapper'>" +
					"<div class='__dialogwrapper-inner'>" +
						"<div class='__dialogmain'>" +
							"<div class='__dialogclose' onclick=\"AP.dialog('"+dialog.id()+"').hide();\"><span class='-ap icon-close'></span> </div>"+
							"<div class='__dialogtitle unselectable ap-xdot'>"+"</div>" +
							"<div class='__dialogcontent'></div>" +
						"</div>"+
					"</div>"+
				"</div>"+
			"</div>");
	};
	
	
	/**
	 * @desc Balancing the dialog.
	 */
	this.balance=function(dialog){
		return this;
	};
	
	
	this.width=function(w){
		return;
	};
};var UploadDialogEngine=new function __UploadDialogEngine(){
	inherits(this, WTDialogEngine);
	
	/**
	 * @desc Render the dialog.
	 */
	this.render=function(dialog){		
		$(dialog.canvas()).append("" +
			"<div class='__uploaddialog unselectable' id='"+dialog.w(true)+"'>" +
				"<div class='__dialogwrapper'>" +
					"<div class='__dialogwrapper-inner'>" +
						"<div class='__dialogmain'>" +
							"<div class='__dialogtitle'>"+"&nbsp;</div>"+
							"<div class='__dialogclose' onclick=\"$('#"+dialog.data('form')+"').multiUpload('close');\"><div class='entypo ticon-cancel'></div> </div>"+
							"<div class='__dialogcontent'></div>" +
							"<div class='__dialogbuttons unselectable'></div>"+
						"</div>"+
					"</div>"+
				"</div>"+
			"</div>");
	};
};AP.sys.on("page.pre.transition", function(data){
	$("#ptransit").show();
	loadBar("#ptransit", true);
});

AP.sys.on("page.post.transition", function(data){
	setTimeout(function(){
		loadBar("#ptransit", false);
	},500);
});


AP.sys.on("form.pre.submit", function(selector){
	if (Client.pageData.event && Client.pageData.event.id){
		$(selector).append("<input type='hidden' name='__event' value='"+Client.pageData.event.id+"'/>");
	}
});


AP.adaptive=function(u1, u2){
	if (!AP.word.prefix(u1, Client.url) || !AP.word.prefix(u2, Client.url)){
		return false;
	}
	
	var p1=getBasePath(u1);
	var p2=getBasePath(u2);
	if (p1==p2){
		return true;
	}
	
	return false;
};


function getBasePath(u2){
	if (!AP.word.prefix(u2, Client.url)){
		return null;
	}
	
	var strs=u2.substr(Client.url.length).split("/");
	if (strs.length<2){
		return null;
	}
	
	return strs[1];
};




function documentInit(){
	AP.initPageData();
	Client.title=document.title;
	nsUpdate();
	
	if (!Client.viewer || !Client.viewer.id){
	}else{
		Layout.start();
	}
};



function nsUpdate(){
	if (Client.pageData.user){
		if (!Client.data.user){
			Client.data.user=Client.pageData.user;
			AP.sys.fire("user.changed", Client.data.user, null);
		}else{
			if (Client.data.user.id!=Client.pageData.user.id){
				Client.data.user=Client.pageData.user;
				AP.sys.fire("user.changed", Client.pageData.user, Client.data.user);
			}else{
				Client.data.user=Client.pageData.user;
				AP.sys.fire("user.unchanged", Client.data.user);
			}
		}
		
		// W.log.setAdv('users', {"id":Client.data.user.id, "username": Client.data.user.username, "gavatar": Client.pageData.user.gavatar});
		// W.log.set('networks',-Client.data.user.id);
	}else{
		Client.data.user=null;
	}
	
	
	if (Client.pageData.network){
		if (!Client.data.network){
			Client.data.network=Client.pageData.network;
			AP.sys.fire("network.changed", Client.data.network, null);
		}else{
			if (Client.data.network.id!=Client.pageData.network.id){
				Client.data.network=Client.pageData.network;
				AP.sys.fire("network.changed", Client.pageData.network, Client.data.network);
			}else{
				Client.data.network=Client.pageData.network;
				AP.sys.fire("network.unchanged", Client.data.network);
			}
		}
		
		// W.log.set('networks', Client.data.network.id);
		
		
	}else{
		Client.data.network=null;
		// AP.sys.fire("network.change", network, null);
	}
};




function ap_update(selector, data){
	$(selector).html(data);
	AP.setContinuousRequest(selector);
	AP.html.init(selector);
};




function reset_page(callback){
	$("#page").children().remove();
	$("#page").empty().html("&nbsp;");
	// Clear lock
	
	AP.__lock=false;
	
	AP.resetPageData();
	AP.sys.fire("page.pre.transition");
	
	if (callback){
		callback();
	}
};

function update_page(data){
	$('#master').removeClass();
	ap_update("#page", data);
	
	window.scrollTo(0,0);
	$("#ap-data").empty();
	
	documentInit();
	
	AP.sys.fire("page.post.transition");
	AP.sys.fire(AP.EVENTS.PAGE_UNLOAD);
	
	
	if (AP.isset('FB')){
		try{
	        FB.XFBML.parse(); 
	    }catch(ex){};	
	}
};










function loadBar(canvas, status){
	if (!status){
		$(canvas).hide();
		$(canvas).data("lock", false);
		stopBar(canvas, 4)
	}else{
		$(canvas).data("lock", true);
		loadBarAnimation(canvas);
	}
};

function stopBar(canvas, len){
	for (var i=0; i<len; i++){
		$(canvas).find('.bar:eq('+i+') .anim').css({width: 0});			
	}
	
	for (var i=0; i<len; i++){
		$(canvas).find('.bar-'+i).appendTo(canvas);
	}
	
	$(canvas).data("ab",0);
}

function loadBarAnimation(canvas){
	var c=['#F03C32','#09A5E3','FFD726','#08D119'];
	var len=c.length;
	
	if (!$(canvas).data('__bars')){
		for (var i=0; i<len; i++){
			$(canvas).append("<div class='bar bar-"+i+"'><div  style='background-color:"+c[i]+"' class='anim'></div></div>");
		}
	}

	$(canvas).data('__bars',1);
	
	$(canvas).find('.bar:eq(0) .anim').show().css("width","100%");
	$(canvas).data('lock', true);
	$(canvas).show();
	
	animateBar(canvas, len);
};

function animateBar(canvas, len){
	var lock=$(canvas).data("lock");
	if (!lock){
		return;
	}
	
	var index=$(canvas).data("ab");
	if (!index){
		index=0;
	}
	index++;
	
	if (index>=len){
		index=0;
		
		for (var i=0; i<len-1; i++){
			$(canvas).find('.bar:eq('+i+') .anim').css({width: 0});			
		}
		$(canvas).find('.bar:last').prependTo(canvas);
		index++;
	}
	

	$(canvas).data("ab",index)
	$(canvas).find('.bar:eq('+index+') .anim').animate({'width':'100%'},800, function(){
		if (!$(canvas).data("lock")){
			stopBar(canvas, 4);
			return;
		}else{
			animateBar(canvas, len);
		}
	});
};
var Viewer = new function _Viewer(){
	
	inherits(this, APViewer);

	
	this.editAccount=function(){
		AP.dialog("#account-edit-dx").temp(false).button($("#account-edit-dx").data("ok"), function(){
			Viewer.exeAccountEdit();
		},'ss').button($("#account-edit-dx").data("cancel"), function(){
			AP.dialog("#account-edit-dx").hide();
		}).show();
	};
	
	
	this.exeAccountEdit=function(){
		AP.submit("#account-edit-fx", function(code){
			if (!code.good()){
				return AP.alertError(code.message);
			}
			AP.alertSuccess(code.message, function(){
				AP.refresh();
			});
		});
	};
	
	
	this.editPassword=function(){
		AP.dialog("#password-edit-dx").temp(false).button($("#password-edit-dx").data("ok"), function(){
			Viewer.exePasswordEdit();
		},'ss').button($("#password-edit-dx").data("cancel"), function(){
			AP.dialog("#password-edit-dx").hide();
		}).show();
	};
	
	
	this.exePasswordEdit=function(){
		AP.submit("#password-edit-fx", function(code){
			if (!code.good()){
				return AP.alertError(code.message);
			}
			AP.alertSuccess(code.message, function(){
				AP.refresh();
			});
		});
	};
};// Require Configuration [Required]
AP.config.dialog={};
AP.config.dialog.engine=WTDialogEngine;
AP.config.alertDialogEngine=WTDialogEngine;
AP.config.uploadDialogEngine=UploadDialogEngine;
AP.config.ajaxAlertDialogEngine=WTAjaxDialogEngine;
AP.config.theme=0;


// Translate error messages [Required]
AP.error.messages=AP.data.assoc()
	.add(AP.error.code.CONFLICT_DATA, "Bad input. Please try again")
	.add(AP.error.code.INVALID_DATA, "Invalid data. Please try again.")
	.add(AP.error.code.INCOMPLETE_DATA, "Your submitted data is incomplete. Please try to complete all required fields.")
	.add(AP.error.code.INVALID_USER, "Authentication error. You may not be able to perform this action.")
	.add(AP.error.code.INVALID_AUTHENTICATION, "Invalid authentication. Please try again.")
	.add(AP.error.code.LOGIN_REQUIRED, "Please login to perform this action.")
	.add(AP.error.code.DB_ERROR, "Unexpected error (1). Please contact us for further information.")
	.add(AP.error.code.SV_ERROR, "Unexpected error (2). Please contact us for further information.")
	.add(AP.error.code.INVALID_PASSWORD, "Invalid password. Please try again.")
	.add(AP.error.code.INVALID_EMAIL, "Invalid or empty email. Please try again.")
	.add(AP.error.code.INVALID_USERNAME, "Invalid username. Please try again.")
	.add(AP.error.code.INVALID_CHARACTER, "Some characters you enter are not allowed. Please try again.")
	.add(AP.error.code.INVALID_CAPTCHA, "Invalid captcha security code. Please try again.")
	.add("BAD_XCODE","Your session was expired. Please refresh the page (press F5) to continue.")
	.add("FORCE_REDIRECT","Your session was expired. Please refresh the page (press F5) to continue.")
	.add("DUPLICATED EMAIL","Email bá» trÃ¹ng láº·p vÃ¬ ÄÃ£ ÄÄng kÃ½ trong há» thá»ng trÆ°á»c ÄÃ³.")
	.assoc();










$(document).ready(function(){
	AP.add('ap-root','ap-temp', 'ap-apps','overlay','alert','ap-data');
	$("<div id='ap-invs'></div>").appendTo(document.body);
	AP.initContinuousRequest();
	AP.setContinuousRequest();
	AP.html.init();
	documentInit();
	
	if (Client.people){
		for (var i=0; i<Client.people.length; i++){
			Client.people[i].value="@"+Client.people[i].username;
			Client.people[i].sub=Client.people[i].first_name+" "+Client.people[i].last_name;
		}
	}
	
});


function mapready(){
	AP.sys.release('mapready');
};var Apply = new function __Apply() {
	this.now = function () {
		this.form.init();
	};

	this.submit = function (ref) {
		AP.ajaxShow();

		// pre-process UTM params
		var source_param = Query.get("utm_source");
		$("#f-utm-source").val(source_param);
		var medium_param = Query.get("utm_medium");
		$("#f-utm-medium").val(medium_param);
		var campaign_param = Query.get("utm_campaign");
		$("#f-utm-campaign").val(campaign_param);
		var content_param = Query.get("utm_content");
		$("#f-utm-content").val(content_param);
		var term_param = Query.get("utm_term");
		$("#f-utm-term").val(term_param);
		var referral_id_param = Query.get("referral_id");
		$("#f-utm-campaign").val(referral_id_param);

		var form = $(ref).closest("form");
		AP.submit(form, function (code) {
			AP.ajaxHide();
			if (!code.good()) {
				return AP.alertError(code.message);
			}

			var msg = "ChÃºc má»«ng báº¡n! Báº¡n ÄÃ£ á»©ng tuyá»n thÃ nh cÃ´ng cho vá» trÃ­ nÃ y. ChÃºng tÃ´i sáº½ liÃªn há» vá»i báº¡n trong thá»i gian sá»m nháº¥t.";

			if (AP.sys.cookie("lang_talent") === "en") {
				msg = "Congratulation! You have successfully applied for this position. We will get back to you as soon as possible.";
			}

			if (Client.pageData.custom !== false && typeof Client.pageData.custom.success_msg !== "undefined") {
				msg = Client.pageData.custom.success_msg.msg;
			}
			
			if (code.video) {
				if (parseInt(code.thank_you) === 1) {
					AP.redirect(code.video);
					return;
				} else {
					AP.alertSuccess(msg, function () {
						AP.redirect(code.video);
						return;
					});
				}
			} else {
				if (parseInt(code.thank_you) === 1 && typeof(code.job_id) != undefined) {
					AP.redirect("thankyou/" + code.job_id);
				} else {
					AP.alertSuccess(msg, function () {
						AP.xRefresh();
					});
				}
			}
			
		});
	};

	this.submitEx = function (ref) {
		var form = $(ref).closest("form");
		AP.ajaxShow();
		AP.submit(form, function (code) {
			AP.ajaxHide();
			if (!code.good()) {
				return AP.alertError(code.message);
			}

			AP.alertSuccess(code.message);
		});
	};

	this.focus = function () {
		if ($("#appform .form .row .input input[name=name]").position() && typeof $("#appform .form .row .input input[name=name]").position() != "undefined") {
			$("html, body").animate({scrollTop: $("#appform .form .row .input input[name=name]").position().top + 400}, 1000);
			$("#appform").find("input[name=name]").focus();
		}
	};

	this.cancel = function () {
		this.form.hide();
	};

	function getUrlVars(url) {
		var vars = [],
			hash;
		var hashes = url.slice(url.indexOf('?') + 1).split('&');
		for (var i = 0; i < hashes.length; i++) {
			hash = hashes[i].split('=');
			vars.push(hash[0]);
			vars[hash[0]] = hash[1];
		}
		return vars;
	}
};
Apply.form = new function __ApplyForm() {
	this.init = function () {
		$(document.body).addClass("-applying");

		if (!$("#application-canvas").length) {
			$("<div id='application-canvas' class='siding'><div class='outer-canvas'><div id='main-appcanvas' class='inner-canvas'></div> <div class='app-closebutton' onclick='Apply.cancel();'><span class='-ap icon-uniF108'></span></div></div></div>").appendTo(document.body);
			$("#appform").appendTo("#main-appcanvas").show();
			AP.html.resize(function () {
				$("#application-canvas").css({height: $(window).height()});
			});

			window.addEventListener("message", function (data) {
			}, true);
		}

		$("#application-canvas").css({height: $(window).height()}).show();
		$("#appform input[name=last_name]").focus();
	};


	this.hide = function () {
		$("#application-canvas").hide();
		$(document.body).removeClass("-applying");
	};

	this.render = function (canvas) {
		var options = {};

		var $c = $(canvas);
		if ($c.data("role") == "material" || $c.data("role") == "flat" || options.role == "flat") {
			$c.materialForm();
		}

		$c.find(".select-m").each(function () {
			var $this = $(this);
			$this.find(".option").each(function () {
				$(this).click(function () {
					var val = $(this).data("value");
					var $input = $(this).closest(".select-m").find("input");
					var vals = AP.word.split(",", $input.val());
					var active = 0;

					if (AP.array.find(vals, val) !== null && AP.array.find(vals, val) !== false) {
						vals = AP.array.remove(vals, val);
					} else {
						vals.push(val);
						active = 1;
					}


					$input.val(vals.join(","));

					if (active) {
						$(this).addClass("active");
					} else {
						$(this).removeClass("active");
					}
				});
			});
		});

		$c.find("input, select, textarea").each(function () {
			var tagname = $(this)[0].nodeName.toLowerCase();

			if (tagname == "select") {
				var val = $(this).data("value");
				if (val === null || typeof val == "undefined") {
				} else {
					$(this).val(val);
				}
			}


			var role = $(this).data("role");
			if (!role || !role.length) {
				return;
			}

			if (role == "markdown") {
				return $(this).markdownEditor();
			}

			if (role == "date") {
				var val = $(this).data("value");
				if (val) {
					$(this).data("ts", val);
				} else {
					val = $(this).val();
					if (val && val.length && AP.data.isInt(val)) {
						$(this).data("ts", val);
					}
				}

				return $(this).selectDate();
			}

			if (role == "drive") {
				Base.drive.init(this, $(this).data("multi"));
			}

			if (role == "editor") {
				return UI.editor(this);
			}

			if (role == "day" && tagname == "select") {
				var opts = "<option> -- Chá»n ngÃ y --</option>";
				for (var i = 1; i <= 31; i++) {
					opts += "<option value='" + i + "'>" + AP.data.zeroPrefix(i) + "</option>";
				}
				$(this).html(opts);
			}


			if (role == "month" && tagname == "select") {
				var opts = "<option> -- Chá»n thÃ¡ng --</option>";
				for (var i = 1; i <= 12; i++) {
					opts += "<option value='" + i + "'>" + AP.data.zeroPrefix(i) + "</option>";
				}
				$(this).html(opts);
			}


			if (role == "year" && tagname == "select") {
				var opts = "<option> -- Chá»n nÄm --</option>";
				for (var i = 2015; i > 1960; i--) {
					opts += "<option value='" + i + "'>" + AP.data.zeroPrefix(i) + "</option>";
				}
				$(this).html(opts);
			}

			if (role == "time") {
				return $(this).selectTime();
			}

			if (role == "teams") {
				return Tag.team(this, $(this).data("context"));
			}

			if (role == "team") {
				return Tag.teamSelect(this, $(this).data("context"));
			}

			if (role == "users" || role == "tag") {
				var context = $(this).data("context");
				if (context) {
					return Tag.user(this);
				} else {
					return Tag.user(this, Tag.people());
				}


			}

			if (role == "int") {
				return better_int_enter($(this));
			}

		});


		$("#appform input[type=file]").on("change", function () {
			var name = getUploadFN($(this).val());
			$(this).closest(".upload").find(".text .more").html("Selected file: <b>" + AP.purify(name) + "</b>");
		});
	};

	this.renderWithValue = function (canvas) {
		var options = {};
		var $c = $(canvas);

		if ($c.data("role") == "material" || $c.data("role") == "flat" || options.role == "flat") {
			$c.materialForm();
		}

		$c.find(".select-m").each(function () {
			var $this = $(this);
			$this.find(".option").each(function () {
				setMState(this);

				$(this).click(function () {
					var val = $(this).data("value");
					var $input = $(this).closest(".select-m").find("input");
					var vals = AP.word.split(",", $input.val());
					var active = 0;

					if (AP.array.find(vals, val) !== null && AP.array.find(vals, val) !== false) {
						vals = AP.array.remove(vals, val);
					} else {
						vals.push(val);
						active = 1;
					}


					$input.val(vals.join(","));

					if (active) {
						$(this).addClass("active");
					} else {
						$(this).removeClass("active");
					}
				});
			});
		});

		$c.find("input, select, textarea").each(function () {
			var tagname = $(this)[0].nodeName.toLowerCase();

			if (tagname == "select") {
				var val = $(this).data("value");
				if (val === null || typeof val == "undefined") {
				} else {
					$(this).val(val);
				}
			}

			if (tagname === "textarea") {
				var value = $(this).data("value");

				if (value) {
					$(this).val(value.replace(/<br>/gi, "\n"));
				}
			}


			var role = $(this).data("role");


			if (role && role.length) {
				if (role == "markdown") {
					return $(this).markdownEditor();
				}

				if (role == "date") {
					var val = $(this).data("value");
					if (val) {
						$(this).data("ts", val);
					} else {
						val = $(this).val();
						if (val && val.length && AP.data.isInt(val)) {
							$(this).data("ts", val);
						}
					}

					return $(this).selectDate();
				}

				if (role == "drive") {
					Base.drive.init(this, $(this).data("multi"));
				}

				if (role == "editor") {
					return UI.editor(this);
				}

				if (role == "day" && tagname == "select") {
					var opts = "<option> -- Chá»n ngÃ y --</option>";
					for (var i = 1; i <= 31; i++) {
						opts += "<option value='" + i + "'>" + AP.data.zeroPrefix(i) + "</option>";
					}
					$(this).html(opts);
				}


				if (role == "month" && tagname == "select") {
					var opts = "<option> -- Chá»n thÃ¡ng --</option>";
					for (var i = 1; i <= 12; i++) {
						opts += "<option value='" + i + "'>" + AP.data.zeroPrefix(i) + "</option>";
					}
					$(this).html(opts);
				}


				if (role == "year" && tagname == "select") {
					var opts = "<option> -- Chá»n nÄm --</option>";
					for (var i = 2015; i > 1960; i--) {
						opts += "<option value='" + i + "'>" + AP.data.zeroPrefix(i) + "</option>";
					}
					$(this).html(opts);
				}

				if (role == "time") {
					return $(this).selectTime();
				}

				if (role == "teams") {
					return Tag.team(this, $(this).data("context"));
				}

				if (role == "team") {
					return Tag.teamSelect(this, $(this).data("context"));
				}

				if (role == "users" || role == "tag") {
					var context = $(this).data("context");
					if (context) {
						return Tag.user(this);
					} else {
						return Tag.user(this, Tag.people());
					}


				}

				if (role == "int") {
					return better_int_enter($(this));
				}
			} else {
				if (tagname === "input") {
					var value = $(this).data("value");

					if (value) {
						$(this).val(value);
					}
				}
			}
		});

		$("#appform input[type=file]").on("change", function () {
			var name = getUploadFN($(this).val());
			$(this).closest(".upload").find(".text .more").html("Selected file: <b>" + name + "</b>");
		});
	}

	function setMState(ref){
		var val=$(ref).data("value");
		var $input=$(ref).closest(".select-m").find("input");
		var vals=AP.word.split(",", $input.val());
		if (vals.indexOf(val)!=-1){
			active=1;
		}else{
			active=0;
		}

		$input.val(vals.join(","));

		if (active){
			$(ref).addClass("active");
		}else{
			$(ref).removeClass("active");
		}
	};


	this.noticeClosedJob = function () {
		$('.side .apply').prop("onclick", null).off("click");
		$('.side .apply').addClass("-closed").html("This job was closed.");
		$('#appform').hide();
	};

	var list = $('.cr-wrapper > .row').length
	if (list === 0) {
		$('.row-collapse').addClass("hidden");
	}
};
/*
     _ _      _       _
 ___| (_) ___| | __  (_)___
/ __| | |/ __| |/ /  | / __|
\__ \ | | (__|   < _ | \__ \
|___/_|_|\___|_|\_(_)/ |___/
                   |__/

 Version: 1.9.0
  Author: Ken Wheeler
 Website: http://kenwheeler.github.io
    Docs: http://kenwheeler.github.io/slick
    Repo: http://github.com/kenwheeler/slick
  Issues: http://github.com/kenwheeler/slick/issues

 */
(function(i){"use strict";"function"==typeof define&&define.amd?define(["jquery"],i):"undefined"!=typeof exports?module.exports=i(require("jquery")):i(jQuery)})(function(i){"use strict";var e=window.Slick||{};e=function(){function e(e,o){var s,n=this;n.defaults={accessibility:!0,adaptiveHeight:!1,appendArrows:i(e),appendDots:i(e),arrows:!0,asNavFor:null,prevArrow:'<button class="slick-prev" aria-label="Previous" type="button">Previous</button>',nextArrow:'<button class="slick-next" aria-label="Next" type="button">Next</button>',autoplay:!1,autoplaySpeed:3e3,centerMode:!1,centerPadding:"50px",cssEase:"ease",customPaging:function(e,t){return i('<button type="button" />').text(t+1)},dots:!1,dotsClass:"slick-dots",draggable:!0,easing:"linear",edgeFriction:.35,fade:!1,focusOnSelect:!1,focusOnChange:!1,infinite:!0,initialSlide:0,lazyLoad:"ondemand",mobileFirst:!1,pauseOnHover:!0,pauseOnFocus:!0,pauseOnDotsHover:!1,respondTo:"window",responsive:null,rows:1,rtl:!1,slide:"",slidesPerRow:1,slidesToShow:1,slidesToScroll:1,speed:500,swipe:!0,swipeToSlide:!1,touchMove:!0,touchThreshold:5,useCSS:!0,useTransform:!0,variableWidth:!1,vertical:!1,verticalSwiping:!1,waitForAnimate:!0,zIndex:1e3},n.initials={animating:!1,dragging:!1,autoPlayTimer:null,currentDirection:0,currentLeft:null,currentSlide:0,direction:1,$dots:null,listWidth:null,listHeight:null,loadIndex:0,$nextArrow:null,$prevArrow:null,scrolling:!1,slideCount:null,slideWidth:null,$slideTrack:null,$slides:null,sliding:!1,slideOffset:0,swipeLeft:null,swiping:!1,$list:null,touchObject:{},transformsEnabled:!1,unslicked:!1},i.extend(n,n.initials),n.activeBreakpoint=null,n.animType=null,n.animProp=null,n.breakpoints=[],n.breakpointSettings=[],n.cssTransitions=!1,n.focussed=!1,n.interrupted=!1,n.hidden="hidden",n.paused=!0,n.positionProp=null,n.respondTo=null,n.rowCount=1,n.shouldClick=!0,n.$slider=i(e),n.$slidesCache=null,n.transformType=null,n.transitionType=null,n.visibilityChange="visibilitychange",n.windowWidth=0,n.windowTimer=null,s=i(e).data("slick")||{},n.options=i.extend({},n.defaults,o,s),n.currentSlide=n.options.initialSlide,n.originalSettings=n.options,"undefined"!=typeof document.mozHidden?(n.hidden="mozHidden",n.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(n.hidden="webkitHidden",n.visibilityChange="webkitvisibilitychange"),n.autoPlay=i.proxy(n.autoPlay,n),n.autoPlayClear=i.proxy(n.autoPlayClear,n),n.autoPlayIterator=i.proxy(n.autoPlayIterator,n),n.changeSlide=i.proxy(n.changeSlide,n),n.clickHandler=i.proxy(n.clickHandler,n),n.selectHandler=i.proxy(n.selectHandler,n),n.setPosition=i.proxy(n.setPosition,n),n.swipeHandler=i.proxy(n.swipeHandler,n),n.dragHandler=i.proxy(n.dragHandler,n),n.keyHandler=i.proxy(n.keyHandler,n),n.instanceUid=t++,n.htmlExpr=/^(?:\s*(<[\w\W]+>)[^>]*)$/,n.registerBreakpoints(),n.init(!0)}var t=0;return e}(),e.prototype.activateADA=function(){var i=this;i.$slideTrack.find(".slick-active").attr({"aria-hidden":"false"}).find("a, input, button, select").attr({tabindex:"0"})},e.prototype.addSlide=e.prototype.slickAdd=function(e,t,o){var s=this;if("boolean"==typeof t)o=t,t=null;else if(t<0||t>=s.slideCount)return!1;s.unload(),"number"==typeof t?0===t&&0===s.$slides.length?i(e).appendTo(s.$slideTrack):o?i(e).insertBefore(s.$slides.eq(t)):i(e).insertAfter(s.$slides.eq(t)):o===!0?i(e).prependTo(s.$slideTrack):i(e).appendTo(s.$slideTrack),s.$slides=s.$slideTrack.children(this.options.slide),s.$slideTrack.children(this.options.slide).detach(),s.$slideTrack.append(s.$slides),s.$slides.each(function(e,t){i(t).attr("data-slick-index",e)}),s.$slidesCache=s.$slides,s.reinit()},e.prototype.animateHeight=function(){var i=this;if(1===i.options.slidesToShow&&i.options.adaptiveHeight===!0&&i.options.vertical===!1){var e=i.$slides.eq(i.currentSlide).outerHeight(!0);i.$list.animate({height:e},i.options.speed)}},e.prototype.animateSlide=function(e,t){var o={},s=this;s.animateHeight(),s.options.rtl===!0&&s.options.vertical===!1&&(e=-e),s.transformsEnabled===!1?s.options.vertical===!1?s.$slideTrack.animate({left:e},s.options.speed,s.options.easing,t):s.$slideTrack.animate({top:e},s.options.speed,s.options.easing,t):s.cssTransitions===!1?(s.options.rtl===!0&&(s.currentLeft=-s.currentLeft),i({animStart:s.currentLeft}).animate({animStart:e},{duration:s.options.speed,easing:s.options.easing,step:function(i){i=Math.ceil(i),s.options.vertical===!1?(o[s.animType]="translate("+i+"px, 0px)",s.$slideTrack.css(o)):(o[s.animType]="translate(0px,"+i+"px)",s.$slideTrack.css(o))},complete:function(){t&&t.call()}})):(s.applyTransition(),e=Math.ceil(e),s.options.vertical===!1?o[s.animType]="translate3d("+e+"px, 0px, 0px)":o[s.animType]="translate3d(0px,"+e+"px, 0px)",s.$slideTrack.css(o),t&&setTimeout(function(){s.disableTransition(),t.call()},s.options.speed))},e.prototype.getNavTarget=function(){var e=this,t=e.options.asNavFor;return t&&null!==t&&(t=i(t).not(e.$slider)),t},e.prototype.asNavFor=function(e){var t=this,o=t.getNavTarget();null!==o&&"object"==typeof o&&o.each(function(){var t=i(this).slick("getSlick");t.unslicked||t.slideHandler(e,!0)})},e.prototype.applyTransition=function(i){var e=this,t={};e.options.fade===!1?t[e.transitionType]=e.transformType+" "+e.options.speed+"ms "+e.options.cssEase:t[e.transitionType]="opacity "+e.options.speed+"ms "+e.options.cssEase,e.options.fade===!1?e.$slideTrack.css(t):e.$slides.eq(i).css(t)},e.prototype.autoPlay=function(){var i=this;i.autoPlayClear(),i.slideCount>i.options.slidesToShow&&(i.autoPlayTimer=setInterval(i.autoPlayIterator,i.options.autoplaySpeed))},e.prototype.autoPlayClear=function(){var i=this;i.autoPlayTimer&&clearInterval(i.autoPlayTimer)},e.prototype.autoPlayIterator=function(){var i=this,e=i.currentSlide+i.options.slidesToScroll;i.paused||i.interrupted||i.focussed||(i.options.infinite===!1&&(1===i.direction&&i.currentSlide+1===i.slideCount-1?i.direction=0:0===i.direction&&(e=i.currentSlide-i.options.slidesToScroll,i.currentSlide-1===0&&(i.direction=1))),i.slideHandler(e))},e.prototype.buildArrows=function(){var e=this;e.options.arrows===!0&&(e.$prevArrow=i(e.options.prevArrow).addClass("slick-arrow"),e.$nextArrow=i(e.options.nextArrow).addClass("slick-arrow"),e.slideCount>e.options.slidesToShow?(e.$prevArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),e.$nextArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),e.htmlExpr.test(e.options.prevArrow)&&e.$prevArrow.prependTo(e.options.appendArrows),e.htmlExpr.test(e.options.nextArrow)&&e.$nextArrow.appendTo(e.options.appendArrows),e.options.infinite!==!0&&e.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true")):e.$prevArrow.add(e.$nextArrow).addClass("slick-hidden").attr({"aria-disabled":"true",tabindex:"-1"}))},e.prototype.buildDots=function(){var e,t,o=this;if(o.options.dots===!0&&o.slideCount>o.options.slidesToShow){for(o.$slider.addClass("slick-dotted"),t=i("<ul />").addClass(o.options.dotsClass),e=0;e<=o.getDotCount();e+=1)t.append(i("<li />").append(o.options.customPaging.call(this,o,e)));o.$dots=t.appendTo(o.options.appendDots),o.$dots.find("li").first().addClass("slick-active")}},e.prototype.buildOut=function(){var e=this;e.$slides=e.$slider.children(e.options.slide+":not(.slick-cloned)").addClass("slick-slide"),e.slideCount=e.$slides.length,e.$slides.each(function(e,t){i(t).attr("data-slick-index",e).data("originalStyling",i(t).attr("style")||"")}),e.$slider.addClass("slick-slider"),e.$slideTrack=0===e.slideCount?i('<div class="slick-track"/>').appendTo(e.$slider):e.$slides.wrapAll('<div class="slick-track"/>').parent(),e.$list=e.$slideTrack.wrap('<div class="slick-list"/>').parent(),e.$slideTrack.css("opacity",0),e.options.centerMode!==!0&&e.options.swipeToSlide!==!0||(e.options.slidesToScroll=1),i("img[data-lazy]",e.$slider).not("[src]").addClass("slick-loading"),e.setupInfinite(),e.buildArrows(),e.buildDots(),e.updateDots(),e.setSlideClasses("number"==typeof e.currentSlide?e.currentSlide:0),e.options.draggable===!0&&e.$list.addClass("draggable")},e.prototype.buildRows=function(){var i,e,t,o,s,n,r,l=this;if(o=document.createDocumentFragment(),n=l.$slider.children(),l.options.rows>0){for(r=l.options.slidesPerRow*l.options.rows,s=Math.ceil(n.length/r),i=0;i<s;i++){var d=document.createElement("div");for(e=0;e<l.options.rows;e++){var a=document.createElement("div");for(t=0;t<l.options.slidesPerRow;t++){var c=i*r+(e*l.options.slidesPerRow+t);n.get(c)&&a.appendChild(n.get(c))}d.appendChild(a)}o.appendChild(d)}l.$slider.empty().append(o),l.$slider.children().children().children().css({width:100/l.options.slidesPerRow+"%",display:"inline-block"})}},e.prototype.checkResponsive=function(e,t){var o,s,n,r=this,l=!1,d=r.$slider.width(),a=window.innerWidth||i(window).width();if("window"===r.respondTo?n=a:"slider"===r.respondTo?n=d:"min"===r.respondTo&&(n=Math.min(a,d)),r.options.responsive&&r.options.responsive.length&&null!==r.options.responsive){s=null;for(o in r.breakpoints)r.breakpoints.hasOwnProperty(o)&&(r.originalSettings.mobileFirst===!1?n<r.breakpoints[o]&&(s=r.breakpoints[o]):n>r.breakpoints[o]&&(s=r.breakpoints[o]));null!==s?null!==r.activeBreakpoint?(s!==r.activeBreakpoint||t)&&(r.activeBreakpoint=s,"unslick"===r.breakpointSettings[s]?r.unslick(s):(r.options=i.extend({},r.originalSettings,r.breakpointSettings[s]),e===!0&&(r.currentSlide=r.options.initialSlide),r.refresh(e)),l=s):(r.activeBreakpoint=s,"unslick"===r.breakpointSettings[s]?r.unslick(s):(r.options=i.extend({},r.originalSettings,r.breakpointSettings[s]),e===!0&&(r.currentSlide=r.options.initialSlide),r.refresh(e)),l=s):null!==r.activeBreakpoint&&(r.activeBreakpoint=null,r.options=r.originalSettings,e===!0&&(r.currentSlide=r.options.initialSlide),r.refresh(e),l=s),e||l===!1||r.$slider.trigger("breakpoint",[r,l])}},e.prototype.changeSlide=function(e,t){var o,s,n,r=this,l=i(e.currentTarget);switch(l.is("a")&&e.preventDefault(),l.is("li")||(l=l.closest("li")),n=r.slideCount%r.options.slidesToScroll!==0,o=n?0:(r.slideCount-r.currentSlide)%r.options.slidesToScroll,e.data.message){case"previous":s=0===o?r.options.slidesToScroll:r.options.slidesToShow-o,r.slideCount>r.options.slidesToShow&&r.slideHandler(r.currentSlide-s,!1,t);break;case"next":s=0===o?r.options.slidesToScroll:o,r.slideCount>r.options.slidesToShow&&r.slideHandler(r.currentSlide+s,!1,t);break;case"index":var d=0===e.data.index?0:e.data.index||l.index()*r.options.slidesToScroll;r.slideHandler(r.checkNavigable(d),!1,t),l.children().trigger("focus");break;default:return}},e.prototype.checkNavigable=function(i){var e,t,o=this;if(e=o.getNavigableIndexes(),t=0,i>e[e.length-1])i=e[e.length-1];else for(var s in e){if(i<e[s]){i=t;break}t=e[s]}return i},e.prototype.cleanUpEvents=function(){var e=this;e.options.dots&&null!==e.$dots&&(i("li",e.$dots).off("click.slick",e.changeSlide).off("mouseenter.slick",i.proxy(e.interrupt,e,!0)).off("mouseleave.slick",i.proxy(e.interrupt,e,!1)),e.options.accessibility===!0&&e.$dots.off("keydown.slick",e.keyHandler)),e.$slider.off("focus.slick blur.slick"),e.options.arrows===!0&&e.slideCount>e.options.slidesToShow&&(e.$prevArrow&&e.$prevArrow.off("click.slick",e.changeSlide),e.$nextArrow&&e.$nextArrow.off("click.slick",e.changeSlide),e.options.accessibility===!0&&(e.$prevArrow&&e.$prevArrow.off("keydown.slick",e.keyHandler),e.$nextArrow&&e.$nextArrow.off("keydown.slick",e.keyHandler))),e.$list.off("touchstart.slick mousedown.slick",e.swipeHandler),e.$list.off("touchmove.slick mousemove.slick",e.swipeHandler),e.$list.off("touchend.slick mouseup.slick",e.swipeHandler),e.$list.off("touchcancel.slick mouseleave.slick",e.swipeHandler),e.$list.off("click.slick",e.clickHandler),i(document).off(e.visibilityChange,e.visibility),e.cleanUpSlideEvents(),e.options.accessibility===!0&&e.$list.off("keydown.slick",e.keyHandler),e.options.focusOnSelect===!0&&i(e.$slideTrack).children().off("click.slick",e.selectHandler),i(window).off("orientationchange.slick.slick-"+e.instanceUid,e.orientationChange),i(window).off("resize.slick.slick-"+e.instanceUid,e.resize),i("[draggable!=true]",e.$slideTrack).off("dragstart",e.preventDefault),i(window).off("load.slick.slick-"+e.instanceUid,e.setPosition)},e.prototype.cleanUpSlideEvents=function(){var e=this;e.$list.off("mouseenter.slick",i.proxy(e.interrupt,e,!0)),e.$list.off("mouseleave.slick",i.proxy(e.interrupt,e,!1))},e.prototype.cleanUpRows=function(){var i,e=this;e.options.rows>0&&(i=e.$slides.children().children(),i.removeAttr("style"),e.$slider.empty().append(i))},e.prototype.clickHandler=function(i){var e=this;e.shouldClick===!1&&(i.stopImmediatePropagation(),i.stopPropagation(),i.preventDefault())},e.prototype.destroy=function(e){var t=this;t.autoPlayClear(),t.touchObject={},t.cleanUpEvents(),i(".slick-cloned",t.$slider).detach(),t.$dots&&t.$dots.remove(),t.$prevArrow&&t.$prevArrow.length&&(t.$prevArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),t.htmlExpr.test(t.options.prevArrow)&&t.$prevArrow.remove()),t.$nextArrow&&t.$nextArrow.length&&(t.$nextArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),t.htmlExpr.test(t.options.nextArrow)&&t.$nextArrow.remove()),t.$slides&&(t.$slides.removeClass("slick-slide slick-active slick-center slick-visible slick-current").removeAttr("aria-hidden").removeAttr("data-slick-index").each(function(){i(this).attr("style",i(this).data("originalStyling"))}),t.$slideTrack.children(this.options.slide).detach(),t.$slideTrack.detach(),t.$list.detach(),t.$slider.append(t.$slides)),t.cleanUpRows(),t.$slider.removeClass("slick-slider"),t.$slider.removeClass("slick-initialized"),t.$slider.removeClass("slick-dotted"),t.unslicked=!0,e||t.$slider.trigger("destroy",[t])},e.prototype.disableTransition=function(i){var e=this,t={};t[e.transitionType]="",e.options.fade===!1?e.$slideTrack.css(t):e.$slides.eq(i).css(t)},e.prototype.fadeSlide=function(i,e){var t=this;t.cssTransitions===!1?(t.$slides.eq(i).css({zIndex:t.options.zIndex}),t.$slides.eq(i).animate({opacity:1},t.options.speed,t.options.easing,e)):(t.applyTransition(i),t.$slides.eq(i).css({opacity:1,zIndex:t.options.zIndex}),e&&setTimeout(function(){t.disableTransition(i),e.call()},t.options.speed))},e.prototype.fadeSlideOut=function(i){var e=this;e.cssTransitions===!1?e.$slides.eq(i).animate({opacity:0,zIndex:e.options.zIndex-2},e.options.speed,e.options.easing):(e.applyTransition(i),e.$slides.eq(i).css({opacity:0,zIndex:e.options.zIndex-2}))},e.prototype.filterSlides=e.prototype.slickFilter=function(i){var e=this;null!==i&&(e.$slidesCache=e.$slides,e.unload(),e.$slideTrack.children(this.options.slide).detach(),e.$slidesCache.filter(i).appendTo(e.$slideTrack),e.reinit())},e.prototype.focusHandler=function(){var e=this;e.$slider.off("focus.slick blur.slick").on("focus.slick","*",function(t){var o=i(this);setTimeout(function(){e.options.pauseOnFocus&&o.is(":focus")&&(e.focussed=!0,e.autoPlay())},0)}).on("blur.slick","*",function(t){i(this);e.options.pauseOnFocus&&(e.focussed=!1,e.autoPlay())})},e.prototype.getCurrent=e.prototype.slickCurrentSlide=function(){var i=this;return i.currentSlide},e.prototype.getDotCount=function(){var i=this,e=0,t=0,o=0;if(i.options.infinite===!0)if(i.slideCount<=i.options.slidesToShow)++o;else for(;e<i.slideCount;)++o,e=t+i.options.slidesToScroll,t+=i.options.slidesToScroll<=i.options.slidesToShow?i.options.slidesToScroll:i.options.slidesToShow;else if(i.options.centerMode===!0)o=i.slideCount;else if(i.options.asNavFor)for(;e<i.slideCount;)++o,e=t+i.options.slidesToScroll,t+=i.options.slidesToScroll<=i.options.slidesToShow?i.options.slidesToScroll:i.options.slidesToShow;else o=1+Math.ceil((i.slideCount-i.options.slidesToShow)/i.options.slidesToScroll);return o-1},e.prototype.getLeft=function(i){var e,t,o,s,n=this,r=0;return n.slideOffset=0,t=n.$slides.first().outerHeight(!0),n.options.infinite===!0?(n.slideCount>n.options.slidesToShow&&(n.slideOffset=n.slideWidth*n.options.slidesToShow*-1,s=-1,n.options.vertical===!0&&n.options.centerMode===!0&&(2===n.options.slidesToShow?s=-1.5:1===n.options.slidesToShow&&(s=-2)),r=t*n.options.slidesToShow*s),n.slideCount%n.options.slidesToScroll!==0&&i+n.options.slidesToScroll>n.slideCount&&n.slideCount>n.options.slidesToShow&&(i>n.slideCount?(n.slideOffset=(n.options.slidesToShow-(i-n.slideCount))*n.slideWidth*-1,r=(n.options.slidesToShow-(i-n.slideCount))*t*-1):(n.slideOffset=n.slideCount%n.options.slidesToScroll*n.slideWidth*-1,r=n.slideCount%n.options.slidesToScroll*t*-1))):i+n.options.slidesToShow>n.slideCount&&(n.slideOffset=(i+n.options.slidesToShow-n.slideCount)*n.slideWidth,r=(i+n.options.slidesToShow-n.slideCount)*t),n.slideCount<=n.options.slidesToShow&&(n.slideOffset=0,r=0),n.options.centerMode===!0&&n.slideCount<=n.options.slidesToShow?n.slideOffset=n.slideWidth*Math.floor(n.options.slidesToShow)/2-n.slideWidth*n.slideCount/2:n.options.centerMode===!0&&n.options.infinite===!0?n.slideOffset+=n.slideWidth*Math.floor(n.options.slidesToShow/2)-n.slideWidth:n.options.centerMode===!0&&(n.slideOffset=0,n.slideOffset+=n.slideWidth*Math.floor(n.options.slidesToShow/2)),e=n.options.vertical===!1?i*n.slideWidth*-1+n.slideOffset:i*t*-1+r,n.options.variableWidth===!0&&(o=n.slideCount<=n.options.slidesToShow||n.options.infinite===!1?n.$slideTrack.children(".slick-slide").eq(i):n.$slideTrack.children(".slick-slide").eq(i+n.options.slidesToShow),e=n.options.rtl===!0?o[0]?(n.$slideTrack.width()-o[0].offsetLeft-o.width())*-1:0:o[0]?o[0].offsetLeft*-1:0,n.options.centerMode===!0&&(o=n.slideCount<=n.options.slidesToShow||n.options.infinite===!1?n.$slideTrack.children(".slick-slide").eq(i):n.$slideTrack.children(".slick-slide").eq(i+n.options.slidesToShow+1),e=n.options.rtl===!0?o[0]?(n.$slideTrack.width()-o[0].offsetLeft-o.width())*-1:0:o[0]?o[0].offsetLeft*-1:0,e+=(n.$list.width()-o.outerWidth())/2)),e},e.prototype.getOption=e.prototype.slickGetOption=function(i){var e=this;return e.options[i]},e.prototype.getNavigableIndexes=function(){var i,e=this,t=0,o=0,s=[];for(e.options.infinite===!1?i=e.slideCount:(t=e.options.slidesToScroll*-1,o=e.options.slidesToScroll*-1,i=2*e.slideCount);t<i;)s.push(t),t=o+e.options.slidesToScroll,o+=e.options.slidesToScroll<=e.options.slidesToShow?e.options.slidesToScroll:e.options.slidesToShow;return s},e.prototype.getSlick=function(){return this},e.prototype.getSlideCount=function(){var e,t,o,s,n=this;return s=n.options.centerMode===!0?Math.floor(n.$list.width()/2):0,o=n.swipeLeft*-1+s,n.options.swipeToSlide===!0?(n.$slideTrack.find(".slick-slide").each(function(e,s){var r,l,d;if(r=i(s).outerWidth(),l=s.offsetLeft,n.options.centerMode!==!0&&(l+=r/2),d=l+r,o<d)return t=s,!1}),e=Math.abs(i(t).attr("data-slick-index")-n.currentSlide)||1):n.options.slidesToScroll},e.prototype.goTo=e.prototype.slickGoTo=function(i,e){var t=this;t.changeSlide({data:{message:"index",index:parseInt(i)}},e)},e.prototype.init=function(e){var t=this;i(t.$slider).hasClass("slick-initialized")||(i(t.$slider).addClass("slick-initialized"),t.buildRows(),t.buildOut(),t.setProps(),t.startLoad(),t.loadSlider(),t.initializeEvents(),t.updateArrows(),t.updateDots(),t.checkResponsive(!0),t.focusHandler()),e&&t.$slider.trigger("init",[t]),t.options.accessibility===!0&&t.initADA(),t.options.autoplay&&(t.paused=!1,t.autoPlay())},e.prototype.initADA=function(){var e=this,t=Math.ceil(e.slideCount/e.options.slidesToShow),o=e.getNavigableIndexes().filter(function(i){return i>=0&&i<e.slideCount});e.$slides.add(e.$slideTrack.find(".slick-cloned")).attr({"aria-hidden":"true",tabindex:"-1"}).find("a, input, button, select").attr({tabindex:"-1"}),null!==e.$dots&&(e.$slides.not(e.$slideTrack.find(".slick-cloned")).each(function(t){var s=o.indexOf(t);if(i(this).attr({role:"tabpanel",id:"slick-slide"+e.instanceUid+t,tabindex:-1}),s!==-1){var n="slick-slide-control"+e.instanceUid+s;i("#"+n).length&&i(this).attr({"aria-describedby":n})}}),e.$dots.attr("role","tablist").find("li").each(function(s){var n=o[s];i(this).attr({role:"presentation"}),i(this).find("button").first().attr({role:"tab",id:"slick-slide-control"+e.instanceUid+s,"aria-controls":"slick-slide"+e.instanceUid+n,"aria-label":s+1+" of "+t,"aria-selected":null,tabindex:"-1"})}).eq(e.currentSlide).find("button").attr({"aria-selected":"true",tabindex:"0"}).end());for(var s=e.currentSlide,n=s+e.options.slidesToShow;s<n;s++)e.options.focusOnChange?e.$slides.eq(s).attr({tabindex:"0"}):e.$slides.eq(s).removeAttr("tabindex");e.activateADA()},e.prototype.initArrowEvents=function(){var i=this;i.options.arrows===!0&&i.slideCount>i.options.slidesToShow&&(i.$prevArrow.off("click.slick").on("click.slick",{message:"previous"},i.changeSlide),i.$nextArrow.off("click.slick").on("click.slick",{message:"next"},i.changeSlide),i.options.accessibility===!0&&(i.$prevArrow.on("keydown.slick",i.keyHandler),i.$nextArrow.on("keydown.slick",i.keyHandler)))},e.prototype.initDotEvents=function(){var e=this;e.options.dots===!0&&e.slideCount>e.options.slidesToShow&&(i("li",e.$dots).on("click.slick",{message:"index"},e.changeSlide),e.options.accessibility===!0&&e.$dots.on("keydown.slick",e.keyHandler)),e.options.dots===!0&&e.options.pauseOnDotsHover===!0&&e.slideCount>e.options.slidesToShow&&i("li",e.$dots).on("mouseenter.slick",i.proxy(e.interrupt,e,!0)).on("mouseleave.slick",i.proxy(e.interrupt,e,!1))},e.prototype.initSlideEvents=function(){var e=this;e.options.pauseOnHover&&(e.$list.on("mouseenter.slick",i.proxy(e.interrupt,e,!0)),e.$list.on("mouseleave.slick",i.proxy(e.interrupt,e,!1)))},e.prototype.initializeEvents=function(){var e=this;e.initArrowEvents(),e.initDotEvents(),e.initSlideEvents(),e.$list.on("touchstart.slick mousedown.slick",{action:"start"},e.swipeHandler),e.$list.on("touchmove.slick mousemove.slick",{action:"move"},e.swipeHandler),e.$list.on("touchend.slick mouseup.slick",{action:"end"},e.swipeHandler),e.$list.on("touchcancel.slick mouseleave.slick",{action:"end"},e.swipeHandler),e.$list.on("click.slick",e.clickHandler),i(document).on(e.visibilityChange,i.proxy(e.visibility,e)),e.options.accessibility===!0&&e.$list.on("keydown.slick",e.keyHandler),e.options.focusOnSelect===!0&&i(e.$slideTrack).children().on("click.slick",e.selectHandler),i(window).on("orientationchange.slick.slick-"+e.instanceUid,i.proxy(e.orientationChange,e)),i(window).on("resize.slick.slick-"+e.instanceUid,i.proxy(e.resize,e)),i("[draggable!=true]",e.$slideTrack).on("dragstart",e.preventDefault),i(window).on("load.slick.slick-"+e.instanceUid,e.setPosition),i(e.setPosition)},e.prototype.initUI=function(){var i=this;i.options.arrows===!0&&i.slideCount>i.options.slidesToShow&&(i.$prevArrow.show(),i.$nextArrow.show()),i.options.dots===!0&&i.slideCount>i.options.slidesToShow&&i.$dots.show()},e.prototype.keyHandler=function(i){var e=this;i.target.tagName.match("TEXTAREA|INPUT|SELECT")||(37===i.keyCode&&e.options.accessibility===!0?e.changeSlide({data:{message:e.options.rtl===!0?"next":"previous"}}):39===i.keyCode&&e.options.accessibility===!0&&e.changeSlide({data:{message:e.options.rtl===!0?"previous":"next"}}))},e.prototype.lazyLoad=function(){function e(e){i("img[data-lazy]",e).each(function(){var e=i(this),t=i(this).attr("data-lazy"),o=i(this).attr("data-srcset"),s=i(this).attr("data-sizes")||r.$slider.attr("data-sizes"),n=document.createElement("img");n.onload=function(){e.animate({opacity:0},100,function(){o&&(e.attr("srcset",o),s&&e.attr("sizes",s)),e.attr("src",t).animate({opacity:1},200,function(){e.removeAttr("data-lazy data-srcset data-sizes").removeClass("slick-loading")}),r.$slider.trigger("lazyLoaded",[r,e,t])})},n.onerror=function(){e.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),r.$slider.trigger("lazyLoadError",[r,e,t])},n.src=t})}var t,o,s,n,r=this;if(r.options.centerMode===!0?r.options.infinite===!0?(s=r.currentSlide+(r.options.slidesToShow/2+1),n=s+r.options.slidesToShow+2):(s=Math.max(0,r.currentSlide-(r.options.slidesToShow/2+1)),n=2+(r.options.slidesToShow/2+1)+r.currentSlide):(s=r.options.infinite?r.options.slidesToShow+r.currentSlide:r.currentSlide,n=Math.ceil(s+r.options.slidesToShow),r.options.fade===!0&&(s>0&&s--,n<=r.slideCount&&n++)),t=r.$slider.find(".slick-slide").slice(s,n),"anticipated"===r.options.lazyLoad)for(var l=s-1,d=n,a=r.$slider.find(".slick-slide"),c=0;c<r.options.slidesToScroll;c++)l<0&&(l=r.slideCount-1),t=t.add(a.eq(l)),t=t.add(a.eq(d)),l--,d++;e(t),r.slideCount<=r.options.slidesToShow?(o=r.$slider.find(".slick-slide"),e(o)):r.currentSlide>=r.slideCount-r.options.slidesToShow?(o=r.$slider.find(".slick-cloned").slice(0,r.options.slidesToShow),e(o)):0===r.currentSlide&&(o=r.$slider.find(".slick-cloned").slice(r.options.slidesToShow*-1),e(o))},e.prototype.loadSlider=function(){var i=this;i.setPosition(),i.$slideTrack.css({opacity:1}),i.$slider.removeClass("slick-loading"),i.initUI(),"progressive"===i.options.lazyLoad&&i.progressiveLazyLoad()},e.prototype.next=e.prototype.slickNext=function(){var i=this;i.changeSlide({data:{message:"next"}})},e.prototype.orientationChange=function(){var i=this;i.checkResponsive(),i.setPosition()},e.prototype.pause=e.prototype.slickPause=function(){var i=this;i.autoPlayClear(),i.paused=!0},e.prototype.play=e.prototype.slickPlay=function(){var i=this;i.autoPlay(),i.options.autoplay=!0,i.paused=!1,i.focussed=!1,i.interrupted=!1},e.prototype.postSlide=function(e){var t=this;if(!t.unslicked&&(t.$slider.trigger("afterChange",[t,e]),t.animating=!1,t.slideCount>t.options.slidesToShow&&t.setPosition(),t.swipeLeft=null,t.options.autoplay&&t.autoPlay(),t.options.accessibility===!0&&(t.initADA(),t.options.focusOnChange))){var o=i(t.$slides.get(t.currentSlide));o.attr("tabindex",0).focus()}},e.prototype.prev=e.prototype.slickPrev=function(){var i=this;i.changeSlide({data:{message:"previous"}})},e.prototype.preventDefault=function(i){i.preventDefault()},e.prototype.progressiveLazyLoad=function(e){e=e||1;var t,o,s,n,r,l=this,d=i("img[data-lazy]",l.$slider);d.length?(t=d.first(),o=t.attr("data-lazy"),s=t.attr("data-srcset"),n=t.attr("data-sizes")||l.$slider.attr("data-sizes"),r=document.createElement("img"),r.onload=function(){s&&(t.attr("srcset",s),n&&t.attr("sizes",n)),t.attr("src",o).removeAttr("data-lazy data-srcset data-sizes").removeClass("slick-loading"),l.options.adaptiveHeight===!0&&l.setPosition(),l.$slider.trigger("lazyLoaded",[l,t,o]),l.progressiveLazyLoad()},r.onerror=function(){e<3?setTimeout(function(){l.progressiveLazyLoad(e+1)},500):(t.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),l.$slider.trigger("lazyLoadError",[l,t,o]),l.progressiveLazyLoad())},r.src=o):l.$slider.trigger("allImagesLoaded",[l])},e.prototype.refresh=function(e){var t,o,s=this;o=s.slideCount-s.options.slidesToShow,!s.options.infinite&&s.currentSlide>o&&(s.currentSlide=o),s.slideCount<=s.options.slidesToShow&&(s.currentSlide=0),t=s.currentSlide,s.destroy(!0),i.extend(s,s.initials,{currentSlide:t}),s.init(),e||s.changeSlide({data:{message:"index",index:t}},!1)},e.prototype.registerBreakpoints=function(){var e,t,o,s=this,n=s.options.responsive||null;if("array"===i.type(n)&&n.length){s.respondTo=s.options.respondTo||"window";for(e in n)if(o=s.breakpoints.length-1,n.hasOwnProperty(e)){for(t=n[e].breakpoint;o>=0;)s.breakpoints[o]&&s.breakpoints[o]===t&&s.breakpoints.splice(o,1),o--;s.breakpoints.push(t),s.breakpointSettings[t]=n[e].settings}s.breakpoints.sort(function(i,e){return s.options.mobileFirst?i-e:e-i})}},e.prototype.reinit=function(){var e=this;e.$slides=e.$slideTrack.children(e.options.slide).addClass("slick-slide"),e.slideCount=e.$slides.length,e.currentSlide>=e.slideCount&&0!==e.currentSlide&&(e.currentSlide=e.currentSlide-e.options.slidesToScroll),e.slideCount<=e.options.slidesToShow&&(e.currentSlide=0),e.registerBreakpoints(),e.setProps(),e.setupInfinite(),e.buildArrows(),e.updateArrows(),e.initArrowEvents(),e.buildDots(),e.updateDots(),e.initDotEvents(),e.cleanUpSlideEvents(),e.initSlideEvents(),e.checkResponsive(!1,!0),e.options.focusOnSelect===!0&&i(e.$slideTrack).children().on("click.slick",e.selectHandler),e.setSlideClasses("number"==typeof e.currentSlide?e.currentSlide:0),e.setPosition(),e.focusHandler(),e.paused=!e.options.autoplay,e.autoPlay(),e.$slider.trigger("reInit",[e])},e.prototype.resize=function(){var e=this;i(window).width()!==e.windowWidth&&(clearTimeout(e.windowDelay),e.windowDelay=window.setTimeout(function(){e.windowWidth=i(window).width(),e.checkResponsive(),e.unslicked||e.setPosition()},50))},e.prototype.removeSlide=e.prototype.slickRemove=function(i,e,t){var o=this;return"boolean"==typeof i?(e=i,i=e===!0?0:o.slideCount-1):i=e===!0?--i:i,!(o.slideCount<1||i<0||i>o.slideCount-1)&&(o.unload(),t===!0?o.$slideTrack.children().remove():o.$slideTrack.children(this.options.slide).eq(i).remove(),o.$slides=o.$slideTrack.children(this.options.slide),o.$slideTrack.children(this.options.slide).detach(),o.$slideTrack.append(o.$slides),o.$slidesCache=o.$slides,void o.reinit())},e.prototype.setCSS=function(i){var e,t,o=this,s={};o.options.rtl===!0&&(i=-i),e="left"==o.positionProp?Math.ceil(i)+"px":"0px",t="top"==o.positionProp?Math.ceil(i)+"px":"0px",s[o.positionProp]=i,o.transformsEnabled===!1?o.$slideTrack.css(s):(s={},o.cssTransitions===!1?(s[o.animType]="translate("+e+", "+t+")",o.$slideTrack.css(s)):(s[o.animType]="translate3d("+e+", "+t+", 0px)",o.$slideTrack.css(s)))},e.prototype.setDimensions=function(){var i=this;i.options.vertical===!1?i.options.centerMode===!0&&i.$list.css({padding:"0px "+i.options.centerPadding}):(i.$list.height(i.$slides.first().outerHeight(!0)*i.options.slidesToShow),i.options.centerMode===!0&&i.$list.css({padding:i.options.centerPadding+" 0px"})),i.listWidth=i.$list.width(),i.listHeight=i.$list.height(),i.options.vertical===!1&&i.options.variableWidth===!1?(i.slideWidth=Math.ceil(i.listWidth/i.options.slidesToShow),i.$slideTrack.width(Math.ceil(i.slideWidth*i.$slideTrack.children(".slick-slide").length))):i.options.variableWidth===!0?i.$slideTrack.width(5e3*i.slideCount):(i.slideWidth=Math.ceil(i.listWidth),i.$slideTrack.height(Math.ceil(i.$slides.first().outerHeight(!0)*i.$slideTrack.children(".slick-slide").length)));var e=i.$slides.first().outerWidth(!0)-i.$slides.first().width();i.options.variableWidth===!1&&i.$slideTrack.children(".slick-slide").width(i.slideWidth-e)},e.prototype.setFade=function(){var e,t=this;t.$slides.each(function(o,s){e=t.slideWidth*o*-1,t.options.rtl===!0?i(s).css({position:"relative",right:e,top:0,zIndex:t.options.zIndex-2,opacity:0}):i(s).css({position:"relative",left:e,top:0,zIndex:t.options.zIndex-2,opacity:0})}),t.$slides.eq(t.currentSlide).css({zIndex:t.options.zIndex-1,opacity:1})},e.prototype.setHeight=function(){var i=this;if(1===i.options.slidesToShow&&i.options.adaptiveHeight===!0&&i.options.vertical===!1){var e=i.$slides.eq(i.currentSlide).outerHeight(!0);i.$list.css("height",e)}},e.prototype.setOption=e.prototype.slickSetOption=function(){var e,t,o,s,n,r=this,l=!1;if("object"===i.type(arguments[0])?(o=arguments[0],l=arguments[1],n="multiple"):"string"===i.type(arguments[0])&&(o=arguments[0],s=arguments[1],l=arguments[2],"responsive"===arguments[0]&&"array"===i.type(arguments[1])?n="responsive":"undefined"!=typeof arguments[1]&&(n="single")),"single"===n)r.options[o]=s;else if("multiple"===n)i.each(o,function(i,e){r.options[i]=e});else if("responsive"===n)for(t in s)if("array"!==i.type(r.options.responsive))r.options.responsive=[s[t]];else{for(e=r.options.responsive.length-1;e>=0;)r.options.responsive[e].breakpoint===s[t].breakpoint&&r.options.responsive.splice(e,1),e--;r.options.responsive.push(s[t])}l&&(r.unload(),r.reinit())},e.prototype.setPosition=function(){var i=this;i.setDimensions(),i.setHeight(),i.options.fade===!1?i.setCSS(i.getLeft(i.currentSlide)):i.setFade(),i.$slider.trigger("setPosition",[i])},e.prototype.setProps=function(){var i=this,e=document.body.style;i.positionProp=i.options.vertical===!0?"top":"left",
"top"===i.positionProp?i.$slider.addClass("slick-vertical"):i.$slider.removeClass("slick-vertical"),void 0===e.WebkitTransition&&void 0===e.MozTransition&&void 0===e.msTransition||i.options.useCSS===!0&&(i.cssTransitions=!0),i.options.fade&&("number"==typeof i.options.zIndex?i.options.zIndex<3&&(i.options.zIndex=3):i.options.zIndex=i.defaults.zIndex),void 0!==e.OTransform&&(i.animType="OTransform",i.transformType="-o-transform",i.transitionType="OTransition",void 0===e.perspectiveProperty&&void 0===e.webkitPerspective&&(i.animType=!1)),void 0!==e.MozTransform&&(i.animType="MozTransform",i.transformType="-moz-transform",i.transitionType="MozTransition",void 0===e.perspectiveProperty&&void 0===e.MozPerspective&&(i.animType=!1)),void 0!==e.webkitTransform&&(i.animType="webkitTransform",i.transformType="-webkit-transform",i.transitionType="webkitTransition",void 0===e.perspectiveProperty&&void 0===e.webkitPerspective&&(i.animType=!1)),void 0!==e.msTransform&&(i.animType="msTransform",i.transformType="-ms-transform",i.transitionType="msTransition",void 0===e.msTransform&&(i.animType=!1)),void 0!==e.transform&&i.animType!==!1&&(i.animType="transform",i.transformType="transform",i.transitionType="transition"),i.transformsEnabled=i.options.useTransform&&null!==i.animType&&i.animType!==!1},e.prototype.setSlideClasses=function(i){var e,t,o,s,n=this;if(t=n.$slider.find(".slick-slide").removeClass("slick-active slick-center slick-current").attr("aria-hidden","true"),n.$slides.eq(i).addClass("slick-current"),n.options.centerMode===!0){var r=n.options.slidesToShow%2===0?1:0;e=Math.floor(n.options.slidesToShow/2),n.options.infinite===!0&&(i>=e&&i<=n.slideCount-1-e?n.$slides.slice(i-e+r,i+e+1).addClass("slick-active").attr("aria-hidden","false"):(o=n.options.slidesToShow+i,t.slice(o-e+1+r,o+e+2).addClass("slick-active").attr("aria-hidden","false")),0===i?t.eq(t.length-1-n.options.slidesToShow).addClass("slick-center"):i===n.slideCount-1&&t.eq(n.options.slidesToShow).addClass("slick-center")),n.$slides.eq(i).addClass("slick-center")}else i>=0&&i<=n.slideCount-n.options.slidesToShow?n.$slides.slice(i,i+n.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false"):t.length<=n.options.slidesToShow?t.addClass("slick-active").attr("aria-hidden","false"):(s=n.slideCount%n.options.slidesToShow,o=n.options.infinite===!0?n.options.slidesToShow+i:i,n.options.slidesToShow==n.options.slidesToScroll&&n.slideCount-i<n.options.slidesToShow?t.slice(o-(n.options.slidesToShow-s),o+s).addClass("slick-active").attr("aria-hidden","false"):t.slice(o,o+n.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false"));"ondemand"!==n.options.lazyLoad&&"anticipated"!==n.options.lazyLoad||n.lazyLoad()},e.prototype.setupInfinite=function(){var e,t,o,s=this;if(s.options.fade===!0&&(s.options.centerMode=!1),s.options.infinite===!0&&s.options.fade===!1&&(t=null,s.slideCount>s.options.slidesToShow)){for(o=s.options.centerMode===!0?s.options.slidesToShow+1:s.options.slidesToShow,e=s.slideCount;e>s.slideCount-o;e-=1)t=e-1,i(s.$slides[t]).clone(!0).attr("id","").attr("data-slick-index",t-s.slideCount).prependTo(s.$slideTrack).addClass("slick-cloned");for(e=0;e<o+s.slideCount;e+=1)t=e,i(s.$slides[t]).clone(!0).attr("id","").attr("data-slick-index",t+s.slideCount).appendTo(s.$slideTrack).addClass("slick-cloned");s.$slideTrack.find(".slick-cloned").find("[id]").each(function(){i(this).attr("id","")})}},e.prototype.interrupt=function(i){var e=this;i||e.autoPlay(),e.interrupted=i},e.prototype.selectHandler=function(e){var t=this,o=i(e.target).is(".slick-slide")?i(e.target):i(e.target).parents(".slick-slide"),s=parseInt(o.attr("data-slick-index"));return s||(s=0),t.slideCount<=t.options.slidesToShow?void t.slideHandler(s,!1,!0):void t.slideHandler(s)},e.prototype.slideHandler=function(i,e,t){var o,s,n,r,l,d=null,a=this;if(e=e||!1,!(a.animating===!0&&a.options.waitForAnimate===!0||a.options.fade===!0&&a.currentSlide===i))return e===!1&&a.asNavFor(i),o=i,d=a.getLeft(o),r=a.getLeft(a.currentSlide),a.currentLeft=null===a.swipeLeft?r:a.swipeLeft,a.options.infinite===!1&&a.options.centerMode===!1&&(i<0||i>a.getDotCount()*a.options.slidesToScroll)?void(a.options.fade===!1&&(o=a.currentSlide,t!==!0&&a.slideCount>a.options.slidesToShow?a.animateSlide(r,function(){a.postSlide(o)}):a.postSlide(o))):a.options.infinite===!1&&a.options.centerMode===!0&&(i<0||i>a.slideCount-a.options.slidesToScroll)?void(a.options.fade===!1&&(o=a.currentSlide,t!==!0&&a.slideCount>a.options.slidesToShow?a.animateSlide(r,function(){a.postSlide(o)}):a.postSlide(o))):(a.options.autoplay&&clearInterval(a.autoPlayTimer),s=o<0?a.slideCount%a.options.slidesToScroll!==0?a.slideCount-a.slideCount%a.options.slidesToScroll:a.slideCount+o:o>=a.slideCount?a.slideCount%a.options.slidesToScroll!==0?0:o-a.slideCount:o,a.animating=!0,a.$slider.trigger("beforeChange",[a,a.currentSlide,s]),n=a.currentSlide,a.currentSlide=s,a.setSlideClasses(a.currentSlide),a.options.asNavFor&&(l=a.getNavTarget(),l=l.slick("getSlick"),l.slideCount<=l.options.slidesToShow&&l.setSlideClasses(a.currentSlide)),a.updateDots(),a.updateArrows(),a.options.fade===!0?(t!==!0?(a.fadeSlideOut(n),a.fadeSlide(s,function(){a.postSlide(s)})):a.postSlide(s),void a.animateHeight()):void(t!==!0&&a.slideCount>a.options.slidesToShow?a.animateSlide(d,function(){a.postSlide(s)}):a.postSlide(s)))},e.prototype.startLoad=function(){var i=this;i.options.arrows===!0&&i.slideCount>i.options.slidesToShow&&(i.$prevArrow.hide(),i.$nextArrow.hide()),i.options.dots===!0&&i.slideCount>i.options.slidesToShow&&i.$dots.hide(),i.$slider.addClass("slick-loading")},e.prototype.swipeDirection=function(){var i,e,t,o,s=this;return i=s.touchObject.startX-s.touchObject.curX,e=s.touchObject.startY-s.touchObject.curY,t=Math.atan2(e,i),o=Math.round(180*t/Math.PI),o<0&&(o=360-Math.abs(o)),o<=45&&o>=0?s.options.rtl===!1?"left":"right":o<=360&&o>=315?s.options.rtl===!1?"left":"right":o>=135&&o<=225?s.options.rtl===!1?"right":"left":s.options.verticalSwiping===!0?o>=35&&o<=135?"down":"up":"vertical"},e.prototype.swipeEnd=function(i){var e,t,o=this;if(o.dragging=!1,o.swiping=!1,o.scrolling)return o.scrolling=!1,!1;if(o.interrupted=!1,o.shouldClick=!(o.touchObject.swipeLength>10),void 0===o.touchObject.curX)return!1;if(o.touchObject.edgeHit===!0&&o.$slider.trigger("edge",[o,o.swipeDirection()]),o.touchObject.swipeLength>=o.touchObject.minSwipe){switch(t=o.swipeDirection()){case"left":case"down":e=o.options.swipeToSlide?o.checkNavigable(o.currentSlide+o.getSlideCount()):o.currentSlide+o.getSlideCount(),o.currentDirection=0;break;case"right":case"up":e=o.options.swipeToSlide?o.checkNavigable(o.currentSlide-o.getSlideCount()):o.currentSlide-o.getSlideCount(),o.currentDirection=1}"vertical"!=t&&(o.slideHandler(e),o.touchObject={},o.$slider.trigger("swipe",[o,t]))}else o.touchObject.startX!==o.touchObject.curX&&(o.slideHandler(o.currentSlide),o.touchObject={})},e.prototype.swipeHandler=function(i){var e=this;if(!(e.options.swipe===!1||"ontouchend"in document&&e.options.swipe===!1||e.options.draggable===!1&&i.type.indexOf("mouse")!==-1))switch(e.touchObject.fingerCount=i.originalEvent&&void 0!==i.originalEvent.touches?i.originalEvent.touches.length:1,e.touchObject.minSwipe=e.listWidth/e.options.touchThreshold,e.options.verticalSwiping===!0&&(e.touchObject.minSwipe=e.listHeight/e.options.touchThreshold),i.data.action){case"start":e.swipeStart(i);break;case"move":e.swipeMove(i);break;case"end":e.swipeEnd(i)}},e.prototype.swipeMove=function(i){var e,t,o,s,n,r,l=this;return n=void 0!==i.originalEvent?i.originalEvent.touches:null,!(!l.dragging||l.scrolling||n&&1!==n.length)&&(e=l.getLeft(l.currentSlide),l.touchObject.curX=void 0!==n?n[0].pageX:i.clientX,l.touchObject.curY=void 0!==n?n[0].pageY:i.clientY,l.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(l.touchObject.curX-l.touchObject.startX,2))),r=Math.round(Math.sqrt(Math.pow(l.touchObject.curY-l.touchObject.startY,2))),!l.options.verticalSwiping&&!l.swiping&&r>4?(l.scrolling=!0,!1):(l.options.verticalSwiping===!0&&(l.touchObject.swipeLength=r),t=l.swipeDirection(),void 0!==i.originalEvent&&l.touchObject.swipeLength>4&&(l.swiping=!0,i.preventDefault()),s=(l.options.rtl===!1?1:-1)*(l.touchObject.curX>l.touchObject.startX?1:-1),l.options.verticalSwiping===!0&&(s=l.touchObject.curY>l.touchObject.startY?1:-1),o=l.touchObject.swipeLength,l.touchObject.edgeHit=!1,l.options.infinite===!1&&(0===l.currentSlide&&"right"===t||l.currentSlide>=l.getDotCount()&&"left"===t)&&(o=l.touchObject.swipeLength*l.options.edgeFriction,l.touchObject.edgeHit=!0),l.options.vertical===!1?l.swipeLeft=e+o*s:l.swipeLeft=e+o*(l.$list.height()/l.listWidth)*s,l.options.verticalSwiping===!0&&(l.swipeLeft=e+o*s),l.options.fade!==!0&&l.options.touchMove!==!1&&(l.animating===!0?(l.swipeLeft=null,!1):void l.setCSS(l.swipeLeft))))},e.prototype.swipeStart=function(i){var e,t=this;return t.interrupted=!0,1!==t.touchObject.fingerCount||t.slideCount<=t.options.slidesToShow?(t.touchObject={},!1):(void 0!==i.originalEvent&&void 0!==i.originalEvent.touches&&(e=i.originalEvent.touches[0]),t.touchObject.startX=t.touchObject.curX=void 0!==e?e.pageX:i.clientX,t.touchObject.startY=t.touchObject.curY=void 0!==e?e.pageY:i.clientY,void(t.dragging=!0))},e.prototype.unfilterSlides=e.prototype.slickUnfilter=function(){var i=this;null!==i.$slidesCache&&(i.unload(),i.$slideTrack.children(this.options.slide).detach(),i.$slidesCache.appendTo(i.$slideTrack),i.reinit())},e.prototype.unload=function(){var e=this;i(".slick-cloned",e.$slider).remove(),e.$dots&&e.$dots.remove(),e.$prevArrow&&e.htmlExpr.test(e.options.prevArrow)&&e.$prevArrow.remove(),e.$nextArrow&&e.htmlExpr.test(e.options.nextArrow)&&e.$nextArrow.remove(),e.$slides.removeClass("slick-slide slick-active slick-visible slick-current").attr("aria-hidden","true").css("width","")},e.prototype.unslick=function(i){var e=this;e.$slider.trigger("unslick",[e,i]),e.destroy()},e.prototype.updateArrows=function(){var i,e=this;i=Math.floor(e.options.slidesToShow/2),e.options.arrows===!0&&e.slideCount>e.options.slidesToShow&&!e.options.infinite&&(e.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false"),e.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false"),0===e.currentSlide?(e.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true"),e.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false")):e.currentSlide>=e.slideCount-e.options.slidesToShow&&e.options.centerMode===!1?(e.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),e.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")):e.currentSlide>=e.slideCount-1&&e.options.centerMode===!0&&(e.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),e.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")))},e.prototype.updateDots=function(){var i=this;null!==i.$dots&&(i.$dots.find("li").removeClass("slick-active").end(),i.$dots.find("li").eq(Math.floor(i.currentSlide/i.options.slidesToScroll)).addClass("slick-active"))},e.prototype.visibility=function(){var i=this;i.options.autoplay&&(document[i.hidden]?i.interrupted=!0:i.interrupted=!1)},i.fn.slick=function(){var i,t,o=this,s=arguments[0],n=Array.prototype.slice.call(arguments,1),r=o.length;for(i=0;i<r;i++)if("object"==typeof s||"undefined"==typeof s?o[i].slick=new e(o[i],s):t=o[i].slick[s].apply(o[i].slick,n),"undefined"!=typeof t)return t;return o}});var BPTracking = new function _BasePlatformTracking() {
    
    var cookie_duration = 30 * 86400;
    this.track = function() {
        console.log("start tracking");
        var utm_source = this.getParameterByName("utm_source");
        
        if(utm_source) {
            $.cookie("utm_source", utm_source, {
                expires: cookie_duration,
                path: '/'
            });
        }
        
        var utm_campaign = this.getParameterByName("utm_campaign");
        
        if(utm_campaign) {
            $.cookie("utm_campaign", utm_campaign, {
                expires: cookie_duration,
                path: '/'
            });
        }
        
        var utm_medium = this.getParameterByName("utm_medium");
        if(utm_medium) {
            $.cookie("utm_medium", utm_medium, {
                expires: cookie_duration,
                path: '/'
            });
        }
        
        var utm_term = this.getParameterByName("utm_term");
        if(utm_term) {
            $.cookie("utm_term", utm_term, {
                expires: cookie_duration,
                path: '/'
            });
        }
        
        var utm_content = this.getParameterByName("utm_content");
        if(utm_content) {
            $.cookie("utm_content", utm_content, {
                expires: cookie_duration,
                path: '/'
            });
        }
        
        var referral_id = this.getParameterByName("referral_id");
        if(referral_id) {
            $.cookie("referral_id", referral_id, {
                expires: cookie_duration,
                path: '/'
            });
        }
    };
    
    this.getParameterByName = function(name, url) {
        if(!url) {
            url = window.location.href;
        }
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"), results = regex.exec(url);
        if(!results || !results[2]) {
            return '';
            //get from cookie 
        } else {
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }
        
    };
};

BPTracking.track();
function setRef(ref, url){
};

var urlc_clicks=0;
var urlc_timer=null;

function urlClick_reset(){
	urlc_clicks=0;
	urlc_timer=null;
}

function urlClick(ref){
	var $this=$(ref);
	
	var username='';
	if ($this.data('username')){
		username=$this.data('username');
	}else if ($this.hasClass('username')){
		username=$this.text();
	}

	if (username && username.length){
		if (username.charAt(0)=='@'){
			username=username.substr(1);
		}
		
		if ($this.data("intent")=="chat"){
			return Base.message.peer(username);
		}
		return usernameClick(username, ref);
	}

	if ($this.data('redirect')){
		var $s=$this.data('redirect');
		AP.redirect($s);
		return;
	}
	
	if ($this.data("urlparam")){
		var p=$this.data("urlparam");
		var v=$this.data("value");
		
		var px={};
		
		if (v && v!=""){
			px[p]=v;
		}else{
			px[p]=null;
		}
		
		AP.setURLParams(px);
		return AP.refresh();
	}

	
	if ($this.data('updateurl')){
		var params=$this.data('updateurl');
		AP.updateURLParams(params);
		return;
	}
	
	var url=null;
	
	if ($this.data('xurl')){
		var url=$this.data('xurl');
		if (Client.pageData.context){
			url=Client.pageData.context.path+"/"+url;
		}
	}else{
		var url=$this.data('url');
		if (url==':self'){
			return __selfcall(ref);
		}
	}
	
	if (url==":refresh"){
		AP.refresh();
		return;
	}
	
	if (url==':submit'){
		Form.submitFrom(ref, function(code){
			if (!code.good()){
				return AP.alertError(code.message);
			}
			
			UI.flash("Update successfully ...");
			
			if ($this.data("callback")){
				var cb=$this.data("callback");
				var fn=getFunctionByName(cb);
				fn(code, $this);
			}else{
				AP.xRefresh();	
			}
		});
		
		return;
	}
	
	if (url==":active"){
		$this.toggleClass("active");
		return;
	}
	
	if (url==":zoom"){
		UI.previewImage($(ref).data("image"));
		return;
	}
	
	if (url==":active:parent" || url==":parent-active" || url==':parent:active'){
		$this.parent().toggleClass("active");
		return;
	}
	
	if (url==':parent:parent:active' || url==':active:parent:parent'){
		$this.parent().parent().toggleClass("active");
		return;
	}
	
	if (url==':parent:parent:parent:active' || url==':active:parent:parent:parent'){
		$this.parent().parent().parent().toggleClass("active");
		return;
	}
	
	if (url==":collapse"){
		$this.toggleClass("-collapsed");
		return;
	}
	
	if (url==":collapse:parent"){
		$this.parent().toggleClass("-collapsed");
		return;
	}
	
	if (url==":collapse:parent:parent"){
		$this.parent().parent().toggleClass("-collapsed");
		return;
	}
	
	
	if (url==":back"){
		AP.back();
		return;
	}
	
	if (url==":export"){
		var curl=Client.path.current;
		if (curl.indexOf("?")!=-1){
			curl+="&export=1";
		}else{
			curl+="?export=1";
		}
		
		window.open(Client.url+"/"+curl);
		return;
	}
	
	
	if (url==":embed"){
		var w=$(ref).data("width");
		if (!w){
			w=800;
		}
		
		var app=$(ref).data("app");
		var url=$(ref).data("embed");
		
		var title=$(ref).data("title");
		if (!title){
			title="App embed: "+app;
		}
		
		Base.api.embed(Base.domain(app)+"/"+url, {
			width: w,
			title: title
		});
		
		return;
	};
	
	if (url==":viewfile"){
		var ext_url=$(ref).closest(".fileviewer-mobile").data("url");
		if (!ext_url){
			ext_url=$(ref).data("file");
		}
		
		if (ext_url){
			window.open(ext_url);
		}
		return;
	}
	
	
	if (url==":file"){
		var ext_url=$(ref).data("file");
		Base.file.preview(ext_url);
		return;
	}
	
	if (AP.word.prefix(url, '#')){
		var id=url.substr(1);
		var $selector=$("#"+id);
		if (!$selector.length){
			return;
		}
		
		var $s=$selector.closest(".scroll-y");
		if (!$s || !$s.length){
			$s=$selector.closest(".scroll-in")
		}
		
		if (!$s || !$s.length){
			return;
		}
		
		var etop=$selector.offset().top;
		var ptop=$s.offset().top;
		var t=etop-ptop+$s.scrollTop();
		
		$s.scrollTop(t);
		
		return;
	}
	
	if (!url){
		return;
	}
	
	if ($(ref).data("ref") && $(ref).data("ref").length){
		var ref_url=$(ref).data("ref");
		if (ref_url==":self" || ref_url=="self"){
			ref_url= AP.url().current();
		}
		setRef(url, ref_url);
	}
	
	
	var dburl=$this.data("dburl");
	
	if (dburl){
		urlc_clicks++;
		if (urlc_clicks === 1){
			urlc_timer = setTimeout(function(){ 
            	base_trueclick($this, ref, url);
            	urlc_clicks = 0;
            }, 200);
        } else {
        	clearTimeout(urlc_timer);
        	urlc_clicks = 0;
        	base_trueclick($this, ref, dburl);
        }
	}else{
		base_trueclick($this, ref, url);	
	}
};



function usernameClick(username, ref){
	UI.user.menu(ref, username);	
};


function base_trueclick($this, ref, url){	
	// Handle URL click
	var inspect=Base.inspect(url);
	
	if (inspect.base){
		if (inspect.local){
		    if (!AP.adaptive(url, window.location.href) && !AP.rewriteCheck(url)){
		    	return AP.redirect(url);
		    }
		    
		    if ($this.data("blank")=="1"){
		    	return window.open(Client.url+"/"+inspect.url);	
		    }
		    
			return AP.toURL(inspect.url, null, ref);
		}else{
			return window.open(inspect.url);
		}
	}else{
		if (!AP.adaptive(url, window.location.href)){
	    	// return AP.redirect(url);
			return window.open(url);
	    }
		
		AP.toURL(url, null, ref);
	}
};










function getFunctionByName(functionName, context) {
    // If using Node.js, the context will be an empty object
    if(typeof(window) == "undefined") {
        context = context || global;
    }else{
        // Use the window (from browser) as context if none providen.
        context = context || window;
    }

    // Retrieve the namespaces of the function you want to execute
    // e.g Namespaces of "MyLib.UI.alerti" would be ["MyLib","UI"]
    var namespaces = functionName.split(".");
    
    // Retrieve the real name of the function i.e alerti
    var functionToExecute = namespaces.pop();
    
    // Iterate through every namespace to access the one that has the function
    // you want to execute. For example with the alert fn "MyLib.UI.SomeSub.alert"
    // Loop until context will be equal to SomeSub
    for (var i = 0; i < namespaces.length; i++) {
        context = context[namespaces[i]];
    }
    
    // If the context really exists (namespaces), return the function or property
    if(context){
        return context[functionToExecute];
    }else{
        return undefined;
    }
}
var Template = new function __Template() {
	this.basic = function (){};
	this.v1 = function (){};
	this.v2 = function (){};
	this.v3 = function (){};
	this.v4 = function (){};
	this.v5 = function (){};
	this.v9 = function (){};
	this.v10 = function (){};
	this.v12 = function (){};
	this.v13 = function (){};
	this.component = function (){};
};


Template.component = new function __TemplateComponent() {

	/**
	 * Scroll to Top
	 * ---
	 */
	this.top = function (version) {
		var _body = $('body');
		var _ver = (typeof version !== "undefined") ? "component__top--" + version : "";

		// HTML
		_body.prepend("<a href='#' id='component__top' class='component__top " + _ver + "'><i class='icon ficon-chevron-up'></i></a>");

		// Trigger
		$(window).scroll(function () {
			if ($(this).scrollTop() > 100) {
				$('#component__top').addClass("--show", 100);
			} else {
				$('#component__top').removeClass("--show", 100);
			}
		});

		$('#component__top').click(function () {
			$("html, body").animate({
				scrollTop: 0
			}, 600);
			return false;
		});
	};

};



Template.basic = new function __TemplateBasic(){

	/**
	 * Initial careers site.
	 */
	this.init = function () {
		if (mobile()) {
			this.mobile();
		}

		if (Client.path.app === "job") {
			initJob();
		}

		reset();
	};


	/**
	 * Initial a single job
	 * ---
	 * @returns {boolean}
	 */
	function initJob() {
		var is_apply = parseInt(Query.get('apply')) === 1;

		if (is_apply) {
			$("html, body").animate({
				scrollTop: $("#appform").offset().top
			}, 2000);
			return false;
		}
	}


	/**
	 * Initial if mobile detected
	 * ---
	 */
	this.mobile = function () {
		initMobileMenu();
	};


	/**
	 * Some function to reset layout
	 * ---
	 */
	function reset() {
		AP.sys.on("page.post.transition", function(){
			if (parseInt(Client.mobile)){
				$("#menu").hide();
			}
		});
	}


	/**
	 * Init mobile Menu
	 * ---
	 */
	function initMobileMenu() {
		var _ref_menu = $("*[data-menu]");

		_ref_menu.on("click", function () {
			if (_ref_menu.data("menu") === "open") {
				$("#menu").toggle();
			}
		});
	}

	jQuery(document).ready(function($){
		$('.icon-uniF162').on('click', function(e){
			e.preventDefault();
			var $this = $(this);
			$this.parents('.search').find('.search-form').stop().slideToggle();
			return false;
		});
	});

};


Template.v1 = new function __TemplateVersion1() {

	/**
	 * Init template
	 * ---
	 */
	this.init = function () {
		if (mobile()) {
			this.mobile();
		}

		this.initComponent();

		$(window).scroll(setSticky);

		Template.component.top("v1");
	};


	/**
	 * Init template when using Mobile Device (Not support for Responsive Design)
	 * ---
	 */
	this.mobile = function () {
		var _body = $('body');
		var _header = $('#header-recr');

		_header.prepend("<div id='overlay-header' data-menu='close'></div>");

		search();
		initHamburger();
	};


	/**
	 * Init components
	 * ---
	 */
	this.initComponent = function () {
		// Filter
		$("input[type='checkbox']").change(function () {
			$('.baseui.button.main').removeClass('disabled');
		});

		// Sticky anchor
		$("#jobs-search, #header-job").before("<div id='sticky-anchor'></div>");

		initSearchAction();
	};


	/**
	 * Init search sticky on top
	 * ---
	 */
	function setSticky() {
		
			var _ref = $("#sticky-anchor");

			if (_ref.length) {
				var window_top = $(window).scrollTop();
				var div_top = _ref.offset().top;
				if (window_top > div_top) {
					$('.search-form,#header-job').addClass('stick');
	
					_ref.height($('.search-form').outerHeight());
				} else {
					$('.search-form,#header-job').removeClass('stick');
					_ref.height(0);
				}
			}
		
	}


	/**
	 * Init search action for *[data-action="search"]
	 * ---
	 */
	function initSearchAction() {
		Support.init();

		var _ref = $("*[data-action='search']");

		_ref.on("keypress", function () {
			return Support.search(this, event);
		});
	}


	/**
	 * Init hamburger button
	 * ---
	 */
	function initHamburger() {
		var _ref = $("*[data-menu]");
		if (_ref.length > 0) {
			_ref.on("click", function () {
				var data_value = $(this).data("menu");
				if (data_value === "open") {
					$("#header-recr").addClass("showmenu");
					$("#overlay-common").css("display","block");
				} else {
					$("#header-recr").removeClass("showmenu");
					$("#overlay-common").css("display","none");
				}
			});
		}
	}


	/**
	 * Init Mobile Search
	 * ---
	 */
	function search() {
		$(".search-form .nav-search").click(function(){
			if($(this).hasClass("active")){
				$(".search-form.stick .box-search").slideUp();
				$(this).removeClass("active");
			}else{
				$(".search-form.stick .box-search").slideDown();
				$(this).addClass("active");
			}
		});
	}
};


Template.v2 = new function __TemplateVersion2() {

	/**
	 * Init template
	 * ---
	 */
	this.init = function () {
		if (mobile()) {
			this.mobile();
		}
		this.initComponents();
		$(window).scroll(setSticky);

		Template.component.top("v2");
	};

	this.mobile = function () {
		$("*[data-menu]").each(function (i, e) {
			$(e).on('click', function () {
				var status = $(e).data('menu');

				if (status === "open") {
					$("#header-recr").addClass("showfixed");
				} else if (status === "close") {
					$("#header-recr").removeClass("showfixed");
				}
			});
		});
		$(".btn-show").click(function () {
			$(".links").toggleClass("active");
		});
	};

	this.initComponents = function () {
		$('.menu-page .links a').click(function () {
			var position = $.attr(this, 'href').replace("/", "");
			$('html, body').animate({
				scrollTop: $(position).offset().top
			}, 500);
			return false;
		});
	};

	function setSticky() {
		var _ref = $(".menu-page");

		if (_ref.length) {
			var window_top = $(window).scrollTop();
			if (window_top > 60) {
				_ref.addClass('stick');
			} else {
				_ref.removeClass('stick');
			}
		}
	}
};


Template.v3 = new function __TemplateV3() {

	this.init = function () {
		if (mobile()) {
			this.mobile();
		}

		initNavigation();
		this.initComponents();

		Template.component.top("v3");
	};


	this.mobile = function () {
		$(".sec-jobs .nav-cat").click(function () {
			if ($(this).hasClass("active")) {
				$(".sec-jobs .sidebar").removeClass("show");
				$(this).removeClass("active");
			} else {
				$(".sec-jobs .sidebar").addClass("show");
				$(this).addClass("active");
			}
		});

		$("*[data-menu]").each(function (i, e) {
			$(e).on('click', function () {
				var status = $(e).data('menu');

				if (status === "open") {
					$("#header-recr").addClass("showfixed");
				} else if (status === "close") {
					$("#header-recr").removeClass("showfixed");
				}
			});
		});
	};

	/**
	this.initHome = function () {
		var category = $('.sidebar-depart a');

		// Filter category
		category.on('click', function () {
			var all_categories = $('.sidebar-depart').find('a'),
				id_active_cat = $(this).attr('data-dept');

			all_categories.each(function (index) {
				if ($(this).attr('data-dept') !== id_active_cat) {
					$(this).removeClass('active');
				} else {
					$(this).addClass('active');
				}
				filter("department");
			});
		});

		var location = $('.sidebar-location a');

		// Filter location
		location.on('click', function (e) {
			var all_locations = $('.sidebar-location').find('a'),
				id_active_loc = $(this).attr('data-office');

			all_locations.each(function (index) {
				if ($(this).attr('data-office') !== id_active_loc) {
					$(this).removeClass('active');
				} else {
					$(this).addClass('active');
				}
				filter("location");
			});
		});

		var type = $('.sidebar-type a');

		// Filter type
		type.on('click', function () {
			var all_types = $('.sidebar-type').find('a'),
				id_active_type = $(this).attr('data-job-type');

			all_types.each(function (index) {
				if ($(this).attr('data-job-type') !== id_active_type) {
					$(this).removeClass('active');
				} else {
					$(this).addClass('active');
				}
				filter("job_type");
			});
		});
	};**/


	this.initComponents = function () {
		$('a.cta[href^="#"]').on('click', function (e) {
			e.preventDefault();
			$(document).off("scroll");
			$('a.cta').each(function () {
				$(this).removeClass('active');
			});
			$(this).addClass('active');
			var target = this.hash,
				menu = target;
			$target = $(target);
			if ($target.length) {
				$('html, body').stop().animate({
					'scrollTop': $target.offset().top + 2
				}, 500, 'swing', function () {
					window.location.hash = target;
				});
			}
		});
		initSearchAction();
	};


	function initNavigation() {
		$(window).scroll(sticky_relocate);
		sticky_relocate();
	}

	/**
	 * Init search action for *[data-action="search"]
	 * ---
	 */
	function initSearchAction() {
		Support.init();

		var _ref = $("*[data-action='search']");

		_ref.on("keypress", function () {
			return Support.search(this, event);
		});
	}

	function sticky_relocate() {
		var _ref = $("#header-recr");

		if (_ref.length) {
			var window_top = $(window).scrollTop();
			if (window_top > 60) {
				_ref.addClass('stick');
			} else {
				_ref.removeClass('stick');
			}
		}
	}
	/**
	function filter(type) {
		if (typeof type === "undefined") {
			return;
		}

		var _sidebar = "";
		var data_type = "";
		var all_locations = '';

		if (type === "location") {
			_sidebar = $('.sidebar-location');
			data_type = "office";
			all_locations = $('.item-job');
		} else if (type === "department") {
			_sidebar = $('.sidebar-depart');
			data_type = "dept";
			all_locations = $('.box-cat');
		} else if (type === "job_type") {
			_sidebar = $('.sidebar-type');
			data_type = "job-type";
			all_locations = $('.item-job');
		}

		var active_category = _sidebar.find('a.active');

		if (active_category.attr('data-' + data_type) !== 'undefined' && active_category.attr('data-' + data_type)) {
			all_locations.each(function (index) {
				if ($(this).attr('data-' + data_type) !== active_category.attr('data-' + data_type)) {
					$(this).addClass('hidden');
				} else {
					$(this).removeClass('hidden');
				}
			});
		} else {
			all_locations.each(function (index) {
				$(this).removeClass('hidden');
			});
		}
	}**/

};


Template.v4 = new function __TemplateVersion1() {

	/**
	 * Init template
	 * ---
	 */
	this.init = function () {
		if (mobile()) {
			this.mobile();
		}

		this.initComponent();

		$(window).scroll(stickyHeader);

		initSearchAction();

		Template.component.top("v4");
	};


	this.mobile = function () {
		var _header = $('.tpl4__header');

		_header.prepend("<div id='overlay-header' data-menu='close'></div>");

		initHamburger();
	};


	this.initComponent = function () {
		$('a.cta').click(function () {
			var position = $.attr(this, 'href').replace("/", "");
			$('html, body').animate({
				scrollTop: $(position).offset().top
			}, 1000);
			return false;
		});
	};

	function initSearchAction() {
		Support.init();

		var _ref = $("*[data-action='search']");

		_ref.on("keypress", function () {
			return Support.search(this, event);
		});
	}


	function stickyHeader() {
		var _header = $(".tpl4__header");
		if (_header.length) {
			var window_top = $(window).scrollTop();
			if (window_top > 60) {
				_header.addClass('header--stick');

			} else {
				_header.removeClass('header--stick');
			}
		}
	}


	/**
	 * Init hamburger button
	 * ---
	 */
	function initHamburger() {
		var _ref = $("*[data-menu]");
		if (_ref.length > 0) {
			_ref.on("click", function () {
				var data_value = $(this).data("menu");
				if (data_value === "open") {
					$(".tpl4__header").addClass("showmenu");
					$("#overlay-common").css("display","block");
				} else {
					$(".tpl4__header").removeClass("showmenu");
					$("#overlay-common").css("display","none");
				}
			});
		}
	}
};


Template.v5 = new function __TemplateVersion5() {

	/**
	 * Init template
	 * ---
	 */
	this.init = function () {
		if (mobile()) {
			this.mobile();
		}

		if (Client.path.app === "job") {
			initJob();
		}

		this.initComponent();
		Template.component.top();
	};

	
	/**
	 * Initial any event listeners on a single Job
	 * ---
	 * @returns {boolean}
	 */
	function initJob() {
		var is_apply = parseInt(Query.get('apply')) === 1;

		if (is_apply) {
			$("html, body").animate({
				scrollTop: $("#appform").offset().top
			}, 1000);
			return false;
		}
	}

	this.initComponent = function () {
		// Init smooth scroll
		// language=JQuery-CSS
		$('a[data-scroll="scroll"]:not(.no-scroll)').on('click', function (e) {
			e.preventDefault();

			$('html, body').animate({
				scrollTop: $($(this).attr('href')).offset().top
			}, 500, 'linear');
		});

		initSearchAction();
	};

	/**
	 * Init search action for *[data-action="search"]
	 * ---
	 */
	 function initSearchAction() {
		Support.init();

		var _ref = $("*[data-action='search']");

		_ref.on("keypress", function () {
			return Support.search(this, event);
		});
	}


	/**
	 * Init template when using Mobile Device (Not support for Responsive Design)
	 * ---
	 */
	this.mobile = function () {
		var $body = $('body');

		$body.prepend("<div id='overlay-common' onclick='Menu.closeMenu();'></div>");
	};
};


Template.v9 = new function __TemplateVersion9() {
    /**
	 * Init template
	 * ---
	 */
	this.init = function () {
		this.initComponent();
        $(window).scroll(scroll_footer);

		Template.component.top("v9");
    };

    this.initComponent = function () {
        $("*[data-menu]").each(function (i, e) {
			$(e).on('click', function () {
				var status = $(e).data('menu');

				if (status === "open") {
					$("#header-recr").addClass("showfixed");
				} else if (status === "close") {
					$("#header-recr").removeClass("showfixed");
				}
			});
        });
        $('a[data-scroll="scroll"]:not(.no-scroll)').on('click', function (e) {
            e.preventDefault();
    
            $('html, body').animate({
                scrollTop: $($(this).attr('href')).offset().top
            }, 500, 'linear');
        });

        initSearchAction();
    };

    /**
	 * Init search action for *[data-action="search"]
	 * ---
	 */
	function initSearchAction() {
		Support.init();

		var _ref = $("*[data-action='search']");

		_ref.on("keypress", function () {
			return Support.search(this, event);
		});
	}

    function scroll_footer() {
        if ($("#sticky-anchor").length) {
            var window_top = $(window).scrollTop();
            var div_top = $('#sticky-anchor').offset().top;
            if (window_top > div_top) {
                $('.footer-article').addClass('stick');
    
            } else {
                $('.footer-article').removeClass('stick');
                $('#sticky-anchor').height(0);
            }
        }
    }

};


Template.v10 = new function __TemplateVersion10() {
    /**
	 * Init template
	 * ---
	 */
	this.init = function () {
		this.initComponent();

		Template.component.top("v10");
    };

    this.initComponent = function () {
        $("*[data-menu]").each(function (i, e) {
			$(e).on('click', function () {
				var status = $(e).data('menu');

				if (status === "open") {
					$("#header-recr").addClass("showfixed");
				} else if (status === "close") {
					$("#header-recr").removeClass("showfixed");
				}
			});
        });
        $('a[data-scroll="scroll"]:not(.no-scroll)').on('click', function (e) {
            e.preventDefault();
    
            $('html, body').animate({
                scrollTop: $($(this).attr('href')).offset().top
            }, 500, 'linear');
        });
    };

};


Template.v12 = new function __TemplateVersion12() {
    /**
	 * Init template
	 * ---
	 */
	this.init = function () {
		this.initComponent();

		Template.component.top("v12");
    };

    this.initComponent = function () {
        $("input[type='checkbox']").change(function () {
			$('.advanced-fields .btn-advanced.btn').removeClass('disabled');
        });
        
        $("*[data-menu]").each(function (i, e) {
			$(e).on('click', function () {
				var status = $(e).data('menu');
				if (status === "open") {
					$("#header-recr").addClass("showfixed");
				} else if (status === "close") {
					$("#header-recr").removeClass("showfixed");
				}
			});
        });

        initSearchAction();
    };

    /**
	 * Init search action for *[data-action="search"]
	 * ---
	 */
	function initSearchAction() {
		Support.init();

		var _ref = $("*[data-action='search']");

		_ref.on("keypress", function () {
			return Support.search(this, event);
		});
	}
};


Template.v13 = new function __TemplateVersion13() {
    /**
	 * Init template
	 * ---
	 */
	this.init = function () {
        if (mobile()) {
			this.mobile();
		}
		this.initComponent();

		Template.component.top("v13");
    };

    this.mobile = function () {
		$("*[data-menu]").each(function (i, e) {
			$(e).on('click', function () {
				var status = $(e).data('menu');

				if (status === "open") {
					$("#header-recr").addClass("showfixed");
				} else if (status === "close") {
					$("#header-recr").removeClass("showfixed");
				}
			});
		});
	};

    this.initComponent = function () {
        $('.menu-right .cta').on('click', function (e) {
            e.preventDefault();
    
            $('html, body').animate({
                scrollTop: $($(this).attr('href')).offset().top
            }, 500, 'linear');
        });
    };
};

var objectFitImages=function(){"use strict";function t(t,e){return"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='"+t+"' height='"+e+"'%3E%3C/svg%3E"}function e(t){if(t.srcset&&!m&&window.picturefill){var e=window.picturefill._;t[e.ns]&&t[e.ns].evaled||e.fillImg(t,{reselect:!0}),t[e.ns].curSrc||(t[e.ns].supported=!1,e.fillImg(t,{reselect:!0})),t.currentSrc=t[e.ns].curSrc||t.src}}function i(t){for(var e,i=getComputedStyle(t).fontFamily,r={};null!==(e=l.exec(i));)r[e[1]]=e[2];return r}function r(e,i,r){var n=t(i||1,r||0);p.call(e,"src")!==n&&b.call(e,"src",n)}function n(t,e){t.naturalWidth?e(t):setTimeout(n,100,t,e)}function c(t){var c=i(t),o=t[a];if(c["object-fit"]=c["object-fit"]||"fill",!o.img){if("fill"===c["object-fit"])return;if(!o.skipTest&&g&&!c["object-position"])return}if(!o.img){o.img=new Image(t.width,t.height),o.img.srcset=p.call(t,"data-ofi-srcset")||t.srcset,o.img.src=p.call(t,"data-ofi-src")||t.src,b.call(t,"data-ofi-src",t.src),t.srcset&&b.call(t,"data-ofi-srcset",t.srcset),r(t,t.naturalWidth||t.width,t.naturalHeight||t.height),t.srcset&&(t.srcset="");try{s(t)}catch(t){window.console&&console.warn("https://bit.ly/ofi-old-browser")}}e(o.img),t.style.backgroundImage='url("'+(o.img.currentSrc||o.img.src).replace(/"/g,'\\"')+'")',t.style.backgroundPosition=c["object-position"]||"center",t.style.backgroundRepeat="no-repeat",t.style.backgroundOrigin="content-box",/scale-down/.test(c["object-fit"])?n(o.img,function(){o.img.naturalWidth>t.width||o.img.naturalHeight>t.height?t.style.backgroundSize="contain":t.style.backgroundSize="auto"}):t.style.backgroundSize=c["object-fit"].replace("none","auto").replace("fill","100% 100%"),n(o.img,function(e){r(t,e.naturalWidth,e.naturalHeight)})}function s(t){var e={get:function(e){return t[a].img[e||"src"]},set:function(e,i){return t[a].img[i||"src"]=e,b.call(t,"data-ofi-"+i,e),c(t),e}};Object.defineProperty(t,"src",e),Object.defineProperty(t,"currentSrc",{get:function(){return e.get("currentSrc")}}),Object.defineProperty(t,"srcset",{get:function(){return e.get("srcset")},set:function(t){return e.set(t,"srcset")}})}function o(t,e){var i=!h&&!t;if(e=e||{},t=t||"img",f&&!e.skipTest||!d)return!1;"img"===t?t=document.getElementsByTagName("img"):"string"==typeof t?t=document.querySelectorAll(t):"length"in t||(t=[t]);for(var r=0;r<t.length;r++)t[r][a]=t[r][a]||{skipTest:e.skipTest},c(t[r]);i&&(document.body.addEventListener("load",function(t){"IMG"===t.target.tagName&&o(t.target,{skipTest:e.skipTest})},!0),h=!0,t="img"),e.watchMQ&&window.addEventListener("resize",o.bind(null,t,{skipTest:e.skipTest}))}var a="bfred-it:object-fit-images",l=/(object-fit|object-position)\s*:\s*([-\w\s%]+)/g,u="undefined"==typeof Image?{style:{"object-position":1}}:new Image,g="object-fit"in u.style,f="object-position"in u.style,d="background-size"in u.style,m="string"==typeof u.currentSrc,p=u.getAttribute,b=u.setAttribute,h=!1;return o.supportsObjectFit=g,o.supportsObjectPosition=f,function(){function t(t,e){return t[a]&&t[a].img&&("src"===e||"srcset"===e)?t[a].img:t}f||(HTMLImageElement.prototype.getAttribute=function(e){return p.call(t(this,e),e)},HTMLImageElement.prototype.setAttribute=function(e,i){return b.call(t(this,e),e,String(i))})}(),o}();
var Talent = new function __Talent() {
    this.setLang = function(lang) {
        if (!lang) {
            lang = "vi";
        }

        $.cookie("lang_talent", lang, {
            expires : 10 * 24 * 3600,
            path    : '/',
            domain  : "."+(Client.domain)+""
        });
    }
};var Render = new function __Render(){
	this._uis={};
	this._events={};
	this._event_queues = [];
	
	
	this.on = function(ui, render, events){
		if (AP.data.isArray(ui)){
			for (var i=0; i<ui.length; i++){
				this.on(ui[i], render, events);
			}
			return;
		}
		
		if (!events){
			events = {};
		}
		
		this._uis[ui.replace(/-/g,'_')] = render;
		this._events[ui.replace(/-/g,'_')] = events;
		
		
	};
	
	this.render = function(ui, attrs, content){
		if (!attrs.id){
			attrs.id = AP.uuid();
		}
		
		if (!this._uis[ui]){
			if (!parseInt(Client.env)){
				console.warn("NO UI render for "+ui);	
			}
			
			var obj = new BaseComponent(attrs);
			var ec = ui.replace(/_/g,'-');
			if (ec.indexOf("-")==-1){
				ec='';
			}
			
			return "<div class='base-"+(ui)+" "+(ec)+" "+(obj.get('class'))+"' "+(obj.show('id'))+" "+(obj.css())+">"+(content)+"</div>";
		}
		
		var fn = this._uis[ui];
		var obj = new BaseComponent(attrs);
		
		obj.name=ui;
		obj.content=content;
		
		attrs.name = ui;
		
		if (this._events[ui] && this._events[ui]["done"]){
			var done = this._events[ui]["done"];
			
			this._event_queues.push({fn: done, attrs: safeClone(attrs)});
		}
		
		return fn.apply(obj);
	};
	
	
	/**
	 * @desc Update based on selecotr
	 */
	this.update = function(selector, event, data){
		if (!$(selector).length){
			$.log("RENDER.update failed for event "+event+" ~ no selector found");
			return;
		}
		
		$(selector).each(function(){
			var ui = $(this).data("ui");
			if (!ui || !Render._events[ui]){
				return;
			}
			
			var ev_def = Render._events[ui];
			if (!ev_def || !ev_def[event]){
				return;
			}
			
			var cb = ev_def[event];
			
			if (AP.data.isArray(data)){
				cb.apply(this, data);	
			}else{
				cb.apply(this, [data]);
			}
			
		});
	};
	
	
	this.finish = function(){
		if (!this._event_queues.length){
			return;
		}
		
		while (true){
			if (!this._event_queues.length){
				return;
			}
			
			var ex = this._event_queues.shift();
			
			var $selector = $("#"+ex.attrs.id);
			if (!$selector.length){
				continue;
			}
			
			ex.fn.apply($selector[0], [ex.attrs]);
		}
	};
	
	
	/**
	 * @desc Safely clone objects, only with number of string, to prevent memonry leak
	 */
	function safeClone(obj){
		var r={};
		for (var key in obj){
			if (AP.data.isObject(obj[key]) || AP.data.isArray(obj[key]) || AP.data.isFunction(obj[key])){
				
			}else{
				r[key] = obj[key];
			}
		}
		
		return r;
	};
	
};


// SPECIAL

(function(){
	jquery_domChanged = function(){
		Render.finish();
	};
})();
